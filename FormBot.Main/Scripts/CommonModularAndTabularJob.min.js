function LoadInstallationSignatureLocation(e,t=0){loadMapScript(),0==t&&$("#popupMap").modal({backdrop:"static",keyboard:!1}),setTimeout(function(){$("#txtSource").focus()},1e3),$("#txtSource").val(e),$("#txtDestination").val($("#txtAddress").val()),$("#dvDistance").html(""),$("#errorMsgRegionMap").hide()}function buttonMapClick(){$("#btnMap").click(function(){$("#lblSrcMap").html("Source"),$("#txtSource").attr("placeholder","Source"),LoadInstallationSignatureLocation("")}),$("#InstallerMap").click(function(){$("#lblSrcMap").html("Geo Location"),$("#txtSource").attr("placeholder","Geo Location"),LoadInstallationSignatureLocation($("#InstallerLatLong").val())}),$("#DesignerMap").click(function(){$("#lblSrcMap").html("Geo Location"),$("#txtSource").attr("placeholder","Geo Location"),LoadInstallationSignatureLocation($("#DesignerLatLong").val())}),$("#ElectricianMap").click(function(){$("#lblSrcMap").html("Geo Location"),$("#txtSource").attr("placeholder","Geo Location"),LoadInstallationSignatureLocation($("#ElectricianLatLong").val())}),$("#OwnerMap").click(function(){$("#lblSrcMap").html("Geo Location"),$("#txtSource").attr("placeholder","Geo Location"),LoadInstallationSignatureLocation($("#OwnerLatLong").val())})}function showHideInstallationAddress(e){1==e?($(".InstallationDPA").show(),$(".InstallationPDA").hide()):($(".InstallationPDA").show(),$(".InstallationDPA").hide())}function fillInstallationAddressDetail(){showHideInstallationAddress(modelInstalltionAddressID),$("#JobInstallationDetails_AddressID").change(function(){showHideInstallationAddress($("#JobInstallationDetails_AddressID").val())}),fillInstallationAddress=function(){if("0"!=$("#BasicDetails_JobID").val()&&$("#JobInstallationDetails_Town").length>0&&""!=$("#JobInstallationDetails_Town").val().trim()&&null!=$("#JobInstallationDetails_Town").val()&&null!=$("#JobInstallationDetails_Town").val()&&$("#JobInstallationDetails_UnitTypeID").find("option").length>0&&$("#JobInstallationDetails_StreetTypeID").find("option").length>0&&$("#JobInstallationDetails_PostalAddressID").find("option").length>0){var e,t=$("#JobInstallationDetails_UnitTypeID").find("option:selected").text(),a=$("#JobInstallationDetails_UnitNumber").val(),o=$("#JobInstallationDetails_StreetNumber").val(),l=$("#JobInstallationDetails_StreetName").val(),i=$("#JobInstallationDetails_StreetTypeID").find("option:selected").text(),n=$("#JobInstallationDetails_PostalAddressID").find("option:selected").text(),s=$("#JobInstallationDetails_PostalDeliveryNumber").val(),r=$("#JobInstallationDetails_Town").val(),d=$("#JobInstallationDetails_State").val(),c=$("#JobInstallationDetails_PostCode").val();1==$("#JobInstallationDetails_AddressID").val()?(""!=a?(e=t+" "+a+"/"+o+" "+l+" "+i+", "+r+" "+d+" "+c,e=e.replace("Select","")):(e=t+" "+o+" "+l+" "+i+", "+r+" "+d+" "+c,e=e.replace("Select","")),InstallationJson.push({PostalAddressType:$("#JobInstallationDetails_AddressID").val(),UnitType:$("#JobInstallationDetails_UnitTypeID").val(),UnitNumber:$("#JobInstallationDetails_UnitNumber").val(),StreetNumber:$("#JobInstallationDetails_StreetNumber").val(),StreetName:$("#JobInstallationDetails_StreetName").val(),StreetType:$("#JobInstallationDetails_StreetTypeID").val(),Town:$("#JobInstallationDetails_Town").val(),State:$("#JobInstallationDetails_State").val(),PostCode:$("#JobInstallationDetails_PostCode").val()})):(e=n+" "+s+", "+r+" "+d+" "+c,InstallationJson.push({PostalAddressType:$("#JobInstallationDetails_AddressID").val(),PostalAddressID:$("#JobInstallationDetails_PostalAddressID").val(),PostalDeliveryNumber:$("#JobInstallationDetails_PostalDeliveryNumber").val(),Town:$("#JobInstallationDetails_Town").val(),State:$("#JobInstallationDetails_State").val(),PostCode:$("#JobInstallationDetails_PostCode").val()})),InstallationPostcodeFromjson=$("#JobInstallationDetails_PostCode").val(),e=e.replace("Select",""),"/ ,"!=e.trim()&&"/Select ,"!=e.trim()&&($("#JobInstallationDetails_AddressDisplay").val(e),$("#txtAddress").val(e),$("#spantxtAddress").hide())}DisplayInstallationAdd()},DisplayInstallationInfo(),DisplayInstallationExtraInfo()}function SameAsOwnerAddressMethod(){$("#JobInstallationDetails_IsSameAsOwnerAddress").change(function(){$(this).is(":checked")?($.each(OwnerAddressJson,function(e,t){$("#JobInstallationDetails_UnitNumber").val(t.UnitNumber),$("#JobInstallationDetails_UnitTypeID").val(t.UnitType),$("#JobInstallationDetails_StreetNumber").val(t.StreetNumber),$("#JobInstallationDetails_StreetName").val(t.StreetName),$("#JobInstallationDetails_StreetTypeID").val(t.StreetType),$("#JobInstallationDetails_Town").val(t.Town),$("#JobInstallationDetails_State").val(t.State),$("#JobInstallationDetails_PostCode").val(t.PostCode),$("#JobInstallationDetails_PostalDeliveryNumber").val(t.PostalDeliveryNumber),$("#JobInstallationDetails_PostalAddressID").val(t.PostalAddressID)}),1==$(".OwnerAddress").val()?($(".InstallationAddress").val(1),$(".InstallationDPA").show(),$(".InstallationPDA").hide()):($(".InstallationAddress").val(2),$(".InstallationPDA").show(),$(".InstallationDPA").hide()),$(".popupAddress").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$(".popupAddress").find(".field-validation-error").attr("class","field-validation-valid"),$("#spantxtAddress").hide(),$("#popupAddress").modal("toggle")):($(".popupAddress").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$(".popupAddress").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobInstallationDetails_UnitTypeID").val($("#JobInstallationDetails_UnitTypeID option:first").val()),$("#JobInstallationDetails_StreetTypeID").val($("#JobInstallationDetails_StreetTypeID option:first").val()),$("#JobInstallationDetails_PostalAddressID").val($("#JobInstallationDetails_PostalAddressID option:first").val()))})}function buttonInstallationDetailClick(){$("#btnInstallationInfo").click(function(){$("#popupInstalltionInfo").modal({backdrop:"static",keyboard:!1})}),$("#btnInstallationExtraInfo").click(function(){$("#popupInstalltionExtraInfo").modal({backdrop:"static",keyboard:!1})}),$("#btnAddressDetail").click(function(e){e.preventDefault(),$("#popupAddress").modal({backdrop:"static",keyboard:!1}),setTimeout(function(){$("#JobInstallationDetails_AddressID").focus()},1e3),$(".popupAddress").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$(".popupAddress").find(".field-validation-error").attr("class","field-validation-valid"),$.each(InstallationJson,function(e,t){$("#JobInstallationDetails_AddressID").val(t.PostalAddressType),$("#JobInstallationDetails_UnitNumber").val(t.UnitNumber),$("#JobInstallationDetails_UnitTypeID").val(t.UnitType),$("#JobInstallationDetails_StreetNumber").val(t.StreetNumber),$("#JobInstallationDetails_StreetName").val(t.StreetName),$("#JobInstallationDetails_StreetTypeID").val(t.StreetType),$("#JobInstallationDetails_Town").val(t.Town),$("#JobInstallationDetails_State").val(t.State),$("#JobInstallationDetails_PostCode").val(t.PostCode),$("#JobInstallationDetails_PostalDeliveryNumber").val(t.PostalDeliveryNumber),$("#JobInstallationDetails_PostalAddressID").val(t.PostalAddressID)}),""==$("#JobInstallationDetails_UnitTypeID option:selected").val()?($("#lblInstallationUnitNumber").removeClass("required"),$("#lblInstallationUnitTypeID").removeClass("required"),$("#lblInstallationStreetNumber").addClass("required")):($("#lblInstallationUnitNumber").addClass("required"),$("#lblInstallationUnitTypeID").addClass("required")),1==$("#JobInstallationDetails_AddressID").val()?($(".InstallationDPA").show(),$(".InstallationPDA").hide()):($(".InstallationPDA").show(),$(".InstallationDPA").hide()),$("#JobInstallationDetails_LocationValidation").hide()})}function InstallationAutoComplete(){$("#JobInstallationDetails_Town").autocomplete({minLength:3,source:function(e,t){$.ajax({type:"GET",url:actionProcessRequest,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var a=JSON.parse(e);a.localities.locality instanceof Array?t($.map(a.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}})):t($.map(a.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}}))}})},select:function(e,t){$("#JobInstallationDetails_State").val(t.item.state),$("#JobInstallationDetails_PostCode").val(t.item.postcode)}}),$("#JobInstallationDetails_PostCode").autocomplete({minLength:3,source:function(e,t){$.ajax({type:"GET",url:actionProcessRequest,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var a=JSON.parse(e);a.localities.locality instanceof Array?t($.map(a.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}})):t($.map(a.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}}))}})},select:function(e,t){$("#JobInstallationDetails_State").val(t.item.state),$("#JobInstallationDetails_Town").val(t.item.location)}})}function OwnerAutoComplete(){$("#JobOwnerDetails_Town").autocomplete({minLength:3,source:function(e,t){$.ajax({type:"GET",url:actionProcessRequest,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var a=JSON.parse(e);a.localities.locality instanceof Array?t($.map(a.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}})):t($.map(a.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}}))}})},select:function(e,t){$("#JobOwnerDetails_State").val(t.item.state),$("#JobOwnerDetails_PostCode").val(t.item.postcode),$("#JobOwnerDetails_State").valid(),$("#JobOwnerDetails_PostCode").valid()}}),$("#JobOwnerDetails_PostCode").autocomplete({minLength:3,source:function(e,t){$.ajax({type:"GET",url:actionProcessRequest,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var a=JSON.parse(e);a.localities.locality instanceof Array?t($.map(a.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}})):t($.map(a.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}}))}})},select:function(e,t){$("#JobOwnerDetails_State").val(t.item.state),$("#JobOwnerDetails_Town").val(t.item.location),$("#JobOwnerDetails_State").valid(),$("#JobOwnerDetails_Town").valid()}})}function validateOrganisation(){"Government body"==$("#JobOwnerDetails_OwnerType").val()||"Corporate body"==$("#JobOwnerDetails_OwnerType").val()||"Trustee"==$("#JobOwnerDetails_OwnerType").val()?($("#JobOwnerDetails_CompanyABN").removeAttr("disabled"),$("#JobOwnerDetails_CompanyName").removeAttr("disabled"),$("#OwnerCompanyABN").addClass("required"),$("#OwnerCompanyName").addClass("required"),$("#OwnerEmail").addClass("required"),$("#OwnerCompanyABNValidate").show(),$("#OwnerCompanyNameValidate").show(),$("#OwnerEmailValidate").show(),$("#JobOwnerDetails_CompanyName").rules("add",{required:!0,messages:{required:"Company Name is required."}}),$("#JobOwnerDetails_CompanyABN").rules("add",{required:!0,messages:{required:"Company ABN is required."}}),$("#JobOwnerDetails_Email").rules("add",{required:!0,messages:{required:"Email address is required."}})):($("#JobOwnerDetails_CompanyABN").val(""),$("#JobOwnerDetails_CompanyABN").prop("disabled",!0),$("#JobOwnerDetails_CompanyABN").rules("remove"),$("#JobOwnerDetails_CompanyABN").removeClass("input-validation-error"),$("#OwnerCompanyABN").removeClass("required"),$("#OwnerCompanyABNValidate").hide(),$("#JobOwnerDetails_CompanyName").prop("selectedIndex",0),$("#JobOwnerDetails_CompanyName").prop("disabled",!0),$("#JobOwnerDetails_CompanyName").rules("remove"),$("#JobOwnerDetails_CompanyName").removeClass("input-validation-error"),$("#OwnerCompanyName").removeClass("required"),$("#OwnerCompanyNameValidate").hide(),$("#JobOwnerDetails_Email").rules("remove"),$("#JobOwnerDetails_Email").removeClass("input-validation-error"),$("#OwnerEmail").removeClass("required"),$("#OwnerEmailValidate").hide())}function showHideOwnerAddress(e){1==e?($(".OwnerDPA").show(),$(".OwnerPDA").hide()):($(".OwnerPDA").show(),$(".OwnerDPA").hide())}function fillOwnerAddressDetail(){showHideOwnerAddress(modelOwnerAddressID),$("#JobOwnerDetails_AddressID").change(function(){showHideOwnerAddress($("#JobOwnerDetails_AddressID").val())}),fillOwnerAddress=function(){"0"!=$("#BasicDetails_JobID").val()&&$("#JobOwnerDetails_UnitTypeID").find("option").length>0&&$("#JobOwnerDetails_PostalAddressID").find("option").length>0&&$("#JobOwnerDetails_StreetTypeID").find("option").length>0&&(1==$("#JobOwnerDetails_AddressID").val()?OwnerAddressJson.push({CompanyABN:$("#JobOwnerDetails_CompanyABN").val(),OwnerType:$("#JobOwnerDetails_OwnerType").val(),CompanyName:$("#JobOwnerDetails_CompanyName").val(),Phone:$("#JobOwnerDetails_Phone").val(),Mobile:$("#JobOwnerDetails_Mobile").val(),FirstName:$("#JobOwnerDetails_FirstName").val(),LastName:$("#JobOwnerDetails_LastName").val(),Email:$("#JobOwnerDetails_Email").val(),PostalAddressType:$("#JobOwnerDetails_AddressID").val(),UnitType:$("#JobOwnerDetails_UnitTypeID").val(),UnitNumber:$("#JobOwnerDetails_UnitNumber").val(),StreetNumber:$("#JobOwnerDetails_StreetNumber").val(),StreetName:$("#JobOwnerDetails_StreetName").val(),StreetType:$("#JobOwnerDetails_StreetTypeID").val(),Town:$("#JobOwnerDetails_Town").val(),State:$("#JobOwnerDetails_State").val(),PostCode:$("#JobOwnerDetails_PostCode").val()}):OwnerAddressJson.push({CompanyABN:$("#JobOwnerDetails_CompanyABN").val(),OwnerType:$("#JobOwnerDetails_OwnerType").val(),CompanyName:$("#JobOwnerDetails_CompanyName").val(),Phone:$("#JobOwnerDetails_Phone").val(),Mobile:$("#JobOwnerDetails_Mobile").val(),FirstName:$("#JobOwnerDetails_FirstName").val(),LastName:$("#JobOwnerDetails_LastName").val(),Email:$("#JobOwnerDetails_Email").val(),PostalAddressType:$("#JobOwnerDetails_AddressID").val(),PostalAddressID:$("#JobOwnerDetails_PostalAddressID").val(),PostalDeliveryNumber:$("#JobOwnerDetails_PostalDeliveryNumber").val(),Town:$("#JobOwnerDetails_Town").val(),State:$("#JobOwnerDetails_State").val(),PostCode:$("#JobOwnerDetails_PostCode").val()}),OwnerPostcodeFromjson=$("#JobOwnerDetails_PostCode").val(),OwnerEmailFromJson=$("#JobOwnerDetails_Email").val(),OwnerFirstNameFromJson=$("#JobOwnerDetails_FirstName").val(),OwnerLastNameFromJson=$("#JobOwnerDetails_LastName").val()),DisplayOwnerAdd()}}function buttonOwnerDetailClick(){$("#btnOwnerDetails").click(function(){$("#errorMsgRegionOwnerPopup").hide(),$("#successMsgRegionInstallerPopup").hide(),$("#popupOwner").modal({backdrop:"static",keyboard:!1}),setTimeout(function(){$("#JobOwnerDetails_OwnerType").focus(),$("#JobOwnerDetails_OwnerType").change()},1e3),$(".popupOwner").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$(".popupOwner").find(".field-validation-error").attr("class","field-validation-valid"),RebindOwnerDetailsPopup(),""==$("#JobOwnerDetails_UnitTypeID option:selected").val()?($("#lblOwnerUnitNumber").removeClass("required"),$("#lblOwnerUnitTypeID").removeClass("required"),$("#lblOwnerStreetNumber").addClass("required")):($("#lblOwnerUnitNumber").addClass("required"),$("#lblOwnerUnitTypeID").addClass("required"),$("#lblOwnerStreetNumber").removeClass("required")),1==$("#JobOwnerDetails_AddressID").val()?($(".OwnerDPA").show(),$(".OwnerPDA").hide()):($(".OwnerPDA").show(),$(".OwnerDPA").hide()),$("#JobOwnerDetails_LocationValidation").hide()})}function RebindOwnerDetailsPopup(){$.each(OwnerAddressJson,function(e,t){null!=$("#JobOwnerDetails_CompanyABN").val()&&$("#JobOwnerDetails_CompanyABN").val().length>0&&GetCompanyABN($("#JobOwnerDetails_CompanyABN").val()),$("#JobOwnerDetails_OwnerType").val(t.OwnerType),""!=t.CompanyName&&($("#JobOwnerDetails_CompanyName").val(t.CompanyName),$("#JobOwnerDetails_CompanyABN").val(t.CompanyABN)),$("#JobOwnerDetails_FirstName").val(t.FirstName),$("#JobOwnerDetails_LastName").val(t.LastName),$("#JobOwnerDetails_Email").val(t.Email),$("#JobOwnerDetails_Phone").val(t.Phone),$("#JobOwnerDetails_Mobile").val(t.Mobile),$("#JobOwnerDetails_AddressID").val(t.PostalAddressType),$("#JobOwnerDetails_UnitNumber").val(t.UnitNumber),$("#JobOwnerDetails_UnitTypeID").val(t.UnitType),$("#JobOwnerDetails_StreetNumber").val(t.StreetNumber),$("#JobOwnerDetails_StreetName").val(t.StreetName),$("#JobOwnerDetails_StreetTypeID").val(t.StreetType),$("#JobOwnerDetails_Town").val(t.Town),$("#JobOwnerDetails_State").val(t.State),$("#JobOwnerDetails_PostCode").val(t.PostCode),$("#JobOwnerDetails_PostalDeliveryNumber").val(t.PostalDeliveryNumber),$("#JobOwnerDetails_PostalAddressID").val(t.PostalAddressID)})}function initializeOwnerDetails(e){$("#JobOwnerDetails_CompanyName").change(function(){$.each(e,function(e,t){t.CompanyName,$("select#JobOwnerDetails_CompanyName option:selected").val()})})}function buttonSoldByClick(){$("#btnSoldBy").click(function(){$("#popupSoldBy").modal({backdrop:"static",keyboard:!1}),""!=jsonvarSoldByDate&&$("#BasicDetails_strSoldByDate").val(jsonvarSoldByDate),$("#BasicDetails_JobSoldByText").val(jsonvarJobSoldBy)})}function DisplaySoldByDate(){var e=$("#BasicDetails_strSoldByDate").val();if(null!=e&&null!=e&&""!=e){$("#BasicDetails_strSoldByDate").val("").removeAttr("value");var t=moment(e).format(dateFormat.toUpperCase());$("#BasicDetails_strSoldByDate").val(t),$("#BasicDetails_strSoldByDate").attr("data-date-format","dd/mm/yyyy"),$("#BasicDetails_strSoldByDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){$(this).datepicker("hide")})}else $("#BasicDetails_strSoldByDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){$(this).datepicker("hide")});jsonvarSoldByDate=$("#BasicDetails_SoldByDate").val(),jsonvarJobSoldBy=$("#BasicDetails_SoldBy").val()}function DisplayInstallationDate(){var e=$("#BasicDetails_strInstallationDate").val();if(null!=e&&null!=e&&""!=e){$("#BasicDetails_strInstallationDate").val("").removeAttr("value");var t=moment(e).format(dateFormat.toUpperCase());$("#BasicDetails_strInstallationDate").val(t),$("#BasicDetails_strInstallationDate").attr("data-date-format","dd/mm/yyyy"),$(".date-pick, .date-pick1, .date-pick").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){$(this).datepicker("hide")})}else $(".date-pick, .date-pick1, .date-pick").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){$(this).datepicker("hide")})}function validateSoldBy(){if(""!=$("#BasicDetails_JobSoldByText").val()){var e=$("#BasicDetails_JobSoldByText").val(),t=$("#BasicDetails_strSoldByDate").val();$("#BasicDetails_SoldBy").val(e),$("#BasicDetails_SoldByDate").val(t),jsonvarSoldByDate=t,jsonvarJobSoldBy=$("#BasicDetails_JobSoldByText").val(),$("#popupSoldBy").modal("toggle")}else $("#spanSoldBy").show().fadeOut(5e3)}function clearSoldBy(){$("#popupSoldBy").modal("hide")}function DisplayInstallationAdd(){var e,t,a,o,l,i=$("#JobInstallationDetails_PostalAddressID").val()>0?$("#JobInstallationDetails_PostalAddressID option:selected").text():"",n=$("#JobInstallationDetails_UnitTypeID").val()>0?$("#JobInstallationDetails_UnitTypeID option:selected").text():"",s=$("#JobInstallationDetails_StreetNumber").val(),r=$("#JobInstallationDetails_StreetName").val(),d=$("#JobInstallationDetails_StreetTypeID").val()>0?$("#JobInstallationDetails_StreetTypeID option:selected").text():"",c=$("#JobInstallationDetails_PostalDeliveryNumber").val(),u=$("#JobInstallationDetails_UnitNumber").val();i=""==i||null==i?"":i,n=""==n||null==n?"":n,s=""==s||null==s?"":s,o=s+(""==r||null==r?"":" "+r)+(""==d||null==d?"":" "+d),l=$("#JobInstallationDetails_Town").val()+" "+$("#JobInstallationDetails_State").val()+" "+$("#JobInstallationDetails_PostCode").val(),1==$("#JobInstallationDetails_AddressID").val()?""!=n&&null!=n||""!=u&&null!=u?(e=n+(""==u||null==u?"":" "+u),t=o,a=l):(e=o,t=l,a=""):(e=i+(""==c||null==c?"":" "+c),t=l);var p=e+"</br>"+t+(null!=a&&""!=a&&null!=a?"</br>"+a:"");$("#installationAdd").html(p)}function DisplayOwnerAdd(){var e,t,a,o,l,i,n,s=$("#JobOwnerDetails_PostalAddressID").val()>0?$("#JobOwnerDetails_PostalAddressID option:selected").text():"",r=$("#JobOwnerDetails_UnitTypeID").val()>0?$("#JobOwnerDetails_UnitTypeID option:selected").text():"",d=$("#JobOwnerDetails_StreetNumber").val(),c=$("#JobOwnerDetails_StreetName").val(),u=$("#JobOwnerDetails_StreetTypeID").val()>0?$("#JobOwnerDetails_StreetTypeID option:selected").text():"",p=$("#JobOwnerDetails_PostalDeliveryNumber").val(),m=$("#JobOwnerDetails_UnitNumber").val();s=""==s||null==s?"":s,r=""==r||null==r?"":r,d=""==d||null==d?"":d,o=d+(""==c||null==c?"":" "+c)+(""==u||null==u?"":" "+u),l=$("#JobOwnerDetails_Town").val()+" "+$("#JobOwnerDetails_State").val()+" "+$("#JobOwnerDetails_PostCode").val(),1==$("#JobOwnerDetails_AddressID").val()?""!=r&&null!=r||""!=m&&null!=m?(e=r+(""==m||null==m?"":" "+m),t=o,a=l):(e=o,t=l,a=""):(e=s+(""==p||null==p?"":" "+p),t=l),i=$("#JobOwnerDetails_CompanyName").val(),n=$("#JobOwnerDetails_FirstName").val()+" "+$("#JobOwnerDetails_LastName").val();var D=i+"</br>"+n+"</br>"+e+"</br>"+t+(null!=a&&""!=a&&null!=a?"</br>"+a:""),b=e+","+t+(null!=a&&""!=a&&null!=a?","+a:"");$("#ownerFullAddress").html(b),$("#ownerAdd").html(D),$("#ownerTypeName").html($("#JobOwnerDetails_OwnerType").val());var v=$("#JobOwnerDetails_Email").val();$("#phoneOwner").html($("#JobOwnerDetails_Phone").val()),$("#mobileOwner").html($("#JobOwnerDetails_Mobile").val()),$(".emailOwnerA").html($("#JobOwnerDetails_Email").val()),$(".emailOwnerA").attr("href","mailto:'"+v+"'"),$(".emailOwnerA").attr("title",$("#JobOwnerDetails_Email").val())}function DisplayInstallationInfo(e){$("#JobInstallationDetails_DistributorID").val()>0?($("#lblDistributor").html($("#JobInstallationDetails_DistributorID option:selected").text()),e&&$("#lblDistributor").data("id",$("#JobInstallationDetails_DistributorID").val())):$("#lblDistributor").html(""),$("#JobInstallationDetails_ElectricityProviderID").val()>0?$("#lblElectricityProvider").html($("#JobInstallationDetails_ElectricityProviderID option:selected").text()):$("#lblElectricityProvider").html(""),$("#JobInstallationDetails_PhaseProperty").val()>0?$("#lblPhaseProperty").html($("#JobInstallationDetails_PhaseProperty option:selected").text()):$("#lblPhaseProperty").html(""),$("#lblNMI").html($("#JobInstallationDetails_NMI").val()),$("#lblMeterNumber").html($("#JobInstallationDetails_MeterNumber").val()),$("#lblLatitude").html(modelInstallationLatitude),$("#lblLongitude").html(modelInstallationLongitude)}function DisplayInstallationExtraInfo(){$("#lblOwnerHasExistingSystem").html($("#JobInstallationDetails_ExistingSystem").is(":checked")?"Yes":"No"),$("#JobInstallationDetails_ExistingSystem").is(":checked")?($("#pExistingSystemSize").show(),$("#pSystemLocation").show(),$("#pNoOfInstallationPanel").show(),$("#lblExistingSystemSize").html($("#JobInstallationDetails_ExistingSystemSize").val()),$("#lblSystemLocation").html($("#JobInstallationDetails_SystemLocation").val()),$("#lblNoOfInstallationPanel").html($("#JobInstallationDetails_NoOfPanels").val())):($("#pExistingSystemSize").hide(),$("#pSystemLocation").hide(),$("#pNoOfInstallationPanel").hide(),$("#lblExistingSystemSize").html(""),$("#lblSystemLocation").html(""),$("#lblNoOfInstallationPanel").html("")),$("#lblAdditionalInstallationInformation").html($("#JobInstallationDetails_AdditionalInstallationInformation").val()),$("#customFields").find("textarea").each(function(){$("#customDetails").find("[id="+this.id+"]").text(this.value)})}function validateOwner(){var e=addressValidationRules("JobOwnerDetails");if(e&&$("#JobOwner").valid()){var t,a,o,l,i,n=$("#JobOwnerDetails_PreviousFirstName").val(),s=$("#JobOwnerDetails_PreviousLastName").val(),r=$("#JobOwnerDetails_PreviousEmail").val(),d=$("#JobOwnerDetails_PreviousMobile").val(),c=$("#JobOwnerDetails_PreviousPhone").val(),u=$("#JobOwnerDetails_PreviousOwnerType").val(),p=$("#JobOwnerDetails_PreviousCompanyName").val(),m=$("#JobOwnerDetails_OldABNNumber").val(),D=$("#ownerFullAddress").html(),b=$("#JobOwnerDetails_PostalAddressID").val()>0?$("#JobOwnerDetails_PostalAddressID option:selected").text():"",v=$("#JobOwnerDetails_UnitTypeID").val()>0?$("#JobOwnerDetails_UnitTypeID option:selected").text():"",g=$("#JobOwnerDetails_StreetNumber").val(),w=$("#JobOwnerDetails_StreetName").val(),h=$("#JobOwnerDetails_StreetTypeID").val()>0?$("#JobOwnerDetails_StreetTypeID option:selected").text():"",I=$("#JobOwnerDetails_PostalDeliveryNumber").val(),y=$("#JobOwnerDetails_UnitNumber").val();b=""==b||null==b?"":b,v=""==v||null==v?"":v,g=""==g||null==g?"":g,l=g+(""==w||null==w?"":" "+w)+(""==h||null==h?"":" "+h),i=$("#JobOwnerDetails_Town").val()+" "+$("#JobOwnerDetails_State").val()+" "+$("#JobOwnerDetails_PostCode").val(),1==$("#JobOwnerDetails_AddressID").val()?""!=v&&null!=v||""!=y&&null!=y?(t=v+(""==y||null==y?"":" "+y),a=l,o=i):(t=l,a=i,o=""):(t=b+(""==I||null==I?"":" "+I),a=i),$("#JobOwnerDetails_CompanyName").val(),$("#JobOwnerDetails_FirstName").val()+" "+$("#JobOwnerDetails_LastName").val();var S=t+","+a+(null!=o&&""!=o&&null!=o?","+o:""),f=JSON.stringify($("#JobOwner").serializeToJson()),_=JSON.parse(f),J={};J.jobOwnerDetails=_.JobOwnerDetails,J.jobId=jobId,OwnerAddressCheck(_.JobOwnerDetails),J.jobOwnerDetails.oldOwnerAddress=D,J.jobOwnerDetails.NewOwnerAddress=S,J.isGST=$("#BasicDetails_IsGst").val(),J.jobOwnerDetails.PreviousFirstName=n,J.jobOwnerDetails.PreviousLastName=s,J.jobOwnerDetails.PreviousEmail=r,J.jobOwnerDetails.PreviousMobile=d,J.jobOwnerDetails.PreviousPhone=c,J.jobOwnerDetails.PreviousOwnerType=u,J.jobOwnerDetails.PreviousCompanyName=p,J.jobOwnerDetails.OldABNNumber=m,$.ajax({url:urlUpdateJobOwnerDetails,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(J),async:!1,success:function(e){if(e.status){var t;if(modelIsOwnerRegisteredWithGST=e.isOwnerRegisteredWithGST,OwnerAddressJson=[],"Government body"==$("#JobOwnerDetails_OwnerType").val()||"Corporate body"==$("#JobOwnerDetails_OwnerType").val()||"Trustee"==$("#JobOwnerDetails_OwnerType").val())t=$("#JobOwnerDetails_CompanyName").val();else{var a=$("#JobOwnerDetails_FirstName").val(),o=$("#JobOwnerDetails_LastName").val();t=a+" "+o}1==$("#JobOwnerDetails_AddressID").val()?$("#JobInstallationDetails_IsSameAsOwnerAddress").prop("disabled",!1):$("#JobInstallationDetails_IsSameAsOwnerAddress").prop("disabled",!0),$("#spantxtClientNames").hide(),$("#txtClientName").val(t),1==$("#JobOwnerDetails_AddressID").val()?(OwnerAddressJson.push({CompanyABN:$("#JobOwnerDetails_CompanyABN").val(),OwnerType:$("#JobOwnerDetails_OwnerType").val(),CompanyName:$("#JobOwnerDetails_CompanyName").val(),Phone:$("#JobOwnerDetails_Phone").val(),Mobile:$("#JobOwnerDetails_Mobile").val(),FirstName:$("#JobOwnerDetails_FirstName").val(),LastName:$("#JobOwnerDetails_LastName").val(),Email:$("#JobOwnerDetails_Email").val(),PostalAddressType:$("#JobOwnerDetails_AddressID").val(),UnitType:$("#JobOwnerDetails_UnitTypeID").val(),UnitNumber:$("#JobOwnerDetails_UnitNumber").val(),StreetNumber:$("#JobOwnerDetails_StreetNumber").val(),StreetName:$("#JobOwnerDetails_StreetName").val(),StreetType:$("#JobOwnerDetails_StreetTypeID").val(),Town:$("#JobOwnerDetails_Town").val(),State:$("#JobOwnerDetails_State").val(),PostCode:$("#JobOwnerDetails_PostCode").val()}),modelOwnerStreetName=$("#JobOwnerDetails_StreetName").val(),modelOwnerStreetNumber=$("#JobOwnerDetails_StreetNumber").val(),modelOwnerStreetTypeID=$("#JobOwnerDetails_StreetTypeID").val(),modelOwnerTown=$("#JobOwnerDetails_Town").val(),modelOwnerState=$("#JobOwnerDetails_State").val(),modelOwnerPostCode=$("#JobOwnerDetails_PostCode").val()):OwnerAddressJson.push({CompanyABN:$("#JobOwnerDetails_CompanyABN").val(),OwnerType:$("#JobOwnerDetails_OwnerType").val(),CompanyName:$("#JobOwnerDetails_CompanyName").val(),Phone:$("#JobOwnerDetails_Phone").val(),Mobile:$("#JobOwnerDetails_Mobile").val(),FirstName:$("#JobOwnerDetails_FirstName").val(),LastName:$("#JobOwnerDetails_LastName").val(),Email:$("#JobOwnerDetails_Email").val(),PostalAddressType:$("#JobOwnerDetails_AddressID").val(),PostalAddressID:$("#JobOwnerDetails_PostalAddressID").val(),PostalDeliveryNumber:$("#JobOwnerDetails_PostalDeliveryNumber").val(),Town:$("#JobOwnerDetails_Town").val(),State:$("#JobOwnerDetails_State").val(),PostCode:$("#JobOwnerDetails_PostCode").val()}),OwnerPostcodeFromjson=$("#JobOwnerDetails_PostCode").val(),OwnerEmailFromJson=$("#JobOwnerDetails_Email").val(),OwnerFirstNameFromJson=$("#JobOwnerDetails_FirstName").val(),OwnerLastNameFromJson=$("#JobOwnerDetails_LastName").val(),DisplayOwnerAdd(),$("#popupOwner").modal("toggle"),SavedData=CommonDataForSave();var l=$("#JobOwnerDetails_FirstName").val(),i=$("#JobOwnerDetails_LastName").val(),n=$("#JobOwnerDetails_Email").val(),s=$("#JobOwnerDetails_Mobile").val(),r=$("#JobOwnerDetails_Phone").val(),d=$("#JobOwnerDetails_OwnerType").val(),c=$("#JobOwnerDetails_CompanyName").val(),u=$("#JobOwnerDetails_CompanyABN").val();$("#JobOwnerDetails_PreviousFirstName").val(l),$("#JobOwnerDetails_PreviousLastName").val(i),$("#JobOwnerDetails_PreviousEmail").val(n),$("#JobOwnerDetails_PreviousMobile").val(s),$("#JobOwnerDetails_PreviousPhone").val(r),$("#JobOwnerDetails_PreviousOwnerType").val(d),$("#JobOwnerDetails_OldABNNumber").val(u),$("#JobOwnerDetails_PreviousCompanyName").val(c),ReloadSTCJobScreen(jobId)}else showErrorMessageForPopup(e.msg,$("#errorMsgRegionOwnerPopup"),$("#successMsgRegionOwnerPopup"));ShowHideGSTSection($("#JobInstallationDetails_PropertyType").val().toLowerCase(),$("#JobOwnerDetails_OwnerType").val().toLowerCase())}})}}function clearPopupOwner(){$(".popupOwner").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$(".popupOwner").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobOwnerDetails_UnitTypeID").val($("#JobOwnerDetails_UnitTypeID option:first").val()),$("#JobOwnerDetails_StreetTypeID").val($("#JobOwnerDetails_StreetTypeID option:first").val()),$("#JobOwnerDetails_PostalAddressID").val($("#JobOwnerDetails_PostalAddressID option:first").val()),$("#JobOwnerDetails_LocationValidation").hide()}function validateInstallation(){oldaddress=$("#JobInstallationDetails_AddressDisplay").val(),$("#JobInstallationDetails_oldInstallationAddress").val(oldaddress);var e=addressValidationRules("JobInstallationDetails");if(e&&$("#JobInstallationAddress").valid()){var t;InstallationJson=[];var a=$("#JobInstallationDetails_UnitTypeID").find("option:selected").text(),o=$("#JobInstallationDetails_UnitNumber").val(),l=$("#JobInstallationDetails_StreetNumber").val(),i=$("#JobInstallationDetails_StreetName").val(),n=$("#JobInstallationDetails_StreetTypeID").find("option:selected").text(),s=$("#JobInstallationDetails_PostalAddressID").find("option:selected").text(),r=$("#JobInstallationDetails_PostalDeliveryNumber").val(),d=$("#JobInstallationDetails_Town").val(),c=$("#JobInstallationDetails_State").val(),u=$("#JobInstallationDetails_PostCode").val();1==$("#JobInstallationDetails_AddressID").val()?(""!=o?(t=a+" "+o+"/"+l+" "+i+" "+n+", "+d+" "+c+" "+u,t=t.replace("Select","")):(t=a+" "+l+" "+i+" "+n+", "+d+" "+c+" "+u,t=t.replace("Select","")),InstallationJson.push({PostalAddressType:$("#JobInstallationDetails_AddressID").val(),UnitType:$("#JobInstallationDetails_UnitTypeID").val(),UnitNumber:$("#JobInstallationDetails_UnitNumber").val(),StreetNumber:$("#JobInstallationDetails_StreetNumber").val(),StreetName:$("#JobInstallationDetails_StreetName").val(),
StreetType:$("#JobInstallationDetails_StreetTypeID").val(),Town:$("#JobInstallationDetails_Town").val(),State:$("#JobInstallationDetails_State").val(),PostCode:$("#JobInstallationDetails_PostCode").val()})):(t=s+" "+r+", "+d+" "+c+" "+u,InstallationJson.push({PostalAddressType:$("#JobInstallationDetails_AddressID").val(),PostalAddressID:$("#JobInstallationDetails_PostalAddressID").val(),PostalDeliveryNumber:$("#JobInstallationDetails_PostalDeliveryNumber").val(),Town:$("#JobInstallationDetails_Town").val(),State:$("#JobInstallationDetails_State").val(),PostCode:$("#JobInstallationDetails_PostCode").val()})),InstallationPostcodeFromjson=$("#JobInstallationDetails_PostCode").val(),$("#JobInstallationDetails_AddressDisplay").val(t),$("#txtAddress").val(t),$("#spantxtAddress").hide(),$("#popupAddress").modal("toggle"),DisplayInstallationAdd(),getlatLongFromInstallationAddress(DisplayLatLonOfInstallationAdd,$("#txtAddress").val())}}function clearPopupInstallation(){$(".popupAddress").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$("#JobInstallationDetails_StreetTypeID").attr("class","form-control valid"),$(".popupAddress").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobInstallationDetails_UnitTypeID").val($("#JobInstallationDetails_UnitTypeID option:first").val()),$("#JobInstallationDetails_StreetTypeID").val($("#JobInstallationDetails_StreetTypeID option:first").val()),$("#JobInstallationDetails_PostalAddressID").val($("#JobInstallationDetails_PostalAddressID option:first").val()),$("#JobInstallationDetails_LocationValidation").hide()}function loadMapScript(e=0){var t,a=document.createElement("script");a.type="text/javascript",t=1!=e?JobMapKeyUrl+"&callback=mapsCallback":JobMapKeyUrl,t=t.toString().replace(/&amp;/g,"&"),a.src=t;var o=$('script[src="'+t+'"]').length;if(o<=0)a.readyState?a.onreadystatechange=function(){if(("loaded"==a.readyState||"complete"==a.readyState)&&(a.onreadystatechange=null,loadMap(e),1!=e))setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtAddress").val())},1e3)}:a.onload=function(){if(loadMap(e),1!=e)setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtAddress").val())},1e3)},document.body.appendChild(a);else if(1!=e)setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtAddress").val())},1e3)}function loadMap(e=0){1==e?new google.maps.Map(document.getElementById("dMap")):new google.maps.Map(document.getElementById("dvMap")),directionsService=new google.maps.DirectionsService,new google.maps.places.SearchBox(document.getElementById("txtSource")),new google.maps.places.SearchBox(document.getElementById("txtDestination")),directionsDisplay=new google.maps.DirectionsRenderer({draggable:!1}),google.maps.event.addListener(directionsDisplay,"directions_changed",function(){directions=directionsDisplay.getDirections();var e=directions.routes[0].legs[0].distance.text,t=directions.routes[0].legs[0].duration.text,a=directions.routes[0].legs[0].start_address,o=directions.routes[0].legs[0].end_address,l=document.getElementById("dvDistance");l.innerHTML="",l.innerHTML+="Distance: "+e+"   ",l.innerHTML+="Duration:"+t,$("#txtSource").val(a),$("#txtDestination").val(o)})}function GetRoute(e=0){if($("#dvDistance").html(""),$("#errorMsgRegionMap").hide(),source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,""!=source&&""!=destination){var t=new google.maps.LatLng(51.508742,-.12085),a={zoom:4,center:t};map=1==e?new google.maps.Map(document.getElementById("dMap"),a):new google.maps.Map(document.getElementById("dvMap"),a),directionsDisplay.setMap(map);var o={origin:source,destination:destination,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(o,function(e,t){t==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(e):(createMarker(destination,25.2744,133.7751),$("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  are not in same country."),$("#errorMsgRegionMap").show())})}else $("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  address are  required"),$("#errorMsgRegionMap").show()}function GetLocation(){latitude="",longitude="",latitude1="",longitude1="",$("#dvDistance").html(""),$("#errorMsgRegionMap").hide(),locations=[],source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,geocoder=new google.maps.Geocoder,""!=source||""!=destination?(""!=source&&geocoder.geocode({address:source},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude=e[0].geometry.location.lat(),longitude=e[0].geometry.location.lng(),sourcedetail=[source,latitude,longitude],locations.push(sourcedetail),GetLocationOnMap(latitude,longitude)):($("#errorMsgRegionMap").html(closeButton+"Invalid source Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852))}),""!=destination&&geocoder.geocode({address:destination},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude1=e[0].geometry.location.lat(),longitude1=e[0].geometry.location.lng(),destinationdetail=[destination,latitude1,longitude1],locations.push(destinationdetail),GetLocationOnMap(latitude1,longitude1)):($("#errorMsgRegionMap").html(closeButton+"Invalid Destination Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852))})):($("#errorMsgRegionMap").html(closeButton+"Source or Destination address  are  required"),$("#errorMsgRegionMap").show())}function GetLocationOnMap(e,t){var a,o,l=new google.maps.LatLngBounds,i=new google.maps.InfoWindow,n=e,s=t,r=new google.maps.Map(document.getElementById("dvMap"),{zoom:10,center:new google.maps.LatLng(n,s),mapTypeId:google.maps.MapTypeId.DRIVING});for(o=0;o<locations.length;o++)a=new google.maps.Marker({position:new google.maps.LatLng(locations[o][1],locations[o][2]),draggable:!1,map:r}),l.extend(a.position),google.maps.event.addListener(a,"click",function(e,t){return function(){i.setContent(locations[t][0]),i.open(r,e)}}(a,o));r.fitBounds(l)}function geocodeAddress(e,t=!1,a=!1){$("#errorMsgRegionMap").hide();var o=new google.maps.Geocoder;""==e.trim()?createMarker("Victoria , Australia",-37.4713,144.7852):o.geocode({address:e},function(o,l){var i=e.split(" "),n=[];if(null!=o&&null!=o[0].address_components&&o[0].address_components.length>0)for(var s=0;s<o[0].address_components.length;s++)n.push((o[0].address_components[s].long_name+",").toLowerCase());if(1==a&&null!=i[1]&&null!=i[1]&&null!=n&&null!=n&&(n.includes((i[1]+" "+i[2]).replace(",","").toLowerCase().trim()+",")?($("#errorMsgValidInstallationAddress").hide(),$("#installationAdd").css("color",""),installationAddressValidationFlag(!0)):($("#errorMsgValidInstallationAddress").html(closeButton+"Installation address does not match google street address."),$("#errorMsgValidInstallationAddress").show(),$("#installationAdd").css("color","Red"),installationAddressValidationFlag(!1))),1==t&&null!=i[1]&&null!=i[1]&&null!=n&&null!=n&&(n.includes((i[1]+" "+i[2]).replace(",","").toLowerCase().trim()+",")?($("#errorMsgValidOwnerAddress").hide(),$("#ownerAdd").css("color",""),OwnerAddressValidationFlag(!0)):($("#errorMsgValidOwnerAddress").html(closeButton+"Owner address does not match google street address."),$("#errorMsgValidOwnerAddress").show(),$("#ownerAdd").css("color","Red"),OwnerAddressValidationFlag(!1))),l==google.maps.GeocoderStatus.OK){var r=o[0].geometry.location,d=r.lat(),c=r.lng();createMarker(e,d,c)}else $("#errorMsgRegionMap").html(closeButton+"Invalid Destination Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852)})}function installationAddressValidationFlag(e){$.ajax({url:installationAddValidFlagChange,type:"post",dataType:"json",data:{isValid:e,JobId:jobId},success:function(e){},error:function(e){}})}function OwnerAddressValidationFlag(e){$.ajax({url:OwnerAddValidFlagChange,type:"post",dataType:"json",data:{isValid:e,JobId:jobId},success:function(e){},error:function(e){}})}function createMarker(e,t,a){var o=new google.maps.InfoWindow,l=new google.maps.LatLng(t,a),i=new google.maps.Map(document.getElementById("dvMap"),{zoom:12,center:new google.maps.LatLng(t,a),mapTypeId:google.maps.MapTypeId.DRIVING}),n=(new google.maps.LatLngBounds,e),s=new google.maps.Marker({position:new google.maps.LatLng(t,a),center:l,map:i,draggable:!1});google.maps.event.addListener(s,"click",function(){o.setContent(n),o.open(i,s)})}function showErrorMessage(e){$(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+e),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}function showErrorMessageForPopup(e,t,a){$(".alert").hide(),a&&a.hide(),t.html(closeButton+e),t.show()}function showSuccessMessageForPopup(e,t,a){$(".alert").hide(),a&&a.hide(),t.html(closeButton+e),t.show()}function showSuccessMessage(e){$(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+e),$("#successMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}function validateInstallationInfo(){$("#JobInstallationDetailInfo").valid()&&(DisplayInstallationInfo(),$("#popupInstalltionInfo").modal("toggle"))}function validateInstallationExtraInfo(){DisplayInstallationExtraInfo(),$("#popupInstalltionExtraInfo").modal("toggle")}function clearInstallationInfo(){$("#installtionInfo").find("input[type=text]").each(function(){$(this).val("")}),$("#installtionInfo").find("select ").each(function(){$(this).val("")})}function clearInstallationExtraInfo(){$("#installtionExtraInfo").find("input[type=text]").each(function(){$(this).val("")}),$("#installtionExtraInfo").find("textarea").each(function(){$(this).val("")}),$("#installtionExtraInfo").find("input[type=checkbox]").each(function(){$(this).prop("checked",!1).trigger("change")})}function getLatitudeLongitude(e,t){"undefined"!=typeof google&&(geocoder=new google.maps.Geocoder,geocoder&&geocoder.geocode({address:t},function(t,a){a==google.maps.GeocoderStatus.OK?e(t[0]):e(null)}))}function getlatLongFromInstallationAddress(e,t){if("undefined"==typeof google){var a=document.createElement("script");a.type="text/javascript";var o=JobMapKeyUrl;o=o.toString().replace(/&amp;/g,"&"),a.src=o,document.body.appendChild(a)}setTimeout(function(){getLatitudeLongitude(e,t)},1e3)}function DisplayLatLonOfInstallationAdd(e){null==e?($("#lblLatitude").html(""),$("#lblLongitude").html("")):($("#lblLatitude").html(e.geometry.location.lat()),$("#lblLongitude").html(e.geometry.location.lng()))}function ShowHideOtherInstalltionInfo(e){1==$(e).attr("isShow")?($("#otherInstalltionInfo").hide(),$(e).attr("isShow","0"),$(e).html("Show More")):($("#otherInstalltionInfo").show(),$(e).attr("isShow","1"),$(e).html("Show Less"))}function OwnerHasExistingSystem(e){"false"==e.toString().toLowerCase()?$("#ExistingSystem").hide():$("#ExistingSystem").show()}function isValidPhone(e,t){return!!e.ctrlKey||(43==e.which&&$("#"+t.id).val().length<2&&-1==$("#"+t.id).val().indexOf("+")||!(e.which>31&&(e.which<48||e.which>57)))}function GSTFileUpload(){var e=modelGuid,t=e,a=actionUploadInvoice;$("#uploadGSTFile").fileupload({url:a,dataType:"json",done:function(e,a){var o=[];o.length=0;var l=[];l.length=0;var i=[];i.length=0;for(var n=0;n<a.result.length;n++)if(1==a.result[n].Status){""!=$("#BasicDetails_GSTDocument").val()&&null!=$("#BasicDetails_GSTDocument").val()&&null!=$("#BasicDetails_GSTDocument").val()?$("#BasicDetails_GSTDocument").attr("OldFileName",$("#BasicDetails_GSTDocument").val()):$("#BasicDetails_GSTDocument").attr("OldFileName","");var s=document.getElementsByName("BasicDetails.GSTDocument"),r=$("#BasicDetails_GSTDocument").attr("OldFileName");if(s.length>0){var d=s[0].defaultValue;null==d||""==d||""!=r&&null!=r&&null!=r||DeleteGSTFile(d,t),$("#tblDocuments").find("tr").each(function(){$(this).remove()})}var c=a.result[n].MimeType.split("/"),u=c[0],p="<tr style='margin-top:30px' id= "+a.result[n].FileName.replace("%","$")+" >";p+='<td class="col-sm-9" style="color:#494949;border-bottom:0px !important">'+a.result[n].FileName.replace("%","$")+" </td>",p+="image"==u?'<td  class="col-sm-1 action" style="color:blue;border-bottom:0px !important; padding:0px;"><a id="'+a.result[n].FileName.replace("%","$")+'" style="cursor: pointer" class="'+a.result[n].FileName.replace("%","$")+' sprite-img view" title="Preview" onclick="OpenGSTDocument(this)"></a></td>':'<td  class="col-sm-1 action" style="color:blue;border-bottom:0px !important; padding:0px;"><a style="cursor: pointer" id="'+a.result[n].FileName.replace("%","$")+'" title="Download" onclick="DownloadGSTDocument(this)" class="'+a.result[n].FileName.replace("%","$")+' sprite-img view"></a></td>',p+='<td class="col-sm-1 action" style="color:blue;border-bottom:0px !important; padding:0px;"><a style="cursor: pointer" id="'+a.result[n].FileName.replace("%","$")+'" title="Delete" onclick="DeleteGSTDocument(this)" class="sprite-img delete GSTDocumentDelete"></a></td>',p+="</tr>",$("#tblDocuments").append(p),$("#BasicDetails_GSTDocument").val(a.result[n].FileName.replace("%","$"))}else 0==a.result[n].Status&&"File Type Not Allowed."==a.result[n].Message?i.push(a.result[n].FileName):0==a.result[n].Status&&"BigName"==a.result[n].Message?l.push(a.result[n].FileName.replace("%","$")):o.push(a.result[n].FileName.replace("%","$"));o.length>0&&($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+o.length+" File has not been uploaded."),$("#errorMsgRegion").show()),i.length>0&&($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+i.length+" Uploaded file type is not supported."),$("#errorMsgRegion").show()),l.length>0&&($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+l.length+" Uploaded filename is too big."),$("#errorMsgRegion").show()),0==l.length&&0==i.length&&0==o.length&&($(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+"File has been uploaded successfully."),$("#successMsgRegion").show()),ReloadSTCJobScreen(t)},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>500)return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Please upload small filename."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(t.files[a].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}else if(t.files[0].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{guid:e,jobId:t,isGSTDocument:1},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function DeleteGSTFile(e,t,a){$.ajax({url:actionDeleteGSTFile,data:{fileName:e,FolderName:t,OldInvoiceFile:a},contentType:"application/json",method:"get",async:!1,success:function(e){return!1}})}function DeleteGSTDocument(e,t){var a=$(e).attr("id"),o=modelGuid,l=$(e).attr("oldFileName"),i=!1;i=!t||confirm("Are you sure you want to delete this file ?"),i&&$.ajax({url:actionDeleteGSTFile,data:{fileName:a,FolderName:o,OldInvoiceFile:l},contentType:"application/json",method:"get",success:function(){return $("#tblDocuments").find("tr").each(function(){$(this).remove()}),$("#BasicDetails_GSTDocument").val(""),ReloadSTCJobScreen(modelGuid),!1}})}function OpenGSTDocument(e){var t=modelGuid,a=modelUploadedDocumentPath,o=$(e).attr("id"),l=a+"/JobDocuments/"+t+"/GST/"+o;$("#loading-image").css("display",""),$("#imgViewImage").attr("src",l).load(function(){logoWidthGST=this.width,logoHeightGST=this.height,$("#popupProof").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeightGST?($("#imgViewImage").closest("div").height($(window).height()-205),$("#imgViewImage").closest("div").css("overflow-y","scroll"),$("#imgViewImage").height(logoHeightGST)):($("#imgViewImage").height(logoHeightGST),$("#imgViewImage").closest("div").removeAttr("style")),screen.width<=logoWidthGST||logoWidthGST>=screen.width-250?($("#popupProof").find(".modal-dialog").width(screen.width-250),$("#imgViewImage").width(logoWidthGST)):($("#imgViewImage").width(logoWidthGST),$("#popupProof").find(".modal-dialog").width(logoWidthGST)),$("#loading-image").css("display","none")}),$("#imgViewImage").unbind("error"),$("#imgViewImage").attr("src",l).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}function DownloadGSTDocument(e){var t=modelGuid,a=$(e).attr("id");window.location.href=actionDownloadGSTDocument+"?FileName="+escape(a)+"&FolderName="+t}function SaveCustomField(){var e=[];$.each($("#customFieldForm").find("input[type=text]"),function(){e.push({VisitCheckListItemId:$(this).attr("visitchecklistitemid"),FieldValue:$(this).val()})}),e.length>0&&$.ajax({type:"POST",url:actionSaveCustomField,dataType:"json",data:{customFields:JSON.stringify(e)},success:function(e){e.status?$.get(actionReloadCustomFields+"?jobId="+modelJobId,function(e){$("#reloadCustomJobField").empty(),$("#reloadCustomJobField").append(e),showSuccessMessage("Custom fields have been saved."),$("#popupCustomField").modal("toggle"),DistinctCustomField()}):showErrorMessage(e.error)},error:function(e){showErrorMessage("Custom fields have not been saved."+e)}})}function ClearCustomField(){$("#customFieldForm").find("input[type=text]").each(function(){$(this).val("")})}function ReloadCustomField(){$.get(actionGetJobCustomFields+"?jobId="+modelJobId,function(e){$("#customFieldForm").empty(),$("#customFieldForm").append(e),$("#popupCustomField").modal({backdrop:"static",keyboard:!1})})}function DistinctCustomField(){$("#reloadCustomJobField").find("p").length>0?$(".jobCustomField").show():$(".jobCustomField").hide();var e=[],t=[];if($.each($("#reloadCustomJobField").find("p"),function(){-1!==$.inArray($(this).attr("fieldId"),e)?t.push({visitchecklistitemid:$(this).attr("visitchecklistitemid"),fieldId:$(this).attr("fieldId"),fieldValue:$(this).find("span").text()}):e.push($(this).attr("fieldId"))}),t.length>0)for(var a=0;a<t.length;a++)$.each($("#reloadCustomJobField").find("p"),function(){if($(this).attr("visitchecklistitemid")==t[a].visitchecklistitemid){var e=t[a].fieldValue,o=t[a].fieldId;$.each($("#reloadCustomJobField").find("p"),function(){$(this).attr("fieldId")==o&&$(this).find("span").text($(this).find("span").text()+" "+e)}),$(this).hide()}})}function SendEmailSignature(){$("#errorMsgRegionSignaturePopup").hide(),$("#successMsgRegionSignaturePopup").hide();var e,t,a,o,l=$("[name=optType]:checked").val(),i=$("#drpSendMail").val(),n=$("#BasicDetails_JobType").val(),s="",r="";if("S"==l){if("2"==i){if(1==n?(e=$("#InstallerView_Mobile").val().trim(),s=$("#InstallerView_FirstName").val(),r=$("#InstallerView_LastName").val()):(e=$("#JobInstallerDetails_Mobile").val().trim(),s=$("#JobInstallerDetails_FirstName").val(),r=$("#JobInstallerDetails_LastName").val()),o="No",1==n&&""==$("#InstallerView_Mobile").val().trim())return $("#errorMsgRegionSignaturePopup").html("Installer Mobile Number is required."),$("#errorMsgRegionSignaturePopup").show(),!1;if(2==n&&""==$("#JobInstallerDetails_Mobile").val().trim())return $("#errorMsgRegionSignaturePopup").html("Installer Mobile Number is required."),$("#errorMsgRegionSignaturePopup").show(),!1}else if("1"==i){if(e=$("#mobileOwner").text().trim(),o="Yes",s=$("#JobOwnerDetails_FirstName").val(),r=$("#JobOwnerDetails_LastName").val(),""==$("#mobileOwner").text().trim())return $("#errorMsgRegionSignaturePopup").html("Owner Mobile Number is required."),$("#errorMsgRegionSignaturePopup").show(),!1}else if("4"==i){if(e=$("#DesignerView_Mobile").val().trim(),s=$("#DesignerView_FirstName").val(),r=$("#DesignerView_LastName").val(),o="No",""==$("#DesignerView_Mobile").val().trim())return $("#errorMsgRegionSignaturePopup").html("Designer Mobile Number is required."),$("#errorMsgRegionSignaturePopup").show(),!1}else if("3"==i&&(e=$("#JobElectricians_Mobile").val().trim(),s=$("#JobElectricians_FirstName").val(),r=$("#JobElectricians_LastName").val(),o="No",""==$("#JobElectricians_Mobile").val().trim()))return $("#errorMsgRegionSignaturePopup").html("Electrician Mobile Number is required."),$("#errorMsgRegionSignaturePopup").show(),!1}else"2"==i?(1==n?(t=$("#InstallerView_Email").val(),s=$("#InstallerView_FirstName").val(),r=$("#InstallerView_LastName").val()):(t=$("#JobInstallerDetails_Email").val(),s=$("#JobInstallerDetails_FirstName").val(),r=$("#JobInstallerDetails_LastName").val()),a="Installer Email is required for it.",o="No"):"1"==i?(t=$("#JobOwnerDetails_Email").val(),a="Owner Email is required for it.",o="Yes",s=$("#JobOwnerDetails_FirstName").val(),r=$("#JobOwnerDetails_LastName").val()):"4"==i?(t=$("#DesignerView_Email").val(),a="Designer Email is required for it.",o="No",s=$("#DesignerView_FirstName").val(),r=$("#DesignerView_LastName").val()):"3"==i&&(t=$("#JobElectricians_Email").val(),a="Electrician Email is required for it.",o="No",s=$("#JobElectricians_FirstName").val(),r=$("#JobElectricians_LastName").val());if("S"==l&&""!=e&&null!=e&&null!=e||"M"==l&&""!=t&&null!=t&&null!=t){var d,c=$("#BasicDetails_CompanyName").val(),u=$("#resellerName").text(),p=id,m=$("#txtAddress").val();"1"==i?d=loginLink+"Job/_OwnerSignature/"+p:"2"==i?d=loginLink+"Job/_InstallerSignature?Id="+p:"3"==i?d=loginLink+"Job/_ElectricianSignature/"+p:"4"==i&&(d=loginLink+"Job/_DesignerSignature/"+p);var D=new Date,b=D.getMonth()+1+"%2F"+D.getDate()+"%2F"+D.getFullYear()+"%20"+D.getHours()+"%3A"+D.getMinutes()+"%3A"+D.getSeconds();if("2"==i){var v="";v="S"==l?d+"&Type="+n+"&SMSOrMail="+l:'<a href="'+d+"&Type="+n+"&SMSOrMail="+l+"&LinkSentedDateTime="+b+'">'+d+"&Type="+n+"&SMSOrMail="+l+"&LinkSentedDateTime="+b+"</a>";var g=t;$.ajax({url:actionMailForCollectSignature,data:{MailUrl:v,MailTo:g,JobType:n,IsOwner:o,FirstName:s,LastName:r,Type:l,url:v,mobile:e,IsClassicJob:!1,jobId:modelJobId,Reseller:u,solarCompany:c,installationAddress:m},contentType:"application/json",method:"get",success:function(e){if(1==e){if($(".alert").hide(),$("#successMsgRegionSignaturePopup").html("S"==l?"SMS has been sent successfully.":"Mail has been sent successfully."))return $("#successMsgRegionSignaturePopup").html("S"==l?"SMS has been sent successfully.":"Mail has been sent successfully."),$("#successMsgRegionSignaturePopup").show(),!1;$(".alert").hide(),$("#errorMsgRegionSignaturePopup").html("S"==l?"SMS has not been sent.":"Mail has not been sent."),$("#errorMsgRegionSignaturePopup").show()}else $("#successMsgRegionSignaturePopup").html("S"==l?"SMS has been sent successfully.":"Mail has been sent successfully.")||($(".alert").hide(),$("#errorMsgRegionSignaturePopup").html("S"==l?"SMS has not been sent.":"Mail has not been sent."),$("#errorMsgRegionSignaturePopup").show())}})}else{v="";v="S"==l?d+"?Type="+n+"&SMSOrMail="+l:'<a href="'+d+"?Type="+n+"&SMSOrMail="+l+"&LinkSentedDateTime="+b+'">'+d+"&Type="+n+"&SMSOrMail="+l+"&LinkSentedDateTime="+b+"</a>";g=t;$.ajax({url:actionMailForCollectSignature,data:{MailUrl:v,MailTo:g,JobType:n,IsOwner:o,FirstName:s,LastName:r,Type:l,url:v,mobile:e,IsClassicJob:!1,jobId:modelJobId,Reseller:u,solarCompany:c,installationAddress:m},contentType:"application/json",method:"get",success:function(e){if(1==e)return $(".alert").hide(),$("#successMsgRegionSignaturePopup").html("S"==l?"SMS has been sent successfully.":"Mail has been sent successfully."),$("#successMsgRegionSignaturePopup").show(),!1;$(".alert").hide(),$("#errorMsgRegionSignaturePopup").html("S"==l?"SMS has not been sent.":"Mail has not been sent."),$("#errorMsgRegionSignaturePopup").show()}})}}else $("#errorMsgRegionSignaturePopup").html(a),$("#errorMsgRegionSignaturePopup").show()}function SerialNumbersValidation(e,t){var a=!1,o=!1;if(null!=e.val()){if(""!=e.val().trim()){var l=e.val().trim(),i=l.split("\n");i=i.filter(function(e){return e.length>0});i.length;for(var n=0;n<i.length;n++)if(i[n].length>100){a=!0;break}isDuplicateSerialNumber=hasDuplicates(i)}return a?t.show().text("Serial numbers's maximum length  is of 100 characters."):IsHaveInvelidChar(e.val().trim())?(o=!0,t.show().text("There are some illegal characters in the serial number field.Job cannot be traded until these are amended with the correct serials.")):t.hide(),!(a||isDuplicateSerialNumber||o)}}function hasDuplicates(e){for(var t=[],a=0;a<e.length;++a){var o=e[a];if(-1!==t.indexOf(o))return!0;t.push(o)}return!1}function showhideFailedCode(e){""==e||"No"==e?($(".DivFailedAccreditationCode").hide(),$(".failedReasonDiv").hide(),$("#JobSTCDetails_FailedReason").val(""),$("#JobSTCDetails_FailedAccreditationCode").val("")):"Yes"==e&&($(".DivFailedAccreditationCode").show(),$(".failedReasonDiv").show())}function showhideAdditionalCapacityNotes(){"New"!=$("#JobInstallationDetails_InstallingNewPanel").val()&&""!=$("#JobInstallationDetails_InstallingNewPanel").val()?$("#additionalCapacityNotes").show():($("#JobSTCDetails_AdditionalCapacityNotes").text(""),$("#additionalCapacityNotes").hide())}function showhideAdditionalLocationInformation(){"No"!=$("#JobSTCDetails_MultipleSGUAddress").val()&&""!=$("#JobSTCDetails_MultipleSGUAddress").val()?$("#STCAdditionalLocation").show():($("#JobSTCDetails_AdditionalLocationInformation").text(""),$("#STCAdditionalLocation").hide())}function GetserialnumberWithSpvStatus(){$.ajax({url:urlGetserialnumberWithSpvStatus,data:{jobId:Model_JobID},dataType:"json",success:function(e){e.status&&(serialNumber=e.serialNumber)}})}function RemoveSPVRelatedClass(){$("div.line-no").removeClass("verified"),$("div.line-no").removeClass("unverified"),$("div.line-no").removeClass("installationVerified"),$("div.line-no").removeClass("notverified")}function AttachSPVLabelWithSerialNumber(){for(var e=null==$("#JobSystemDetails_SerialNumbers").val()?"":$("#JobSystemDetails_SerialNumbers").val().split(/\n/g),t=0;t<e.length;t++){var a=serialNumber.find(a=>a.SerialNumber==e[t]);null!=a?a.IsSPVInstallationVerified?$(".panel-list div.line-no.l-"+(t+1)).addClass("installationVerified"):a.IsVerified?$(".panel-list div.line-no.l-"+(t+1)).addClass("verified"):null==a.IsVerified?$(".panel-list div.line-no.l-"+(t+1)).addClass("unverified"):$(".panel-list div.line-no.l-"+(t+1)).addClass("notverified"):$(".panel-list div.line-no.l-"+(t+1)).addClass("unverified")}}function VerifyUnVerifySerialNumber(){GetserialnumberWithSpvStatus(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?ShowSPV():HideSPV()}function SPVProductverification(e=!1){if(""==$("#JobSystemDetails_SerialNumbers").val().trim())return alert("Please enter serial number for do Product Verification."),!1;$("#JobSystemDetails_SerialNumbers").removeAttr("disabled");var t=$("#JobSystemDetails_SerialNumbers").val($("#JobSystemDetails_SerialNumbers").val().trim()).serializeToJson();$("#JobSystemDetails_SerialNumbers").attr("disabled","disabled"),$.ajax({url:urlSPVProductVerification,type:"GET",data:{jobId:Model_JobID,serialNumber:JSON.stringify(t),reProductVerification:e},dataType:"json",success:function(e){if(e.status)$(".alert").hide(),$("#successSPVProductVerification").html(closeButton+"Verify serialnumber successfully"),$("#successSPVProductVerification").show(),serialNumber=e.serialNumber,VerifyUnVerifySerialNumber();else{if($(".alert").hide(),e.IsInstallationVerification)$("#errorSPVProductVerification").html(closeButton+"There are serial numbers listed which are already SPV Installation Verified.So, SPV verify cannot be done.");else if(e.IsPhotoUnAvailable){var t="";null!=e.lstNotExistPhoto&&e.lstNotExistPhoto.length>0&&(t=e.lstNotExistPhoto.join()),$("#errorSPVProductVerification").html(closeButton+"There are serial numbers ["+t+"] listed that do not have matching photos associated. SPV verify cannot be completed.")}else $("#errorSPVProductVerification").html(closeButton+"Something wrong happen in verifying serial number.");$("#errorSPVProductVerification").show()}}})}function SPVProductionVerificationErrorLog(){$("#spvproduct-failure-reason-div").load(urlGetSPVProductionVerificationErrorLog+"?jobId="+$("#BasicDetails_JobID").val(),function(){$("#spvproduct-verification-failure-reason").modal({backdrop:"static",keyboard:!1}),$("#errorMsgRegionSPVProductFailure").hide()})}function GetARoute(){if($("#dDistance").html(""),$("#MapErrorMsgRegion").hide(),source=document.getElementById("txtSrc").value,destination=document.getElementById("txtDest").value,""!=source&&""!=destination){var e=new google.maps.LatLng(51.508742,-.12085),t={zoom:4,center:e};map=new google.maps.Map(document.getElementById("dMap"),t),directionsDisplay.setMap(map);var a={origin:source,destination:destination,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(a,function(e,t){t==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(e):(createAMarker(destination,25.2744,133.7751),$("#MapErrorMsgRegion").html(closeButton+" Both Source and Destination  are not in same country."),$("#MapErrorMsgRegion").show())})}else $("#MapErrorMsgRegion").html(closeButton+" Both Source and Destination  address are  required"),$("#MapErrorMsgRegion").show()}function GetALocation(){latitude="",longitude="",latitude1="",longitude1="",$("#dDistance").html(""),$("#MapErrorMsgRegion").hide(),locations=[],source=document.getElementById("txtSrc").value,destination=document.getElementById("txtDest").value,geocoder=new google.maps.Geocoder,""!=source||""!=destination?(""!=source&&geocoder.geocode({address:source},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude=e[0].geometry.location.lat(),longitude=e[0].geometry.location.lng(),sourcedetail=[source,latitude,longitude],locations.push(sourcedetail),GetALocationOnMap(latitude,longitude)):($("#MapErrorMsgRegion").html(closeButton+"Invalid source Address."),$("#MapErrorMsgRegion").show(),createAMarker("Victoria , Australia",-37.4713,144.7852))}),""!=destination&&geocoder.geocode({address:destination},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude1=e[0].geometry.location.lat(),longitude1=e[0].geometry.location.lng(),destinationdetail=[destination,latitude1,longitude1],locations.push(destinationdetail),GetALocationOnMap(latitude1,longitude1)):($("#MapErrorMsgRegion").html(closeButton+"Invalid Installation Address."),$("#MapErrorMsgRegion").show(),createAMarker("Victoria , Australia",-37.4713,144.7852))})):($("#MapErrorMsgRegion").html(closeButton+"Source or Destination address  are  required"),$("#MapErrorMsgRegion").show())}function GetALocationOnMap(e,t){var a,o,l=new google.maps.LatLngBounds,i=new google.maps.InfoWindow,n=e,s=t,r=new google.maps.Map(document.getElementById("dMap"),{zoom:10,center:new google.maps.LatLng(n,s),mapTypeId:google.maps.MapTypeId.DRIVING});for(o=0;o<locations.length;o++)a=new google.maps.Marker({
position:new google.maps.LatLng(locations[o][1],locations[o][2]),draggable:!1,map:r}),l.extend(a.position),google.maps.event.addListener(a,"click",function(e,t){return function(){i.setContent(locations[t][0]),i.open(r,e)}}(a,o));r.fitBounds(l)}function createAMarker(e,t,a){var o=new google.maps.InfoWindow,l=new google.maps.LatLng(t,a),i=new google.maps.Map(document.getElementById("dMap"),{zoom:12,center:new google.maps.LatLng(t,a),mapTypeId:google.maps.MapTypeId.DRIVING}),n=(new google.maps.LatLngBounds,e),s=new google.maps.Marker({position:new google.maps.LatLng(t,a),center:l,map:i,draggable:!1});google.maps.event.addListener(s,"click",function(){o.setContent(n),o.open(i,s)})}function GetCompanyABN(e){$.ajax({type:"GET",url:urlGetCompanyABN,data:{id:e},contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){if(0!=e){$("#JobOwnerDetails_CompanyName option").length>1?($("#JobOwnerDetails_CompanyName").empty(),$("#JobOwnerDetails_CompanyName").append($("<option></option>").val("").html("Select")),$.each(e,function(e,t){$("#JobOwnerDetails_CompanyName").append($("<option></option>").val(t.CompanyName).html(t.CompanyName))})):$.each(e,function(e,t){$("#JobOwnerDetails_CompanyName").append($("<option></option>").val(t.CompanyName).html(t.CompanyName))}),initializeOwnerDetails(e);var t=modelOwnerCompanyName;if(-1!=t.indexOf("&#39"))t=t.replace(/&#39;/g,"'");else if(-1!=t.indexOf("&amp"))t=t.replace(/&amp;/g,"&");else if(-1!=t.indexOf("&quot"))t=t.replace(/&quot;/g,'"');else if(-1!=t.indexOf("&lt"))t=t.replace(/&lt;/g,"<");else if(-1!=t.indexOf("&gt"))t=t.replace(/&gt;/g,">");return $("#JobOwnerDetails_CompanyName").val(t),e}$("#JobOwnerDetails_CompanyName").empty(),$("#JobOwnerDetails_CompanyName").append($("<option></option>").val("").html("Select"))}})}function deemingPeriodCallBack(e){0!=modelSTCDeemingPeriod&&null!=modelSTCDeemingPeriod&&""!=modelSTCDeemingPeriod||$("#JobSTCDetails_DeemingPeriod").val($("#JobSTCDetails_DeemingPeriod option:last").val())}function BindDeemingPeriodDropdown(e,t){$.ajax({type:"get",url:urlGetDeemingPeriod,dataType:"json",data:{year:e},async:!1,success:function(e){$("#JobSTCDetails_DeemingPeriod").html(""),$.each(e,function(e,t){$("#JobSTCDetails_DeemingPeriod").append('<option value="'+t.Value+'">'+t.Text+"</option>")}),0!=t?document.getElementById("JobSTCDetails_DeemingPeriod").value=t:$("#JobSTCDetails_DeemingPeriod").val($("#JobSTCDetails_DeemingPeriod option:last").val())},error:function(e){alert("Failed to retrieve DeemingPeriod."+e)}})}function ShowHideGSTSection(e,t){2==tempIsRegisteredWithGST&&"true"==modelIsRegisteredWithGST?($(".isGSTRegistered").show(),$("#jobGST").show(),$("#BasicDetails_IsGst").val(!0)):1==tempIsRegisteredWithGST&&"true"==modelIsRegisteredWithGST?"corporate body"==t||"trustee"==t?null!=modelIsOwnerRegisteredWithGST&&"true"==modelIsOwnerRegisteredWithGST.toString().toLowerCase()?($(".isGSTRegistered").show(),$("#jobGST").show(),$("#BasicDetails_IsGst").val(!0)):($(".isGSTRegistered").hide(),$("#BasicDetails_IsGst").val(!1)):"commercial"==e||"school"==e?($(".isGSTRegistered").show(),$("#jobGST").show(),$("#BasicDetails_IsGst").val(!0)):($(".isGSTRegistered").hide(),$("#BasicDetails_IsGst").val(!1)):($(".isGSTRegistered").hide(),$("#BasicDetails_IsGst").val(!1),$("#BasicDetails_IsGst").val(!1))}function ShowSPV(){AttachSPVLabelWithSerialNumber(),$(".isSPVRequired").show(),$("#SPVLabel").show(),IsSPVRequired="True",$("#btnSPVProductVerification").show(),$("#btnSPVProductVerificationErrorLog").show()}function HideSPV(){RemoveSPVRelatedClass(),$(".isSPVRequired").hide(),$("#SPVLabel").hide(),IsSPVRequired="False",$("#btnSPVProductVerification").hide(),$("#btnSPVProductVerificationErrorLog").hide()}function CheckInstallationAddressIsValidOrNot(){if(""==jobInsd_IsInstallationAddressValid){var e,t=$("#JobInstallationDetails_UnitTypeID").find("option:selected").text(),a=$("#JobInstallationDetails_UnitNumber").val(),o=$("#JobInstallationDetails_StreetNumber").val(),l=$("#JobInstallationDetails_StreetName").val(),i=$("#JobInstallationDetails_StreetTypeID").find("option:selected").text(),n=($("#JobInstallationDetails_PostalAddressID").find("option:selected").text(),$("#JobInstallationDetails_PostalDeliveryNumber").val(),$("#JobInstallationDetails_Town").val()),s=$("#JobInstallationDetails_State").val(),r=$("#JobInstallationDetails_PostCode").val();if(1==$("#JobInstallationDetails_AddressID").val()){if(""!=a&&""!=t?(e=t+" "+a+"/"+o+" "+l+" "+i+", "+n+" "+s+" "+r,e=e.replace("Select","")):(e=o+" "+l+" "+i+", "+n+" "+s+" "+r,e=e.replace("Select","")),e=e.replace("Select",""),"undefined"==typeof google){var d=document.createElement("script");d.type="text/javascript",d.async=!0;var c=JobMapKeyUrl;c=c.toString().replace(/&amp;/g,"&"),d.src=c,document.body.appendChild(d)}setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress(e,!1,!0)},3e3),$("#errorMsgRegionMap").hide()}}else"False"==jobInsd_IsInstallationAddressValid&&1==ProjectSession_UserTypeId?($("#errorMsgValidInstallationAddress").html(closeButton+"Installation address does not match google street address."),$("#errorMsgValidInstallationAddress").show(),$("#installationAdd").css("color","Red")):($("#errorMsgValidInstallationAddress").hide(),$("#installationAdd").css("color",""))}function CheckOwnerAddressIsValidOrNot(){if(""==jobOwd_IsOwnerAddressValid){var e,t=$("#JobOwnerDetails_UnitTypeID").find("option:selected").text(),a=$("#JobOwnerDetails_UnitNumber").val(),o=$("#JobOwnerDetails_StreetNumber").val(),l=$("#JobOwnerDetails_StreetName").val(),i=$("#JobOwnerDetails_StreetTypeID").find("option:selected").text(),n=$("#JobOwnerDetails_Town").val(),s=$("#JobOwnerDetails_State").val(),r=$("#JobOwnerDetails_PostCode").val();if(1==$("#JobOwnerDetails_AddressID").val()){if(""!=a&&""!=t?(e=t+" "+a+"/"+o+" "+l+" "+i+", "+n+" "+s+" "+r,e=e.replace("Select","")):(e=o+" "+l+" "+i+", "+n+" "+s+" "+r,e=e.replace("Select","")),e=e.replace("Select",""),"undefined"==typeof google){var d=document.createElement("script");d.type="text/javascript",d.async=!0;var c=JobMapKeyUrl;c=c.toString().replace(/&amp;/g,"&"),d.src=c,document.body.appendChild(d)}setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress(e,!0,!1)},2e3),$("#errorMsgRegionMap").hide()}}else"False"==jobOwd_IsOwnerAddressValid&&1==ProjectSession_UserTypeId?($("#errorMsgValidOwnerAddress").html(closeButton+"Owner address does not match google street address."),$("#errorMsgValidOwnerAddress").show(),$("#ownerAdd").css("color","Red")):($("#errorMsgValidOwnerAddress").hide(),$("#ownerAdd").css("color",""))}function installationAddressChangeCheck(e){var t=modelInstallationStreetNumber+", "+modelInstallationStreetName+" "+modelInstallationStreetTypeID+", "+modelInstallationTown+" "+modelInstallationState+" "+modelInstallationPostCode,a=$("#JobInstallationDetails_StreetTypeID").find("option:selected").text(),o=e.StreetNumber+", "+e.StreetName+" "+e.StreetTypeID+", "+e.Town+" "+e.State+" "+e.PostCode;if(t.toLowerCase()!=o.toLowerCase()){if(o=e.StreetNumber.toString().trim()+", "+e.StreetName.toString().trim()+" "+a.toString().trim()+", "+e.Town.toString().trim()+" "+e.State.toString().trim()+" "+e.PostCode.toString().trim(),"undefined"==typeof google){var l=document.createElement("script");l.type="text/javascript";var i=JobMapKeyUrl;i=i.toString().replace(/&amp;/g,"&"),l.src=i,document.body.appendChild(l)}setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress(o,!1,!0)},1e3)}}function OwnerAddressCheck(e){var t=modelOwnerStreetNumber+", "+modelOwnerStreetName+" "+modelOwnerStreetTypeID+", "+modelOwnerTown+" "+modelOwnerState+" "+modelOwnerPostCode,a=$("#JobOwnerDetails_StreetTypeID").find("option:selected").text(),o=e.StreetNumber+", "+e.StreetName+" "+e.StreetTypeID+", "+e.Town+" "+e.State+" "+e.PostCode;if(t.toLowerCase()!=o.toLowerCase()){if(o=e.StreetNumber.toString().trim()+", "+e.StreetName.toString().trim()+" "+a.toString().trim()+", "+e.Town.toString().trim()+" "+e.State.toString().trim()+" "+e.PostCode.toString().trim(),"undefined"==typeof google){var l=document.createElement("script");l.type="text/javascript";var i=JobMapKeyUrl;i=i.toString().replace(/&amp;/g,"&"),l.src=i,document.body.appendChild(l)}setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress(o,!0,!1)},1e3)}}function callbackCheckList(){$("#checkListItemForTrade").find("ul").find("li").length>0?$("#checkListItemForTrade").show():$("#checkListItemForTrade").hide()}var OwnerPostcodeFromjson,OwnerEmailFromJson,OwnerFirstNameFromJson,OwnerLastNameFromJson,fillOwnerAddress,fillInstallationAddress,InstallationPostcodeFromjson,previousPropertyType,source,destination,directionsDisplay,latitude,longitude,latitude1,longitude1,SRCOwnerSign,jsonvarSoldByDate="",jsonvarJobSoldBy="",OwnerAddressJson=[],InstallationJson=[],locations=[],sourcedetail=[],destinationdetail=[],isMapsApiLoaded=!1,MasterSerialArray=[],JobSerialArray=[],logoWidthGST=0,logoHeightGST=0;$(document).ready(function(){$("#BasicDetails_strInstallationDate").val($("#BasicDetails_strInstallationDateTemp").val()),$.fn.serializeToJson=function(){var e=$(this[0]),t=e.serializeArray(),a={},o=[];return $.each(t,function(e,t){if(-1!=t.name.indexOf(".")){var l=t.name.split(".");o.indexOf(l[0])<0&&o.push(l[0]);var i=a[o[o.indexOf(l[0])]]||{};i[l[1]]||(i[l[1]]=t.value),a[o[o.indexOf(l[0])]]=i}else a[t.name]||(a[t.name]=t.value)}),a},validateOrganisation(),null!=modelOwnerSign&&""!=modelOwnerSign&&null!=modelOwnerSign&&$("#imgOwnerSign").attr("src",signatureURL+modelOwnerSignURL),$("#ownerGetSignFromVisit").click(function(e){GetSignatureFromVisit(1),e.preventDefault()}),$("#BasicDetails_IsGst").change(function(){$("#tblDocuments").find("tr").each(function(){$(this).remove()}),$(this).is(":checked")?$("#jobGST").show():$("#jobGST").hide()}),1==$("#JobOwnerDetails_AddressID").val()?$("#JobInstallationDetails_IsSameAsOwnerAddress").prop("disabled",!1):$("#JobInstallationDetails_IsSameAsOwnerAddress").prop("disabled",!0),ShowHideGSTSection($("#JobInstallationDetails_PropertyType").val().toLowerCase(),$("#JobOwnerDetails_OwnerType").val().toLowerCase()),GSTFileUpload(),$("#btnClosepopupProof").click(function(){$("#popupProof").modal("hide")}),fillOwnerAddressDetail();var e=modelOwnerPostalAddressID||0,t=modelOwnerUnitTypeID||0,a=modelOwnerStreetTypeID||0,o=modelOwnerCompanyName;-1!=o.indexOf("&#39")?o=o.replace(/&#39;/g,"'"):-1!=o.indexOf("&amp")?o=o.replace(/&amp;/g,"&"):-1!=o.indexOf("&quot")?o=o.replace(/&quot;/g,'"'):-1!=o.indexOf("&lt")?o=o.replace(/&lt;/g,"<"):-1!=o.indexOf("&gt")&&(o=o.replace(/&gt;/g,">")),$("#JobOwnerDetails_CompanyName").append($("<option></option>").val(o).html(o)),$("#JobOwnerDetails_CompanyName").val(o),dropDownData=[],dropDownData.push({id:"JobOwnerDetails_UnitTypeID",key:"UnitType",value:t,hasSelect:!0,callback:fillOwnerAddress,defaultText:null,proc:"UnitType_BindDropdown",param:[],bText:"UnitTypeName",bValue:"UnitTypeID"},{id:"JobOwnerDetails_StreetTypeID",key:"StreetType",value:a,hasSelect:!0,callback:fillOwnerAddress,defaultText:null,proc:"StreetType_BindDropdown",param:[],bText:"StreetTypeName",bValue:"StreetTypeID"},{id:"JobOwnerDetails_PostalAddressID",key:"PostalAddress",value:e,hasSelect:!0,callback:fillOwnerAddress,defaultText:null,proc:"PostalAddress_BindDropdown",param:[],bText:"PostalDeliveryType",bValue:"PostalAddressID"}),fillInstallationAddressDetail();modelInstallationPostalAddressID,modelInstallationUnitTypeID,modelInstallationStreetTypeID;var l=modelInstallationDistributorID||0,i=modelInstallationElectricityProviderID||0;dropDownData.push({id:"BasicDetails_JobStage",key:"JobStage",value:BasicDetails_JobStage,hasSelect:!0,callback:null,defaultText:null,proc:"Job_GetJobSatge",param:[],bText:"StageName",bValue:"JobStageId"}),dropDownData.push({id:"BasicDetails_Priority",key:"",value:BasicDetails_Priority,hasSelect:!0,callback:null,defaultText:null,proc:"GetPriority",param:[],bText:"Text",bValue:"Value"}),dropDownData.push({id:"JobInstallationDetails_UnitTypeID",key:"UnitType",value:modelInstallationUnitTypeID,hasSelect:!0,callback:fillInstallationAddress,defaultText:null,proc:"UnitType_BindDropdown",param:[],bText:"UnitTypeName",bValue:"UnitTypeID"},{id:"JobInstallationDetails_StreetTypeID",key:"StreetType",value:modelInstallationStreetTypeID,hasSelect:!0,callback:fillInstallationAddress,defaultText:null,proc:"StreetType_BindDropdown",param:[],bText:"StreetTypeName",bValue:"StreetTypeID"},{id:"JobInstallationDetails_PostalAddressID",key:"PostalAddress",value:modelInstallationPostalAddressID,hasSelect:!0,callback:fillInstallationAddress,defaultText:null,proc:"PostalAddress_BindDropdown",param:[],bText:"PostalDeliveryType",bValue:"PostalAddressID"},{id:"JobInstallationDetails_DistributorID",key:"Destributors",value:l,hasSelect:!0,callback:DisplayInstallationInfo,defaultText:null,proc:"GetDistributor",param:[],bText:"DistributorName",bValue:"DistributorID"},{id:"JobInstallationDetails_ElectricityProviderID",key:"ElectricityProvider",value:i,hasSelect:!0,callback:DisplayInstallationInfo,defaultText:null,proc:"Job_GetElectricityProvider",param:[],bText:"Provider",bValue:"ElectricityProviderId"},{id:"BasicDetails_JobSoldBy",key:"SoldBy",value:0,hasSelect:!0,callback:null,defaultText:null,proc:"GetSoldBy",param:[],bText:"NAME",bValue:"NAME"});var n,s="",r=$("#BasicDetails_strInstallationDate").val();null!=r&&null!=r&&""!=r&&(s=moment(r).format("yyyy".toUpperCase())),n=modelSTCDeemingPeriod||0,dropDownData.push({id:"JobSTCDetails_DeemingPeriod",key:"DeemingPeriod",value:n,hasSelect:!0,callback:deemingPeriodCallBack,defaultText:null,proc:"",param:[{jobYear:s}],bText:"Text",bValue:"Value"}),$("#BasicDetails_strInstallationDate").change(function(){var e="",t=$("#BasicDetails_strInstallationDate").val();null!=t&&null!=t&&""!=t&&(e=moment(t,"DD/MM/YYYY").format("yyyy".toUpperCase())),$("#JobSTCDetails_DeemingPeriod").val(),BindDeemingPeriodDropdown(e,0)}),DisplayInstallationDate(),DisplaySoldByDate(),buttonSoldByClick(),buttonOwnerDetailClick(),buttonInstallationDetailClick(),SameAsOwnerAddressMethod(),OwnerAutoComplete(),InstallationAutoComplete(),$("#JobOwnerDetails_OwnerType").change(function(e){validateOrganisation()}),$("#JobOwnerDetails_UnitTypeID").change(function(){""==$("#JobOwnerDetails_UnitTypeID option:selected").val()?($("#lblOwnerUnitNumber").removeClass("required"),$("#lblOwnerUnitTypeID").removeClass("required"),$("#lblOwnerStreetNumber").addClass("required")):($("#lblOwnerUnitNumber").addClass("required"),$("#lblOwnerUnitTypeID").addClass("required"),$("#lblOwnerStreetNumber").removeClass("required"))}),$("#JobInstallationDetails_UnitTypeID").change(function(){""==$("#JobInstallationDetails_UnitTypeID option:selected").val()?($("#lblInstallationUnitNumber").removeClass("required"),$("#lblInstallationUnitTypeID").removeClass("required"),$("#lblInstallationStreetNumber").addClass("required")):($("#lblInstallationUnitNumber").addClass("required"),$("#lblInstallationUnitTypeID").addClass("required"))}),$("#JobInstallationDetails_ExistingSystem").change(function(){OwnerHasExistingSystem($(this).is(":checked"))}),$("#aShowHideOtherInstalltionInfo").click(function(e){ShowHideOtherInstalltionInfo(this),e.preventDefault()}),OwnerHasExistingSystem(modelInstallationExistingSystem),1==modelBasicJobType&&("Yes"==modelSTCMultipleSGUAddress?$("#STCAdditionalLocation").show():($("#STCAdditionalLocation").hide(),$("#JobSTCDetails_AdditionalLocationInformation").val(""))),2==modelBasicJobType&&("Yes"==modelSTCMultipleSGUAddress||1==ProjectSession_UserTypeId||3==ProjectSession_UserTypeId?$("#additionalInfo").show():$("#additionalInfo").hide()),$("#JobSTCDetails_MultipleSGUAddress").change(function(e){1==modelBasicJobType&&("No"!=$("#JobSTCDetails_MultipleSGUAddress").val()&&""!=$("#JobSTCDetails_MultipleSGUAddress").val()?$("#JobSTCDetails_AdditionalLocationInformation").show():$("#JobSTCDetails_AdditionalLocationInformation").hide(),showhideAdditionalLocationInformation()),2==modelBasicJobType&&("Yes"==$("#JobSTCDetails_MultipleSGUAddress").val()||1==ProjectSession_UserTypeId||3==ProjectSession_UserTypeId?$("#additionalInfo").show():$("#additionalInfo").hide())}),$("#JobInstallationDetails_InstallingNewPanel").change(function(e){"New"!=$("#JobInstallationDetails_InstallingNewPanel").val()&&""!=$("#JobInstallationDetails_InstallingNewPanel").val()||1==ProjectSession_UserTypeId?(EnableTradeButton(),$("#JobSTCDetails_AdditionalCapacityNotes").show()):(isJobWithCommonInstallationAddress?DisableTradeButton():EnableTradeButton(),$("#JobSTCDetails_AdditionalCapacityNotes").hide()),showhideAdditionalCapacityNotes()}),$("#JobInstallationDetails_PropertyType").on("focus",function(){previousPropertyType=this.value}).change(function(e){var t=$("#JobInstallationDetails_PropertyType").val(),a=$("#JobOwnerDetails_Email").val();return"commercial"!=t.toLowerCase()||null!=a&&""!=a?"school"!=t.toLowerCase()||null!=a&&""!=a?(ShowHideGSTSection($("#JobInstallationDetails_PropertyType").val().toLowerCase(),$("#JobOwnerDetails_OwnerType").val().toLowerCase()),void $.ajax({url:urlUpdateJobInstallationPropertyType,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:jobId,propertyType:$("#JobInstallationDetails_PropertyType").val(),isGST:$("#BasicDetails_IsGst").val()}),async:!1,success:function(e){e.status?(showSuccessMessageForPopup("Installation property type has been saved successfully.",$("#successMsgRegionSTCDetails"),$("#errorMsgRegionSTCDetails")),SavedData=CommonDataForSave(),ReloadSTCJobScreen(jobId)):showErrorMessageForPopup(e.msg,$("#errorMsgRegionSTCDetails"),$("#successMsgRegionSTCDetails"))}})):(showErrorMessage("Owner email address is mandatory for installtion property type school."),$("#JobInstallationDetails_PropertyType").val(previousPropertyType),!1):(showErrorMessage("Owner email address is mandatory for commercial jobs."),$("#JobInstallationDetails_PropertyType").val(previousPropertyType),!1)}),$("#JobSTCDetails_VolumetricCapacity").change(function(){$("#spanStatutoryDeclarations").hide(),"Yes"==$(this).val()?$("#divStatutoryDeclarations").show():($("#divStatutoryDeclarations").val($("#divStatutoryDeclarations option:first").val()),$("#divStatutoryDeclarations").hide())}),$("#JobSTCDetails_StatutoryDeclarations").change(function(){"Select"!=$(this).val()&&null!=$(this).val()&&null!=$(this).val()&&""!=$(this).val()&&$("#spanStatutoryDeclarations").hide()}),showhideFailedCode(modelSTCCertificateCreated),$("#JobSTCDetails_CertificateCreated").change(function(e){showhideFailedCode($(this).val())}),"Replacing"==modelInstalltionInstallingNewPanel||"Adding"==modelInstalltionInstallingNewPanel||"Extension"==modelInstalltionInstallingNewPanel?$("#additionalCapacityNotes").show():($("#additionalCapacityNotes").hide(),$("#JobSTCDetails.AdditionalCapacityNotes").val("")),$("#btnCustomJobField").click(function(){ReloadCustomField()}),DistinctCustomField(),buttonMapClick(),showhideAdditionalCapacityNotes(),$("#JobOwnerDetails_CompanyABN").change(function(){$.ajax({type:"GET",url:urlGetCompanyABN,data:{id:$("#JobOwnerDetails_CompanyABN").val()},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){return 0==e?($("#JobOwnerDetails_CompanyName").empty(),$("#JobOwnerDetails_CompanyName").append($("<option></option>").val("").html("Select")),showErrorMessageForPopup("Invalid Company ABN.",$("#errorMsgRegionOwnerPopup"),$("#successMsgRegionInstallerPopup")),!1):($("#JobOwnerDetails_CompanyName option").length>1?($("#JobOwnerDetails_CompanyName").empty(),$("#JobOwnerDetails_CompanyName").append($("<option></option>").val("").html("Select")),$.each(e,function(e,t){$("#JobOwnerDetails_CompanyName").append($("<option></option>").val(t.CompanyName).html(t.CompanyName))})):$.each(e,function(e,t){$("#JobOwnerDetails_CompanyName").append($("<option></option>").val(t.CompanyName).html(t.CompanyName))}),initializeOwnerDetails(e),e)}})}),0==$("#isotherDetails").length&&0==$("#isCustomDetails").length&&$("#otherInstalltionInfo").hide(),$("#hdnsolarCompanyid").val($("#BasicDetails_SolarCompanyId").val()),""==BasicDetails_Priority||BasicDetails_Priority,$("#BasicDetails_Priority").change(function(){var e=$("#BasicDetails_Priority option:selected").text();$("#BasicDetails_CurrentPriority").val(e)}),$("#BasicDetails_JobSoldBy").change(function(){var e=$("#BasicDetails_JobSoldBy").val();$("#BasicDetails_JobSoldByText").val(e)}),jsonvarSoldByDate=$("#BasicDetails_strSoldByDate").val(),jsonvarJobSoldBy=$("#BasicDetails_SoldBy").val(),""!=jsonvarSoldByDate&&$("#BasicDetails_SoldByDate").val(jsonvarSoldByDate),$("#BasicDetails_SoldByDate").val(jsonvarSoldByDate),$("#BasicDetails_JobSoldByText").val(jsonvarJobSoldBy),$("#BasicDetails_IsAllowTrade").length&&"false"==$("#BasicDetails_IsAllowTrade").val().toLowerCase()&&$(".term").remove(),CheckInstallationAddressIsValidOrNot(),setTimeout(function(){CheckOwnerAddressIsValidOrNot()},3e3)}),window.mapsCallback=function(){getLatitudeLongitude(DisplayLatLonOfInstallationAdd,$("#installationAdd").html())},$("#aGetOwnerSignature").click(function(e){e.preventDefault(),$("#mdlGetSignature").modal("show")}),$("#btnSendMail").click(function(e){SendEmailSignature(),SearchHistory()}),$("#mdlGetSignature").on("show.bs.modal",function(){$("#errorMsgRegionSignaturePopup,#successMsgRegionSignaturePopup").css("display","none")}),$("#mdlGetSignature").on("hide.bs.modal",function(){$("#mdlGetSignature").removeData("type")});var oldValSerialNumber="",ready=function(){$(".text-editor").setNumber({activeLine:1}),$(".text-editor-inverter").setNumber({activeLine:1}),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?$(".isSPVRequired").show():$(".isSPVRequired").hide(),$(".text-editor").autosize({callback:function(e){$(e).scroll(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired&&VerifyUnVerifySerialNumber()}}),$(".text-editor-inverter").autosize({callback:function(e){$(e).scroll()}}),$(".text-editor").focus(),$(".text-editor-inverter").focus(),$("#JobSystemDetails_SerialNumbers").prop("disabled")&&$("div.line-no").removeClass("active"),$("#JobSystemDetails_SerialNumbers").on("change keyup paste",function(){var e=$(this).val();e!=oldValSerialNumber&&(oldValSerialNumber=e,"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired&&VerifyUnVerifySerialNumber())})};$(document).ready(ready);