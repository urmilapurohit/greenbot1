function BindSAASUser(){$.ajax({url:"/Reseller/GetSAASForPricingManager",dataType:"json",data:{},success:function(e){$.each(e,function(e,l){saasUsersList.push({value:l.Value,text:l.Text})}),$("#hdnresellerId").val(saasUsersList.length>0?saasUsersList[0].value:0),$("#SAASUserId").val(saasUsersList.length>0?saasUsersList[0].text:"")}})}function BindSolarCompany(e){return $.ajax({type:"GET",url:urlGetSolarCompanyByResellerId,dataType:"json",data:{id:e},async:!0,success:function(e){solarCompanyList=[],$.each(e,function(e,l){solarCompanyList.push({value:l.Value,text:l.Text})}),$.each(solarCompanyList,function(e,l){l.value==localStorage.getItem("User_SolarCompanyId")&&($("#searchSolarCompany").val(l.text),$("#hdnsolarCompanyid").val(localStorage.getItem("User_SolarCompanyId")))})},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),!1}function BindGlobalPricingTerms(){$.ajax({type:"GET",url:"/SAASPricingManager/GetGlobalBillingTermsList",data:{},success:function(e){if(PricingLocalDataArr.length>0)for(var l=0;l<PricingLocalDataArr.length;l++)for(var a=0;a<e.length;a++)parseInt(PricingLocalDataArr[l].GlobalTermId)==e[a].Id&&(e[a].strBillableCode=PricingLocalDataArr[l].NewDisplayValue,e[a].IsGlobalGST=PricingLocalDataArr[l].IsGlobalGST);for(var t='<option value="0">Please Select a Billable Term</option>',r=0;r<e.length;r++)t+='<option value="'+e[r].Id+'" TermName="'+e[r].TermName+'" TermCode="'+e[r].TermCode+'" Price="'+e[r].GlobalPrice+'" Description="'+e[r].TermDescription+'"  IsGlobalGST="'+e[r].IsGlobalGST+'">'+e[r].strBillableCode+"</option>";$("#ddlTermCode").html(t),$("#ddlBillableTerms").empty(),$("#ddlBillableTerms").multiselect("destroy");for(r=0;r<e.length;r++)$("#ddlBillableTerms").append('<option id="chk_'+e[r].Id+'" value="'+e[r].Id+'" TermName="'+e[r].TermName+'" TermCode="'+e[r].TermCode+'" Price="'+e[r].GlobalPrice+'" Description="'+e[r].TermDescription+'"  IsGlobalGST="'+e[r].IsGlobalGST+'">'+e[r].strBillableCode+"</option>");$("ddlBillableTerms").multiselect("refresh"),$(function(){$("#ddlBillableTerms").multiselect({includeSelectAllOption:!0,selectAllValue:"multiselect-all",enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:"250",buttonWidth:"560"})})}})}function BindGlobalPricingTermDescription(e){if(null==$("#ddlBillableTerms").val())$("#spnBillingDescription").val(""),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide();else{for(var l=$("#ddlBillableTerms").val(),a="",t=0;t<l.length;t++)a+="<b>"+$("#chk_"+l[t]).attr("termcode")+": </b>"+$("#chk_"+l[t]).attr("description")+"\n";var r=$("#spnBillingDescription").html(a);r.html(r.html().replace(/\n/g,"<br/>")),$("#dvBillingDescription").show(),$("#dvGlobalPricingButtons").show()}}function BindGlobalPrices(e){var l=!0;PricingLocalDataArr.length>0&&$.each(PricingLocalDataArr,function(a,t){t.GlobalTermId==e.value&&($("#txtpopGlobalPrice").val(t.Price),l=!1)}),0!=e.value&&1==l?$.ajax({type:"POST",url:urlGetGlobalPricingList,data:{IsIsArchive:!1},success:function(l){for(var a=0;a<l.length;a++)l[a].Id==e.value&&($("#txtpopGlobalPrice").val(l[a].GlobalPrice),l[a].IsGlobalGST?$("#IspopGlobalGST").attr("checked",!0):$("#IspopGlobalGST").attr("checked",!1))},error:function(e){}}):l&&($("#IspopGlobalGST").attr("checked",!1),$("#txtpopGlobalPrice").val(""),$("#ddlTermCode").val(0)),l=!0}function SavePrice(e){ValidateForm()&&("Save"==$("#btnSavePrice").val()?$.ajax({type:"POST",url:savepricingURL,data:{SAASPricingId:0,SAASUserId:$("#hdnresellerId").val(),SettlementTermId:$("#ddlPricingType").val(),IsEnable:!0,Price:$("#txtSAASPrice").val(),IsGst:"",BillingPeriod:"0",SettlementPeriod:"0"},success:function(e){ClearForm(),$("#btnSavePrice").val("Save"),$("#dvPrive").hide(),$("#dvPricingType").hide(),$("#dvBtnSave").hide(),$("#dvBtnCancel").hide(),$("#datatable").DataTable().destroy(),$("#SAASUser").val($("#hdnresellerName").val()),DrawSAASPricingGrid(),alert("Price saved sucessfully.")}}):$.ajax({type:"POST",url:savepricingURL,data:{SAASPricingId:SAASId,SAASUserId:$("#hdnresellerId").val(),SettlementTermId:$("#ddlPricingType").val(),IsEnable:!1,Price:$("#txtSAASPrice").val(),IsGst:"",BillingPeriod:"0",SettlementPeriod:"0"},success:function(e){ClearForm(),$("#btnSavePrice").val("Save"),$("#dvPrive").hide(),$("#dvPricingType").hide(),$("#dvBtnSave").hide(),$("#dvBtnCancel").hide(),$("#datatable").dataTable().fnClearTable(),$("#datatable").dataTable().fnDestroy(),$("#datatable").DataTable().destroy(),$("#SAASUser").val($("#hdnresellerName").val()),DrawSAASPricingGrid(),alert("Price updated sucessfully.")}}))}function ClearForm(){$("#SAASUser").val(""),$("#ddlPricingType").val(0),$("#txtSAASPrice").val(""),"Update"==$("#btnSavePrice").val()&&$("#btnSavePrice").val("Save"),$("#drpUserType").val(""),$("#txtBillableCode").val(""),$("#txtTermCode").val(""),$("#RoleID").val(""),$("#txtCompanyName").val("")}function ValidateForm(){return""==$("#SAASUser").val()?(alert("Please select saasuser."),!1):0==$("#ddlPricingType").val()?(alert("Please select pricing type."),!1):""!=$("#txtSAASPrice").val()||(alert("Please select price."),!1)}function EditPrice(e,l,a,t,r){SAASId=e,$("#SAASUser").val(t),$("#ddlPricingType").val(l),$("#txtSAASPrice").val(a),$("#hdnresellerId").val(r),$("#btnSavePrice").val("Update"),$("#dvPricingType").show(),$("#dvPrive").show(),$("#dvBtnSave").show(),$("#dvBtnCancel").show()}function DrawSAASPricingGrid(){$.fn.DataTable.isDataTable("#datatable")&&$("#datatable").DataTable().destroy(),$("#datatable tbody").empty(),$("#datatable").DataTable({autoWidth:!1,destory:!0,retrieve:!0,processing:!0,serverSide:!0,iDisplayLength:10,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"RoleId",orderable:!1,render:function(e,l,a,t){return $("#chkAll").prop("checked"),'<input type="checkbox" id="chk_'+a.RoleId+'" RoleId="'+a.RoleId+'" onchange="SetId('+a.RoleId+')">'}},{data:"RoleId",visible:!1},{data:"RoleName"},{data:"UserTypeName"},{data:"strAppliedRolesUserCount",render:function(e,l,a,t){return'<a href="#profile" data-toggle="tab" onclick="ShowUserInUserRoleGrid('+a.RoleId+')">'+e+"</a>"},orderable:!1},{data:"BillableTerm",render:function(e,l,a,t){var r="",o="",i="",n="";if(""!=e&&null!=e){r=e.split(","),i=a.GlobalBillableTermId.split(","),n=a.strPrice.split(",");for(var s=0;s<i.length;s++)1==n.length?o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow;margin-bottom: 5px;" class="col-sm-9">'+r[s].replace("]",'<a href="javascript:deleteAppliedTermFromRoleGrid('+a.RoleId+","+i[s]+","+n[s]+","+`'${a.strBillableSettingsId}'`+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a>]')+"</p></br>":o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow;margin-bottom: 5px;" class="col-sm-9">'+r[s].replace("]",'<a href="javascript:deleteAppliedTermFromRoleGrid('+a.RoleId+","+i[s]+","+n[s]+`,'${a.strBillableSettingsId}'`+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp;</a>]')+"</p></br>";return o}return""},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetSAASPricingList,fnDrawCallback:function(){1==$("#chkAll").prop("checked")?chkCount=$("#datatable >tbody >tr").length:chkCount=0,$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>=1?$("#datatable_length").show():$("#datatable").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var e=$("#datatable").DataTable(),l=e.page.info();0==l.recordsTotal?document.getElementById("numRecords").innerHTML="<b>0</b>  of  <b>"+l.recordsTotal+"</b> User Role Records(s) found":document.getElementById("numRecords").innerHTML="<b>"+$("#datatable >tbody >tr").length+"</b>  of  <b>"+l.recordsTotal+"</b> User Role Records(s) found"},fnServerParams:function(e){e.push({name:"RoleID",value:localStorage.getItem("SAASPM_RoleID")}),e.push({name:"TermCode",value:$("#txtTermCode").val()}),e.push({name:"UserType",value:localStorage.getItem("SAASPM_UserType")}),e.push({name:"BillerCode",value:$("#txtBillableCode").val()}),e.push({name:"TermName",value:$("#txtTermName").val()})}})}function DrawUsersInUserRoleGrid(e){$.fn.DataTable.isDataTable("#datatableUsersInRoles")&&$("#datatableUsersInRoles").DataTable().destroy(),$("#datatableUsersInRoles tbody").empty(),$("#datatableUsersInRoles").DataTable({autoWidth:!1,destory:!0,retrieve:!0,processing:!0,serverSide:!0,iDisplayLength:10,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"RoleId",orderable:!1,render:function(e,l,a,t){return $("#chkAll").prop("checked"),'<input type="checkbox" id="chk_'+a.UserId+'" onclick="SetUserId('+a.UserId+')">'}},{data:"RoleId",visible:!1},{data:"UserName"},{data:"RoleName"},{data:"UserTypeName"},{data:"TermCode",render:function(e,l,a,t){var r="",o="",i="";if(""!=e){r=e.split(","),i=a.strBillableSettingsId.split(",");for(var n=0;n<i.length;n++)for(n=0;n<r.length;n++)1==r.length?o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow; width:auto;" class="col-sm-6">'+r[n]+'<a href="javascript:deleteAppliedTermFromUserGrid('+a.UserId+","+i[n]+","+a.RoleId+","+a.IsGlobalGST+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></p>':o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow; width:auto;" class="col-sm-3">'+r[n]+'<a href="javascript:deleteAppliedTermFromUserGrid('+a.UserId+","+i[n]+","+a.RoleId+","+a.IsGlobalGST+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></p>';return o}}}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetRoleWiseUserSAAS,fnDrawCallback:function(){1==$("#chkAll").prop("checked")?chkCount=$("#datatableUsersInRoles >tbody >tr").length:chkCount=0,$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>=1?$("#datatable_length").show():$("#datatableUsersInRoles").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide()},fnServerParams:function(l){l.push({name:"RoleId",value:e}),l.push({name:"UserName",value:localStorage.getItem("SAASPM_UserName")}),l.push({name:"RoleName",value:localStorage.getItem("SAASPM_RoleID")}),l.push({name:"TermCode",value:localStorage.getItem("SE_GridTermCodeFilter")})}})}function DrawUsersGrid(e){$.fn.DataTable.isDataTable("#datatableUsers")&&$("#datatableUsers").DataTable().destroy(),$("#datatableUsers tbody").empty(),$("#datatableUsers").DataTable({autoWidth:!1,destory:!0,retrieve:!0,processing:!0,serverSide:!0,iDisplayLength:10,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"RoleId",orderable:!1,render:function(e,l,a,t){return $("#chkAll").prop("checked"),'<input type="checkbox" id="chk_'+a.UserId+'" name="'+a.UserId+'" onclick="SetUserId('+a.UserId+')">'}},{data:"Name"},{data:"UserName"},{data:"Email"},{data:"Mobile"},{data:"RoleName"},{data:"UserTypeName"},{data:"TermCode",render:function(e,l,a,t){var r="",o="",i="";if(""!=e&&null!=e){r=e.split(","),i=a.strBillableSettingsId.split(",");for(var n=0;n<i.length;n++)for(n=0;n<r.length;n++)1==r.length?o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow;width:100%;margin-bottom: 5px;" class="col-sm-6">'+r[n]+'<a href="javascript:deleteAppliedTermFromUserGrid('+a.UserId+","+i[n]+","+a.RoleId+","+a.IsGlobalGST+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></p></br>':o+='<p style="border: 1px solid #dddd50; text-align: center;margin-right: 8px; background: lightyellow;width:100%;margin-bottom: 5px;" class="col-sm-3">'+r[n]+'<a href="javascript:deleteAppliedTermFromUserGrid('+a.UserId+","+i[n]+","+a.RoleId+","+a.IsGlobalGST+')" class="ic-edit" style="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></p></br>';return o}return""},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetAllRoleUserList,fnDrawCallback:function(){1==$("#chkAll").prop("checked")?chkCount=$("#datatableUsers >tbody >tr").length:chkCount=0,$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>=1?$("#datatable_length").show():$("#datatableUsers").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var e=$("#datatableUsers").DataTable(),l=e.page.info();0==l.recordsTotal?document.getElementById("numRecords").innerHTML="<b>0</b>  of  <b>"+l.recordsTotal+"</b> Users Records(s) found":document.getElementById("numRecords").innerHTML="<b>"+$("#datatableUsers >tbody >tr").length+"</b>  of  <b>"+l.recordsTotal+"</b> Users Records(s) found"},fnServerParams:function(l){l.push({name:"RoleName",value:localStorage.getItem("SAASPM_UserRole")}),l.push({name:"TermCode",value:$("#txtTermCode").val()}),l.push({name:"UserType",value:localStorage.getItem("SAASPM_UserType")}),l.push({name:"TermCode",value:localStorage.getItem("SAASPM_TermCode")}),l.push({name:"BillableCode",value:localStorage.getItem("SAASPM_BillableCode")}),l.push({name:"ResellerId",value:localStorage.getItem("SAASPM_ResellerId")}),l.push({name:"SolarCompany",value:"0"==localStorage.getItem("SAASPM_SolarCompany")?null:localStorage.getItem("SAASPM_SolarCompany")}),l.push({name:"RoleID",value:null==e?localStorage.getItem("SAASPM_RoleID"):e})}})}function ApplyGlobalPricing(){if(""!=GlblRoleId){for(var e=$("#ddlBillableTerms").val(),l=GlblRoleId.replace(/,\s*$/,"").split(","),a=1,t=0;t<e.length;t++){for(var r=0;r<l.length;r++)$.ajax({type:"POST",url:SaveUserBillableSettingsURL,data:{RoleId:l[r],GlobalTermId:e[t],Price:$("#chk_"+e[t]).attr("price"),IsGST:$("#chk_"+e[t]).attr("isglobalgst"),DATAOPMODE:1},async:!1,success:function(l){$("#ddlBillableTerms").val(0),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide(),DrawSAASPricingGrid(),a==e.length&&alert("Global pricing terms applied sucessfully.")}});a++}GlblRoleId="",$("#ddlBillableTerms").multiselect("clearSelection")}else if(""!=GlblUserId){e=$("#ddlBillableTerms").val();var o=GlblUserId.replace(/,\s*$/,"").split(","),i="",n="",s=1;for(t=0;t<e.length;t++){for(r=0;r<o.length;r++){if(PricingLocalDataArr.length>0)for(var d=0;d<PricingLocalDataArr.length;d++)PricingLocalDataArr[d].GlobalTermId==e[t]?(i=PricingLocalDataArr[d].Price,n=PricingLocalDataArr[d].IsGlobalGST):(i=$("#chk_"+e[t]).attr("price"),n="1"==$("#chk_"+e[t]).attr("isglobalgst"));else i=$("#chk_"+e[t]).attr("price"),n="1"==$("#chk_"+e[t]).attr("isglobalgst");$.ajax({type:"POST",url:SaveUserBillableSettingsURL,data:{RoleId:0,GlobalTermId:e[t],Price:i,IsGST:n,DATAOPMODE:2,UserId:o[r]},async:!1,success:function(e){""!=GrdRoleId&&(localStorage.setItem("SE_GridTermCodeFilter",""),DrawUsersInUserRoleGrid(GrdRoleId)),""!=GlblUserId&&(localStorage.setItem("SE_GridTermCodeFilter",""),DrawUsersGrid()),PricingLocalDataArr=[],$("#ddlBillableTerms").val(0),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide(),s==o.length&&alert("Global pricing terms applied sucessfully.")}})}s++}GlblUserId="",$("#ddlBillableTerms").multiselect("clearSelection")}else alert("Please select any record!.")}function CancelGlobalPricing(){$("#ddlBillableTerms").val(0),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide(),$("#ddlBillableTerms").multiselect("clearSelection")}function PopSaveGlobalPricing(){""!=$("#txtpopGlobalPrice").val()?$.ajax({type:"POST",url:SaveGlobalBillableTermSAASURL,data:{Id:$("#ddlBillableTerms").val(),TermName:$("#ddlBillableTerms").find("option:selected").attr("TermName"),TermCode:$("#ddlBillableTerms").find("option:selected").attr("TermCode"),TermDescription:$("#ddlBillableTerms").find("option:selected").attr("Description"),GlobalPrice:$("#txtpopGlobalPrice").val(),IsGlobalGST:$("#IspopGlobalGST").is(":checked"),CreatedBy:LoggedInUserId,CreatedDate:Date.now},success:function(e){$("#ddlBillableTerms").val(0),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide(),$("#popupmanageprice .close").click(),""!=GrdRoleId&&DrawUsersInUserRoleGrid(GrdRoleId),GrdRoleId="",GlblUserId="",DrawUsersGrid(),BindGlobalPricingTerms(),alert("Global pricing terms saved sucessfully.")}}):alert("Please enter global price.")}function ShowUserInUserRoleGrid(e){GrdRoleId=e,DrawUsersGrid(e),$("#dvBtnOptions").show(),$("#myTab li:nth-child(2) a").tab("show")}function SetId(e){if(1==$("#chk_"+e).prop("checked"))GlblRoleId+=e+",",GlblRoleId.replace(/,\s*$/,"");else if(""!=GlblRoleId){var l=GlblRoleId.replace(/,\s*$/,"").split(",");l.forEach(function(a,t){l[t]==e&&(l[t]="")}),l.forEach(function(e,l){GlblRoleId="",""!=e&&(GlblRoleId+=e+","),GlblRoleId.replace(/,\s*$/,"")})}}function SetUserId(e){if(1==$("#chk_"+e).prop("checked"))GlblUserId+=e+",",GlblUserId.replace(/,\s*$/,"");else if(""!=GlblUserId){var l=GlblUserId.replace(/,\s*$/,"").split(",");l.forEach(function(a,t){l[t]==e&&(l[t]="")}),GlblUserId="",l.forEach(function(e,l){""!=e&&(GlblUserId+=e+","),GlblUserId.replace(/,\s*$/,"")})}}function SearchUsers(){localStorage.setItem("SAASPM_UserName",$("#txtUserName").val()),localStorage.setItem("SAASPM_RoleID",$("#RoleID").val()),localStorage.setItem("SAASPM_UserType",$("#drpUserType").val()),localStorage.setItem("SAASPM_TermCode",$("#txtTermCode").val()),localStorage.setItem("SAASPM_BillableCode",$("#txtBillableCode").val()),localStorage.setItem("SAASPM_ResellerId",$("#ResellerId").val()),localStorage.setItem("SAASPM_SolarCompany",$("#hdnsolarCompanyid").val()),"UserRole"==ActiveTab?DrawSAASPricingGrid():DrawUsersGrid()}function ResetSearchFilters(){$("#drpUserType").val(""),$("#txtBillableCode").val(""),$("#txtTermCode").val(""),$("#RoleID").val(""),$("#txtUserName").val(""),$("#txtCompanyName").val(""),$("#txtTermName").val(""),localStorage.setItem("SAASPM_UserName",""),localStorage.setItem("SAASPM_RoleID",""),localStorage.setItem("SAASPM_UserType",""),localStorage.setItem("SAASPM_TermCode",""),localStorage.setItem("SAASPM_BillableCode",""),localStorage.setItem("SAASPM_ResellerId",""),localStorage.setItem("SAASPM_SolarCompany",""),DrawSAASPricingGrid(),DrawUsersGrid()}function deleteAppliedTermFromUserGrid(e,l,a,t){""!=e&&""!=l&&$.ajax({type:"POST",url:SaveUserBillableSettingsURL,data:{RoleId:0,GlobalTermId:0,Price:0,IsGST:t,DATAOPMODE:3,UserId:e,BillableSettingsId:l},success:function(e){DrawUsersGrid(),alert("Applied term deleted sucessfully.")},error:function(e){}})}function deleteAppliedTermFromRoleGrid(e,l,a,t){""!=e&&""!=l&&""!=a?$.ajax({type:"POST",url:SaveUserBillableSettingsURL,data:{RoleId:e,GlobalTermId:l,Price:a.toFixed(2),DATAOPMODE:4,IsGST:!1,strBillableSettingsId:t},success:function(e){DrawSAASPricingGrid(),DrawUsersGrid(),alert("Applied term deleted sucessfully.")},error:function(e){}}):alert("Error deleting applied term!")}function SavePricingLocally(){var e="",l="",a="",t=$("#ddlTermCode").val(),r=$("#txtpopGlobalPrice").val(),o=$("#IspopGlobalGST").is(":checked");$(".multiselect-container input[type=checkbox]").each(function(){this.value==t&&(l=$("#chk_"+t).text(),a=l.split("+")[1],e="$"+r+"+"+a)}),PricingLocalDataArr.length>0?$.each(PricingLocalDataArr,function(l,a){if(a.GlobalTermId!=t)return PricingLocalDataArr.push({GlobalTermId:t,Price:r,IsGlobalGST:o,NewDisplayValue:e}),!1;a.Price=r,a.IsGlobalGST=o}):PricingLocalDataArr.push({GlobalTermId:t,Price:r,IsGlobalGST:o,NewDisplayValue:e}),$("#popupmanageprice .close").click(),BindGlobalPricingTerms(!0,t,e)}function getRole(e){"1"==ProjectSessionUserTypeId?e=e:"2"==ProjectSessionUserTypeId?e=5:"4"!=ProjectSessionUserTypeId&&"6"!=ProjectSessionUserTypeId||(e=8),$.ajax({url:urlGetRole,type:"get",data:{id:e},async:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){0==e?($("#RoleID").empty(),$("#RoleID").append('<option value="">Select</option>')):($("#RoleID").empty(),$("#RoleID").append('<option value="" selected>Select</option>'),$.each(e,function(e,l){$("#RoleID").append('<option value="'+l.Value+'">'+l.Text+"</option>")}))}})}$(document).ready(function(){ActiveTab="UserRole",localStorage.setItem("SE_GridTermCodeFilter",""),localStorage.setItem("SAASPM_UserName",""),localStorage.setItem("SAASPM_RoleID",""),localStorage.setItem("SAASPM_UserType",""),localStorage.setItem("SAASPM_TermCode",""),localStorage.setItem("SAASPM_BillableCode",""),localStorage.setItem("SAASPM_ResellerId",""),localStorage.setItem("SAASPM_SolarCompany",""),$("#myTab li:first-child a").tab("show"),$("#profile-tab").attr("class","disabled"),$("#dialog").dialog({autoOpen:!1,modal:!0,title:"View Details"}),$("#dvPrive").hide(),$("#dvPricingType").hide(),$("#dvBtnSave").hide(),$("#dvBillingDescription").hide(),$("#dvGlobalPricingButtons").hide(),BindSAASUser(),DrawSAASPricingGrid(),BindGlobalPricingTerms(),FillDropDownUser("drpUserType",urlGetUserType,null,!0,null),FillDropDown("ResellerId",urlGetReseller,localStorage.getItem("User_ResellerId"),!0,null),$("#txtCompanyName").autocomplete({minLength:0,source:function(e,l){var a=[];$("#hdnsolarCompanyid").val(0),$.each(solarCompanyList,function(e,l){l.text.toLowerCase().indexOf($("#txtCompanyName").val().toLowerCase())>-1&&a.push({Title:l.text,id:l.value})}),l($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id}}))},select:function(e,l){$("#hdnsolarCompanyid").val(l.item.id)}}).on("focus",function(){$(this).keydown()}),$.ui.autocomplete.prototype._renderItem=function(e,l){var a=new RegExp($.trim(this.term.toLowerCase())),t=l.label.replace(a,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",l).append("<a>"+t+"</a>").appendTo(e)},getRole($("#drpUserType").val()),$("#drpUserType").change(function(){var e=$("#drpUserType").val();getRole(e)})}),$("#ddlPricingType").change(function(){0==$("#ddlPricingType").val()?$("#dvPrive").hide():$("#dvPrive").show()}),$("#txtSAASPrice").on("input",function(){$("#txtSAASPrice").val().length>0?($("#dvBtnSave").show(),$("#dvBtnCancel").show()):($("#dvBtnSave").hide(),$("#dvBtnCancel").hide())}),$("#chkAll").on("click",function(){var e=$("#datatable").DataTable(),l=e.rows({search:"applied"}).nodes();$('input[type="checkbox"]',l).prop("checked",this.checked),chkCount=this.checked?$("#datatable >tbody >tr").length:0,$("#datatable input:checkbox").each(function(){var e=$(this);e.is(":checked")?"select_all"!=e.attr("name")&&(GlblRoleId+=e.attr("roleid")+",",GlblRoleId.replace(/,\s*$/,"")):GlblRoleId=""})}),$("#datatable tbody").on("change",'input[type="checkbox"]',function(){this.checked?(chkCount++,chkCount==$("#datatable >tbody >tr").length&&$("#chkAll").prop("checked",this.checked)):(chkCount--,$("#chkAll").prop("checked",this.checked))}),$("#chkAll3").on("click",function(){var e=$("#datatableUsers").DataTable(),l=e.rows({search:"applied"}).nodes();$('input[type="checkbox"]',l).prop("checked",this.checked),chkCount=this.checked?$("#datatableUsers >tbody >tr").length:0,$("#datatableUsers input:checkbox").each(function(){var e=$(this);e.is(":checked")?"select_all"!=e.attr("name")&&(GlblUserId+=e.attr("name")+",",GlblUserId.replace(/,\s*$/,"")):GlblUserId=""})}),$("#btnOptions").click(function(){$("#hdnPopGlobalTermId").val($("#ddlBillableTerms").val());$("#popupmanageprice").modal({backdrop:"static",keyboard:!1})}),$("#myTab a").on("click",function(e){e.preventDefault(),$(this).tab("show"),"users in user roles"==this.innerHTML.toLowerCase()?""!=GrdRoleId&&($("#dvBtnOptions").show(),DrawUsersInUserRoleGrid(GrdRoleId),GlblRoleId="",GlblUserId=""):"users"==this.innerHTML.toLowerCase()?(ActiveTab="Users",$(".userfilter").show(),$(".rolefilter").hide(),$("#ResellerId").select2(),$("#dvBtnOptions").show(),DrawUsersGrid(),GlblRoleId="",GlblUserId=""):(ActiveTab="UserRole",$(".userfilter").hide(),$(".rolefilter").show(),$("#dvApplyGlobalPricing").show(),DrawSAASPricingGrid(),GlblUserId="")}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){e.target,e.relatedTarget}),$("#btnpopupmanagepriceclose").click(function(){$("#IspopGlobalGST").attr("checked",!1),$("#txtpopGlobalPrice").val(""),$("#ddlTermCode").val(0)}),$("#ResellerId").change(function(){BindSolarCompany($("#ResellerId").val())});