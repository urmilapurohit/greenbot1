function GetFCOByResellerId(e){var t=!1;return $("#ComplianceOfficerId").empty(),$("#AssignComplianceOfficerId").empty(),$.ajax({type:"get",url:urlGetFCOByResellerId,dataType:"json",async:!1,data:{rId:e},success:function(e){$("#ComplianceOfficerId").append('<option value="0">Select</option>'),$("#AssignComplianceOfficerId").append('<option value="0">Select</option>'),$.each(e,function(e,a){$("#ComplianceOfficerId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),$("#AssignComplianceOfficerId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),0==t&&a.Value==localStorage.getItem("STCSubmission_ComplianceOfficerId")&&(t=!0)}),t?document.getElementById("ComplianceOfficerId").value=localStorage.getItem("STCSubmission_ComplianceOfficerId"):($("#ComplianceOfficerId").val($("#ComplianceOfficerId option:first").val()),localStorage.setItem("STCSubmission_ComplianceOfficerId",$("#ComplianceOfficerId option:first").val()))},error:function(e){alert("Failed to retrieve Compliance Officers."+e)}}),!1}function GetRAMByResellerId(e){var t=!1;return $("#RamId").empty(),$.ajax({type:"get",url:urlGetRAMForReseller,dataType:"json",async:!1,data:{rId:e},success:function(e){$("#RamId").append('<option value="0">Select</option>'),$.each(e,function(e,a){$("#RamId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),0==t&&a.Value==localStorage.getItem("STCSubmission_RamId")&&(t=!0)}),t?document.getElementById("RamId").value=localStorage.getItem("STCSubmission_RamId"):($("#RamId").val($("#RamId option:first").val()),localStorage.setItem("STCSubmission_RamId",$("#RamId option:first").val()))},error:function(e){alert("Failed to retrieve Account Managers."+e)}}),!1}function BindSolarCompany(e,t){var a=!1;$("#searchSolarCompany").val("");var o="",s="";return 0==t?(o=urlGetSolarCompanyByResellerId,s=e):(o=urlGetSolarCompanyByRAMID,s=t),$.ajax({type:"POST",url:o,dataType:"json",async:!1,data:{id:s},success:function(e){solarCompanyList=[],solarCompanyList.push({value:"0",text:"All"}),$.each(e,function(e,t){solarCompanyList.push({value:t.Value,text:t.Text}),0==a&&t.Value==localStorage.getItem("STCSubmission_SolarCompanyId")&&(a=!0)});var t=STCSubmission_SolarCompanyId;""==t||null==t?(a?$("#hdnsolarCompanyid").val(localStorage.getItem("STCSubmission_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val())),""==localStorage.getItem("STCSubmission_SolarCompanyId")&&($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val())),$.each(solarCompanyList,function(e,t){t.value==localStorage.getItem("STCSubmission_SolarCompanyId")&&($("#searchSolarCompany").val(t.text),$("#hdnsolarCompanyid").val(localStorage.getItem("STCSubmission_SolarCompanyId")))})):$("#hdnsolarCompanyid").val(t)},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),!1}function ResetSearchFilters(e){1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||($("#hdnsolarCompanyid").val("0"),$("#searchSolarCompany").val("All"),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val()),localStorage.setItem("STCSubmission_PVDSWHCode","")),1!=UserTypeID&&5!=UserTypeID&&2!=UserTypeID||(document.getElementById("ComplianceOfficerId").selectedIndex=0,localStorage.setItem("STCSubmission_ComplianceOfficerId",document.getElementById("ComplianceOfficerId").value)),localStorage.setItem("StaticSTCSubmission_RefJobId",""),localStorage.setItem("STCSubmission_OwnerName",""),localStorage.setItem("STCSubmission_InstallationAddress",""),$("#txtSubmissionFromDate").val(""),$("#txtSubmissionToDate").val(""),$("#txtSettlementFromDate").val(""),$("#txtSettlementToDate").val(""),$("#IsSPVRequired").val("All"),document.getElementById("IsSPVInstallationVerified").selectedIndex=0,document.getElementById("SettlementTermId").selectedIndex=0,localStorage.setItem("STCSubmission_STCSettlementTerm",document.getElementById("SettlementTermId").value),document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkHasBeenInvoiced").checked=!0,invoiced=0,SetParamsFromLocalStorage(),$("#datatable").dataTable().fnDraw()}function SearchJobSTCRecords(){1!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("STCSubmission_ComplianceOfficerId",document.getElementById("ComplianceOfficerId").value),1!=UserTypeID&&2!=UserTypeID&&3!=UserTypeID&&5!=UserTypeID||(localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val()),localStorage.setItem("STCSubmission_PVDSWHCode",$("#txtPVDSWHCode").val())),localStorage.setItem("StaticSTCSubmission_RefJobId",$("#txtRefJobId").val()),localStorage.setItem("STCSubmission_OwnerName",$("#txtOwnerName").val()),localStorage.setItem("STCSubmission_InstallationAddress",$("#txtInstallationAddress").val()),localStorage.setItem("STCSubmission_STCSettlementTerm",document.getElementById("SettlementTermId").value),$("#datatable").dataTable().fnDraw()}function GetDates(e){if(""!=e){var t=ConvertDateToTick(e,dateFormat);return moment(t).format("YYYY-MM-DD")}return""}function UpdateSettlementDate(e,t,a){obj=e,$(".error-message").hide(),$("#txtPopUpSettlementDate").val(a),$("#hdnJobId").val(t),$("#popupbox").modal(),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0)}function AddUpdatePVDSWHCode(e,t,a){obj=e,$(".error-message").hide(),$("#txtPopUpPvdSwhCode").val(a),$("#hdncode").val(t),$("#popupbox1").modal(),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0),setTimeout(function(){$("#txtPopUpPvdSwhCode").focus()},1e3)}function StcCompliance(e,t,a){$.ajaxSetup({cache:!1}),$.ajax({type:"POST",url:url_StatusCompliance,data:JSON.stringify({uniq_param:(new Date).getTime(),JobId:t,JobDetailsId:a}),cache:!1,dataType:"html",contentType:"application/json; charset=utf-8",success:function(t){$("#popupStcCompliance").modal({backdrop:"static",keyboard:!1}),$("#modalContentStcCompliance").html(""),$("#modalContentStcCompliance").html(t),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0)},error:function(e){}})}function LoadStc(e,t){$.ajax({url:url_STCJobPopup,type:"POST",data:{jobId:e,IsSubmissionScreen:1},async:!1,success:function(e){$("#STcBasicDetails").html(e),$("#StcModal").modal({backdrop:"static",keyboard:!1})}})}function LoadComplienceCheckList(){$("#collapsetow").hide();var e=$("#collapseOne").css("display");"none"==e?$("#collapseOne").show():$("#collapseOne").hide()}function LoadStcHistory(){$("#collapseOne").hide();var e=$("#collapsetow").css("display");"none"==e?$("#collapsetow").show():$("#collapsetow").hide()}function LoadComplienceCheckList(){$("#collapsetow").hide();var e=$("#collapseOne").css("display");"none"==e?$("#collapseOne").show():$("#collapseOne").hide()}function GetSubRecords(e,t){var a=!1,o=$("#ticon_"+e).closest("tr");return o.hasClass("open")?($(".open").removeClass("open"),$(".table-responsive .edit-panel").removeClass("edit-panel")):$.ajax({type:"POST",url:urlGetSubRecordsForJob,dataType:"html",async:!1,data:{id:e,isKendo:$(t).attr("isKendo")},success:function(t){$(".open").removeClass("open"),$(".table-responsive .hidden-row").remove(),o.addClass("open"),$("#ticon_"+e).closest("tr").after(t),o.closest("table").find("tr").each(function(){var e=$(this);e.hasClass("togglerow")&&(a=!1),a&&e.addClass("edit-panel"),e.hasClass("open")&&(a=!0)})},error:function(e){alert("Failed to retrieve job records."+e)}}),!1}function SetStageId(e){$(".filters-row > ul > li > a").css("background","#f7f7f7"),SelectedStageId=e;var t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#686868",SetParamsFromLocalStorage(),GetSTCJobStageCount(),$("#datatable").dataTable().fnDraw()}function GetSTCJobStageCount(){var e=0,t=0,a=0;return 1==UserTypeID||3==UserTypeID?(e=document.getElementById("ResellerId").value,t=document.getElementById("RamId").value,a=$("#hdnsolarCompanyid").val()):2==UserTypeID?(e=ResellerId,t=document.getElementById("RamId").value,a=$("#hdnsolarCompanyid").val()):5==UserTypeID?(e=ResellerId,t=LoggedInUserId,a=$("#hdnsolarCompanyid").val()):a=SolarCompanyId,$.ajax({type:"POST",url:urlGetSTCJobStageCount,dataType:"json",async:!1,data:{reseller:e,ram:t,sId:a,isAllScaJobView:isAllScaJobView,isShowOnlyAssignJobsSCO:isShowOnlyAssignJobsSCO},success:function(e){var t=0;$.each(e.lstSTCJobStagesCount,function(e,a){document.getElementById("jobstage_"+a.JobStageId).innerHTML=a.StageName+"<span>("+a.jobCount+")</span>",-1!=a.JobStageId&&(t+=a.jobCount)}),document.getElementById("jobstage_0").innerHTML="Show All<span>("+t+")</span>"},error:function(e){alert("Failed to retrieve count for Job Stages."+e)}}),!1}function AssignSelectedJobsToComplianceOfficer(){selectedRows=[],document.getElementById("AssignComplianceOfficerId").selectedIndex=0,$('#datatable tbody input[type="checkbox"]').each(function(){1==$(this).prop("checked")&&selectedRows.push($(this).attr("id").substring(4))}),null!=selectedRows&&selectedRows.length>0?1==UserTypeID?($(".error-message").hide(),$("#Assignjobpopup").modal()):3==UserTypeID&&AssignJobToFCO(LoggedInUserId):alert("Please select any job to assign.")}function AssignJobToFCO(e){$.ajax({url:urlAssignJobToFCO,type:"POST",async:!1,data:JSON.stringify({complianceOfficerID:e,jobs:selectedRows.join(",")}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Jobs assigned to compliance officer successfully."),$("#errorMsgRegion").show(),GetSTCJobStageCount(),$("#datatable").dataTable().fnDraw())}})}function SendSTCInvoice(e){selectedRows=[];var t=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var a=$(this).parent().parent().find(".clsLabelPVDSWH").text(),o=$(this).parent().parent().find(".clsDateLabel").text(),s=$(this).attr("IsInvoiced"),l=$(this).attr("IsCreditNote"),r=($(this).attr("IsPayment"),$(this).attr("STCStatus")),n=$(this).attr("term"),i=$(this).attr("custterm");$(this).attr("STCInvoiceCount");if(12==n||10==n&&12==i)return alert("Can't generate STCInvoice for STC record which has PeakPay as settlement term."),t=!1,!1;if(""==a||null==a)alert("Can't generate STCInvoice for STC record which has not PVD code."),t=!1;else if("On Approval"==o&&"CER Approved"!=r)alert("Can't generate STCInvoice On Approval STC record"),t=!1;else if("true"==s&&"1"==e)alert("STCInvoice has been already generated for this job."),t=!1;else if("true"==l&&"0"==e)alert("CreditNote has been already generated for this job."),t=!1;else if("false"==s&&"0"==e)alert("First generate STC Invoice then after credit note will be generated."),t=!1;else{var d=$(this).attr("id").substring(4),c=$(this).attr("term"),u=$(this).attr("JobId");selectedRows.push(d+"_"+c+"_"+u)}}}),t)if(null!=selectedRows&&selectedRows.length>0){var a=0;1!=UserTypeID&&3!=UserTypeID||(a=document.getElementById("ResellerId").value),$.ajax({url:urlGenerateSTCInvoiceForSelectedJobs,type:"POST",data:JSON.stringify({resellerId:a,jobs:selectedRows.join(","),isstcinvoice:e,solarCompanyId:$("#hdnsolarCompanyid").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e&&0==e.status&&("specified method is not supported."==e.error.toLowerCase()||"renewtokenexception"==e.error.toLowerCase()?window.open(urlConnect,"_blank"):"sessiontimeout"==e.error.toLowerCase()&&(window.location.href=urlLogout)),e.success&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Invoice is generated successfully for selected jobs."),$("#errorMsgRegion").show(),$("#datatable").dataTable().fnDraw())},error:function(e){alert("error")}})}else alert("Please select any record to generate STC Invoice.")}function CreateRECEntry(){selectedRows=[],selectedRows_JobIDs=[];var e=!0,t=[];return $("#datatable tbody input:checked").length>100?(alert("Maximum 100 jobs can be created in rec-registry at a time."),!1):0==$("#datatable tbody input:checked").length?(alert("Please select any job to create entry in REC"),!1):(JobType="",$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(r=$(this).attr("IsInvoiced"),STCSettlementTerm=$(this).attr("term"),""!=JobType&&JobType!=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype"))return alert("All selected Jobs should have same Job Type to generate REC Registry entries"),e=!1,!1;JobType=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype");var a=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(""==a||null==a||"Ready To Create"!=a.trim())return alert("Can't generate REC Registry for selected STC records."),e=!1,!1;var o=$(this).attr("id").substring(4),s=$(this).attr("term"),l=$(this).attr("custterm"),r=$(this).attr("IsInvoiced"),n=$(this).attr("JobId"),i="undefined"==$(this).attr("gbbatchrecuploadid")||""==$(this).attr("gbbatchrecuploadid")?"":"_"+$(this).attr("gbbatchrecuploadid"),d=$(this).attr("IsSPVRequired"),c=$(this).attr("IsSPVInstallationVerified");if("true"==d.toLowerCase()&&("false"==c.toLowerCase()||"null"==c))return alert("Installation verification not done yet."),e=!1,!1;"false"!=r.toLowerCase()||4==s||8==s||12==s||10==s||4==l&&8==l&&12==l||selectedRows.push(o+"_"+s+"_"+n);var u=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");selectedRows_JobIDs.push(u+i),t.push(u)}}),void(null!=selectedRows_JobIDs&&selectedRows_JobIDs.length>0&&e&&(1!=UserTypeID&&3!=UserTypeID||(rId=document.getElementById("ResellerId").value),$.ajax({url:urlCheckResellerRECCredentials,type:"GET",data:{resellerID:rId.toString(),JobIds:t.join(",")},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){if("true"==e.status.toString()){userid=e.ResellerDetails[0].Id;for(var t=0;t<e.ResellerDetails.length;t++)null!=e.ResellerDetails[t].RECLoginType&&""!=e.ResellerDetails[t].RECLoginType&&"Admin"==e.ResellerDetails[t].RECLoginType?($("#defaultCompName").text(e.ResellerDetails[t].RECCompName),$("#defaultAccName").text(e.ResellerDetails[t].RECAccName),$("#hdnDefaultCERLoginId").val(e.ResellerDetails[t].CERLoginId),$("#hdnDefaultCERPassword").val(e.ResellerDetails[t].CERPassword),$("#hdnDefaultLoginType").val(e.ResellerDetails[t].RECLoginType)):($("#otherCompName").text(e.ResellerDetails[t].RECCompName),$("#otherAccName").text(e.ResellerDetails[t].RECAccName),$("#hdnOtherCERLoginId").val(e.ResellerDetails[t].CERLoginId),$("#hdnOtherCERPassword").val(e.ResellerDetails[t].CERPassword),$("#hdnOtherLoginType").val(e.ResellerDetails[t].RECLoginType))}1==UserTypeID||3==UserTypeID?$("#rec-Login").modal({backdrop:"static",keyboard:!1}):""!=$("#hdnDefaultCERLoginId").val()&&""!=$("#hdnDefaultCERPassword").val()&&""!=$("#defaultAccName").text()?UseDefault():""!=$("#hdnOtherCERLoginId").val()&&""!=$("#hdnOtherCERPassword").val()&&""!=$("#otherAccName").text()?UseOther():alert("REC Credentials not found. Please Update it from Profile"),"false"==e.status.toString()&&e.lstJobIds.length>0&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"["+e.strlstJobIds+"] Jobs are already In Progress or SuccessFully Uploaded on REC."),$("#errorMsgRegion").show())}}))))}function CreateInRECEntry(){$.ajax({url:urlCreateEntryInRECForSelectedJobs,type:"POST",data:JSON.stringify({resellerId:rId,jobs:selectedRows.join(","),JobIDs:selectedRows_JobIDs.join(","),JobType:JobType,TotalSTC:$("#btotalTradedSTC").text(),CERLoginId:$("#hdnCERLoginId").val(),CERPassword:$("#hdnCERPassword").val(),RECAccName:$("#hdnRECAccName").val(),RECCompanyName:$("#hdnRECCompanyName").val(),LoginType:$("#hdnLoginType").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Failed"==e.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()),$(window).scrollTop(0),setTimeout(function(){SetParamsFromLocalStorage(),$("#datatable").dataTable().fnDraw(),GetSTCJobStageCount()},1e3)}})}function UseDefault(){""!=$("#hdnDefaultCERLoginId").val()&&""!=$("#hdnDefaultCERPassword").val()&&""!=$("#defaultAccName").text()?(IsDefaultRECCredentials=!0,$("#hdnCERLoginId").val($("#hdnDefaultCERLoginId").val()),$("#hdnCERPassword").val($("#hdnDefaultCERPassword").val()),$("#hdnRECAccName").val($("#defaultAccName").text()),$("#hdnRECCompanyName").val($("#defaultCompName").text()),$("#hdnLoginType").val($("#hdnDefaultLoginType").val()),CreateInRECEntry(),$("#rec-Login").modal("toggle")):alert("Default Credentials are blank")}function UseOther(){""!=$("#hdnOtherCERLoginId").val()&&""!=$("#hdnOtherCERPassword").val()&&""!=$("#otherAccName").text()?(IsDefaultRECCredentials=!1,$("#hdnCERLoginId").val($("#hdnOtherCERLoginId").val()),$("#hdnCERPassword").val($("#hdnOtherCERPassword").val()),$("#hdnRECAccName").val($("#otherAccName").text()),$("#hdnRECCompanyName").val($("#otherCompName").text()),$("#hdnLoginType").val($("#hdnOtherLoginType").val()),CreateInRECEntry(),$("#rec-Login").modal("toggle")):alert("Credentials are blank")}function UpdateUser(){$("#rec-Login").modal("toggle"),window.open(urlEditUser+"/"+userid+"#horizontalTab3","_blank")}function SetSTCInvoiceStatus(){document.getElementById("chkNotInvoiced").checked&&(invoiced=2),document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=1),document.getElementById("chkNotInvoiced").checked&&document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=0),0==document.getElementById("chkNotInvoiced").checked&&0==document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=3)}function ValidateLettersWithSpaceOnly(e){e=e||event;var t=e.charCode?e.charCode:e.keyCode?e.keyCode:e.which?e.which:0;return!(t>32&&(t<65||t>90)&&(t<97||t>122)&&(t<=47||t>58))}function CheckTextContent(){var e,t=$("#txtPopUpPvdSwhCode").val(),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ";for(i=0;i<t.length;i++)if(e=t.charAt(i),-1==a.indexOf(e))return alert("Special characters are not allowed for PVD code."),$("#txtPopUpPvdSwhCode").val(""),!1;return!1}function ToDate(e){if(null!=e&&""!=e){var t=ConvertDateToTick(e,"dd/mm/yyyy");tDate=moment(t).format("MM/DD/YYYY");var a=new Date(tDate);return moment(a).format(dateFormatMoment)}return""}function SetParamsFromLocalStorage(){1!=UserTypeID&&2!=UserTypeID&&3!=UserTypeID&&5!=UserTypeID||$("#txtPVDSWHCode").val(localStorage.getItem("STCSubmission_PVDSWHCode")),$("#txtRefJobId").val(localStorage.getItem("StaticSTCSubmission_RefJobId")),$("#txtOwnerName").val(localStorage.getItem("STCSubmission_OwnerName")),$("#txtInstallationAddress").val(localStorage.getItem("STCSubmission_InstallationAddress"))}function BindSTCJobStages(){return $("#STCJobStageID").empty(),$.ajax({type:"POST",url:urlGetSTCJobStages,dataType:"json",async:!1,success:function(e){$("#STCJobStageID").append('<option value="0">Select STC job stage</option>'),$.each(e,function(e,t){$("#STCJobStageID").append('<option value="'+t.Value+'">'+t.Text+"</option>")})},error:function(e){alert("Failed to retrieve Job Stages."+e)}}),!1}function BulkChangeSTCJobStage(){if(!(document.getElementById("STCJobStageID").selectedIndex>0))return alert("Please select STC Job Stage first."),!1;var e="";selectedRows=[];var t=[],a=[],o=!0,s=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if("CER Approved"==$(this).attr("STCStatus")||"New Submission"==$(this).attr("STCStatus"))return o=!1,!1;if(22==document.getElementById("STCJobStageID").value&&5==$(this).attr("term")&&!$(this).attr("PartialValid"))return s=!1,!1;14==document.getElementById("STCJobStageID").value&&"false"==$(this).attr("IsInvoiced")?(e="are you sure you want to change this status as per normal, and status change but no credit note is created because no invoice has been generated.",selectedRows.push($(this).attr("id").substring(4)),t.push($(this).attr("jobid"))):(selectedRows.push($(this).attr("id").substring(4)),t.push($(this).attr("jobid")));var l={JobId:$(this).attr("jobid"),STCJobDetailsID:$(this).attr("id").substring(4)};a.push(l)}}),s){if(!o)return alert("You can not change stc status of job which have CER Approved or New Submission STC status."),!1;if(!(null!=selectedRows&&selectedRows.length>0))return alert("Please select atleast one Job to update STC Stage."),!1;""==e&&(e=22==document.getElementById("STCJobStageID").value?"Are you sure you want to change stc status  as CERApproved of selected jobs as you can not reverse it after change ?":"Are you sure you want to change stc status of selected jobs ?");var l=confirm(e);l&&$.ajax({type:"POST",url:urlBulkChangeSTCJobStage,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcjobstage:document.getElementById("STCJobStageID").value,stcjobids:selectedRows.join(","),checkSPVrequired:a}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Job Stages updated successfully."),$("#errorMsgRegion").show(),GetSTCJobStageCount(),$("#datatable").dataTable().fnDraw(),document.getElementById("STCJobStageID").selectedIndex=0)},error:function(e){}})}else alert("You can not change status to CERApproved which has STCStatus Partial and first invoice is not yet generated.")}function InstallationVerifyAgain(e){if(e.disabled=!0,selectedRows=[],0==$("#datatable tbody input:checked").length)return alert("Please select atleast one Job for Installation Verify."),e.disabled=!1,!1;var t=!0,a=!0;return $('#datatable tbody input[type="checkbox"]:checked').each(function(o,s){return STCStatus=$(this).attr("STCStatus"),IsSPVRequired=$(this).attr("IsSPVRequired"),IsSPVInstallationVerified=$(this).attr("isspvinstallationverified"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim()?(a=!1,!1):"true"!=IsSPVRequired||"true"==IsSPVInstallationVerified?(t=!1,e.disabled=!1,!1):void 0}),0==t?(alert("Selected job must have is spv required true and spv installation verify not true."),e.disabled=!1,!1):0==a?(alert("Selected Job STC status must be 'Ready To Create'."),e.disabled=!1,!1):void $('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){var t;if(STCStatus=$(this).attr("STCStatus"),IsSPVRequired=$(this).attr("IsSPVRequired"),IsSPVInstallationVerified=$(this).attr("isspvinstallationverified"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim())return alert("STC status must be 'Ready To Create'."),flage=!1,e.disabled=!1,!1;if("true"!=IsSPVRequired||"false"!=IsSPVInstallationVerified&&"null"!=IsSPVInstallationVerified||(selectedRows.push($(this).attr("id").substring(4)),$.ajax({type:"POST",url:urlInstallationVerifyAgain,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcjobids:selectedRows.join(",")}),success:function(a){a.success&&(e.disabled=!1,$(".alert").hide(),a.IsError?($("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),t="Something went wrong,Please check SPV failure reason."):($("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),t="SPV Installation verification done successfully."),$("#errorMsgRegion").html(closeButton+t),$("#errorMsgRegion").show(),$("#datatable").dataTable().fnDraw(),document.getElementById("STCJobStageID").selectedIndex=0)},error:function(t){e.disabled=!1}})),"true"!=IsSPVRequired||"true"==IsSPVInstallationVerified)return alert("Selected job must have is spv required true and spv installation verify not true."),flage=!1,e.disabled=!1,!1}})}function UpdateJobStatusFromREC(e){var t=$("#ResellerId").val(),a=$("#UpdateJobStatusFromRECSwitch").prop("checked"),o=!0;a&&e&&(o=confirm("Are you sure you want to switch on Auto CER Update On? On switching yes all CER data will get updated."));var s=e?a?"Update job status from rec has been switched ON":"Update job status from rec has been switched OFF":"Updating job status from rec";o?$.ajax({url:urlUpdateJobStatusFromREC,type:"post",dataType:"json",async:!1,data:{resellerId:t,isSwitch:e,isAutoUpdateCEROn:a},success:function(e){e.status&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+s),$("#errorMsgRegion").show(),showHideBtnUpdateJobStatusFromREC(a),$("#datatable").dataTable().fnDraw())},error:function(e){alert("Failed to update."+e)}}):$("#UpdateJobStatusFromRECSwitch").prop("checked",!1)}function GetUpdateJobStatusFromRecByResellerId(e){$.ajax({url:urlGetUpdateJobStatusFromRecByResellerId,type:"get",dataType:"json",async:!1,data:{resellerId:e},success:function(e){$("#errorMsgRegion").hide(),$("#UpdateJobStatusFromRECSwitch").prop("checked",e.isAutoUpdateCEROn),showHideBtnUpdateJobStatusFromREC(e.isAutoUpdateCEROn)},error:function(e){alert("Failed to retrive."+e)}})}function showHideBtnUpdateJobStatusFromREC(e){e?$(".btnUpdateJobStatusFromREC").hide():$(".btnUpdateJobStatusFromREC").show()}function ToDate(e){if(null!=e&&""!=e){var t=ConvertDateToTick(e,"dd/mm/yyyy");tDate=moment(t).format("MM/DD/YYYY");var a=new Date(tDate);return moment(a).format(dateFormat.toUpperCase())}return""}function GetRecFailureReason(){window.open(urlRecFailureReason,"_blank")}function GetSPVFailureReason(){$("#spv-failure-reason").modal({backdrop:"static",keyboard:!1}),$("#errorMsgRegionSPVFailure").hide()}function RemoveSelectedJobFromBatch(e){event.preventDefault();$("#accordionExample").find(".collapse.in").attr("id");$.ajax({url:urlRemoveJobFromBatch,type:"POST",dataType:"json",async:!1,data:{StcJobdetailsId:e},success:function(e){e.status?($("#errorMsgRegionRECFailure").removeClass("alert-danger"),$("#errorMsgRegionRECFailure").addClass("alert-success"),$("#errorMsgRegionRECFailure").html(closeButton+"Remove Job From Batch Successfully"),$("#errorMsgRegionRECFailure").show(),GridConfig[0].IsKendoGrid?$("#datatable").data("kendoGrid").dataSource.read():$("#datatable").dataTable().fnDraw()):($("#errorMsgRegionRECFailure").html(closeButton+"Something happend not remove job from batch"),$("#errorMsgRegionRECFailure").show())},error:function(e){alert("Failed to retrive."+e)}})}function ResetSPVInstaller(){selectedRows=[];var e=[],t=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select atleast one Job for spv release."),!1;if($('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){var a=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(""==a||null==a||"Ready To Create"!=a.trim())return alert("STC status must be 'Ready To Create'."),t=!1,!1;if(IsSPVRequired=$(this).attr("IsSPVRequired"),"true"!=IsSPVRequired)return alert("Selected job must have is spv required true."),t=!1,!1;var o=$(this).attr("id").substring(4);selectedRows.push(o);var s=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");e.push(s)}}),null!=selectedRows&&selectedRows.length>0&&null!=e&&e.length>0&&t){console.log(selectedRows),console.log(e);var a=confirm("Are you sure you want to release spv of selected jobs ? ");a&&$.ajax({type:"POST",url:urlResetSPVInstaller,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcJobDetailIds:selectedRows.join(","),stcjobids:e.join(",")}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Spv release of selected job done successfully."),$("#errorMsgRegion").show(),$("#datatable").dataTable().fnDraw())},error:function(e){}})}}function SearchSPVFailureReason(){$("#spv-failure-reason-div").load(urlGetSpvFailureReason+"?resellerId="+$("#ResellerId").val()+"&RefJobId="+$("#txtSpvRefJobId").val().trim(),function(){})}function ResetSPVSearchFilters(e){$("#txtSpvRefJobId").val(""),SearchSPVFailureReason()}function SPVReset(){selectedRows=[];var e=[],t=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select atleast one Job for spv reset."),!1;if($('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){if(STCStatus=$(this).attr("STCStatus"),IsRelease=$(this).attr("IsRelease"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim())return alert("STC status must be 'Ready To Create'."),t=!1,!1;if("true"!=IsRelease)return alert("Selected job must have is spv release true."),t=!1,!1;var a=$(this).attr("id").substring(4);selectedRows.push(a);var o=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");e.push(o)}}),null!=selectedRows&&selectedRows.length>0&&null!=e&&e.length>0&&t){console.log(selectedRows),console.log(e);var a=confirm("Are you sure you want to reset spv of selected jobs ? ");a&&$.ajax({type:"POST",url:urlSPVReset,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcJobDetailIds:selectedRows.join(","),jobids:e.join(",")}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Spv reset of selected job done successfully."),$("#errorMsgRegion").show(),$("#datatable").dataTable().fnDraw())},error:function(e){}})}}function searchSpvFailureReasonByJobIdAndRefNumber(){var e,t,a,o,s,l,r="#accordionExample .panel",n=0;if(e=document.getElementById("txtSpvRefJobId"),t=e.value.toUpperCase(),s=$(r).length,s>0){for(o=0;o<s;o++)l=$(r+":eq("+o+")"),a=$(l).find(".spv-search:eq(0)"),spvsearchjobid=a.attr("data-jobid"),spvsearchrefnumber=a.attr("data-refnumber"),spvsearchjobid.toUpperCase().indexOf(t)>-1||spvsearchrefnumber.toUpperCase().indexOf(t)>-1?(n=1,$(l).css("display","")):$(l).css("display","none");0==n?($("#accordionExample").hide(),$(".no-record-found").show()):($("#accordionExample").show(),$(".no-record-found").hide())}else $("#accordionExample").hide(),$(".no-record-found").show()}var IsDefaultRECCredentials=!0,rId=0,selectedRows_JobIDs=[],JobType="";$(document).ready(function(){if($("#searchSolarCompany").autocomplete({minLength:0,source:function(e,t){var a=[];$("#hdnsolarCompanyid").val(0),$.each(solarCompanyList,function(e,t){t.text.toLowerCase().indexOf($("#searchSolarCompany").val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value})}),t($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id}}))},select:function(e,t){$("#hdnsolarCompanyid").val(t.item.id)}}).on("focus",function(){$(this).keydown()}),$.ui.autocomplete.prototype._renderItem=function(e,t){var a=new RegExp($.trim(this.term.toLowerCase())),o=t.label.replace(a,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",t).append("<a>"+o+"</a>").appendTo(e)},null!=STCSubmission_Status&&""!=STCSubmission_Status){SelectedStageId=STCSubmission_Status;$(".filters-row > ul > li > a").css("background","#f7f7f7");var e=document.getElementById("jobstage_"+SelectedStageId);e.style.backgroundColor="#686868",1!=UserTypeID&&3!=UserTypeID||(document.getElementById("RamId").selectedIndex=0),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("STCSubmission_PVDSWHCode",""),1!=UserTypeID&&5!=UserTypeID&&2!=UserTypeID||(document.getElementById("ComplianceOfficerId").selectedIndex=0),localStorage.setItem("StaticSTCSubmission_RefJobId",""),
localStorage.setItem("STCSubmission_OwnerName",""),localStorage.setItem("STCSubmission_InstallationAddress",""),$("#txtSubmissionFromDate").val(""),$("#txtSubmissionToDate").val(""),$("#txtSettlementFromDate").val(""),$("#txtSettlementToDate").val(""),$("#IsSPVRequired").val("All"),$("#IsSPVInstallationVerified").val("All"),document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkHasBeenInvoiced").checked=!0,invoiced=0,GetSTCJobStageCount()}if(null!=ComplianceIssuesDashboardStatus&&""!=ComplianceIssuesDashboardStatus){SelectedStageId=ComplianceIssuesDashboardStatus;$(".filters-row > ul > li > a").css("background","#f7f7f7");e=document.getElementById("jobstage_"+SelectedStageId);e.style.backgroundColor="#686868",1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||$("#txtPVDSWHCode").val(""),1!=UserTypeID&&5!=UserTypeID&&2!=UserTypeID||(document.getElementById("ComplianceOfficerId").selectedIndex=0),$("#txtRefJobId").val(""),$("#txtOwnerName").val(""),$("#txtInstallationAddress").val(""),$("#txtSubmissionFromDate").val(""),$("#txtSubmissionToDate").val(""),$("#txtSettlementFromDate").val(""),$("#txtSettlementToDate").val(""),document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkHasBeenInvoiced").checked=!0,invoiced=0,GetSTCJobStageCount()}if(BindSTCJobStages(),$("#txtSubmissionFromDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=$("#txtSubmissionToDate").val()){var e=new Date(ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat)),t=new Date(ConvertDateToTick($("#txtSubmissionToDate").val(),dateFormat));e>t&&$("#txtSubmissionToDate").val("")}var a=ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat);tDate=moment(a).format("MM/DD/YYYY"),$("#txtSubmissionToDate").data("datepicker")&&$("#txtSubmissionToDate").data("datepicker").setStartDate(new Date(tDate))}),$("#txtSubmissionToDate").datepicker({format:dateFormat,autoclose:!0}),$("#txtSubmissionToDate").change(function(){new Date(ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat)),new Date(ConvertDateToTick($("#txtSubmissionToDate").val(),dateFormat))}),$("#ExportCSVAll").click(function(e){var t="";if(0==$("#datatable tbody input:checked").length)return alert("Please select any job to export csv."),!1;if(1==$("#chkAll").prop("checked"))t="";else{var a=[];$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var e=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");a.push(e)}}),null!=a&&a.length>0&&(t=a.join(","))}var o="",s="",l="",r="",n="";1!=UserTypeID&&3!=UserTypeID||(o=document.getElementById("ResellerId").value),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(s=0==$("#hdnsolarCompanyid").val()?-1:$("#hdnsolarCompanyid").val(),l=$("#txtPVDSWHCode").val()),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID||(r=document.getElementById("RamId").value),1!=UserTypeID&&5!=UserTypeID&&2!=UserTypeID||(n=document.getElementById("ComplianceOfficerId").value);var i="No",d="No";document.getElementById("chkNotInvoiced").checked&&(i="Yes"),document.getElementById("chkHasBeenInvoiced").checked&&(d="Yes"),window.location.href=urlBulkUploadAll+"?JobID="+t+"&stageid="+SelectedStageId+"&reseller="+o+"&solarcompanyid="+s+"&RecCode="+l+"&RAM="+r+"&complianceOfficerId="+n+"&RefJobId="+$("#txtRefJobId").val()+"&ownername="+$("#txtOwnerName").val()+"&installationaddress="+$("#txtInstallationAddress").val()+"&submissionfromdate="+GetDates($("#txtSubmissionFromDate").val())+"&submissiontodate="+GetDates($("#txtSubmissionToDate").val())+"&settlementfromdate="+GetDates($("#txtSettlementFromDate").val())+"&settlementtodate="+GetDates($("#txtSettlementToDate").val())+"&IsInvoiced="+invoiced+"&SettlementTermId="+$("#SettlementTermId").val()+"&complianceOfficername="+$("#ComplianceOfficerId option:selected").text()+"&solarcompanyname="+$("#searchSolarCompany").val()+"&SettlementTermname="+$("#SettlementTermId option:selected").text()+"&NotInvoiced="+i+"&HasBeenInvoiced="+d+"&ResellerName="+$("#ResellerId option:selected").text()+"&RamName="+$("#RamId option:selected").text()+"&isAllScaJobView="+isAllScaJobView+"&isShowOnlyAssignJobsSCO="+isShowOnlyAssignJobsSCO+"&isSPVRequired="+$("#IsSPVRequired").val()+"&isSPVInstallationVerified="+$("#IsSPVInstallationVerified").val()}),$("#ExportCSV").click(function(e){selectedRows=[];var t=[],a=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select any job to export csv."),!1;var o="";$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(""!=o&&o!=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype"))return alert("All selected Jobs should have same job type to export csv."),a=!1,!1;o=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype");var e=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(""==e||null==e||"Ready To Create"!=e.trim())return alert("STC status must be 'Ready To Create'."),!1;var s=$(this).attr("id").substring(4),l=$(this).attr("term");selectedRows.push(s+"_"+l);var r=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");t.push(r)}}),null!=selectedRows&&selectedRows.length>0&&a&&(console.log(o),"1"==o?$.ajax({url:checkInstallationDateURL+"?JobID="+t.join(","),type:"POST",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"false"==e.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+e.message),$("#errorMsgRegion").show()):window.location.href=urlBulkUpload+"?JobID="+t.join(",")}}):window.location.href=urlBulkUploadSWHCSV+"?JobID="+t.join(","))}),$("#txtSettlementFromDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=$("#txtSettlementToDate").val()){var e=new Date(ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat)),t=new Date(ConvertDateToTick($("#txtSettlementToDate").val(),dateFormat));e>t&&$("#txtSettlementToDate").val("")}var a=ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat);tDate=moment(a).format("MM/DD/YYYY"),$("#txtSettlementToDate").data("datepicker")&&$("#txtSettlementToDate").data("datepicker").setStartDate(new Date(tDate))}),$("#txtSettlementToDate").datepicker({format:dateFormat,autoclose:!0}),$("#txtSettlementToDate").change(function(){new Date(ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat)),new Date(ConvertDateToTick($("#txtSettlementToDate").val(),dateFormat))}),$("#txtPopUpSettlementDate").datepicker({format:dateFormat,autoclose:!0}),1==UserTypeID||3==UserTypeID){var t=!1;$.ajax({type:"get",url:urlGetReseller,dataType:"json",data:"",async:!1,success:function(e){$.each(e,function(e,a){$("#ResellerId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),0==t&&a.Value==localStorage.getItem("STCSubmission_ResellerId")&&(t=!0)});var a=STCSubmission_ResellerId;""==a||"0"==a?t?document.getElementById("ResellerId").value=localStorage.getItem("STCSubmission_ResellerId"):($("#ResellerId").val($("#ResellerId option:first").val()),localStorage.setItem("STCSubmission_ResellerId",$("#ResellerId option:first").val())):$("#ResellerId").val(a),GetRAMByResellerId($("#ResellerId").val()),BindSolarCompany($("#ResellerId").val(),document.getElementById("RamId").value),GetSTCJobStageCount()},error:function(e){alert("Failed to retrieve Resellers."+e)}})}1==UserTypeID&&$("#ResellerId").val()>0&&(GetFCOByResellerId($("#ResellerId").val()),GetUpdateJobStatusFromRecByResellerId($("#ResellerId").val())),2==UserTypeID&&(GetFCOByResellerId(ResellerId),GetRAMByResellerId(ResellerId),BindSolarCompany(ResellerId,document.getElementById("RamId").value),GetSTCJobStageCount()),8==UserTypeID&&GetSTCJobStageCount(),5==UserTypeID&&(GetFCOByResellerId(ResellerId),"true"==isAllScaJobView?BindSolarCompany(ResellerId,0):BindSolarCompany(0,LoggedInUserId),GetSTCJobStageCount()),1==UserTypeID||3==UserTypeID?$("#ResellerId").focus():2==UserTypeID?$("#searchSolarCompany").focus():5==UserTypeID?$("#RamId").focus():$("#txtRefJobId").focus(),SetParamsFromLocalStorage(),$("#ResellerId").change(function(){$("#ResellerId").val()>0?(GetFCOByResellerId($("#ResellerId").val()),GetRAMByResellerId($("#ResellerId").val()),BindSolarCompany($("#ResellerId").val(),0),GetSTCJobStageCount(),GetUpdateJobStatusFromRecByResellerId($("#ResellerId").val()),localStorage.setItem("STCSubmission_ResellerId",document.getElementById("ResellerId").value)):($("#RamId").empty(),$("#RamId").append('<option value="0">Select</option>')),$("#datatable").dataTable().fnDraw()}),$("#RamId").change(function(){$("#RamId").val()>0?BindSolarCompany(0,$("#RamId").val()):BindSolarCompany($("#ResellerId").val(),0),GetSTCJobStageCount(),localStorage.setItem("STCSubmission_RamId",document.getElementById("RamId").value),$("#datatable").dataTable().fnDraw()}),$("#btnSaveSettlementDate").click(function(e){""!=$("#txtPopUpSettlementDate ").val()?($("#popupbox").modal("hide"),$.ajax({type:"get",url:urlUpdateSettlementDate,dataType:"json",async:!1,data:{jobId:$("#hdnJobId").val(),sDate:GetDates($("#txtPopUpSettlementDate").val()),isMultipleRecords:$("#isMultipleRecords").val()},success:function(e){e.success&&(obj.parentNode.innerHTML=$("#txtPopUpSettlementDate").val()+'<a title="edit" href="#" onclick="UpdateSettlementDate(this,'+$("#hdnJobId").val()+",'"+$("#txtPopUpSettlementDate").val()+'\');" class="edit sprite-img grid-edit-ic" style="text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>',$(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Settlement date updated successfully."),$("#errorMsgRegion").show())},error:function(e){alert("Failed to update settlement date."+e)}}),$(".error-message").hide()):$(".error-message").show()}),$("#aSwitch").click(function(){window.location.href="/Job/STCSubmission?IsKendoStcSubmissionPage=true"}),$("#btnSavePvdSwhCode").click(function(e){""!=$("#txtPopUpPvdSwhCode").val()?($("#popupbox1").modal("hide"),$.ajax({type:"get",url:urlUpdatePVDSWHCode,dataType:"json",async:!1,data:{jobId:$("#hdncode").val(),pvdswhCode:$("#txtPopUpPvdSwhCode").val(),isMultipleRecords:$("#isMultipleRecords").val()},success:function(e){e.success&&(obj.parentNode.innerHTML='<lable class="clsLabelPVDSWH" >'+$("#txtPopUpPvdSwhCode").val()+'</lable><a title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+$("#hdncode").val()+",'"+$("#txtPopUpPvdSwhCode").val()+'\');" class="edit sprite-img grid-edit-ic" style="text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>',$(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"PVD/SWH code updated successfully."),$("#errorMsgRegion").show())},error:function(e){alert("Failed to update settlement date."+e)}}),$(".error-message").hide()):$(".error-message").show()}),$("#btnAssignJobs").click(function(e){0!=document.getElementById("AssignComplianceOfficerId").value?($("#Assignjobpopup").modal("hide"),AssignJobToFCO(document.getElementById("AssignComplianceOfficerId").value),$(".error-message").hide()):$(".error-message").show()}),$("#datatable").DataTable({iDisplayLength:GridConfig[0].PageSize,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"Id",orderable:!1,render:function(e,t,a,o){var s="";return null!=a.GBBatchRECUploadId&&""!=a.GBBatchRECUploadId&&(s=a.GBBatchRECUploadId.split("-").length>1&&""!=a.GBBatchRECUploadId.split("-")[1]?a.GBBatchRECUploadId:a.GBBatchRECUploadId.split("-")[0]),1==$("#chkAll").prop("checked")?'<input type="checkbox"  STCStatusId="'+a.STCStatusId+'" jobId="'+a.JobID+'" id="chk_'+a.STCJobDetailsID+'" term="'+a.STCSettlementTerm+'" custTerm="'+a.CustomSettlementTerm+'" IsInvoiced="'+a.IsInvoiced+'" STCInvoiceCount="'+a.STCInvoiceCount+'" IsCreditNote="'+a.IsCreditNote+'"  IsPayment="'+a.IsPayment+'" STCStatus="'+a.STCStatus+'" PartialValid="'+a.IsPartialValidForSTCInvoice+'" GBBatchRECUploadId="'+s+'" IsSPVRequired="'+a.IsSPVRequired+'" IsSPVInstallationVerified="'+a.IsSPVInstallationVerified+'" IsRelease="'+a.IsRelease+'" STC="'+a.STC+'" checked >':'<input type="checkbox"  STCStatusId="'+a.STCStatusId+'" jobId="'+a.JobID+'" id="chk_'+a.STCJobDetailsID+'" term="'+a.STCSettlementTerm+'" custTerm="'+a.CustomSettlementTerm+'" IsInvoiced="'+a.IsInvoiced+'" STCInvoiceCount="'+a.STCInvoiceCount+'" IsCreditNote="'+a.IsCreditNote+'" IsPayment="'+a.IsPayment+'" STCStatus="'+a.STCStatus+'" PartialValid="'+a.IsPartialValidForSTCInvoice+'" GBBatchRECUploadId="'+s+'" IsSPVRequired="'+a.IsSPVRequired+'" IsSPVInstallationVerified="'+a.IsSPVInstallationVerified+'" IsRelease="'+a.IsRelease+'" STC="'+a.STC+'">'}},{data:"HasMultipleRecords",render:function(e,t,a,o){return a.HasMultipleRecords?'<i id="ticon_'+a.JobID+'" isKendo = false class="sprite-img grid-toggle-ic" style="cursor:pointer" onclick="GetSubRecords('+a.JobID+',this);"></i>':""}},{data:"IsSPVRequired",render:function(e,t,a,o){return a.IsSPVRequired?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},orderable:!1},{data:"IsSPVInstallationVerified",visible:1==UserTypeID||2==UserTypeID||3==UserTypeID||5==UserTypeID||4==UserTypeID,render:function(e,t,a,o){return null==a.IsSPVInstallationVerified?'<span style="font-weight: bold;">Not Yet Verified</span>':a.IsSPVInstallationVerified?'<span style="font-weight: bold;color: Green;">Verified</span>':'<span style="font-weight: bold;color: Red;">Verify Failed</span>'},orderable:!1},{data:"RefNumberOwnerName",render:function(e,t,a,o){if(null!=a.RefNumberOwnerName){var s=urlJobIndex+"?id="+a.Id;return'<a href="'+s+'" style="text-decoration:none;" target="_blank">'+a.RefNumberOwnerName+"</a>"}return""}},{data:"InstallationAddress"},{data:"STCStatus",render:function(e,t,a,o){return 19!=a.STCStatusId||null==a.IsSPVInstallationVerified||a.IsSPVInstallationVerified?'<lable class="clsSTCStatusLabel" data-JobID='+a.JobID+" data-JobType="+a.JobType+' style="color:'+a.ColorCode+'">'+a.STCStatus+"</lable>":'<lable class="clsSTCStatusLabel Installation-verified-false" data-JobID='+a.JobID+" data-JobType="+a.JobType+' style="color:'+a.ColorCode+'">'+a.STCStatus+" </lable> "}},{data:"GBBatchRECUploadId",visible:1==UserTypeID||3==UserTypeID,render:function(e,t,a,o){if(null!=a.GBBatchRECUploadId&&""!=a.GBBatchRECUploadId){var s="text-decoration:none;margin-left:5px";return"<lable>"+(a.GBBatchRECUploadId.split("-").length>1&&""!=a.GBBatchRECUploadId.split("-")[1]?a.GBBatchRECUploadId:a.GBBatchRECUploadId.split("-")[0])+'</lable><a title="delete" href="#" onclick="RemoveSelectedJobFromBatch('+a.STCJobDetailsID+');" class="delete sprite-img grid-delete-ic" style="'+s+'">&nbsp;&nbsp;</a>'}return""}},{data:"strRECBulkUploadTimeDate",visible:1==UserTypeID||3==UserTypeID,render:function(e,t,a,o){return ToDate(a.strRECBulkUploadTimeDate)}},{data:"SolarCompany"},{data:"PVDSWHCode",visible:1==UserTypeID||2==UserTypeID||3==UserTypeID||5==UserTypeID,render:function(e,t,a,o){if(1==UserTypeID||3==UserTypeID){if(null!=a.PVDSWHCode){var s="text-decoration:none;margin-left:5px",l='<lable class="clsLabelPVDSWH">'+a.PVDSWHCode+'</lable><a title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+a.STCJobDetailsID+",'"+a.PVDSWHCode+'\');" class="edit sprite-img grid-edit-ic" style="'+s+'">&nbsp;&nbsp;</a>';return l}var r="background-position: -132px -383px;height: 16px;width: 16px!importanttext-decoration:none;margin-left:5px";l='<a class="img-border sprite-img add_ic" title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+a.STCJobDetailsID+',\'\');" class="edit" style="'+r+'">&nbsp;&nbsp;</a>';return l}if(null!=a.PVDSWHCode){l='<lable class="clsLabelPVDSWH">'+a.PVDSWHCode+"</lable>";return l}l="";return l}},{data:"STC",sClass:"dt-right",render:function(e,t,a,o){return'<lable class="clsLabel">'+parseInt(a.STC)+"</lable>"}},{data:"STCPrice",visible:"true"!=isWholeSalers,render:function(e,t,a,o){return 4==a.STCSettlementTerm&&0==a.IsInvoiced?"":(11==a.STCSettlementTerm||10==a.STCSettlementTerm&&11==a.CustomSettlementTerm)&&0==a.IsInvoiced?"":a.IsGst?'<lable class="lblSTcPrice">$'+parseFloat(e).toFixed(2)+" +GST</lable>":'<lable class="lblSTcPrice">$'+parseFloat(e).toFixed(2)+"</lable>"}},{data:"STCSettlementTerm",render:function(e,t,a,o){return 1==a.STCSettlementTerm?"24 Hour":2==a.STCSettlementTerm?"3 Days":3==a.STCSettlementTerm?"7 Days":4==a.STCSettlementTerm?"CER Approved":5==a.STCSettlementTerm?"Partial Payment":6==a.STCSettlementTerm?"Upfront":7==a.STCSettlementTerm?"Rapid-Pay":8==a.STCSettlementTerm?"Opti-Pay":9==a.STCSettlementTerm?"Commercial":10==a.STCSettlementTerm?a.CustomTermLabel:11==a.STCSettlementTerm?"Invoice Stc":12==a.STCSettlementTerm?"Peak Pay":""}},{data:"STCSubmissionDate",render:function(e,t,a,o){return ToDate(a.strSTCSubmissionDate)}},{data:"STCSettlementDate",render:function(e,t,a,o){if(5!=a.STCSettlementTerm){if(null!=a.strSTCSettlementDate){var s,l=ToDate(a.strSTCSettlementDate),r="text-decoration:none;margin-left:5px";return s=1==UserTypeID||3==UserTypeID?'<lable class="clsDateLabel">'+l+'</lable><a title="edit" href="#" onclick="UpdateSettlementDate(this,'+a.STCJobDetailsID+",'"+l+'\');" class="edit sprite-img grid-edit-ic" style="'+r+'">&nbsp;&nbsp;</a>':'<lable class="clsDateLabel">'+l+"</lable>",s}return 11==a.STCSettlementTerm||10==a.STCSettlementTerm&&11==a.CustomSettlementTerm?"":'<lable class="clsDateLabel">On Approval</lable>'}if(5==a.STCSettlementTerm){if(null!=a.strSTCSettlementDate){l=ToDate(a.strSTCSettlementDate);return'<lable class="clsDateLabel">'+l+"(Partial)</lable>"}return'<lable class="clsDateLabel">(Partial)</lable>'}}},{data:"ComplianceOfficer"},{data:"IsInvoiced",render:function(e,t,a,o){return a.IsInvoiced?'<span class="sprite-img file-green-ic"></span>':5==a.STCSettlementTerm&&1==a.STCInvoiceCount?'<span class="sprite-img file-orange-ic"></span>':'<span class="sprite-img file-red-ic"></span>'},orderable:!1},{data:"Id",render:function(e,t,a,o){if(imgassign="text-decoration:none;",4==UserTypeID||6==UserTypeID)var s="javascript:LoadStc('"+a.JobID+"','"+a.STCJobDetailsID+"')";else s="javascript:StcCompliance('this','"+a.JobID+"','"+a.STCJobDetailsID+"')";var l="";return l+='<a href="'+s+'" class="action edit sprite-img compliance-ic" style="'+imgassign+'" title="Compliance Check">&nbsp; &nbsp; &nbsp; &nbsp;</a>',l},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",initComplete:function(e,t){$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("...")},fnRowCallback:function(e,t,a,o){$(e).addClass("togglerow"),t.HasMultipleRecords&&$(e).addClass("togglerow").find(".toggle-icon").parent().addClass("toggle-btn")},bServerSide:!0,sAjaxSource:urlGetJobSTCSubmission,fnDrawCallback:function(){if($("#btotalTradedSTC").html(0),1==$("#chkAll").prop("checked")){chkCount=$("#datatable >tbody").find("tr.togglerow").length;var e=0,t=0;$('#datatable tbody input[type="checkbox"]').each(function(){var a=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();e=parseFloat(parseFloat(e)+parseFloat(a)).toFixed(2);var o=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?"0":$(this).parent().parent().find(".lblSTcPrice").text();t=parseFloat(parseFloat(t)+parseFloat(a)*parseFloat(o.replace("$",""))).toFixed(2)}),$("#btotalTradedSTC").html(e),$("#btotalAmount").html(t),$("#btotalNoofJobs").text(chkCount)}else chkCount=0,$("#btotalTradedSTC").html(0),$("#btotalAmount").html(0),$("#btotalNoofJobs").text(0);$(".Installation-verified-false").each(function(e,t){$(this).closest("tr").addClass("installation-notverified")}),$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>1?$("#datatable_length").show():$("#datatable").find("tr.togglerow").length>11?$("#datatable_length").show():$("#datatable_length").hide();var a=$("#datatable").DataTable(),o=a.page.info();0==o.recordsTotal?document.getElementById("numRecords").innerHTML="<b>0</b>  of  <b>"+o.recordsTotal+"</b> Job(s) found":document.getElementById("numRecords").innerHTML="<b>"+$("#datatable >tbody").find("tr.togglerow").length+"</b>  of  <b>"+o.recordsTotal+"</b> Job(s) found"},fnServerParams:function(e){e.push({name:"stageid",value:SelectedStageId}),1!=UserTypeID&&3!=UserTypeID||e.push({name:"reseller",value:document.getElementById("ResellerId").value}),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(e.push({name:"solarcompanyid",value:$("#hdnsolarCompanyid").val()}),e.push({name:"pvdswhcode",value:$("#txtPVDSWHCode").val()})),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID||e.push({name:"RAM",value:document.getElementById("RamId").value}),1!=UserTypeID&&5!=UserTypeID&&2!=UserTypeID||e.push({name:"complianceOfficerId",value:document.getElementById("ComplianceOfficerId").value}),e.push({name:"RefJobId",value:$("#txtRefJobId").val()}),e.push({name:"ownername",value:$("#txtOwnerName").val()}),e.push({name:"installationaddress",value:$("#txtInstallationAddress").val()}),e.push({name:"submissionfromdate",value:GetDates($("#txtSubmissionFromDate").val())}),e.push({name:"submissiontodate",value:GetDates($("#txtSubmissionToDate").val())}),e.push({name:"settlementfromdate",value:GetDates($("#txtSettlementFromDate").val())}),e.push({name:"settlementtodate",value:GetDates($("#txtSettlementToDate").val())}),e.push({name:"IsInvoiced",value:invoiced}),e.push({name:"isAllScaJobView",value:isAllScaJobView}),e.push({name:"isShowOnlyAssignJobsSCO",value:isShowOnlyAssignJobsSCO}),e.push({name:"SettlementTermId",value:$("#SettlementTermId").val()}),e.push({name:"isSPVRequired",value:$("#IsSPVRequired").val()}),e.push({name:"isSPVInstallationVerified",value:$("#IsSPVInstallationVerified").val()})}});var a=$("#datatable").DataTable();$("#datatable").on("length.dt",function(e,t,a){SetPageSizeForGrid(a,!1,ViewPageId),GridConfig[0].PageSize=a,GridConfig[0].IsKendoGrid=!1,GridConfig[0].ViewPageId=parseInt(ViewPageId)}),$("#chkAll").on("click",function(){var e=a.rows({search:"applied"}).nodes();if($('input[type="checkbox"]',e).prop("checked",this.checked),chkCount=this.checked?$("#datatable >tbody").find("tr.togglerow").length:0,this.checked){var t=0,o=0;$('#datatable tbody input[type="checkbox"]').each(function(){var e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();t=parseFloat(parseFloat(t)+parseFloat(e)).toFixed(2);var a=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?"0":$(this).parent().parent().find(".lblSTcPrice").text();o=parseFloat(parseFloat(o)+parseFloat(e)*parseFloat(a.replace("$",""))).toFixed(2)}),$("#btotalTradedSTC").html(t),$("#btotalAmount").html(o),$("#btotalNoofJobs").text(chkCount)}else $("#btotalTradedSTC").html(0),$("#btotalAmount").html(0),$("#btotalNoofJobs").text(0)}),$("#datatable tbody").on("change",'input[type="checkbox"]',function(){if(this.checked){chkCount++,chkCount==$("#datatable >tbody").find("tr.togglerow").length&&$("#chkAll").prop("checked",this.checked);var e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html(),a=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?0:$(this).parent().parent().find(".lblSTcPrice").text(),o=parseFloat(parseFloat($("#btotalAmount").html())+parseFloat(e*parseFloat(a.replace("$","")))).toFixed(2);$("#btotalAmount").html(o),$("#btotalTradedSTC").html(parseFloat(parseFloat(e)+parseFloat(t)).toFixed(2)),$("#btotalNoofJobs").text(chkCount)}else{chkCount--,$("#chkAll").prop("checked",this.checked);e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html(),a=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?0:$(this).parent().parent().find(".lblSTcPrice").text(),o=parseFloat(parseFloat($("#btotalAmount").html())-parseFloat(e*parseFloat(a.replace("$","")))).toFixed(2);$("#btotalAmount").html(o),$("#btotalTradedSTC").html(parseFloat(parseFloat(t)-parseFloat(e)).toFixed(2)),$("#btotalNoofJobs").text(chkCount)}})}),$("#btnSearchSpvFailureReason").click(function(){var e=$("#txtSpvRefJobId").val();if(""==e)return $("#errorMsgRegionSPVFailure").html(closeButton+"Please enter valid JobId for search SPVfailure reasons."),$("#errorMsgRegionSPVFailure").show(),!1;isNaN(e)?($("#errorMsgRegionSPVFailure").html(closeButton+"Please enter valid JobId for search SPVfailure reasons."),$("#errorMsgRegionSPVFailure").show()):$("#spv-failure-reason-div").load(urlGetSpvFailureReason+"?refJobId="+$("#txtSpvRefJobId").val(),function(){$("#spv-failure-reason").modal({backdrop:"static",keyboard:!1}),$("#errorMsgRegionSPVFailure").hide()})});