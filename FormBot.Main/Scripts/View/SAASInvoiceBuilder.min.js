function SAASInvoiceBuilderKendoIntialiize(){kendoColsNew=[],kendoColsNew.push({title:"Chkbox",field:"Id",encoded:!1,template:function(e){return'<input type="checkbox" class="k-checkbox" chkType="HeaderCheckBox" strJobID = "'+e.strJobID+'" strProcessedJobID = "'+e.strProcessedJobID+'" BillingPeriod = "'+e.BillingPeriod+'" CreatedDate = "'+e.CreatedDate+'" GlobalTermID = "'+e.Id+'" InvoiceAmount = "'+e.InvoiceAmount+'" InvoiceID = "'+e.RowNum+'" InvoicedDate = "'+e.InvoicedDate+'" IsGlobalGST = "'+e.IsGlobalGST+'" QTY = "'+e.QTY+'" Rate = "'+e.Rate+'" SettelmentTerm = "'+e.SettelmentTerm+'" ResellerID="'+e.ResellerID+'" id="chk_'+e.RowNum+'" onchange="CheckChangeParent(\''+e.strJobID+"','"+e.RowNum+'\')"><label class="k-checkbox-label" for="chk_'+e.RowNum+'">'},filterable:!1,sortable:!1,headerTemplate:'<input type="checkbox" id="chkAll" name="select_all"  class="k-checkbox"><label class="k-checkbox-label" for="chkAll"></label>',width:5,stickyPosition:0,reorderable:!1,resizable:!1}),kendoColsNew.push({title:"Saas User",field:"ResellerName",encoded:!1,headerAttributes:{"data-field":"ResellerName","data-columnid":"ResellerName","data-order":4},headerTemplate:"<span>Saas User</span>",width:25,filterable:{operators:{string:{contains:"Contains"}},extra:!1},sortable:!0}),kendoColsNew.push({title:"Settelment Term",field:"SettelmentTerm",encoded:!1,headerAttributes:{"data-field":"SettelmentTerm","data-columnid":"SettelmentTerm","data-order":4},headerTemplate:"<span>Settelment Term</span>",width:25,template:"#=Keno_SettelmentTerm(data) #",filterable:{operators:{string:{contains:"Contains"}},extra:!1,ui:filterStatus},template:function(e){return"PerJob-S"==e.SettelmentTerm?"<span >P/Job</span>":"PerSTC-S"==e.SettelmentTerm?"<span>P/STC</span>":"PerUser-S"==e.SettelmentTerm?"<span>P/User</span>":void 0},sortable:!0}),kendoColsNew.push({title:"Rate",field:"Rate",encoded:!1,headerAttributes:{"data-field":"Rate","data-columnid":"Rate","data-order":5},headerTemplate:"<span>Rate</span>",width:25,template:"#=Keno_RateAndGST(data) #",filterable:{operators:{string:{eq:"Is equal to"}},extra:!1},sortable:!0}),kendoColsNew.push({title:"QTY",field:"QTY",encoded:!1,headerAttributes:{"data-field":"QTY","data-columnid":"QTY","data-order":6},headerTemplate:"<span>QTY</span>",width:25,filterable:{operators:{string:{eq:"Is equal to"}},extra:!1},sortable:!0}),kendoColsNew.push({title:"Total Amount",field:"InvoiceAmount",encoded:!1,headerAttributes:{"data-field":"InvoiceAmount","data-columnid":"InvoiceAmount","data-order":6},headerTemplate:"<span>Total Amount</span>",width:25,template:"#=Keno_InvoiceAmount(data) #",filterable:{operators:{string:{eq:"Is equal to"}},extra:!1},sortable:!0}),kendoColsNew.push({title:"Billing Period",field:"BillingPeriod",encoded:!1,headerAttributes:{"data-field":"BillingPeriod","data-columnid":"BillingPeriod","data-order":4},headerTemplate:"<span>Billing Period</span>",width:25,filterable:{operators:{string:{contains:"Contains"}},extra:!1},sortable:!0})}function drawSAASInvoiceBuilderKendoGrid(e){$("#datatable").hasClass("k-grid")&&$("#datatable").kendoGrid("destroy").empty(),kendo.ui.FilterMenu.fn.options.operators.date={gte:"Begin Date",lte:"End Date"},$("#datatable").kendoGrid({columns:kendoColsNew,dataSource:{type:"json",transport:{read:{url:urlSAASInvoiceBuilderIndexNew,data:{},contentType:"application/json",dataType:"json",type:"POST"},parameterMap:function(e){if(e.UserTypeID=$("#UserTypeID").val(),e.SAASUserId=$("#hdnResellerIdForFilter").val(),e.UserRole=0==$("#ddlUserRoles option:selected").val()?"":$("#ddlUserRoles option:selected").val(),e.IsIsArchive=$("#IsIsArchive").is(":checked"),null!=e.filter)for(var t=0;t<e.filter.filters.length;t++)"IsSAASInvoiced"==e.filter.filters[t].field&&("yes"==e.filter.filters[t].value.toLowerCase()?e.filter.filters[t].value="1":e.filter.filters[t].value="0");return JSON.stringify(e)}},filter:e,schema:{data:"data",total:"total",model:{fields:{CreatedDate:{type:"date"},InvoicedDate:{type:"date"}}}},pageSize:GridConfig[0].PageSize,serverPaging:!0,serverSorting:!0,serverFiltering:!0,requestStart:function(e){setTimeout(function(e){$(".k-loading-image").hide()})},requestEnd:function(e){},filterMenuInit:function(e){},dataBound:function(e){$("#chkAll").change(),$(".k-pager-sizes").find("select").on("change",function(){GridConfig[0].PageSize=$(this).val(),GridConfig[0].IsKendoGrid=!0,GridConfig[0].ViewPageId=3})}},groupable:!1,sortable:!0,filterable:{extra:!1},columnReorder:onReorder,pageable:{buttonCount:5,pageSizes:[10,25,50,100,200]},resizable:!0,scrollable:!0,reorderable:!0,filterMenuInit:function(e){},dataBound:function(e){$("#chkAll").change(),$(".k-pager-sizes").find("select").on("change",function(){SetPageSizeForGrid($(this).val(),!0,ViewPageId),GridConfig[0].PageSize=$(this).val(),GridConfig[0].IsKendoGrid=!0,GridConfig[0].ViewPageId=parseInt(ViewPageId)})},detailInit:detailInit}),$("#datatable").data("kendoGrid").thead.kendoTooltip({filter:"th:not(':first')",content:function(e){var t=e.target;return $(t).text()}})}function SaveUserWiseColumnDetails(){$("#loading-image").css("display","");var e=[],t=0,o=$("#datatable").data("kendoGrid").columns;$("#datatable th").not(":first").each(function(i,a){t+=1;var r=$("#datatable").data("kendoGrid").dataSource.pageSize();e.push({Width:o[i].width,ColumnID:$(a).attr("data-columnid"),OrderNumber:t,PageSize:r})}),$("#loading-image").css("display","none")}function BindSAASUser(){$.ajax({url:urlSAASUsersList,dataType:"json",data:{},success:function(e){$("#SAASUserId").autocomplete({minLength:1,source:function(t,o){var i=[];$.each(e,function(e,t){t.ResellerName.toLowerCase().indexOf($("#SAASUserId").val().toLowerCase())>-1&&i.push({Title:t.ResellerName,id:t.ResellerID,ResellerIdForFilter:t.ResellerIdForFilter})}),o($.map(i,function(e){return{label:e.Title,value:e.Title,id:e.id,ResellerIdForFilter:e.ResellerIdForFilter}}))},select:function(e,t){$("#hdnresellerId").val(t.item.id),$("#hdnResellerIdForFilter").val(t.item.ResellerIdForFilter)}}).on("focus",function(){$(this).keydown()})}}),$.ui.autocomplete.prototype._renderItem=function(e,t){var o=new RegExp($.trim(this.term.toLowerCase())),i=t.label.replace(o,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",t).append("<a>"+i+"</a>").appendTo(e)}}function onReorder(e){if(void 0!==e.column.reorderable&&!e.column.reorderable){var t=$("#datatable").data("kendoGrid");setTimeout(function(){t.reorderColumn(e.oldIndex,t.columns[e.newIndex])},0)}}function detailInit(e){GlblInvoiceID=e.data.RowNum,$("<div/>").appendTo(e.detailCell).kendoGrid({dataSource:{transport:{read:{url:urlSAASInvoiceBuilderDetailNew,data:{},contentType:"application/json",dataType:"json",type:"POST"},parameterMap:function(t){return t.strJobID=e.data.strJobID,JSON.stringify(t)}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,schema:{data:"data",total:"total",model:{fields:{}}}},scrollable:!1,sortable:!0,pageable:!1,dataBound:childGridDataBound,columns:[{template:function(e){if(null!=e.JobId)return'<input type="checkbox" class="k-checkbox" JobID = "'+e.JobId+'" id="chk_'+e.JobId+"_"+GlblInvoiceID+'" InvoiceId="'+GlblInvoiceID+'"  IsSent="'+e.IsSAASInvoiced+'" HeaderCheckboxId = "chk_'+GlblInvoiceID+'" onchange="CheckChangeChild(\''+e.JobId+"_"+GlblInvoiceID+'\')"><label class="k-checkbox-label" for="chk_'+e.JobId+"_"+GlblInvoiceID+'" JobID = "'+e.JobId+'" value = "'+e.JobId+"_"+GlblInvoiceID+'">'},width:"50px"},{field:"JobId",title:"Job Id",width:"110px"},{field:"RefNumber",title:"Ref. Number",width:"110px"},{field:"OwnerName",title:"Owner Name",width:"110px"},{field:"OwnerAddress",title:"Owner Address",width:"300px"},{field:"STCPrice",title:"STC Amount",width:"100px",template:function(e){return'<lable class="lblSTcPrice">$'+parseFloat(e.STCPrice).toFixed(2)+"</lable>"}},{field:"Status",title:"CER Status",width:"200px"},{field:"RECBulkUploadTime",title:"REC Creation Date",width:"200px",template:function(e){return null!=e.RECBulkUploadTime&&"null"!=e.RECBulkUploadTime?ToDate(new Date(moment(e.RECBulkUploadTime).format("MM/DD/YYYY"))):""}},{field:"STCPVDCode",title:"PVD Code",width:"100px"},{title:"Is Sent?",template:function(e){return e.IsSAASInvoiced?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},width:"100px"},{title:"Action",template:function(e){imgassign="text-decoration:none;";var t="";return e.IsSAASInvoiced?t+='<a href="javascript:void(0);" onclick="restoreSAASInvoiceFomBuilder('+e.JobId+')" id="" class="btn default btn-sm sprite-img reset_ic" title="Restore invoice"></a>':t+='<a href="javascript:void(0);" onclick="deleteSAASInvoiceFomBuilder('+e.JobId+')" id="" class="btn default icon-btn btn-sm remove-ic" title="Delete invoice"></a>',t},width:"100px"}]})}function childGridDataBound(e){for(var t=$("#datatable").data("kendoGrid"),o=e.sender.dataSource._view.length,i=0;i<o;i++){var a=e.sender.dataSource._view[i].uid,r=t.table.find("tr[data-uid='"+a+"']");$(r).css("background-color","#fff1e0")}}function dirtyField(e,t){var o=$("[data-uid="+e.JobID+"]").find(".k-dirty-cell").length<1;return e.dirty&&e.dirtyFields[t]&&o?"<span class='k-dirty'></span>":""}function ToDate(e){return null!=e?e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2):""}function SendToSAASInvoiceNew(){var e=1,t=null,o=!1,i="";selectedRows=[];var a={},r=$('#datatable tbody input[type="checkbox"]:Checked').length;if($('#datatable tbody input[type="checkbox"]:Checked').each(function(){$(this).prop("checked")&&0==o&&("null"==t&&(t=null),"HeaderCheckBox"==$(this).attr("chkType")?(1==e?("null"==$(this).attr("strprocessedjobid")?(t=null,r=e):t=$(this).attr("strprocessedjobid"),i=confirm("Are you sure you want to send selected SAAS Invoice(s) ?")):t="null"==$(this).attr("strprocessedjobid")?null:t,o=!0,selectedRows.push($(this).attr("strjobid")),a={InvoiceID:$(this).attr("invoiceid"),SettelmentTerm:$(this).attr("settelmentterm"),GlobalTermId:$(this).attr("globaltermid"),IsGlobalGST:$(this).attr("isglobalgst"),strJobID:$(this).attr("strjobid"),CreatedDate:$(this).attr("createddate"),Rate:$(this).attr("rate"),QTY:$(this).attr("qty"),InvoiceAmount:$(this).attr("invoiceamount"),BillingPeriod:$(this).attr("billingperiod"),BillingMonth:$(this).attr("billingperiod").split(" ")[0],BillingYear:$(this).attr("billingperiod").split(" ")[1],ResellerID:$(this).attr("resellerid"),strAllJobIds:t},0==$("#chkAll").is(":checked")&&1==r?e=r:o=!1):"true"==$(this).attr("issent")?alert("Some invoices are alredy sent, Select unsent invoices only"):(1==e&&("null"!=$("#chk_"+$(this).attr("invoiceid")).attr("strprocessedjobid")&&(t=$("#chk_"+$(this).attr("invoiceid")).attr("strprocessedjobid")),i=confirm("Are you sure you want to send selected SAAS Invoice(s) ?")),selectedRows.push("1"),null!=$("#chk_"+LastProcesssedId).attr("invoiceid")?$("#chk_"+LastProcesssedId).attr("invoiceid")!=$(this).attr("invoiceid")&&(t=null):t=t,a={InvoiceID:$(this).attr("invoiceid"),SettelmentTerm:$("#chk_"+$(this).attr("invoiceid")).attr("settelmentterm"),GlobalTermId:$("#chk_"+$(this).attr("invoiceid")).attr("globaltermid"),IsGlobalGST:$("#chk_"+$(this).attr("invoiceid")).attr("isglobalgst"),strJobID:$(this).attr("jobid"),CreatedDate:$("#chk_"+$(this).attr("invoiceid")).attr("createddate"),Rate:$("#chk_"+$(this).attr("invoiceid")).attr("rate"),QTY:1,InvoiceAmount:$("#chk_"+$(this).attr("invoiceid")).attr("invoiceamount"),BillingPeriod:$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod"),BillingMonth:$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod").split(" ")[0],BillingYear:$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod").split(" ")[1],ResellerID:$("#chk_"+$(this).attr("invoiceid")).attr("resellerid"),strAllJobIds:t})),null!=selectedRows&&selectedRows.length>0&&i&&(selectedRows=[],$.ajax({type:"POST",url:urlSendToSAASInvoices,dataType:"json",async:!1,data:a,success:function(o){null==t?0==$("#chkAll").is(":checked")&&(t=a.strJobID,LastProcesssedId=a.strJobID):t=t+","+a.strJobID,e==r?(showSuccessMessage("Invoice Sent successfully to the SAAS Invoice"),filter=$("#datatable").data("kendoGrid").dataSource.filter(),SAASInvoiceBuilderKendoIntialiize(),drawSAASInvoiceBuilderKendoGrid(filter)):e++},error:function(t){e++,alert("Error sending invoices")}}))}),o=!0,0==r)return alert("Please select at least one SAAS Invoice to send."),!1}function showSuccessMessage(e){$(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+e),$("#successMsgRegion").show()}function FillDropDownUser(e){$.ajax({url:"/SAASInvoiceBuilder/GetUserRolesSASS",type:"POST",data:{id:e},dataType:"json",success:function(e){$("#ddlUserRoles").empty(),""!=e&&($("#ddlUserRoles").prepend('<option value="0"> All </option>'),$.each(e,function(e,t){$("#ddlUserRoles").append('<option value="'+t.RoleId+'">'+t.Name+"</option>")}))},error:function(e){alert("Failed to Retrieve User Roles."+e)}})}function ResetSearchFilters(e){$("#SAASUserId").val(""),$("#hdnresellerId").val(""),$("#UserTypeID").val(""),$("#ddlUserRoles").val(0),$("#hdnResellerIdForFilter").val(""),drawSAASInvoiceBuilderKendoGrid()}function CheckChangeChild(e){$("#chk_"+e).is(":checked")||$("#"+$("#chk_"+e).attr("headercheckboxid")).prop("checked",!1)}function CheckChangeParent(e,t){for(var o=e.split(","),i=0;i<o.length;i++)$("#chk_"+o[i]+"_"+t).is(":checked")?($("#chk_"+o[i]+"_"+t).prop("checked",!1),strlstjobid=""):($("#chk_"+o[i]+"_"+t).prop("checked",!0),strlstjobid=e)}function deleteSAASInvoiceFomBuilder(e){var t=confirm("Are you sure you want to remove job with ID: "+e+" ?");t&&$.ajax({type:"POST",url:"/SAASInvoiceBuilder/DeleteSAASInvoiceFomBuilder",dataType:"json",data:{jobid:e},success:function(e){filter=$("#datatable").data("kendoGrid").dataSource.filter(),SAASInvoiceBuilderKendoIntialiize(),drawSAASInvoiceBuilderKendoGrid(filter)},error:function(e){alert("Error deleting data")}})}function restoreSAASInvoiceFomBuilder(e){$.ajax({type:"POST",url:"/SAASInvoice/RestoreSAASInvoice",dataType:"json",data:{InvoiceId:e},success:function(e){filter=$("#datatable").data("kendoGrid").dataSource.filter(),SAASInvoiceKendoIntialiizeNew(),drawSAASInvoiceKendoGridNew(filter)},error:function(e){alert("Error restoring data")}})}function BindGlobalPricingTerms(){if($("#lblMonthWarning").text(""),$("#dvMonthWarning").hide(),"0"!=$("#ddlPopSaasUsers").val())$.ajax({type:"GET",url:"/SAASInvoiceBuilder/GetGlobalBillingTermsList",data:{UserID:$("#ddlPopSaasUsers option:selected").attr("userid")},success:function(e){for(var t='<option value="0" id="popoptn_0">Please Select a Billable Term</option>',o=0;o<e.length;o++){var i=1==e[o].IsGST?"+GST":"",a="("+e[o].BillerCode+") "+e[o].TermName+" $"+e[o].Price+i+" "+e[o].TermCode;t+='<option id="popoptn_'+e[o].Id+'"  value="'+e[o].Id+'" TermName="'+e[o].TermName+'" TermCode="'+e[o].TermCode+'" Price="'+e[o].Price+'" Description="'+e[o].TermDescription+'"  IsGlobalGST="'+e[o].IsGST+'">'+a+"</option>",a="",i=""}$("#ddlPopTermCode").html(t)}});else{var e='<option value="0" id="popoptn_0">Please Select a Billable Term</option>';$("#ddlPopTermCode").html(e)}}function BindPopSAASUser(){$.ajax({url:"/SAASInvoiceBuilder/GetSAASForPricingManager",dataType:"json",data:{},success:function(e){for(var t='<option value="0" id="popOptnSaasUser_0">Select</option>',o=0;o<e.length;o++)t+='<option id="popOptnSaasUser_'+e[o].ResellerIdForFilter+'"  value="'+e[o].ResellerIdForFilter+'" ResellerName="'+e[o].ResellerName+'" UserId="'+e[o].ResellerID+'">'+e[o].ResellerName+"</option>";$("#ddlPopSaasUsers").html(t)}})}function BindPrice(e){if(0!=$("#ddlPopTermCode").val())$("#txtpopPrice").val($("#popoptn_"+e.value).attr("price")),$("#popoptn_"+e.value).attr("isglobalgst")?$("#IspopGlobalGST").prop("checked",!0):$("#IspopGlobalGST").prop("checked",!1),GetMonthAndQTYBasedOnTerms($("#popoptn_"+e.value).attr("termcode"),$("#popoptn_"+e.value).attr("price"),$("#ddlPopSaasUsers option:selected").attr("userid"));else{$("#txtpopPrice").val(""),$("#txtpopQuantity").val(""),$("#IspopGlobalGST").prop("checked",!1);var t='<option value=""> Select </option>';$("#ddlPopMonth").html(t)}}function CreateNewInvoice(){var e,t,o,i,a,r,l,n,d,s,c=1;if(e=$("#ddlPopSaasUsers option:selected").attr("userid"),t=$("#ddlPopSaasUsers").val(),o=$("#ddlPopSaasUsers option:selected").attr("resellername"),i=$("#ddlPopTermCode option:selected").attr("termcode"),a=$("#txtpopPrice").val(),r=1,l=$("#ddlPopMonth option:selected").text(),n=$("#ddlPopTermCode").val(),d=$("#IspopGlobalGST").prop("checked"),s=$("#ddlPopMonth option:selected").attr("strjobid"),ValidateCreateNewInvoice())for(var p=0;p<s.split(",").length;p++)$.ajax({url:urlCreateNewInvoice,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({UserID:e,ResellerID:t,ResellerName:o,SettelmentTerm:i,Rate:a,QTY:r,BillingPeriod:l,GlobalTermId:n,IsGlobalGST:d,JobID:s.split(",")[p]}),async:!1,success:function(e){$("#popupCreateNewInvoice .close").click(),$("#ddlPopSaasUsers").val("0"),$("#ddlPopTermCode").val("0"),$("#txtpopPrice").val(""),$("#txtpopQuantity").val(""),$("#IspopGlobalGST").prop("checked",!1),c==s.split(",").length&&(drawSAASInvoiceBuilderKendoGrid(),showSuccessMessage("Invoice created."))},error:function(e){showErrorMessage("Invoice not created.")}}),c++}function ValidateCreateNewInvoice(){return"0"==$("#ddlPopSaasUsers").val()?(alert("Please select saas user."),!1):"0"==$("#ddlPopTermCode").val()?(alert("Please select billable term."),!1):""!=$("#ddlPopMonth").val()||(alert("Please select month."),!1)}function GetMonthAndQTYBasedOnTerms(e,t,o){$.ajax({url:urlGetMonthAndQTYBasedOnTerms,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({SettelmentTerm:e,Rate:t,UserID:o}),success:function(e){$("#ddlPopMonth").empty(),""!=e.data?($("#lblMonthWarning").text(""),$("#dvMonthWarning").hide(),$("#ddlPopMonth").prepend('<option value=""> Select </option>'),$.each(e.data,function(e,t){$("#ddlPopMonth").append('<option value="'+e+'" QTY="'+t.QTY+'" strJobID = "'+t.strJobID+'">'+t.BillingPeriod+"</option>")})):($("#lblMonthWarning").text("No month data available for selected options."),$("#dvMonthWarning").show())},error:function(e){showErrorMessage("Error fetching data!.")}})}function BindQTY(){""!=$("#ddlPopMonth").val()?$("#txtpopQuantity").val($("#ddlPopMonth option:selected").attr("qty")):$("#txtpopQuantity").val("")}function SendtoSaasInvoicesOptimized(){var e=null,t=new Array;if($('#datatable tbody input[type="checkbox"]:Checked').each(function(){var o={};o.InvoiceID=($(this).attr("chkType"),$(this).attr("invoiceid")),o.SettelmentTerm="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("settelmentterm"):$("#chk_"+$(this).attr("invoiceid")).attr("settelmentterm"),o.GlobalTermId="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("globaltermid"):$("#chk_"+$(this).attr("invoiceid")).attr("globaltermid"),o.IsGlobalGST="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("isglobalgst"):$("#chk_"+$(this).attr("invoiceid")).attr("isglobalgst"),o.strJobID="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("strjobid"):$(this).attr("jobid"),o.CreatedDate="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("createddate"):$("#chk_"+$(this).attr("invoiceid")).attr("createddate"),o.Rate="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("rate"):$("#chk_"+$(this).attr("invoiceid")).attr("rate"),o.QTY="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("qty"):1,o.InvoiceAmount="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("invoiceamount"):1*$("#chk_"+$(this).attr("invoiceid")).attr("rate"),o.BillingPeriod="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("billingperiod"):$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod"),o.BillingMonth="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("billingperiod").split(" ")[0]:$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod").split(" ")[0],o.BillingYear="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("billingperiod").split(" ")[1]:$("#chk_"+$(this).attr("invoiceid")).attr("billingperiod").split(" ")[1],o.ResellerID="HeaderCheckBox"==$(this).attr("chkType")?$(this).attr("resellerid"):$("#chk_"+$(this).attr("invoiceid")).attr("resellerid"),o.strAllJobIds="HeaderCheckBox"==$(this).attr("chkType")?e:$("#chk_"+$(this).attr("invoiceid")).attr("strprocessedjobid"),o.isBulkRecord="HeaderCheckBox"==$(this).attr("chkType"),t.push(o)}),!(t.length>0))return alert("Please select at least one SAAS Invoice to send."),!1;var o=o=confirm("Are you sure you want to send selected SAAS Invoice(s) ?");o&&$.ajax({type:"POST",url:urlSendToSAASInvoices,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,data:JSON.stringify(t),success:function(e){showSuccessMessage("Invoice Sent successfully to the SAAS Invoice"),filter=$("#datatable").data("kendoGrid").dataSource.filter(),SAASInvoiceBuilderKendoIntialiize(),drawSAASInvoiceBuilderKendoGrid(filter)},error:function(e){alert("Error sending invoices")}})}function showErrorMessage(e){$(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+e),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}function showSuccessMessage(e){$(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+e),$("#successMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}var kendoCols=[],kendoColsNew=[],ViewPageId=3,lstJobID=[],strlstJobID="",GlblInvoiceID="",isAlertSelectOne=!1,LastProcesssedId="";$(document).ready(function(){SAASInvoiceBuilderKendoIntialiize(),setTimeout(function(){drawSAASInvoiceBuilderKendoGrid()},2e3),BindSAASUser(),$(document).on("change","#chkAll",function(){$("#datatable").find("[type='checkbox']").prop("checked",this.checked),chkCount=this.checked?$("#datatable tbody").find("tr").length:0}),FillDropDownUser(2)});var filterStatus=function(e){var t=[{Text:"PerJob-S",Value:"PerJob-S"},{Text:"PerSTC-S",Value:"PerSTC-S"},{Text:"PerUser-S",Value:"PerUser-S"}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},Kendo_CreatedDate=function(e){return ToDate(e.CreatedDate)},Keno_RateAndGST=function(e){if(null!=e)return e.IsGlobalGST?"$"+e.Rate+"+GST":"$"+e.Rate},Keno_InvoiceAmount=function(e){if(null!=e&&e.InvoiceAmount)return"$"+e.InvoiceAmount},Keno_SettelmentTerm=function(e){if(null!=e)return e.SettelmentTerm.toLowerCase().includes("user")?"P/User":e.SettelmentTerm.toLowerCase().includes("job")?"P/Job":"P/STC"};$("#btnCreateNewInvoice").click(function(){BindPopSAASUser(),$("#popupCreateNewInvoice").modal({backdrop:"static",keyboard:!1})}),$("#btnCancelCreateInvoicePopup").click(function(){$("#popupCreateNewInvoice .close").click(),$("#ddlPopSaasUsers").val("0"),$("#ddlPopTermCode").val("0"),$("#txtpopPrice").val(""),$("#txtpopQuantity").val(""),$("#IspopGlobalGST").prop("checked",!1)}),$("#btnpopupCreateNewInvoiceClose").click(function(){$("#ddlPopSaasUsers").val("0"),$("#ddlPopTermCode").val("0"),$("#txtpopPrice").val(""),$("#ddlPopMonth").val(""),$("#txtpopQuantity").val(""),$("#IspopGlobalGST").prop("checked",!1)});