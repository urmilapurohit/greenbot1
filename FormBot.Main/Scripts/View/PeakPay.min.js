function BindSolarCompany(e,t){var a=!1;$("#searchSolarCompany").val("");var o="",l="";return 0==t?(o=urlGetSolarCompanyByResellerId,l=e):(o=urlGetSolarCompanyByRamId,l=t),$.ajax({type:"POST",url:o,dataType:"json",async:!1,data:{id:l},success:function(e){solarCompanyList=[],solarCompanyList.push({value:"0",text:"All"}),$.each(e,function(e,t){solarCompanyList.push({value:t.Value,text:t.Text}),0==a&&t.Value==localStorage.getItem("PeakPay_SolarCompanyId")&&(a=!0)});var t=PeakPay_SolarCompanyId;""==t||null==t?(a?$("#hdnsolarCompanyid").val(localStorage.getItem("PeakPay_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("PeakPay_SolarCompanyId",$("#hdnsolarCompanyid").val())),""==localStorage.getItem("PeakPay_SolarCompanyId")&&($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("PeakPay_SolarCompanyId",$("#hdnsolarCompanyid").val())),$.each(solarCompanyList,function(e,t){t.value==localStorage.getItem("PeakPay_SolarCompanyId")&&($("#searchSolarCompany").val(t.text),$("#hdnsolarCompanyid").val(localStorage.getItem("PeakPay_SolarCompanyId")))})):$("#hdnsolarCompanyid").val(t)},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),!1}function SearchPeakPayRecords(){1!=UserTypeID&&3!=UserTypeID||localStorage.setItem("PeakPay_Reseller",$("#ResellerId").val()),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("PeakPay_solarcompanyId",$("#hdnsolarCompanyid").val()),localStorage.setItem("PeakPay_searchText",$("#txtSearchfor").val()),localStorage.setItem("PeakPay_stcFromtcPrice",$("#txtStcFromPrice").val()),localStorage.setItem("PeakPay_stcToPrice",$("#txtStcToPrice").val()),localStorage.setItem("PeakPay_cerApprovedFromDate",$("#txtCERApprovedFromDate").val()),localStorage.setItem("PeakPay_cerApprovedToDate",$("#txtCERApprovedToDate").val()),localStorage.setItem("PeakPay_SettleBeforeFromDate",$("#txtSettleBeforeFromDate").val()),localStorage.setItem("PeakPay_SettleBeforeToDate",$("#txtSettleBeforeToDate").val()),localStorage.setItem("PeakPay_paymentFromDate",$("#txtPaymentFromDate").val()),localStorage.setItem("PeakPay_paymentToDate",$("#txtPaymentToDate").val()),localStorage.setItem("PeakPay_systSize",$("#SystemSize").val()),GetPeakPayJobStageCount(),$("#datatable").dataTable().fnDraw()}function ResetSearchFilters(){1!=UserTypeID&&3!=UserTypeID||$("#ResellerId").val(localStorage.getItem("PeakPay_Reseller")),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(localStorage.setItem("PeakPay_solarcompanyId",0),$("#hdnsolarCompanyid").val(0)),$("#txtSearchfor").val(""),$("#txtStcFromPrice").val(""),$("#txtStcToPrice").val(""),$("#txtCERApprovedFromDate").val(""),$("#txtCERApprovedToDate").val(""),$("#txtSettleBeforeFromDate").val(""),$("#txtSettleBeforeToDate").val(""),$("#txtPaymentFromDate").val(""),$("#txtPaymentToDate").val(""),$("#SystemSize").val(""),document.getElementById("chkSentInvoice").checked=!1,document.getElementById("chkUnsentInvoice").checked=!0,document.getElementById("chkReadytoSTCInvoice").checked=!0;var e=document.getElementById("peakPayStcstage_"+SelectedStageId);e.style.backgroundColor="#f7f7f7",GetPeakPayJobStageCount(),$("#datatable").dataTable().fnDraw()}function FromToDate(e,t){e.datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=t.val()){var a=new Date(ConvertDateToTick(e.val(),dateFormat)),o=new Date(ConvertDateToTick(t.val(),dateFormat));a>o&&t.val("")}var l=ConvertDateToTick(e.val(),dateFormat);tDate=moment(l).format("MM/DD/YYYY"),t.data("datepicker")&&t.data("datepicker").setStartDate(new Date(tDate))}),t.datepicker({format:dateFormat,autoclose:!0}),t.change(function(){new Date(ConvertDateToTick(e.val(),dateFormat)),new Date(ConvertDateToTick(t.val(),dateFormat))})}function showErrorMessage(e){$(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+e),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}function showSuccessMessage(e){$(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+e),$("#successMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow")}function ExportCsv(){selectedRows=[],$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var e=$(this).attr("jobid");selectedRows.push(e)}}),null!=selectedRows&&selectedRows.length>0?window.location.href=urlExportCSV+selectedRows.join(","):alert("Please select any job to export.")}function SendSTCInvoice(e){selectedRows=[];var t=!0;$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var a=$(this).attr("stcPvdCode"),o=$(this).attr("isInvoiced"),l=($(this).attr("stcStatusId"),$(this).attr("stcPrice")),r=$(this).attr("stcinvoicecnt");if(0==l)alert("Please set price"),t=!1;else if(""==a||null==a)alert("Can't generate STCInvoice for STC record which has not PVD code."),t=!1;else if(r>0)alert("STCInvoice has been already generated for this job."),t=!1;else if("1"==o&&"1"==e)alert("STCInvoice has been already generated for this job."),t=!1;else{var n=$(this).attr("stcjobdetailsid"),s=$(this).attr("settlementTerm"),c=$(this).attr("jobid");selectedRows.push(n+"_"+s+"_"+c)}}}),t&&(null!=selectedRows&&selectedRows.length>0?$.ajax({url:urlGenerateSTCInvoiceForSelectedJobs,type:"POST",data:JSON.stringify({resellerId:$("#ResellerId").val(),jobs:selectedRows.join(","),isstcinvoice:e,solarCompanyId:$("#hdnsolarCompanyid").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e&&0==e.status&&("specified method is not supported."==e.error.toLowerCase()||"renewtokenexception"==e.error.toLowerCase()?window.open(urlConnect,"_blank"):"sessiontimeout"==e.error.toLowerCase()&&(window.location.href=urlLogout)),e.success&&(showSuccessMessage("Invoice is generated successfully for selected jobs."),$("#datatable").dataTable().fnDraw())},error:function(e){alert("error")}}):alert("Please select any record to generate STC Invoice."))}function BulkChangeInvoiceStatus(){if(!(document.getElementById("STCJobStageID").selectedIndex>0))return alert("Please select STC Job Stage first."),!1;var e="";selectedRows=[];var t=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(22==$(this).attr("stcStatusId"))return t=!1,!1;selectedRows.push($(this).attr("stcjobdetailsid"))}}),!t)return alert("You can not change stc status of job which have CER Approved status."),!1;if(!(null!=selectedRows&&selectedRows.length>0))return alert("Please select atleast one Job to update STC Stage."),!1;""==e&&(e=22==document.getElementById("STCJobStageID").value?"Are you sure you want to change stc status  as CERApproved of selected jobs as you can not reverse it after change ?":"Are you sure you want to change stc status of selected jobs ?");var a=confirm(e);a&&$.ajax({type:"POST",url:urlBulkChangeSTCJobStage,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcjobstage:document.getElementById("STCJobStageID").value,stcjobids:selectedRows.join(",")}),success:function(e){e.success&&(showSuccessMessage("Job Stages updated successfully."),$("#datatable").dataTable().fnDraw(),document.getElementById("STCJobStageID").selectedIndex=0)},error:function(e){showErrorMessage("Job Stages cannot be updated")}})}function SetStcPrice(){selectedRows=[];var e=!0,t=!0,a=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var a=$(this).attr("stcjobdetailsid");selectedRows.push(a),e=!0;var o=$(this).attr("stcPrice");if(o>0&&(t=!1),1==$(this).attr("isinvoiced"))return alert("Cannot change stc price of jobs whose invoice is already generated."),e=!1,!1}}),e&&(t||(a=confirm("STC price already exists, are you sure you want to change STC price.")),a)){if(!($("#SetSTCPrice").val()>0))return alert("Please enter STC Price."),!1;if(!(null!=selectedRows&&selectedRows.length>0))return alert("Please select atleast one Job to set STC Price."),!1;$.ajax({type:"POST",url:urlPeakPaySetStcPrice,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcPrice:$("#SetSTCPrice").val(),stcJobDetailIds:selectedRows.join(",")}),success:function(e){e.success&&(showSuccessMessage("Stc Price set successfully."),$("#datatable").dataTable().fnDraw(),$("#STCPrice").val(0))},error:function(e){showErrorMessage("Cannot set Stc Price")}})}}function ChangePeakPayInvoiceStatus(e){selectedRows=[];var t=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(3==e&&(22!=$(this).attr("stcstatusid")||0==$(this).attr("stcprice")))return alert("Jobs with Stc status as pending approval and STC price less than 0 cannot be marked as ReadyToSent invoice."),t=!1,!1;if(1==$(this).attr("isinvoiced"))return alert("Cannot change invoice status of jobs whose invoice is already generated."),t=!1,!1;var a=$(this).attr("stcjobdetailsid");selectedRows.push(a)}}),t){if(!(null!=selectedRows&&selectedRows.length>0))return alert("Please select atleast one Job to change invoice status."),!1;$.ajax({type:"POST",url:urlChangePeakpayInvoiceStatus,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcJobDetailIds:selectedRows.join(","),invoiceStatus:e}),success:function(e){e.success&&(2==e.InvoiceStatus&&showSuccessMessage("PeakPay job is marked as unsent."),3==e.InvoiceStatus&&showSuccessMessage("PeakPay job is marked as readyToSent."),GetPeakPayJobStageCount(),$("#datatable").dataTable().fnDraw())},error:function(e){showErrorMessage("Cannot change invoice status")}})}}function SetStageId(e){var t=document.getElementById("peakPayStcstage_"+SelectedStageId);t.style.backgroundColor="#f7f7f7",SelectedStageId=e;t=document.getElementById("peakPayStcstage_"+SelectedStageId);t.style.backgroundColor="#686868",$("#txtSearchfor").val(""),$("#txtStcFromPrice").val(""),$("#txtStcToPrice").val(""),$("#txtCERApprovedFromDate").val(""),$("#txtCERApprovedToDate").val(""),$("#txtSettleBeforeFromDate").val(""),$("#txtSettleBeforeToDate").val(""),$("#txtPaymentFromDate").val(""),$("#txtPaymentToDate").val(""),$("#SystemSize").val(""),document.getElementById("chkSentInvoice").checked=!1,document.getElementById("chkUnsentInvoice").checked=!0,document.getElementById("chkReadytoSTCInvoice").checked=!0,GetPeakPayJobStageCount(),$("#datatable").dataTable().fnDraw()}function GetPeakPayJobStageCount(e){var t=0,a=0,o=0;return 1==UserTypeID||3==UserTypeID?(t=0==e||void 0===e?$("#ResellerId").val():e,o=$("#hdnsolarCompanyid").val()):2==UserTypeID?(t=ProjectSession_ResellerId,o=$("#hdnsolarCompanyid").val()):5==UserTypeID?(t=ProjectSession_ResellerId,o=$("#hdnsolarCompanyid").val()):o=ProjectSession_SolarCompanyId,$.ajax({type:"POST",url:urlGetPeakPayJobStageCount,dataType:"json",async:!1,data:{reseller:t,ram:a,sId:o,isAllScaJobView:isAllScaJobView},success:function(e){var t=0;$.each(e.lstPeakPayJobStagesCount,function(e,a){document.getElementById("peakPayStcstage_"+a.JobStageId).innerHTML=a.StageName+"<span>("+a.jobCount+")</span>",t+=a.jobCount}),document.getElementById("peakPayStcstage_0").innerHTML="Show All<span>("+t+")</span>"},error:function(e){alert("Failed to retrieve count for Job Stages."+e)}}),!1}$(document).ready(function(){if($("#ResellerId").select2(),$("#searchSolarCompany").autocomplete({minLength:0,source:function(e,t){var a=[];$("#hdnsolarCompanyid").val(0),$.each(solarCompanyList,function(e,t){t.text.toLowerCase().indexOf($("#searchSolarCompany").val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value})}),t($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id}}))},select:function(e,t){$("#hdnsolarCompanyid").val(t.item.id)}}).on("focus",function(){$(this).keydown()}),$.ui.autocomplete.prototype._renderItem=function(e,t){var a=new RegExp($.trim(this.term.toLowerCase())),o=t.label.replace(a,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",t).append("<a>"+o+"</a>").appendTo(e)},1==UserTypeID||3==UserTypeID){var e=!1;$.ajax({type:"get",url:url_GetReseller,dataType:"json",data:"",async:!1,success:function(t){$.each(t,function(t,a){$("#ResellerId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),0==e&&a.Value==localStorage.getItem("PeakPay_Reseller")&&(e=!0)});var a=PeakPay_Reseller;""==a||"0"==a?e?document.getElementById("ResellerId").value=localStorage.getItem("PeakPay_Reseller"):($("#ResellerId").val($("#ResellerId option:first").val()),localStorage.setItem("PeakPay_Reseller",$("#ResellerId option:first").val())):$("#ResellerId").val(a),BindSolarCompany(localStorage.getItem("PeakPay_Reseller"),0)},error:function(e){alert("Failed to retrieve Resellers."+e)}})}else 2==UserTypeID?BindSolarCompany(localStorage.getItem("PeakPay_Reseller"),0):5==UserTypeID&&("true"==isAllScaJobView?BindSolarCompany(ResellerId,0):BindSolarCompany(0,ProjectSession_LoggedInUserId));FromToDate($("#txtCERApprovedFromDate"),$("#txtCERApprovedToDate")),FromToDate($("#txtSettleBeforeFromDate"),$("#txtSettleBeforeToDate")),FromToDate($("#txtPaymentFromDate"),$("#txtPaymentToDate")),$("#datatable").DataTable({destroy:!0,iDisplayLength:10,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"Id",orderable:!1,render:function(e,t,a,o){return 1==$("#chkAll").prop("checked")?'<input type="checkbox"  stcStatusId="'+a.STCStatusId+'" jobId="'+a.JobID+'" stcJobDetailsId="'+a.STCJobDetailsID+'" stcPvdCode="'+a.STCPVDCode+'" isInvoiced="'+a.IsInvoiced+'" settlementTerm="'+a.STCSettlementTerm+'" stcPrice="'+a.STCPrice+'" STCInvoiceCnt="'+a.STCInvoiceCnt+'" checked >':'<input type="checkbox"  stcStatusId="'+a.STCStatusId+'" jobId="'+a.JobID+'" stcJobDetailsId="'+a.STCJobDetailsID+'" stcPvdCode="'+a.STCPVDCode+'" isInvoiced="'+a.IsInvoiced+'" settlementTerm="'+a.STCSettlementTerm+'" stcPrice="'+a.STCPrice+'" STCInvoiceCnt="'+a.STCInvoiceCnt+'">'}},{data:"Id",render:function(e,t,a,o){return a.JobID},orderable:!1},{data:"Reference",render:function(e,t,a,o){if(null!=a.Reference){var l=urlJobIndex+"?id="+a.Id;return'<a href="'+l+'" style="text-decoration:none;" target="_blank">'+a.Reference+"</a>"}return""}},{data:"OwnerName",render:function(e,t,a,o){return null!=a.OwnerName?a.OwnerName:""}},{data:"InstallationAddress",render:function(e,t,a,o){return a.InstallationAddress}},{data:"StcStatus",render:function(e,t,a,o){return a.StcStatus}},{data:"SolarCompany",render:function(e,t,a,o){return $("#lblTotalAmount").html(o.settings.json.iTotalAmount),a.SolarCompany}},{data:"SubmissionDate",render:function(e,t,a,o){return ConvertToDateWithFormat(e,dateFormat)}},{data:"CERApprovedDate",render:function(e,t,a,o){return ConvertToDateWithFormat(e,dateFormat)}},{data:"SettleBefore",render:function(e,t,a,o){return ConvertToDateWithFormat(e,dateFormat)}},{data:"DaysLeft",render:function(e,t,a,o){return a.DaysLeft}},{data:"PaymentDate",render:function(e,t,a,o){return ConvertToDateWithFormat(e,dateFormat)}},{data:"STCAmount",sClass:"dt-right",render:function(e,t,a,o){return'<lable class="clsLabel">'+PrintDecimal(a.STCAmount)+"</lable>"}},{data:"STCPrice",render:function(e,t,a,o){return PrintDecimal(a.STCPrice)}},{data:"IsGst",render:function(e,t,a,o){return a.IsGst?"Yes":"No"},orderable:!1},{data:"STCFee",render:function(e,t,a,o){return PrintDecimal(a.STCFee)}},{data:"Total",render:function(e,t,a,o){return'<lable class="lblTotal">'+PrintDecimal(a.Total)+"</lable>"},orderable:!1},{data:"IsInvoiced",render:function(e,t,a,o){return 1==a.IsInvoiced||a.STCInvoiceCnt>0?'<img src="../images/ar_green.png"/><span style="display:none">sent</span>':2==a.IsInvoiced?'<img src="../images/ic_reject.png"/><span style="display:none">unsent</span>':3==a.IsInvoiced?'<img src="../images/ic_readytotrade.png"/><span style="display:none">ready to sent</span>':""},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",initComplete:function(e,t){$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html("")},fnRowCallback:function(e,t,a,o){},bServerSide:!0,sAjaxSource:urlGetPeakPayList,fnDrawCallback:function(e,t){$("#btotalTradedSTC").html(0),$("#lblTotalAmountSelected").html(parseFloat(0).toFixed(2)),$("#lblTotalAmountViewable").html(parseFloat(0).toFixed(2));var a=0;if($("#datatable tbody tr").each(function(){var e=$(this).find(".lblTotal").text(),t=""==e||null==e?0:e;a=parseFloat(parseFloat(a)+parseFloat(t)).toFixed(2)}),$("#lblTotalAmountViewable").html(a),1==$("#chkAll").prop("checked")){chkCount=$("#datatable >tbody >tr").length;var o=0,l=0;$('#datatable tbody input[type="checkbox"]').each(function(){var e=$(this).parent().parent().find(".lblTotal").text(),t=""==e||null==e?0:e;o=parseFloat(parseFloat(o)+parseFloat(t)).toFixed(2);var a=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();l=parseFloat(parseFloat(l)+parseFloat(a)).toFixed(2)}),$("#lblTotalAmountSelected").html(o),$("#btotalTradedSTC").html(l)}else chkCount=0,$("#lblTotalAmountSelected").html(parseFloat(0).toFixed(2)),$("#btotalTradedSTC").html(0);$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>=1?$("#datatable_length").show():$("#datatable").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var r=$("#datatable").DataTable(),n=r.page.info();0==n.recordsTotal?(document.getElementById("numRecords").innerHTML="<b>0</b>  of  <b>"+n.recordsTotal+"</b> STC Job(s) found",$("#lblTotalAmount").html(parseFloat(0).toFixed(2))):document.getElementById("numRecords").innerHTML="<b>"+$("#datatable >tbody >tr").length+"</b>  of  <b>"+n.recordsTotal+"</b> STC Job(s) found",GetPeakPayJobStageCount()},fnServerParams:function(e){e.push({name:"stageid",value:SelectedStageId}),1!=UserTypeID&&3!=UserTypeID||e.push({name:"reseller",value:document.getElementById("ResellerId").value}),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||e.push({name:"solarcompanyId",value:$("#hdnsolarCompanyid").val()}),e.push({name:"searchText",value:$("#txtSearchfor").val()}),e.push({name:"stcFromPrice",value:$("#txtStcFromPrice").val()}),e.push({name:"stcToPrice",value:$("#txtStcToPrice").val()}),e.push({name:"cerApprovedFromDate",value:$("#txtCERApprovedFromDate").val()}),e.push({name:"cerApprovedToDate",value:$("#txtCERApprovedToDate").val()}),e.push({name:"settleBeforeFromDate",value:$("#txtSettleBeforeFromDate").val()}),e.push({name:"settleBeforeToDate",value:$("#txtSettleBeforeToDate").val()}),e.push({name:"paymentFromDate",value:$("#txtPaymentFromDate").val()}),e.push({name:"paymentToDate",value:$("#txtPaymentToDate").val()}),e.push({name:"isSentInvoice",value:document.getElementById("chkSentInvoice").checked}),e.push({name:"isUnsentInvoice",value:document.getElementById("chkUnsentInvoice").checked}),e.push({name:"isReadytoSentInvoice",value:document.getElementById("chkReadytoSTCInvoice").checked}),e.push({name:"systSize",value:$("#SystemSize").val()}),e.push({name:"isAllScaJobView",value:isAllScaJobView}),e.push({name:"defaultGrid",value:defaultGrid})}});var t=$("#datatable").DataTable();$("#chkAll").on("click",function(){var e=t.rows({search:"applied"}).nodes();if($('input[type="checkbox"]',e).prop("checked",this.checked),chkCount=this.checked?$("#datatable >tbody >tr").length:0,this.checked){var a=0,o=0;$('#datatable tbody input[type="checkbox"]').each(function(){var e=""==$(this).parent().parent().find(".lblTotal").text()||null==$(this).parent().parent().find(".lblTotal").text()?0:$(this).parent().parent().find(".lblTotal").text();a=parseFloat(a)+parseFloat(e);var t=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();o=parseFloat(parseFloat(o)+parseFloat(t)).toFixed(2)}),$("#lblTotalAmountSelected").html(parseFloat(a).toFixed(2)),$("#btotalTradedSTC").html(o)}else $("#lblTotalAmountSelected").html(parseFloat(0).toFixed(2)),$("#btotalTradedSTC").html(0)}),$("#datatable tbody").on("change",'input[type="checkbox"]',function(){if(this.checked){chkCount++,chkCount==$("#datatable >tbody >tr").length&&$("#chkAll").prop("checked",this.checked);var e=""==$(this).parent().parent().find(".lblTotal").text()||null==$(this).parent().parent().find(".lblTotal").text()?0:$(this).parent().parent().find(".lblTotal").text(),t=$("#lblTotalAmountSelected").html();$("#lblTotalAmountSelected").html(parseFloat(parseFloat(e)+parseFloat(t)).toFixed(2));var a=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),o=$("#btotalTradedSTC").html();$("#btotalTradedSTC").html(parseFloat(parseFloat(a)+parseFloat(o)).toFixed(2))}else{chkCount--,$("#chkAll").prop("checked",this.checked);e=""==$(this).parent().parent().find(".lblTotal").text()||null==$(this).parent().parent().find(".lblTotal").text()?0:$(this).parent().parent().find(".lblTotal").text(),t=$("#lblTotalAmountSelected").html();$("#lblTotalAmountSelected").html(parseFloat(parseFloat(t)-parseFloat(e)).toFixed(2));a=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),o=$("#btotalTradedSTC").html();$("#btotalTradedSTC").html(parseFloat(parseFloat(o)-parseFloat(a)).toFixed(2))}}),$("#importCSV").fileupload({url:urlImportCSV,dataType:"json",done:function(e,t){t.result.status?($("#datatable").dataTable().fnDraw(),showSuccessMessage("CSV File has been imported successfully.")):t.result.error?showErrorMessage(t.result.error):showErrorMessage("CSV File has not been imported.")},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){var a=t.files[0].type;if(1==t.files.length)for(var o=0;o<t.files.length;o++){if(t.files[o].name.length>50)return showErrorMessage("Please upload small filename."),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(t.files[o].name))return showErrorMessage("Please upload file that not conatain <> ^ [] ."),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1}if(t.files.length>1)for(o=0;o<t.files.length;o++){if(t.files[o].size>parseInt(MaxImageSize))return showErrorMessage(" "+t.files[o].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxLogoSize+"MB"),!1;if(CheckSpecialCharInFileName(t.files[o].name))return showErrorMessage("Please upload file that not conatain <> ^ [] ."),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showErrorMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxLogoSize+"MB"),!1;return"text/csv"!=a&&"application/csv"!=a&&"csv"!=a&&"text/x-csv"!=a&&"application/x-csv"!=a&&"text/x-comma-separated-values"!=a&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=a&&"application/vnd.ms-excel"!=a&&"text/comma-separated-values"!=a&&""!=a?(showErrorMessage("Please upload a file with .csv extension."),!1):($(".alert").hide(),$("#errorMsgRegionForPopUp").html(""),$("#errorMsgRegionForPopUp").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0)},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}),$("#ResellerId").change(function(){BindSolarCompany($("#ResellerId").val(),0),GetPeakPayJobStageCount(),$("#datatable").dataTable().fnDraw()});