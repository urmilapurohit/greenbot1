function drawSTCSubmissionKendoGrid(e){kendo.ui.FilterMenu.fn.options.operators.date={gte:"Begin Date",lte:"End Date"},$("#datatable").kendoGrid({columns:kendoCols,dataSource:{type:"json",transport:{read:{url:urlGetJobSTCSubmissionKendo,data:{},contentType:"application/json",dataType:"json",type:"POST"},parameterMap:function(e){if(null!=e.filter)for(i=0;i<e.filter.filters.length;i++)"STCSettlementDate"!=e.filter.filters[i].field&&"STCSubmissionDate"!=e.filter.filters[i].field&&"InstallationDate"!=e.filter.filters[i].field&&"CERAuditedDate"!=e.filter.filters[i].field||(e.filter.filters[i].value=moment(new Date(e.filter.filters[i].value.toString().substr(0,16))).format("DD-MM-YYYY"));return e.stageid=SelectedStageId,1!=UserTypeID&&3!=UserTypeID||(e.reseller=document.getElementById("ResellerId").value),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(e.solarcompanyid=$("#hdnsolarCompanyid").val()),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID||(e.RAM=document.getElementById("RamId").value),e.RecCode=$("#txtRecCode").val(),e.isAllScaJobView=isAllScaJobView,e.isShowOnlyAssignJobsSCO=isShowOnlyAssignJobsSCO,e.RefJobId=$("#txtRefJobId").val(),e.ownername=$("#txtOwnerName").val(),e.isSPVRequired=$("#IsSPVRequired").val(),e.isSPVInstallationVerified=$("#IsSPVInstallationVerified").val(),e.defaultGrid=isDefaultGrid,isArchiveScreenVar&&(e.year=$("#ddlYear").val()),JSON.stringify(e)}},filter:e,schema:{data:"data",total:"total",model:{fields:{STCSubmissionDate:{type:"date"},STCSettlementDate:{type:"date"},RECBulkUploadTimeDate:{type:"date"},InstallationDate:{type:"date"},CERAuditedDate:{type:"date"}}}},pageSize:GridConfig[0].PageSize,serverPaging:!0,serverSorting:!0,serverFiltering:!0,requestStart:function(e){$("#loading-image").addClass("display-block-important"),setTimeout(function(e){$(".k-loading-image").hide()})},requestEnd:function(e){$("#loading-image").removeClass("display-block-important")}},groupable:!1,sortable:!0,filterable:{extra:!1},columnResize:function(e){SaveUserWiseColumnDetails()},columnReorder:onReorder,pageable:{buttonCount:5,pageSizes:[10,25,50,100,200]},resizable:!0,scrollable:!0,reorderable:!0,filterMenuInit:function(e){if($(".loading-image").hide(),e.field.includes("Date")){this.thead.find("[data-field='"+e.field+"'] .k-grid-filter").click(function(e){t()});var t=function(){var t=e.container.find("select:eq(0)").data("kendoDropDownList");t.value("gte"),t.trigger("change"),t.enable(!1);var a=e.container.find("select:eq(1)").data("kendoDropDownList");a.wrapper.hide();var o=e.container.find("select:eq(2)").data("kendoDropDownList");o.enable(!1),o.value("lte"),o.trigger("change")};t()}else if("contains"==e.container.find("select").val()){var a=e.container.find("select:eq(0)").data("kendoDropDownList");a.enable(!1)}else if(null!=e.container.find("select:eq(0)").data("kendoDropDownList")&&1==e.container.find("select:eq(0)").data("kendoDropDownList").dataSource.options.data.length){a=e.container.find("select:eq(0)").data("kendoDropDownList");a.enable(!1)}else if("JobID"==e.field||"STC"==e.field||"STCPrice"==e.field){a=e.container.find("select:eq(0)").data("kendoDropDownList");a.value("eq"),a.trigger("change"),a.enable(!1),e.container.find("input").attr("onkeypress","STC"==e.field||"STCPrice"==e.field?"return isDecimal(event);":"return isNumber(event);")}},dataBound:function(e){$("#chkAll").change(),$(".k-pager-sizes").find("select").on("change",function(){SetPageSizeForGrid($(this).val(),!0,ViewPageId),GridConfig[0].PageSize=$(this).val(),GridConfig[0].IsKendoGrid=!0,GridConfig[0].ViewPageId=parseInt(ViewPageId)}),$(".Installation-verified-false").each(function(e,t){$(this).closest("tr").addClass("installation-notverified")})}}),$("#datatable").data("kendoGrid").thead.kendoTooltip({filter:"th:not(':first')",content:function(e){var t=e.target;return $(t).text()}})}function STCSubmissionKendoIntialiize(){function CheckRender(functionName){var isDefined=eval("(typeof Kendo_"+functionName+"=='function');");return!!isDefined}cols=[],kendoCols=[],colsDefs=[];var dbFields=[];dbFields=listColumns.split(",");var dbFieldsWidth=[];dbFieldsWidth=listColumnsWidth.split(","),kendoCols.push({title:"Chkbox",field:"Id",encoded:!1,template:function(e){var t="";return null!=e.GBBatchRECUploadId&&""!=e.GBBatchRECUploadId&&(t=e.GBBatchRECUploadId.split("-").length>1&&""!=e.GBBatchRECUploadId.split("-")[1]?e.GBBatchRECUploadId:e.GBBatchRECUploadId.split("-")[0]),1==$("#chkAll").prop("checked")?'<input type="checkbox" class="k-checkbox" STCStatusId="'+e.STCStatusId+'" jobId="'+e.JobID+'" id="chk_'+e.STCJobDetailsId+'" term="'+e.STCSettlementTerm+'" custTerm="'+e.CustomSettlementTerm+'" IsInvoiced="'+e.IsInvoiced+'" STCInvoiceCount="'+e.STCInvoiceCount+'" IsCreditNote="'+e.IsCreditNote+'"  IsPayment="'+e.IsPayment+'" STCStatus="'+e.STCStatus+'" PartialValid="'+e.IsPartialValidForSTCInvoice+'" GBBatchRECUploadId="'+t+'" IsSPVRequired="'+e.IsSPVRequired+'" IsSPVInstallationVerified="'+e.IsSPVInstallationVerified+'"IsRelease="'+e.IsRelease+'" STC="'+e.STC+'"  checked ><label class="k-checkbox-label" for="chk_'+e.STCJobDetailsId+'">':'<input type="checkbox" class="k-checkbox"  STCStatusId="'+e.STCStatusId+'" jobId="'+e.JobID+'" id="chk_'+e.STCJobDetailsId+'" term="'+e.STCSettlementTerm+'" custTerm="'+e.CustomSettlementTerm+'" IsInvoiced="'+e.IsInvoiced+'" STCInvoiceCount="'+e.STCInvoiceCount+'" IsCreditNote="'+e.IsCreditNote+'" IsPayment="'+e.IsPayment+'" STCStatus="'+e.STCStatus+'" PartialValid="'+e.IsPartialValidForSTCInvoice+'" GBBatchRECUploadId="'+t+'" IsSPVRequired="'+e.IsSPVRequired+'" IsSPVInstallationVerified="'+e.IsSPVInstallationVerified+'"IsRelease="'+e.IsRelease+'" STC="'+e.STC+'"><label class="k-checkbox-label" for="chk_'+e.STCJobDetailsId+'">'},filterable:!1,sortable:!1,headerTemplate:'<input type="checkbox" id="chkAll" name="select_all"  class="k-checkbox"><label class="k-checkbox-label" for="chkAll"></label>',width:50,stickyPosition:0,reorderable:!1,resizable:!1}),kendoCols.push({title:"Has Multiple Records",field:"HasMultipleRecords",encoded:!1,headerTemplate:"<span> Has Multiple Records </span>",width:50,template:function(e){return e.HasMultipleRecords?'<i id="ticon_'+e.JobID+'" isKendo = true class="sprite-img grid-toggle-ic" style="cursor:pointer" onclick="GetSubRecords('+e.JobID+',this);"></i>':""},filterable:{operators:{string:{eq:"Is equal to"}},extra:!1,ui:filterYesNo},sortable:!0,reorderable:!1,resizable:!1,stickyPosition:1}),$.each(dbFields,function(i,e){var isfilterYesNo=!1,isfilterInt=!1,isFilterEq=!1,isHidden=!1;"HasMultipleRecords"!=e&&"IsInvoiced"!=e&&"IsCreditNote"!=e&&"IsSPVRequired"!=e&&"IsRelease"!=e||(isfilterYesNo=!0),"STCSettlementTerm"!=e&&"Priority"!=e||(isfilterInt=!0),"JobID"!=e&&"JobTypeId"!=e&&"SystemSize"!=e&&"IsSPVInstallationVerified"!=e||(isFilterEq=!0),4!=UserTypeID&&8!=UserTypeID||"JobTypeId"!=e&&"AccountManager"!=e||(isHidden=!0),"GBBatchRECUploadId"==e&&1!=UserTypeID&&3!=UserTypeID&&(isHidden=!0),"IsSPVInstallationVerified"==e&&1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID&&4!=UserTypeID&&(isHidden=!0);var columnData=$.grep(UserWiseColumnsData,function(t,a){return t.Name==e});if("STCStatus"==e)kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:StcStatus,itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allsc' name='StcStatus' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allsc'>#= all#</li>":"<li><input type='checkbox' id='#=JobStageId#' name='StcStatus' value='#=JobStageId#' class='k-checkbox'/><label class='k-checkbox-label' for='#=JobStageId#'>#= StageName #</li>"}},template:"#=Kendo_"+e+"(data) #",sortable:!0,hidden:isHidden});else if("SolarCompany"==e)kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:{transport:{read:{url:urlGetSolarCompanyForFilter,dataType:"json",data:{id:$("#ResellerId").val(),solarCompanyId:0==$("#hdnsolarCompanyid").val()?-1:$("#hdnsolarCompanyid").val(),ramId:$("#RamId").val()}}}},itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allsc' name='SolarComanyId' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allsc'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='SolarComanyId' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},sortable:!0,hidden:isHidden,template:"#=Kendo_"+e+"(data) #"});else if("ComplianceOfficer"==e)kendoCols.push({title:columnData[0].DisplayName,field:"ComplianceOfficer",headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},encoded:!1,width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:{transport:{read:{url:urlGetFCOByResellerId,dataType:"json",data:{rId:2==UserTypeID||5==UserTypeID?ProjectSession_ResellerId:$("#ResellerId").val()}}}},itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allfco' name='ComplianceOfficerId' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allfco'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='ComplianceOfficerId' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},hidden:isHidden});else if("STCSettlementTerm"==e){var data=[{Text:"24 Hour",Value:"1"},{Text:"3 Days",Value:"2"},{Text:"7 Days",Value:"3"},{Text:"CER Approved",Value:"4"},{Text:"Partial Payment",Value:"5"},{Text:"Upfront",Value:"6"},{Text:"Rapid-Pay",Value:"7"},{Text:"Opti-Pay",Value:"8"},{Text:"Commercial",Value:"9"},{Text:"Custom",Value:"10"},{Text:"Invoice Stc",Value:"11"},{Text:"Peak Pay",Value:"12"}];kendoCols.push({title:columnData[0].DisplayName,field:e,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},encoded:!1,width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:data,itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allfco' name='ComplianceOfficerId' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allfco'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='ComplianceOfficerId' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},template:"#=Kendo_"+e+"(data) #",hidden:isHidden})}else"AccountManager"==e?kendoCols.push({title:columnData[0].DisplayName,field:"AccountManager",headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},encoded:!1,width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:{transport:{read:{url:urlGetRAMForReseller,dataType:"json",data:{rId:$("#ResellerId").val()}}}},itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allfco' name='AccountManagerId' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allfco'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='AccountManagerId' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},hidden:isHidden}):isfilterYesNo?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=Kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to"}},extra:!1,ui:filterYesNo},sortable:!0,hidden:isHidden}):isfilterInt?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=Kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!1,ui:eval("filter_"+e)},sortable:!0,hidden:isHidden}):isFilterEq?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=Kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to"}},extra:!1,ui:eval("filter_"+e)},sortable:!0,hidden:isHidden}):e.includes("Date")?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=Kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!0,ui:eval("filter_"+e)},sortable:!0,hidden:isHidden}):"PVDSWHCode"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},template:function(e){if(1==UserTypeID||3==UserTypeID){if(null!=e.PVDSWHCode){var t="text-decoration:none;margin-left:5px",a='<lable class="clsLabelPVDSWH">'+e.PVDSWHCode+'</lable><a title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+e.STCJobDetailsId+",'"+e.PVDSWHCode+'\');" class="edit sprite-img grid-edit-ic" style="'+t+'">&nbsp;&nbsp;</a>';return a}var o="background-position: -132px -383px;height: 16px;width: 16px!important;text-decoration:none;margin-left:5px";a='<a class="img-border sprite-img add_ic " title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+e.STCJobDetailsId+',\'\');" class="edit " style="'+o+'">&nbsp;&nbsp;</a>';return a}if(null!=e.PVDSWHCode){a='<lable class="clsLabelPVDSWH">'+e.PVDSWHCode+"</lable>";return a}a="";return a},hidden:1!=UserTypeID&&2!=UserTypeID&&3!=UserTypeID&&5!=UserTypeID,width:parseInt(dbFieldsWidth[i]),filterable:{operators:{string:{contains:"Contains"}},extra:!1},hidden:isHidden}):"STC"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,template:function(e){return'<lable class="clsLabel">'+parseInt(e.STC)+"</lable>"},width:parseInt(dbFieldsWidth[i]),attributes:{class:"dt-right"},headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!1},hidden:isHidden}):"STCPrice"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},template:function(e){return 4==e.STCSettlementTerm&&0==e.IsInvoiced?"":(11==e.STCSettlementTerm||10==e.STCSettlementTerm&&11==e.CustomSettlementTerm)&&0==e.IsInvoiced?"":e.IsGst?'<lable class="lblSTcPrice">$'+parseFloat(e.STCPrice).toFixed(2)+" +GST</lable>":'<lable class="lblSTcPrice">$'+parseFloat(e.STCPrice).toFixed(2)+"</lable>"},hidden:"true"==isWholeSalers,width:parseInt(dbFieldsWidth[i]),filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!1},hidden:isHidden}):"IsSPVRequired"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,template:function(e){return e.IsSPVRequired?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},width:parseInt(dbFieldsWidth[i]),attributes:{class:"dt-right"},headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},filterable:{operators:{string:{eq:"Is equal to"}},extra:!1},hidden:isHidden}):CheckRender(e)?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=Kendo_"+e+"(data) #",filterable:{operators:{string:{contains:"Contains"}},extra:!1},sortable:!0,hidden:isHidden}):kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),filterable:{operators:{string:{contains:"Contains"}},extra:!1},sortable:!0,hidden:isHidden})}),kendoCols.push({title:"Action",field:"Id",template:function(e){if(imgassign="text-decoration:none;",4==UserTypeID||6==UserTypeID)var t="javascript:LoadStc('"+e.JobID+"','"+e.STCJobDetailsId+"')";else t="javascript:StcCompliance(this,'"+e.JobID+"','"+e.STCJobDetailsId+"')";var a="";return a+='<a href="'+t+'" class="action edit sprite-img compliance-ic" style="'+imgassign+'" title="Compliance Check">&nbsp; &nbsp; &nbsp; &nbsp;</a>',a},sortable:!1,width:50,filterable:!1})}function GetFCOByResellerId(e){return $("#ComplianceOfficerId").empty(),$("#AssignComplianceOfficerId").empty(),$.ajax({type:"get",url:urlGetFCOByResellerId,dataType:"json",async:!1,data:{rId:e},success:function(e){$("#ComplianceOfficerId").append('<option value="0">Select</option>'),$("#AssignComplianceOfficerId").append('<option value="0">Select</option>'),$.each(e,function(e,t){$("#ComplianceOfficerId").append('<option value="'+t.Value+'">'+t.Text+"</option>"),$("#AssignComplianceOfficerId").append('<option value="'+t.Value+'">'+t.Text+"</option>")})},error:function(e){alert("Failed to retrieve Compliance Officers."+e)}}),!1}function GetRAMByResellerId(e){var t=!1;return $("#RamId").empty(),$.ajax({type:"get",url:urlGetRAMForReseller,dataType:"json",async:!1,data:{rId:e},success:function(e){$("#RamId").append('<option value="0">Select</option>'),$.each(e,function(e,a){$("#RamId").append('<option value="'+a.Value+'">'+a.Text+"</option>"),0==t&&a.Value==localStorage.getItem("STCSubmission_RamId")&&(t=!0)}),t?document.getElementById("RamId").value=localStorage.getItem("STCSubmission_RamId"):($("#RamId").val($("#RamId option:first").val()),localStorage.setItem("STCSubmission_RamId",$("#RamId option:first").val()))},error:function(e){alert("Failed to retrieve Account Managers."+e)}}),!1}function BindSolarCompany(e,t){var a=!1;$("#searchSolarCompany").val("");var o="",l="";return 0==t?(o=urlGetSolarCompanyByResellerId,l=e):(o=urlGetSolarCompanyByRAMID,l=t),$.ajax({type:"POST",url:o,dataType:"json",async:!1,data:{id:l},success:function(e){solarCompanyList=[],solarCompanyList.push({value:"0",text:"All"}),$.each(e,function(e,t){solarCompanyList.push({value:t.Value,text:t.Text}),0==a&&t.Value==localStorage.getItem("STCSubmission_SolarCompanyId")&&(a=!0)});var t=STCSubmission_SolarCompanyId;""==t||null==t?(a?$("#hdnsolarCompanyid").val(localStorage.getItem("STCSubmission_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val())),""==localStorage.getItem("STCSubmission_SolarCompanyId")&&($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val())),$.each(solarCompanyList,function(e,t){t.value==localStorage.getItem("STCSubmission_SolarCompanyId")&&($("#searchSolarCompany").val(t.text),$("#hdnsolarCompanyid").val(localStorage.getItem("STCSubmission_SolarCompanyId")))})):$("#hdnsolarCompanyid").val(t)},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),!1}function ResetSearchFilters(e){1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||($("#hdnsolarCompanyid").val("0"),$("#searchSolarCompany").val("All"),localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val()),localStorage.setItem("STCSubmission_PVDSWHCode","")),localStorage.setItem("STCSubmission_RecCode",""),localStorage.setItem("STCSubmission_RefJobId",""),localStorage.setItem("STCSubmission_OwnerName",""),localStorage.setItem("STCSubmission_InstallationAddress",""),localStorage.setItem("STCSubmission_IsSPVRequired","-1"),localStorage.setItem("STCSubmission_IsSPVInstallationVerified","-1"),SetParamsFromLocalStorage(),GetSTCJobStageCount(),$("#IsSPVRequired").val("-1"),$("#IsSPVInstallationVerified").val("-1"),$("#datatable").data("kendoGrid").dataSource.filter({}),$("#datatable").data("kendoGrid").dataSource.page(1)}function SearchJobSTCRecords(){1==UserTypeID||2==UserTypeID||UserTypeID,1!=UserTypeID&&2!=UserTypeID&&3!=UserTypeID&&5!=UserTypeID||localStorage.setItem("STCSubmission_SolarCompanyId",$("#hdnsolarCompanyid").val()),localStorage.setItem("STCSubmission_RecCode",$("#txtRecCode").val()),localStorage.setItem("STCSubmission_RefJobId",$("#txtRefJobId").val()),localStorage.setItem("STCSubmission_OwnerName",$("#txtOwnerName").val()),localStorage.setItem("STCSubmission_IsSPVRequired",$("#IsSPVRequired").val()),localStorage.setItem("STCSubmission_IsSPVInstallationVerified",$("#IsSPVInstallationVerified").val()),filter=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),STCSubmissionKendoIntialiize(),drawSTCSubmissionKendoGrid(filter),GetSTCJobStageCount()}function GetDates(e){if(""!=e){var t=ConvertDateToTick(e,dateFormat);return moment(t).format("YYYY-MM-DD")}return""}function UpdateSettlementDate(e,t,a){obj=e,window.event.preventDefault(),$(".error-message").hide(),$("#txtPopUpSettlementDate").val(a),$("#hdnJobId").val(t),$("#popupbox").modal(),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0)}function AddUpdatePVDSWHCode(e,t,a){obj=e,window.event.preventDefault(),$(".error-message").hide(),$("#txtPopUpPvdSwhCode").val(a),$("#hdncode").val(t),$("#popupbox1").modal(),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0),setTimeout(function(){$("#txtPopUpPvdSwhCode").focus()},1e3)}function AddUpdateComplianceNotes(e,t,a){obj=e,window.event.preventDefault(),$(".error-message").hide(),$("#txtareaComplianceNote").val(a),$("#popupboxaddupdateComplianceNote").modal(),$("#hdnStcJobDetailsId").val(t),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0),setTimeout(function(){$("#txtareaComplianceNote").focus()},1e3)}function StcCompliance(e,t,a){$.ajaxSetup({cache:!1}),$.ajax({type:"POST",url:url_StatusCompliance,data:JSON.stringify({uniq_param:(new Date).getTime(),JobId:t,JobDetailsId:a}),cache:!1,dataType:"html",contentType:"application/json; charset=utf-8",success:function(t){$("#popupStcCompliance").modal({backdrop:"static",keyboard:!1}),$("#modalContentStcCompliance").html(""),$("#modalContentStcCompliance").html(t),$(e).closest("tr").hasClass("hidden-row")?$("#isMultipleRecords").val(1):$("#isMultipleRecords").val(0)},error:function(e){}})}function LoadStc(e,t){$.ajax({url:url_STCJobPopup,type:"POST",data:{jobId:e,IsSubmissionScreen:1},async:!1,success:function(e){$("#STcBasicDetails").html(e),$("#StcModal").modal({backdrop:"static",keyboard:!1})}})}function LoadComplienceCheckList(){$("#collapsetow").hide();var e=$("#collapseOne").css("display");"none"==e?$("#collapseOne").show():$("#collapseOne").hide()}function LoadStcHistory(){$("#collapseOne").hide();var e=$("#collapsetow").css("display");"none"==e?$("#collapsetow").show():$("#collapsetow").hide()}function LoadComplienceCheckList(){$("#collapsetow").hide();var e=$("#collapseOne").css("display");"none"==e?$("#collapseOne").show():$("#collapseOne").hide()}function GetSubRecords(e,t){var a=!1,o=$("#ticon_"+e).closest("tr");return o.hasClass("open")?($(".open").removeClass("open"),$(".kendo-grid .edit-panel").removeClass("edit-panel")):$.ajax({type:"POST",url:urlGetSubRecordsForJob,dataType:"html",async:!1,data:{id:e,isKendo:$(t).attr("isKendo")},success:function(t){$(".open").removeClass("open"),$(".kendo-grid .hidden-row").remove(),o.addClass("open"),$("#ticon_"+e).closest("tr").after(t),o.closest("table").find("tr").each(function(){var e=$(this);e.hasClass("togglerow")&&(a=!1),a&&e.addClass("edit-panel"),e.hasClass("open")&&(a=!0)})},error:function(e){alert("Failed to retrieve job records."+e)}}),!1}function SetStageId(e){var t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#f7f7f7",SelectedStageId=e;t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#686868",SetParamsFromLocalStorage(),GetSTCJobStageCount(!0),$("#datatable").data("kendoGrid").dataSource.page(1)}function GetSTCJobStageCount(e=!1){var t=0,a=0,o=0;return 1==UserTypeID||3==UserTypeID?(t=document.getElementById("ResellerId").value,a=document.getElementById("RamId").value,o=$("#hdnsolarCompanyid").val()):2==UserTypeID?(t=ResellerId,a=document.getElementById("RamId").value,o=$("#hdnsolarCompanyid").val()):5==UserTypeID?(t=ResellerId,a=LoggedInUserId,o=$("#hdnsolarCompanyid").val()):o=SolarCompanyId,$.ajax({type:"POST",url:urlGetSTCJobStageCount,dataType:"json",async:e,data:{reseller:t,ram:a,sId:o,isAllScaJobView:isAllScaJobView,isShowOnlyAssignJobsSCO:isShowOnlyAssignJobsSCO,year:isArchiveScreenVar?$("#ddlYear").val():""},success:function(e){var t=0;$.each(e.lstSTCJobStagesCount,function(e,a){document.getElementById("jobstage_"+a.JobStageId).innerHTML=a.StageName+"<span>("+a.jobCount+")</span>",-1!=a.JobStageId&&(t+=a.jobCount)}),document.getElementById("jobstage_0").innerHTML="Show All<span>("+t+")</span>"},error:function(e){alert("Failed to retrieve count for Job Stages."+e)}}),!1}function AssignSelectedJobsToComplianceOfficer(){selectedRows=[],document.getElementById("AssignComplianceOfficerId").selectedIndex=0,$('#datatable tbody input[type="checkbox"]').each(function(){1==$(this).prop("checked")&&selectedRows.push($(this).attr("id").substring(4))}),null!=selectedRows&&selectedRows.length>0?1==UserTypeID?($(".error-message").hide(),$("#Assignjobpopup").modal()):3==UserTypeID&&AssignJobToFCO(LoggedInUserId):alert("Please select any job to assign.")}function AssignJobToFCO(e){$.ajax({url:urlAssignJobToFCO,type:"POST",async:!1,data:JSON.stringify({complianceOfficerID:e,jobs:selectedRows.join(","),isArchiveScreen:isArchiveScreenVar}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Jobs assigned to compliance officer successfully."),$("#errorMsgRegion").show(),GetSTCJobStageCount(),$("#datatable").data("kendoGrid").dataSource.read())}})}function SendSTCInvoice(e){selectedRows=[];var t=!0;if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var a=$(this).parent().parent().find(".clsLabelPVDSWH").text(),o=$(this).parent().parent().find(".clsDateLabel").text(),l=$(this).attr("IsInvoiced"),s=$(this).attr("IsCreditNote"),n=($(this).attr("IsPayment"),$(this).attr("STCStatus")),r=$(this).attr("term"),i=$(this).attr("custterm");if(12==r||10==r&&12==i)return alert("Can't generate STCInvoice for STC record which has PeakPay as settlement term."),t=!1,!1;if(""==a||null==a)alert("Can't generate STCInvoice for STC record which has not PVD code."),t=!1;else if("On Approval"==o&&"CER Approved"!=n)alert("Can't generate STCInvoice On Approval STC record"),t=!1;else if("true"==l&&"1"==e)alert("STCInvoice has been already generated for this job."),t=!1;else if("true"==s&&"0"==e)alert("CreditNote has been already generated for this job."),t=!1;else if("false"==l&&"0"==e)alert("First generate STC Invoice then after credit note will be generated."),t=!1;else{var d=$(this).attr("id").substring(4),c=$(this).attr("term"),u=$(this).attr("JobId");selectedRows.push(d+"_"+c+"_"+u)}}}),t)if(null!=selectedRows&&selectedRows.length>0){var a=0;1!=UserTypeID&&3!=UserTypeID||(a=document.getElementById("ResellerId").value),$.ajax({url:urlGenerateSTCInvoiceForSelectedJobs,type:"POST",data:JSON.stringify({resellerId:a,jobs:selectedRows.join(","),isstcinvoice:e,solarCompanyId:$("#hdnsolarCompanyid").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e&&0==e.status&&("specified method is not supported."==e.error.toLowerCase()||"renewtokenexception"==e.error.toLowerCase()?window.open(urlConnect,"_blank"):"sessiontimeout"==e.error.toLowerCase()&&(window.location.href=urlLogout)),e.success&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Invoice is generated successfully for selected jobs."),$("#errorMsgRegion").show(),$("#datatable").data("kendoGrid").dataSource.read(),GetSTCJobStageCount())},error:function(e){alert("error")}})}else alert("Please select any record to generate STC Invoice.")}function CreateRECEntry(){selectedRows=[],selectedRows_JobIDs=[];var e=!0,t=[];return $("#datatable tbody input:checked").length>100?(alert("Maximum 100 jobs can be created in rec-registry at a time."),!1):0==$("#datatable tbody input:checked").length?(alert("Please select any job to create entry in REC"),!1):(JobType="",$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(n=$(this).attr("IsInvoiced"),STCSettlementTerm=$(this).attr("term"),""!=JobType&&JobType!=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype"))return alert("All selected Jobs should have same Job Type to generate REC Registry entries"),e=!1,!1;JobType=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype");var a=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(IsSPVRequired=$(this).attr("IsSPVRequired"),IsSPVInstallationVerified=$(this).attr("IsSPVInstallationVerified"),""==a||null==a||"Ready To Create"!=a.trim())return alert("Can't generate REC Registry for selected STC records."),e=!1,!1;var o=$(this).attr("id").substring(4),l=$(this).attr("term"),s=$(this).attr("custterm"),n=$(this).attr("IsInvoiced"),r=$(this).attr("JobId"),i="undefined"==$(this).attr("gbbatchrecuploadid")||""==$(this).attr("gbbatchrecuploadid")?"":"_"+$(this).attr("gbbatchrecuploadid");if("true"==IsSPVRequired&&("false"==IsSPVInstallationVerified||"null"==IsSPVInstallationVerified))return alert("Installation verification not done yet."),e=!1,!1;"false"!=n.toLowerCase()||4==l||8==l||12==l||10==l||4==s&&8==s&&12==s||selectedRows.push(o+"_"+l+"_"+r);var d=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");selectedRows_JobIDs.push(d+i),t.push(d)}}),void(null!=selectedRows_JobIDs&&selectedRows_JobIDs.length>0&&e&&(1!=UserTypeID&&3!=UserTypeID||(rId=document.getElementById("ResellerId").value),$.ajax({url:urlCheckResellerRECCredentials,type:"GET",data:{resellerID:rId.toString(),JobIds:t.join(",")},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){if("true"==e.status.toString()){userid=e.ResellerDetails[0].Id;for(var t=0;t<e.ResellerDetails.length;t++)null!=e.ResellerDetails[t].RECLoginType&&""!=e.ResellerDetails[t].RECLoginType&&"Admin"==e.ResellerDetails[t].RECLoginType?($("#defaultCompName").text(e.ResellerDetails[t].RECCompName),$("#defaultAccName").text(e.ResellerDetails[t].RECAccName),$("#hdnDefaultCERLoginId").val(e.ResellerDetails[t].CERLoginId),$("#hdnDefaultCERPassword").val(e.ResellerDetails[t].CERPassword),
$("#hdnDefaultLoginType").val(e.ResellerDetails[t].RECLoginType)):($("#otherCompName").text(e.ResellerDetails[t].RECCompName),$("#otherAccName").text(e.ResellerDetails[t].RECAccName),$("#hdnOtherCERLoginId").val(e.ResellerDetails[t].CERLoginId),$("#hdnOtherCERPassword").val(e.ResellerDetails[t].CERPassword),$("#hdnOtherLoginType").val(e.ResellerDetails[t].RECLoginType));1==UserTypeID||3==UserTypeID?$("#rec-Login").modal({backdrop:"static",keyboard:!1}):""!=$("#hdnDefaultCERLoginId").val()&&""!=$("#hdnDefaultCERPassword").val()&&""!=$("#defaultAccName").text()?UseDefault():""!=$("#hdnOtherCERLoginId").val()&&""!=$("#hdnOtherCERPassword").val()&&""!=$("#otherAccName").text()?UseOther():alert("REC Credentials not found. Please Update it from Profile")}"false"==e.status.toString()&&e.lstJobIds.length>0&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"["+e.strlstJobIds+"] Jobs are already In Progress or SuccessFully Uploaded on REC."),$("#errorMsgRegion").show())}}))))}function CreateInRECEntry(){$.ajax({url:urlCreateEntryInRECForSelectedJobs,type:"POST",data:JSON.stringify({resellerId:rId,jobs:selectedRows.join(","),JobIDs:selectedRows_JobIDs.join(","),JobType:JobType,TotalSTC:$("#btotalTradedSTC").text(),CERLoginId:$("#hdnCERLoginId").val(),CERPassword:$("#hdnCERPassword").val(),RECAccName:$("#hdnRECAccName").val(),RECCompanyName:$("#hdnRECCompanyName").val(),LoginType:$("#hdnLoginType").val()}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Failed"==e.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()),$(window).scrollTop(0),setTimeout(function(){filter=$("#datatable").data("kendoGrid").dataSource.filter(),STCSubmissionKendoIntialiize(),drawSTCSubmissionKendoGrid(filter),GetSTCJobStageCount()},1e3)}})}function UseDefault(){""!=$("#hdnDefaultCERLoginId").val()&&""!=$("#hdnDefaultCERPassword").val()&&""!=$("#defaultAccName").text()?(IsDefaultRECCredentials=!0,$("#hdnCERLoginId").val($("#hdnDefaultCERLoginId").val()),$("#hdnCERPassword").val($("#hdnDefaultCERPassword").val()),$("#hdnRECAccName").val($("#defaultAccName").text()),$("#hdnRECCompanyName").val($("#defaultCompName").text()),$("#hdnLoginType").val($("#hdnDefaultLoginType").val()),CreateInRECEntry(),$("#rec-Login").modal("toggle")):alert("Default Credentials are blank")}function UseOther(){""!=$("#hdnOtherCERLoginId").val()&&""!=$("#hdnOtherCERPassword").val()&&""!=$("#otherAccName").text()?(IsDefaultRECCredentials=!1,$("#hdnCERLoginId").val($("#hdnOtherCERLoginId").val()),$("#hdnCERPassword").val($("#hdnOtherCERPassword").val()),$("#hdnRECAccName").val($("#otherAccName").text()),$("#hdnRECCompanyName").val($("#otherCompName").text()),$("#hdnLoginType").val($("#hdnOtherLoginType").val()),CreateInRECEntry(),$("#rec-Login").modal("toggle")):alert("Credentials are blank")}function UpdateUser(){$("#rec-Login").modal("toggle"),window.open(urlEditUser+"/"+userid+"#horizontalTab3","_blank")}function SetSTCInvoiceStatus(){document.getElementById("chkNotInvoiced").checked&&(invoiced=2),document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=1),document.getElementById("chkNotInvoiced").checked&&document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=0),0==document.getElementById("chkNotInvoiced").checked&&0==document.getElementById("chkHasBeenInvoiced").checked&&(invoiced=3)}function ValidateLettersWithSpaceOnly(e){e=e||event;var t=e.charCode?e.charCode:e.keyCode?e.keyCode:e.which?e.which:0;return!(t>32&&(t<65||t>90)&&(t<97||t>122)&&(t<=47||t>58))}function CheckTextContent(){var e,t=$("#txtPopUpPvdSwhCode").val(),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 ";for(i=0;i<t.length;i++)if(e=t.charAt(i),-1==a.indexOf(e))return alert("Special characters are not allowed for PVD code."),$("#txtPopUpPvdSwhCode").val(""),!1;return!1}function ToDate(e){if(null!=e){var t=ConvertDateToTick(e,"dd/mm/yyyy");tDate=moment(t).format("MM/DD/YYYY");var a=new Date(tDate);return moment(a).format(dateFormatMoment)}return""}function SetParamsFromLocalStorage(){$("#txtRefJobId").val(localStorage.getItem("STCSubmission_RefJobId")),$("#txtOwnerName").val(localStorage.getItem("STCSubmission_OwnerName")),$("#txtRecCode").val(localStorage.getItem("STCSubmission_RecCode"))}function BindSTCJobStages(){return $("#STCJobStageID").empty(),$.ajax({type:"POST",url:urlGetSTCJobStages,dataType:"json",async:!1,success:function(e){$("#STCJobStageID").append('<option value="0">Select STC job stage</option>'),$.each(e,function(e,t){$("#STCJobStageID").append('<option value="'+t.Value+'">'+t.Text+"</option>")})},error:function(e){alert("Failed to retrieve Job Stages."+e)}}),!1}function BulkChangeSTCJobStage(){if(!(document.getElementById("STCJobStageID").selectedIndex>0))return alert("Please select STC Job Stage first."),!1;var e="";selectedRows=[];var t=[],a=!0,o=!0,l=[];if($('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if("CER Approved"==$(this).attr("STCStatus")||"New Submission"==$(this).attr("STCStatus"))return a=!1,!1;if(22==document.getElementById("STCJobStageID").value&&5==$(this).attr("term")&&!$(this).attr("PartialValid"))return o=!1,!1;14==document.getElementById("STCJobStageID").value&&"false"==$(this).attr("IsInvoiced")?(e="are you sure you want to change this status as per normal, and status change but no credit note is created because no invoice has been generated.",selectedRows.push($(this).attr("id").substring(4)),t.push($(this).attr("jobid"))):(selectedRows.push($(this).attr("id").substring(4)),t.push($(this).attr("jobid")));var s={JobId:$(this).attr("jobid"),STCJobDetailsID:$(this).attr("id").substring(4)};l.push(s)}}),o){if(!a)return alert("You can not change stc status of job which have CER Approved or New Submission STC status."),!1;if(!(null!=selectedRows&&selectedRows.length>0))return alert("Please select atleast one Job to update STC Stage."),!1;""==e&&(e=22==document.getElementById("STCJobStageID").value?"Are you sure you want to change stc status  as CERApproved of selected jobs as you can not reverse it after change ?":"Are you sure you want to change stc status of selected jobs ?");var s=confirm(e);s&&$.ajax({type:"POST",url:urlBulkChangeSTCJobStage,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcjobstage:document.getElementById("STCJobStageID").value,stcjobids:selectedRows.join(","),checkSPVrequired:l}),success:function(e){e.success?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Job Stages updated successfully."),$("#errorMsgRegion").show(),GetSTCJobStageCount(),$("#datatable").data("kendoGrid").dataSource.read(),document.getElementById("STCJobStageID").selectedIndex=0):($(".alert").hide(),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").html(closeButton+e.message),$("#errorMsgRegion").show(),GetSTCJobStageCount(),$("#datatable").data("kendoGrid").dataSource.read(),document.getElementById("STCJobStageID").selectedIndex=0)},error:function(e){}})}else alert("You can not change status to CERApproved which has STCStatus Partial and first invoice is not yet generated.")}function InstallationVerifyAgain(e){var t=!0,a=!0;return e.disabled=!0,selectedRows=[],0==$("#datatable tbody input:checked").length?(alert("Please select atleast one Job for Installation Verify."),e.disabled=!1,!1):($("#datatable tbody input:checked").each(function(o,l){return STCStatus=$(this).attr("STCStatus"),IsSPVRequired=$(this).attr("IsSPVRequired"),IsSPVInstallationVerified=$(this).attr("isspvinstallationverified"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim()?(a=!1,!1):"true"!=IsSPVRequired||"true"==IsSPVInstallationVerified?(t=!1,e.disabled=!1,!1):void 0}),0==t?(alert("Selected job must have is spv required true and spv installation verify not true."),e.disabled=!1,!1):0==a?(alert("Selected Job STC status must be 'Ready To Create'."),e.disabled=!1,!1):void $('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){var t;if(STCStatus=$(this).attr("STCStatus"),IsSPVRequired=$(this).attr("IsSPVRequired"),IsSPVInstallationVerified=$(this).attr("isspvinstallationverified"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim())return alert("STC status must be 'Ready To Create'."),flage=!1,!1;if("true"!=IsSPVRequired||"false"!=IsSPVInstallationVerified&&"null"!=IsSPVInstallationVerified||(selectedRows.push($(this).attr("id").substring(4)),$.ajax({type:"POST",url:urlInstallationVerifyAgain,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcjobids:selectedRows.join(",")}),success:function(a){a.success&&(e.disabled=!1,$(".alert").hide(),a.IsError?($("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),t="Something went wrong,Please check SPV failure reason."):($("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),t="SPV Installation verification done successfully."),$("#errorMsgRegion").html(closeButton+t),$("#errorMsgRegion").show(),$("#datatable").data("kendoGrid").dataSource.read(),document.getElementById("STCJobStageID").selectedIndex=0)},error:function(t){e.disabled=!1}})),"true"!=IsSPVRequired||"true"==IsSPVInstallationVerified)return alert("Selected job must have is spv required true and SPV installation verified not true."),flage=!1,!1}}))}function UpdateJobStatusFromREC(e){var t=$("#ResellerId").val(),a=$("#UpdateJobStatusFromRECSwitch").prop("checked"),o=!0;a&&e&&(o=confirm("Are you sure you want to switch on Auto CER Update On? On switching yes all CER data will get updated."));var l=e?a?"Update job status from rec has been switched ON":"Update job status from rec has been switched OFF":"Updating job status from rec";o?$.ajax({url:urlUpdateJobStatusFromREC,type:"post",dataType:"json",async:!1,data:{resellerId:t,isSwitch:e,isAutoUpdateCEROn:a},success:function(e){e.status&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+l),$("#errorMsgRegion").show(),showHideBtnUpdateJobStatusFromREC(a),$("#datatable").data("kendoGrid").dataSource.read())},error:function(e){alert("Failed to update."+e)}}):$("#UpdateJobStatusFromRECSwitch").prop("checked",!1)}function GetUpdateJobStatusFromRecByResellerId(e){$.ajax({url:urlGetUpdateJobStatusFromRecByResellerId,type:"get",dataType:"json",async:!1,data:{resellerId:e},success:function(e){$("#errorMsgRegion").hide(),$("#UpdateJobStatusFromRECSwitch").prop("checked",e.isAutoUpdateCEROn),showHideBtnUpdateJobStatusFromREC(e.isAutoUpdateCEROn)},error:function(e){alert("Failed to retrive."+e)}})}function showHideBtnUpdateJobStatusFromREC(e){e?$(".btnUpdateJobStatusFromREC").hide():$(".btnUpdateJobStatusFromREC").show()}function ToDate(e){if(null!=e){var t=ConvertDateToTick(e,"dd/mm/yyyy");tDate=moment(t).format("MM/DD/YYYY");var a=new Date(tDate);return moment(a).format(dateFormat.toUpperCase())}return""}function SaveUserWiseColumnDetails(){$("#loading-image").css("display","");var e=[],t=0,a=$("#datatable").data("kendoGrid").columns;$("#datatable th").each(function(o,l){t+=1;var s=$("#datatable").data("kendoGrid").dataSource.pageSize();e.push({Width:a[o].width,ColumnID:$(l).attr("data-columnid"),OrderNumber:t,PageSize:s})}),e.length>0?$.ajax({url:"/Job/SaveUserWiseColumnsDetails",type:"POST",async:!1,data:JSON.stringify({columns:e,MenuId:STCSubmissionView}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.status?(listColumns=e.ListColumnName,listColumnsWidth=e.ListColumnWidth,UserWiseColumnsData=e.JSUserColumnList,DefaultPageSize=e.PageSize):alert("Try again.")},error:function(e){alert("Try again. "+e)}}):alert("Add atleast one column."),$("#loading-image").css("display","none")}function onReorder(e){if(void 0!==e.column.reorderable&&!e.column.reorderable){var t=$("#datatable").data("kendoGrid");setTimeout(function(){t.reorderColumn(e.oldIndex,t.columns[e.newIndex])},0)}setTimeout(function(){SaveUserWiseColumnDetails()},150)}function GetRecFailureReason(){window.open(urlRecFailureReason,"_blank")}function GetSPVFailureReason(){$("#spv-failure-reason").modal({backdrop:"static",keyboard:!1}),$("#errorMsgRegionSPVFailure").hide()}function RemoveJobFromBatch(){var e="";$("#rec-failure-reason .collection-item.active:not(.selectAll)").each(function(t,a){e=e+$(this).data("stcjobdetailsid")+","}),""!=e?RemoveSelectedJobFromBatch(e.replace(/,\s*$/,"")):alert("Please select jobs")}function RemoveSelectedJobFromBatch(e){event.preventDefault();$("#accordionExample").find(".collapse.in").attr("id");$.ajax({url:urlRemoveJobFromBatch,type:"POST",dataType:"json",async:!1,data:{StcJobdetailsId:e},success:function(e){e.status?($("#errorMsgRegionRECFailure").removeClass("alert-danger"),$("#errorMsgRegionRECFailure").addClass("alert-success"),$("#errorMsgRegionRECFailure").html(closeButton+"Remove Job From Batch Successfully"),$("#errorMsgRegionRECFailure").show(),GridConfig[0].IsKendoGrid&&$("#datatable").data("kendoGrid").dataSource.read()):($("#errorMsgRegionRECFailure").html(closeButton+"Something happend not remove job from batch"),$("#errorMsgRegionRECFailure").show())},error:function(e){alert("Failed to retrive."+e)}})}function ResetSPVInstaller(){selectedRows=[];var e=[],t=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select atleast one Job for spv release."),!1;if($('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){var a=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(""==a||null==a||"Ready To Create"!=a.trim())return alert("STC status must be 'Ready To Create'."),t=!1,!1;if(IsSPVRequired=$(this).attr("IsSPVRequired"),"true"!=IsSPVRequired)return alert("Selected job must have is spv required true."),t=!1,!1;var o=$(this).attr("id").substring(4);selectedRows.push(o);var l=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");e.push(l)}}),null!=selectedRows&&selectedRows.length>0&&null!=e&&e.length>0&&t){var a=confirm("Are you sure you want to spv release of selected jobs ? ");a&&$.ajax({type:"POST",url:urlResetSPVInstaller,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcJobDetailIds:selectedRows.join(","),stcjobids:e.join(",")}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Spv release for selected job done successfully."),$("#errorMsgRegion").show(),$("#datatable").data("kendoGrid").dataSource.read())},error:function(e){}})}}function SearchSPVFailureReason(){$("#spv-failure-reason-div").load(urlGetSpvFailureReason+"?resellerId="+$("#ResellerId").val()+"&RefJobId="+$("#txtSpvRefJobId").val().trim(),function(){})}function ResetSPVSearchFilters(e){$("#txtSpvRefJobId").val(""),SearchSPVFailureReason()}function SPVReset(){var e=[],t=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select atleast one Job for spv reset."),!1;if($('#datatable tbody input[type="checkbox"]:checked').each(function(){if(1==$(this).prop("checked")){if(IsRelease=$(this).attr("IsRelease"),STCStatus=$(this).attr("STCStatus"),""==STCStatus||null==STCStatus||"Ready To Create"!=STCStatus.trim())return alert("STC status must be 'Ready To Create'."),t=!1,!1;if("true"!=IsRelease)return alert("Selected job must have is spv release true."),t=!1,!1;var a=$(this).attr("id").substring(4);selectedRows.push(a);var o=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");e.push(o)}}),null!=selectedRows&&selectedRows.length>0&&null!=e&&e.length>0&&t){var a=confirm("Are you sure you want to reset spv of selected jobs ? ");a&&$.ajax({type:"POST",url:urlSPVReset,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({stcJobDetailIds:selectedRows.join(","),jobids:e.join(",")}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Spv reset for selected job done successfully."),$("#errorMsgRegion").show(),$("#datatable").data("kendoGrid").dataSource.read())},error:function(e){}})}}var filter={},IsDefaultRECCredentials=!0,rId=0,selectedRows_JobIDs=[],JobType="",isArchiveScreenVar="undefined"==typeof isArchiveScreen?0:isArchiveScreen?1:0;$(document).ready(function(){if($("#searchSolarCompany").autocomplete({minLength:0,source:function(e,t){var a=[];$("#hdnsolarCompanyid").val(0),$.each(solarCompanyList,function(e,t){t.text.toLowerCase().indexOf($("#searchSolarCompany").val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value})}),t($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id}}))},select:function(e,t){$("#hdnsolarCompanyid").val(t.item.id)}}).on("focus",function(){$(this).keydown()}),$.ui.autocomplete.prototype._renderItem=function(e,t){var a=new RegExp($.trim(this.term.toLowerCase())),o=t.label.replace(a,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",t).append("<a>"+o+"</a>").appendTo(e)},null!=STCSubmission_Status&&""!=STCSubmission_Status){SelectedStageId=STCSubmission_Status;var e=0,t=document.getElementById("jobstage_"+e);t.style.backgroundColor="#f7f7f7";t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#686868",1!=UserTypeID&&3!=UserTypeID||(document.getElementById("RamId").selectedIndex=0),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("STCSubmission_PVDSWHCode",""),1==UserTypeID||5==UserTypeID||UserTypeID,localStorage.setItem("STCSubmission_RefJobId",""),localStorage.setItem("STCSubmission_OwnerName",""),localStorage.setItem("STCSubmission_InstallationAddress",""),localStorage.setItem("STCSubmission_IsSPVRequired","-1"),localStorage.setItem("STCSubmission_IsSPVInstallationVerified","-1"),$("#txtSubmissionFromDate").val(""),$("#txtSubmissionToDate").val(""),$("#txtSettlementFromDate").val(""),$("#txtSettlementToDate").val(""),$("#IsSPVRequired").val("-1"),$("#IsSPVInstallationVerified").val("-1"),invoiced=0,GetSTCJobStageCount()}if(null!=ComplianceIssuesDashboardStatus&&""!=ComplianceIssuesDashboardStatus){SelectedStageId=ComplianceIssuesDashboardStatus;e=0,t=document.getElementById("jobstage_"+e);t.style.backgroundColor="#f7f7f7";t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#686868",1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||$("#txtPVDSWHCode").val(""),1==UserTypeID||5==UserTypeID||UserTypeID,$("#txtRefJobId").val(""),$("#txtOwnerName").val(""),$("#txtRecCode").val(""),document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkHasBeenInvoiced").checked=!0,invoiced=0,GetSTCJobStageCount()}if($("#aSwitch").click(function(e){window.location.href="/Job/StaticSTCSubmission?IsKendoStcSubmissionPage=false"}),BindSTCJobStages(),$("#txtSubmissionFromDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=$("#txtSubmissionToDate").val()){var e=new Date(ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat)),t=new Date(ConvertDateToTick($("#txtSubmissionToDate").val(),dateFormat));e>t&&$("#txtSubmissionToDate").val("")}var a=ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat);tDate=moment(a).format("MM/DD/YYYY"),$("#txtSubmissionToDate").data("datepicker")&&$("#txtSubmissionToDate").data("datepicker").setStartDate(new Date(tDate))}),$("#txtSubmissionToDate").datepicker({format:dateFormat,autoclose:!0}),$("#txtSubmissionToDate").change(function(){new Date(ConvertDateToTick($("#txtSubmissionFromDate").val(),dateFormat)),new Date(ConvertDateToTick($("#txtSubmissionToDate").val(),dateFormat))}),$("#ExportCSVAll").click(function(e){var t="";if(0==$("#datatable tbody input:checked").length)return alert("Please select any job to export csv."),!1;if(1==$("#chkAll").prop("checked"))t="";else{var a=[];$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var e=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");a.push(e)}}),null!=a&&a.length>0&&(t=a.join(","))}var o="",l="",s="";1!=UserTypeID&&3!=UserTypeID||(o=document.getElementById("ResellerId").value),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(l=0==$("#hdnsolarCompanyid").val()?-1:$("#hdnsolarCompanyid").val()),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID||(s=document.getElementById("RamId").value);var n=$("#datatable").data("kendoGrid").dataSource.filter();window.location.href=urlBulkUploadAll+"?JobID="+t+"&stageid="+SelectedStageId+"&reseller="+o+"&solarcompanyid="+l+(isArchiveScreenVar?"&year="+$("#ddlYear").val():"")+"&RAM="+s+"&RecCode="+$("#txtRecCode").val()+"&RefJobId="+$("#txtRefJobId").val()+"&ownername="+$("#txtOwnerName").val()+"&complianceOfficername="+$("#ComplianceOfficerId option:selected").text()+"&solarcompanyname="+$("#searchSolarCompany").val()+"&ResellerName="+$("#ResellerId option:selected").text()+"&RamName="+$("#RamId option:selected").text()+"&isAllScaJobView="+isAllScaJobView+"&filter= "+JSON.stringify(n)+"&isShowOnlyAssignJobsSCO="+isShowOnlyAssignJobsSCO+"&isSPVRequired="+$("#IsSPVRequired").val()+"&isSPVInstallationVerified="+$("#IsSPVInstallationVerified").val()}),$("#ExportCSV").click(function(e){selectedRows=[];var t=[],a=!0;if(0==$("#datatable tbody input:checked").length)return alert("Please select any job to export csv."),!1;var o="";$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){if(""!=o&&o!=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype"))return alert("All selected Jobs should have same job type to export csv."),a=!1,!1;o=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-jobtype");var e=$(this).parent().parent().find(".clsSTCStatusLabel").text();if(""==e||null==e||"Ready To Create"!=e.trim())return alert("STC status must be 'Ready To Create'."),!1;var l=$(this).attr("id").substring(4),s=$(this).attr("term");selectedRows.push(l+"_"+s);var n=$(this).parent().parent().find(".clsSTCStatusLabel").attr("data-JobID");t.push(n)}}),null!=selectedRows&&selectedRows.length>0&&a&&(console.log(o),"1"==o?$.ajax({url:checkInstallationDateURL+"?JobID="+t.join(","),type:"POST",async:!0,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"false"==e.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+e.message),$("#errorMsgRegion").show()):window.location.href=urlBulkUpload+"?JobID="+t.join(",")}}):window.location.href=urlBulkUploadSWHCSV+"?JobID="+t.join(","))}),$("#txtSettlementFromDate").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=$("#txtSettlementToDate").val()){var e=new Date(ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat)),t=new Date(ConvertDateToTick($("#txtSettlementToDate").val(),dateFormat));e>t&&$("#txtSettlementToDate").val("")}var a=ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat);tDate=moment(a).format("MM/DD/YYYY"),$("#txtSettlementToDate").data("datepicker")&&$("#txtSettlementToDate").data("datepicker").setStartDate(new Date(tDate))}),$("#txtSettlementToDate").datepicker({format:dateFormat,autoclose:!0}),$("#txtSettlementToDate").change(function(){new Date(ConvertDateToTick($("#txtSettlementFromDate").val(),dateFormat)),new Date(ConvertDateToTick($("#txtSettlementToDate").val(),dateFormat))}),$("#txtPopUpSettlementDate").datepicker({format:dateFormat,autoclose:!0}),1==UserTypeID||3==UserTypeID){var a=!1;$.ajax({type:"get",url:urlGetReseller,dataType:"json",data:"",async:!1,success:function(e){$.each(e,function(e,t){$("#ResellerId").append('<option value="'+t.Value+'">'+t.Text+"</option>"),0==a&&t.Value==localStorage.getItem("STCSubmission_ResellerId")&&(a=!0)});var t=STCSubmission_ResellerId;""==t||"0"==t?a?document.getElementById("ResellerId").value=localStorage.getItem("STCSubmission_ResellerId"):($("#ResellerId").val($("#ResellerId option:first").val()),localStorage.setItem("STCSubmission_ResellerId",$("#ResellerId option:first").val())):$("#ResellerId").val(t),GetRAMByResellerId($("#ResellerId").val()),BindSolarCompany($("#ResellerId").val(),document.getElementById("RamId").value),GetSTCJobStageCount()},error:function(e){alert("Failed to retrieve Resellers."+e)}})}1==UserTypeID&&$("#ResellerId").val()>0&&(GetFCOByResellerId($("#ResellerId").val()),GetUpdateJobStatusFromRecByResellerId($("#ResellerId").val())),2==UserTypeID&&(GetFCOByResellerId(ResellerId),GetRAMByResellerId(ResellerId),BindSolarCompany(ResellerId,document.getElementById("RamId").value),GetSTCJobStageCount()),5==UserTypeID&&(GetFCOByResellerId(ResellerId),"true"==isAllScaJobView?BindSolarCompany(ResellerId,0):BindSolarCompany(0,LoggedInUserId),GetSTCJobStageCount()),8==UserTypeID&&GetSTCJobStageCount(),1==UserTypeID||3==UserTypeID?$("#ResellerId").focus():2==UserTypeID?$("#searchSolarCompany").focus():5==UserTypeID?$("#RamId").focus():$("#txtRefJobId").focus(),SetParamsFromLocalStorage(),$("#ResellerId").change(function(){$("#ResellerId").val()>0?(GetFCOByResellerId($("#ResellerId").val()),GetRAMByResellerId($("#ResellerId").val()),BindSolarCompany($("#ResellerId").val(),0),GetSTCJobStageCount(),GetUpdateJobStatusFromRecByResellerId($("#ResellerId").val()),localStorage.setItem("STCSubmission_ResellerId",document.getElementById("ResellerId").value)):($("#RamId").empty(),$("#RamId").append('<option value="0">Select</option>')),filter=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),STCSubmissionKendoIntialiize(),drawSTCSubmissionKendoGrid(filter)}),$("#RamId").change(function(){$("#RamId").val()>0?BindSolarCompany(0,$("#RamId").val()):BindSolarCompany($("#ResellerId").val(),0),GetSTCJobStageCount(),localStorage.setItem("STCSubmission_RamId",document.getElementById("RamId").value),filter=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),STCSubmissionKendoIntialiize(),drawSTCSubmissionKendoGrid(filter)}),$("#btnSaveSettlementDate").click(function(e){""!=$("#txtPopUpSettlementDate ").val()?($("#popupbox").modal("hide"),$.ajax({type:"get",url:urlUpdateSettlementDate,dataType:"json",async:!1,data:{jobId:$("#hdnJobId").val(),sDate:GetDates($("#txtPopUpSettlementDate").val()),isMultipleRecords:$("#isMultipleRecords").val()},success:function(e){e.success&&(obj.parentNode.innerHTML=$("#txtPopUpSettlementDate").val()+'<a title="edit" href="#" onclick="UpdateSettlementDate(this,'+$("#hdnJobId").val()+",'"+$("#txtPopUpSettlementDate").val()+'\');" class="edit sprite-img grid-edit-ic" style=" text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>',$(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Settlement date updated successfully."),$("#errorMsgRegion").show())},error:function(e){alert("Failed to update settlement date."+e)}}),$(".error-message").hide()):$(".error-message").show()}),$("#btnSaveComplainceNotes").click(function(e){$("#popupboxaddupdateComplianceNote").modal("hide"),$.ajax({type:"get",url:urlUpdateComplianceNote,dataType:"json",async:!1,data:{STCJobdetailsId:$("#hdnStcJobDetailsId").val(),Complaincenote:$("#txtareaComplianceNote").val(),isMultipleRecords:$("#isMultipleRecords").val()},success:function(e){e.success&&(""!=$("#txtareaComplianceNote").val()?obj.parentNode.innerHTML='<lable class="clsLabelComplianceNotes" >'+$("#txtareaComplianceNote").val()+'</lable><a title="edit" href="#" onclick="AddUpdateComplianceNotes(this,'+$("#hdnStcJobDetailsId").val()+",'"+$("#txtareaComplianceNote").val()+'\');" class="edit sprite-img grid-edit-ic" style="text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>':obj.parentNode.innerHTML='<a class="sprite-img add_ic" title="add" href="#" onclick="AddUpdateComplianceNotes(this,'+$("#hdnStcJobDetailsId").val()+",'"+$("#txtareaComplianceNote").val()+'\');" style="background-position: -132px -383px;height: 16px;width: 16px!important;text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>',$(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Compliance Note updated successfully."),$("#errorMsgRegion").show())},error:function(e){alert("Failed to update Compliance Note."+e)}})}),$("#btnSavePvdSwhCode").click(function(e){""!=$("#txtPopUpPvdSwhCode").val()?($("#popupbox1").modal("hide"),$.ajax({type:"get",url:urlUpdatePVDSWHCode,dataType:"json",async:!1,data:{jobId:$("#hdncode").val(),pvdswhCode:$("#txtPopUpPvdSwhCode").val(),isMultipleRecords:$("#isMultipleRecords").val()},success:function(e){e.success&&(obj.parentNode.innerHTML='<lable class="clsLabelPVDSWH" >'+$("#txtPopUpPvdSwhCode").val()+'</lable><a title="edit" href="#" onclick="AddUpdatePVDSWHCode(this,'+$("#hdncode").val()+",'"+$("#txtPopUpPvdSwhCode").val()+'\');" class="edit sprite-img grid-edit-ic" style=" text-decoration:none;margin-left:5px">&nbsp;&nbsp;</a>',$(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"PVD/SWH code updated successfully."),$("#errorMsgRegion").show())},error:function(e){alert("Failed to update settlement date."+e)}}),$(".error-message").hide()):$(".error-message").show()}),$("#btnAssignJobs").click(function(e){0!=document.getElementById("AssignComplianceOfficerId").value?($("#Assignjobpopup").modal("hide"),AssignJobToFCO(document.getElementById("AssignComplianceOfficerId").value),$(".error-message").hide()):$(".error-message").show()}),STCSubmissionKendoIntialiize(),drawSTCSubmissionKendoGrid(),$(document).on("change","#chkAll",function(){if($("#datatable").find("[type='checkbox']").prop("checked",this.checked),chkCount=this.checked?$("#datatable tbody").find("tr .k-checkbox-label").length:0,this.checked){var e=0,t=0;$('#datatable tbody input[type="checkbox"]').each(function(){var a=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();e=parseFloat(parseFloat(e)+parseFloat(a)).toFixed(2);var o=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?"0":$(this).parent().parent().find(".lblSTcPrice").text();t=parseFloat(parseFloat(t)+parseFloat(a)*parseFloat(o.replace("$",""))).toFixed(2)}),$("#btotalTradedSTC").html(e),$("#btotalAmount").html(t),$("#btotalNoofJobs").text(chkCount)}else $("#btotalTradedSTC").html(0),$("#btotalAmount").html(0),$("#btotalNoofJobs").text(0)}),$(document).on("change","#datatable tbody input[type='checkbox']",function(){if(this.checked){chkCount++,chkCount==$("#datatable").data("kendoGrid").dataSource.view().length&&$("#chkAll").prop("checked",this.checked)
;var e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html(),a=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?"0":$(this).parent().parent().find(".lblSTcPrice").text(),o=parseFloat(parseFloat($("#btotalAmount").html())+parseFloat(e*parseFloat(a.replace("$","")))).toFixed(2);$("#btotalAmount").html(o),$("#btotalTradedSTC").html(parseFloat(parseFloat(e)+parseFloat(t)).toFixed(2)),$("#btotalNoofJobs").text(chkCount)}else{chkCount--,$("#chkAll").prop("checked",this.checked);e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html(),a=""==$(this).parent().parent().find(".lblSTcPrice").text()||null==$(this).parent().parent().find(".lblSTcPrice").text()?"0":$(this).parent().parent().find(".lblSTcPrice").text(),o=parseFloat(parseFloat($("#btotalAmount").html())-parseFloat(e*parseFloat(a.replace("$","")))).toFixed(2);$("#btotalAmount").html(o),$("#btotalTradedSTC").html(parseFloat(parseFloat(t)-parseFloat(e)).toFixed(2)),$("#btotalNoofJobs").text(chkCount)}})});var Kendo_ComplianceNotes=function(e){if((1==UserTypeID||3==UserTypeID)&&(e.STCJobComplianceID>0||e.ComplianceBy!=parseInt(loggedInUserId))&&"Under Review"==e.STCStatus){if(null!=e.ComplianceNotes&&""!=e.ComplianceNotes){var t=" text-decoration:none;margin-left:5px",a='<lable class="clsLabelComplianceNotes">'+e.ComplianceNotes+'</lable><a title="edit" href="#" onclick="AddUpdateComplianceNotes(this,'+e.STCJobDetailsId+",'"+e.ComplianceNotes+'\');" class="edit sprite-img grid-edit-ic" style="'+t+'">&nbsp;&nbsp;</a>';return a}var o="background-position: -132px -383px;height: 16px;width: 16px!important;text-decoration:none;margin-left:5px";a='<a class="img-border sprite-img add_ic" title="edit" href="#" onclick="AddUpdateComplianceNotes(this,'+e.STCJobDetailsId+',\'\');" class="edit" style="'+o+'">&nbsp;&nbsp;</a>';return a}a='<lable class="clsLabelComplianceNotes">'+e.ComplianceNotes+"</lable>";return a},Kendo_GBBatchRECUploadId=function(e){if(null!=e.GBBatchRECUploadId&&""!=e.GBBatchRECUploadId){var t="text-decoration:none;margin-left:5px";return"<lable>"+(e.GBBatchRECUploadId.split("-").length>1&&""!=e.GBBatchRECUploadId.split("-")[1]?e.GBBatchRECUploadId:e.GBBatchRECUploadId.split("-")[0])+'</lable><a title="delete" href="#" onclick="RemoveSelectedJobFromBatch('+e.STCJobDetailsId+');" class="delete sprite-img grid-delete-ic " style="'+t+'">&nbsp;&nbsp;</a>'}return""},Kendo_IsInvoiced=function(e){return e.IsInvoiced?'<span class="sprite-img file-green-ic "></span>':5==e.STCSettlementTerm&&1==e.STCInvoiceCount?'<span class="sprite-img file-orange-ic"></span>':'<span class="sprite-img file-red-ic"></span>'},Kendo_IsRelease=function(e){return e.IsRelease?'<span class="sprite-img file-green-ic "></span>':'<span class="sprite-img file-red-ic"></span>'},Kendo_IsCreditNote=function(e){return e.IsCreditNote?'<span class="sprite-img file-green-ic "></span>':'<span class="sprite-img file-red-ic"></span>'},Kendo_IsSPVRequired=function(e){return e.IsSPVRequired?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},Kendo_IsSPVInstallationVerified=function(e){return null==e.IsSPVInstallationVerified?'<span style="font-weight: bold;">Not Yet Verified</span>':e.IsSPVInstallationVerified?'<span style="font-weight: bold;color: Green;">Verified</span>':'<span style="font-weight: bold;color: Red;">Verify Failed</span>'},Kendo_RefNumberOwnerName=function(e){if(null!=e.RefNumberOwnerName){var t=urlJobIndex+"?id="+e.Id;return'<a href="'+t+'" style="text-decoration:none;">'+e.RefNumberOwnerName+"</a>"}return""},Kendo_JobID=function(e){return e.JobID},Kendo_SolarCompany=function(e){return"<span style='font-weight:bold;'>"+e.SolarCompany+"</span>"},Kendo_InstallationDate=function(e){return ToDate(e.strInstallationDate)},Kendo_RECBulkUploadTimeDate=function(e){return""!=e.strRECBulkUploadTimeDate?ToDate(e.strRECBulkUploadTimeDate):""},Kendo_InstallationState=function(e){return e.InstallationState},Kendo_InstallationTown=function(e){return e.InstallationTown},Kendo_SystemSize=function(e){return e.SystemSize},Kendo_InstallationAddress=function(e){return e.InstallationAddress},Kendo_STCStatus=function(e){return 19!=e.STCStatusId||null==e.IsSPVInstallationVerified||e.IsSPVInstallationVerified?'<lable class="clsSTCStatusLabel" data-JobID='+e.JobID+" data-JobType="+e.JobTypeId+' style="color:'+e.ColorCode+'">'+e.STCStatus+"</lable>":'<lable class="clsSTCStatusLabel Installation-verified-false" data-JobID='+e.JobID+" data-JobType="+e.JobTypeId+' style="color:'+e.ColorCode+'">'+e.STCStatus+" </lable>"},Kendo_STCSettlementTerm=function(e){return 1==e.STCSettlementTerm?"24 Hour":2==e.STCSettlementTerm?"3 Days":3==e.STCSettlementTerm?"7 Days":4==e.STCSettlementTerm?"CER Approved":5==e.STCSettlementTerm?"Partial Payment":6==e.STCSettlementTerm?"Upfront":7==e.STCSettlementTerm?"Rapid-Pay":8==e.STCSettlementTerm?"Opti-Pay":9==e.STCSettlementTerm?"Commercial":10==e.STCSettlementTerm?e.CustomTermLabel:11==e.STCSettlementTerm?"Invoice Stc":12==e.STCSettlementTerm?"Peak Pay":""},Kendo_Priority=function(e){return 1==e.Priority?1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="../Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="../Images/prio-high.png" alt="" / ><span style="display:none">High</span></span></div>':'<div class="ic_cover"><span class="priority"><img src="../Images/prio-high.png" alt="High" title="High"><span style="display:none">High</span></span></div>':2==e.Priority?1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="../Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="../Images/prio-mid.png" alt="" /><span style="display:none">Normal</span></span></div>':'<div class="ic_cover"><span class="priority"><img src="../Images/prio-mid.png" alt="Normal" title="Normal"><span style="display:none">Normal</span></span></div>':1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="../Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="../Images/prio-low.png" alt="" /></span><span style="display:none">Low</span></div>':'<div class="ic_cover"><span class="priority"><img src="../Images/prio-low.png" alt="Low" title="Low"><span style="display:none">Low</span></span></div>'},Kendo_STCSubmissionDate=function(e){return ToDate(e.strSTCSubmissionDate)},Kendo_STCSettlementDate=function(e){if(5!=e.STCSettlementTerm){if(""!=e.strSTCSettlementDate){var t,a=ToDate(e.strSTCSettlementDate),o=" text-decoration:none;margin-left:5px";return t=1==UserTypeID||3==UserTypeID?'<lable class="clsDateLabel">'+a+'</lable><a title="edit" href="#" onclick="UpdateSettlementDate(this,'+e.STCJobDetailsId+",'"+a+'\');" class="edit sprite-img grid-edit-ic" style="'+o+'">&nbsp;&nbsp;</a>':'<lable class="clsDateLabel">'+a+"</lable>",t}return 11==e.STCSettlementTerm||10==e.STCSettlementTerm&&11==e.CustomSettlementTerm?"":'<lable class="clsDateLabel">On Approval</lable>'}if(5==e.STCSettlementTerm){if(null!=e.STCSettlementDate){a=ToDate(e.strSTCSettlementDate);return'<lable class="clsDateLabel">'+a+"(Partial)</lable>"}return'<lable class="clsDateLabel">(Partial)</lable>'}},Kendo_JobTypeId=function(e){return e.JobTypeId>0?1==e.JobTypeId?"PVD":2==e.JobTypeId?"SWH":void 0:""},Kendo_CERAuditedDate=function(e){return null==e.strCERAuditedDate||""==e.strCERAuditedDate?"":ToDate(e.strCERAuditedDate)},filterYesNo=function(e){var t=[{Text:"Yes",Value:1},{Text:"No",Value:0}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_JobTypeId=function(e){var t=JSON.parse(colJobType);$.each(t,function(e,t){t.field="JobType"}),e.kendoDropDownList({dataTextField:"Name",dataValueField:"ID",dataSource:t,optionLabel:"--Select Value--"})},filter_JobID=function(e){e.addClass("k-textbox"),e.attr("onkeypress","return isNumber(event);")},filter_SystemSize=function(e){e.addClass("k-textbox"),e.attr("onkeypress","return isDecimal(event);")},filter_STCSubmissionDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_InstallationDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_RECBulkUploadTimeDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_STCSettlementDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_STCSettlementTerm=function(e){var t=[{Text:"24 Hour",Value:"1"},{Text:"3 Days",Value:"2"},{Text:"7 Days",Value:"3"},{Text:"CER Approved",Value:"4"},{Text:"Partial Payment",Value:"5"},{Text:"Upfront",Value:"6"},{Text:"Rapid-Pay",Value:"7"},{Text:"Opti-Pay",Value:"8"},{Text:"Commercial",Value:"9"},{Text:"Custom",Value:"10"},{Text:"Invoice Stc",Value:"11"},{Text:"Peak Pay",Value:"12"}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_IsSPVInstallationVerified=function(e){var t=[{Text:"Verified",Value:"1"},{Text:"Verify Failed",Value:"0"},{Text:"Not Yet Verified",Value:" "}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_Priority=function(e){var t=JSON.parse(colPriority);e.kendoDropDownList({dataTextField:"Name",dataValueField:"ID",dataSource:t,optionLabel:"--Select Value--"})},filter_CERAuditedDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})};$("#btnSearchSpvFailureReason").click(function(){var e=$("#txtSpvRefJobId").val();if(""==e)return $("#errorMsgRegionSPVFailure").html(closeButton+"Please enter valid JobId for search SPVfailure reasons."),$("#errorMsgRegionSPVFailure").show(),!1;isNaN(e)?($("#errorMsgRegionSPVFailure").html(closeButton+"Please enter valid JobId for search SPVfailure reasons."),$("#errorMsgRegionSPVFailure").show()):$("#spv-failure-reason-div").load(urlGetSpvFailureReason+"?refJobId="+$("#txtSpvRefJobId").val(),function(){$("#spv-failure-reason").modal({backdrop:"static",keyboard:!1}),$("#errorMsgRegionSPVFailure").hide()})});