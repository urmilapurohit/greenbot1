function GetDates(date){if(""!=date){var tickStartDate=ConvertDateToTick(date,dateFormat);return moment(tickStartDate).format("YYYY-MM-DD")}return""}function BindVspService(){return $.ajax({url:urlGetEndPoints,type:"POST",dataType:"json",processData:!1,cache:!1,contentType:"application/json; charset=utf-8",success:function(data){if(null!=data&&data.length>0)for(var i=0;i<data.length;i++)$("#txtVpsService")[0].sumo.add(data[i],data[i]);$(".SumoSelect .SelectBox").show()},error:function(e){console.log(e)}}),!1}function BindSolarCompany(resellerID){return $("#txtSolarCompany").val(""),$.ajax({type:"POST",url:urlGetSolarCompanyByResellerId,dataType:"json",async:!1,data:{id:resellerID,isAll:!0},success:function(solarcompany){solarCompanyList=[],$.each(solarcompany,(function(i,company){solarCompanyList.push({value:company.Value,text:company.Text})})),$("#txtSolarCompany").autocomplete({minLength:0,source:function(request,response){var data=[];$("#hdnsolarCompanyid").val(0),$.each(solarCompanyList,(function(key,value){value.text.toLowerCase().indexOf($("#txtSolarCompany").val().toLowerCase())>-1&&data.push({Title:value.text,id:value.value})})),response($.map(data,(function(item){return{label:item.Title,value:item.Title,id:item.id}})))},select:function(event,ui){$("#hdnsolarCompanyid").val(ui.item.id)}}).on("focus",(function(){$(this).keydown()})),$.ui.autocomplete.prototype._renderItem=function(ul,item){var re=new RegExp($.trim(this.term.toLowerCase())),t=item.label.replace(re,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",item).append("<a>"+t+"</a>").appendTo(ul)}},error:function(ex){alert("Failed to retrieve Solar Companies."+ex)}}),!1}function BindSpvLogs(){var kendoCols=[];kendoCols.push({title:"Serial Number",field:"SerialNumber",template:function(data){return"<span>"+data.SerialNumber+"</span>"},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),kendoCols.push({title:"Job ID",field:"JobId",template:function(data){return"<span><a href='/Job/Index?id="+data.EncryptedJobId+"'>"+data.JobId+"</a></span>"},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),kendoCols.push({title:"SPV Method",field:"SPVMethod",template:function(data){return"<span>"+(1==data.SPVMethod?"Product Verification":"Installation Verification")+"</span>"},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),kendoCols.push({title:"Verification Status",field:"VerificationStatus",template:function(data){return"<span>"+data.VerificationStatus==0?"in progress":(1==data.VerificationStatus?"<span style='color: #006400;'>Success</span>":"<span style='color: Red;'>Fail</span>")+"</span>"},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),kendoCols.push({title:"RCode",field:"ResponseCode",template:function(data){return"<span>"+(null==data.ResponseCode?"":data.ResponseCode)+"</span>"},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),kendoCols.push({title:"Date Time",field:"ResponseTime",template:function(data){return null!=data.ResponseTime?kendo.toString(kendo.parseDate(data.ResponseTime,"yyyy-MM-dd hh:mm tt"),"dd/MM/yyyy HH:mm:ss"):""},sortable:!0,width:50,filterable:!1,media:"(min-width: 100px)"}),$("#dtSpvLogs").kendoGrid({columns:kendoCols,dataSource:{type:"odata",transport:{read:{url:urlGetSpvLogs,data:{},contentType:"application/json",dataType:"json",type:"POST"},parameterMap:function(options){return options.ServiceAdministrator=null==$(".report-search-box").val()?"All":$(".report-search-box").val().join(),options.ResellerId=$("#drpReseller").val(),options.SolarCompanyId=""==$("#hdnsolarCompanyid").val()||0==$("#hdnsolarCompanyid").val()?-1:parseInt($("#hdnsolarCompanyid").val()),options.JobReferenceOrId=$("#txtReferenceNumberOrJobId").val(),options.PVDSWHcode=$("#txtPvdOrSwhCode").val(),options.SPVMethod=parseInt($("#drpSpvMethod").val()),options.VerificationStatus=parseInt($("#drpSpvRequestStatus").val()),options.ResponseCode=$("#txtResponseCode").val(),options.Manufacturer=$("#txtManufacturer").val(),options.ModelNumber=$("#txtModelNumber").val(),options.SerialNumer=$("#txtSerialNumber").val(),options.FromRequestDate=""==$("#txtFromDateOrTime").val()?null:new Date($("#txtFromDateOrTime").val()),options.ToRequestDate=""==$("#txtToDateOrTime").val()?null:new Date($("#txtToDateOrTime").val()),JSON.stringify(options)}},schema:{data:"data",total:"total"},pageSize:"10",serverPaging:!0,serverSorting:!0,requestStart:function(e){setTimeout((function(e){$(".k-loading-image").hide()}))}},dataBound:function(){for(var i=0;i<this.columns.length;i++)this.autoFitColumn(i)},detailInit:detailInit,groupable:!1,sortable:!0,filterable:{extra:!1},pageable:{buttonCount:5,pageSizes:[10,25,50,100,200]},resizable:!1,scrollable:!0,reorderable:!1,filterMenuInit:function(e){$(".loading-image").hide()}})}function detailInit(e){$.ajax({url:urlGetSpvLogDetails,dataType:"json",method:"GET",data:{SPVLogId:parseInt(e.data.SPVLogId)},success:function(data){data="<div><a href='/job/index?id="+data.EncryptedJobId+"'><strong>Ref Number:</strong> "+data.Refnumber+"</a> <strong>Job ID:</strong> "+data.JobID+" </div><div><strong>Request sent:</strong> "+ConvertToDateWithFormat(data.RequestTime,"dd/mm/yyyy hh:mm:ss")+"</div><div><strong>Job Details:</strong> </div><div>"+data.JobAddress+"</div>"+(2==data.SPVMethod?"<div><strong>Installer:</strong> "+data.InstallerName+"</div>":"")+"<div><strong>Manufacturer:</strong> "+data.Manufacturer+"</div><div><strong>Model Number:</strong> "+data.modelNumber+"</div>"+(2==data.SPVMethod?"<div><strong>No.ofPanels:</strong> "+data.NoOfPanel+"</div>":"")+"<div><strong>Serial Number:</strong> <span class='text-danger'>"+data.SerialNumber+"</span></div><div><strong>Response Message:</strong></div><div>"+(null==data.ResponseMessage?"":data.ResponseMessage)+"</div><div><strong>Reseller:</strong> "+data.ResellerName+" | <strong>Solar Company:</strong> <a href='/User/ViewDetail/"+data.EncryptedSolarCompanyId+"'>"+data.CompanyName+"</a></div><div><strong>Service Administrator:</strong> "+data.ServiceAdministrator+"</div>",$(data).appendTo(e.detailCell)}})}function ClearFilters(){$("#txtVpsService")[0].sumo.unSelectAll(),$("#txtSolarCompany").val(""),$("#hdnsolarCompanyid").val(0),$("#txtReferenceNumberOrJobId").val(""),$("#drpSpvMethod").val(-1),$("#drpSpvRequestStatus").val(-1),$("#txtResponseCode").val(""),$("#txtSerialNumber").val(""),$("#txtManufacturer").val(""),$("#txtModelNumber").val(""),$("#txtFromDateOrTime").val(""),$("#txtToDateOrTime").val(""),$("#btnSearch").click()}$(document).ready((function(){$("#drpReseller").select2(),FillDropDown("drpReseller",urlGetAllReseller,0,!1,null,""),$("#txtVpsService").SumoSelect({csvDispCount:3,search:!0,searchText:"Search..",selectAll:!0,okCancelInMulti:!0}),$("#txtFromDateOrTime").datetimepicker({format:"MM/DD/YYYY HH:mm"}),$("#txtToDateOrTime").datetimepicker({format:"MM/DD/YYYY HH:mm"}),$(".kendo-dropdown-ui").kendoDropDownList(),BindVspService(),setTimeout(()=>{BindSolarCompany($("#drpReseller").val()),BindSpvLogs()},200),$("#btnSearch").click((function(){$("#dtSpvLogs").kendoGrid("destroy").empty(),BindSpvLogs()})),$("#drpReseller").change((function(){$("#drpReseller").val()>0&&BindSolarCompany($("#drpReseller").val())})),$("#collapse").click((function(e){var grid=$("#dtSpvLogs").data("kendoGrid");$("#dtSpvLogs .k-master-row").each((function(index){grid.collapseRow(this)}))})),$("#txtFromDateOrTime").on("dp.change",(function(e){$("#txtToDateOrTime").data("DateTimePicker").minDate(e.date)})),$("#txtToDateOrTime").on("dp.change",(function(e){$("#txtFromDateOrTime").data("DateTimePicker").maxDate(e.date)})),$("#btnClear").click((function(){ClearFilters()}))})),$("#btnCsvGenerate").click((function(){var fromReqDate=new moment($("#txtFromDateOrTime").val(),"MM/DD/YYYY HH:mm").toDate(),toReqDate,diffOfDateInTime,diffOfDateInDays;if((new moment($("#txtToDateOrTime").val(),"MM/DD/YYYY HH:mm").toDate().getTime()-fromReqDate.getTime())/864e5>7||""==$("#txtFromDateOrTime").val()||""==$("#txtToDateOrTime").val())return $("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"Please select date range between 7 days to export csv log."),$("#errorMsgRegion").show(),!1;var ServiceAdministrator=null==$(".report-search-box").val()?"All":$(".report-search-box").val().join(),ResellerId=$("#drpReseller").val(),SolarCompanyId=""==$("#hdnsolarCompanyid").val()||0==$("#hdnsolarCompanyid").val()?-1:parseInt($("#hdnsolarCompanyid").val()),JobReferenceOrId=$("#txtReferenceNumberOrJobId").val(),PVDSWHcode=$("#txtPvdOrSwhCode").val(),SPVMethod=parseInt($("#drpSpvMethod").val()),VerificationStatus=parseInt($("#drpSpvRequestStatus").val()),ResponseCode=$("#txtResponseCode").val(),Manufacturer=$("#txtManufacturer").val(),ModelNumber=$("#txtModelNumber").val(),SerialNumer=$("#txtSerialNumber").val(),FromRequestDate=""==$("#txtFromDateOrTime").val()?null:$("#txtFromDateOrTime").val(),ToRequestDate=""==$("#txtToDateOrTime").val()?null:$("#txtToDateOrTime").val(),WithOutSCA=!1,solarCompanyName=$("#txtSolarCompany").val(),resellerName=$("#drpReseller option:selected").text();window.location.href=urlExportCSVForSPVLogs+"?ServiceAdministrator="+ServiceAdministrator+"&ResellerId="+ResellerId+"&SolarCompanyId="+SolarCompanyId+"&JobReferenceOrId="+JobReferenceOrId+"&PVDSWHcode="+PVDSWHcode+"&SPVMethod="+SPVMethod+"&VerificationStatus="+VerificationStatus+"&ResponseCode="+ResponseCode+"&Manufacturer="+Manufacturer+"&ModelNumber="+ModelNumber+"&SerialNumer="+SerialNumer+"&FromRequestDate="+FromRequestDate+"&ToRequestDate="+ToRequestDate+"&IsWithoutSCA="+!1+"&SolarCompanyName="+solarCompanyName+"&ResellerName="+resellerName})),$("#btnCsvGenerateWithOutSCA").click((function(){var fromReqDate=new moment($("#txtFromDateOrTime").val(),"MM/DD/YYYY HH:mm").toDate(),toReqDate,diffOfDateInTime,diffOfDateInDays;if((new moment($("#txtToDateOrTime").val(),"MM/DD/YYYY HH:mm").toDate().getTime()-fromReqDate.getTime())/864e5>7||""==$("#txtFromDateOrTime").val()||""==$("#txtToDateOrTime").val())return $("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"Please select date range between 7 days to export csv log."),$("#errorMsgRegion").show(),!1;var ServiceAdministrator=null==$(".report-search-box").val()?"All":$(".report-search-box").val().join(),ResellerId=$("#drpReseller").val(),SolarCompanyId=""==$("#hdnsolarCompanyid").val()||0==$("#hdnsolarCompanyid").val()?-1:parseInt($("#hdnsolarCompanyid").val()),JobReferenceOrId=$("#txtReferenceNumberOrJobId").val(),PVDSWHcode=$("#txtPvdOrSwhCode").val(),SPVMethod=parseInt($("#drpSpvMethod").val()),VerificationStatus=parseInt($("#drpSpvRequestStatus").val()),ResponseCode=$("#txtResponseCode").val(),Manufacturer=$("#txtManufacturer").val(),ModelNumber=$("#txtModelNumber").val(),SerialNumer=$("#txtSerialNumber").val(),FromRequestDate=""==$("#txtFromDateOrTime").val()?null:$("#txtFromDateOrTime").val(),ToRequestDate=""==$("#txtToDateOrTime").val()?null:$("#txtToDateOrTime").val(),WithOutSCA=!0,solarCompanyName=$("#txtSolarCompany").val(),resellerName=$("#drpReseller option:selected").text();window.location.href=urlExportCSVForSPVLogs+"?ServiceAdministrator="+ServiceAdministrator+"&ResellerId="+ResellerId+"&SolarCompanyId="+SolarCompanyId+"&JobReferenceOrId="+JobReferenceOrId+"&PVDSWHcode="+PVDSWHcode+"&SPVMethod="+SPVMethod+"&VerificationStatus="+VerificationStatus+"&ResponseCode="+ResponseCode+"&Manufacturer="+Manufacturer+"&ModelNumber="+ModelNumber+"&SerialNumer="+SerialNumer+"&FromRequestDate="+FromRequestDate+"&ToRequestDate="+ToRequestDate+"&IsWithoutSCA="+!0+"&SolarCompanyName="+solarCompanyName+"&ResellerName="+resellerName}));