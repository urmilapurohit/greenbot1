function CompareJobData(){SetDataForSSCSCO();var e=CommonDataForSave();return JSON.stringify(e)===JSON.stringify(SavedData)}function BindAllTabsAjax(){$("#loading-image").hide(),$("#loader-Ajax-notessec").hide(),$.ajax({url:UrlLoadCustomDetailsAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#loader-Ajax-customdetail").hide(),$("#LoadCustomDetailsAjax").append(e.customdetailView),LoadSystemDetailsAjax())}})}function LoadSystemDetailsAjax(){$.ajax({url:UrlLoadSystemDetailsAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#loader-Ajax-system").hide(),$("#LoadSystemDetailsAjax").append(e.systemdetailView),LoadInstallerDesignerElectricianAjax(),showPnlInvoiceElecBillOver60kw())}})}function LoadInstallerDesignerElectricianAjax(){$.ajax({url:UrlLoadInstallerDesignerElectricianAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#loader-Ajax-electrician").hide(),$("#LoadInstallerDesignerElectricianAjax").append(e.installerdesignerelectricianView),LoadJobSchedulingVisitAjax())}})}function LoadJobSchedulingVisitAjax(){$.ajax({url:UrlLoadJobSchedulingVisitAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){if(e){if($("#loader-Ajax-Scheduling").hide(),$("#LoadJobSchedulingVisitAjax").append(e.JobVisitView),0==$("#btnAddVisit:visible").length)$(".assign-installer").hide(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").removeAttr("onclick");else{var t=2;$(".assign-installer").show(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").attr("onClick",BasicDetails_InstallerID>0?'addQuickVisit($("#hdBasicDetails_InstallerID").val(), $("#txtBasicDetails_InstallerID").val(),'+t+");":'addQuickVisit($("#hdBasicDetails_SWHInstallerID").val(), $("#txtBasicDetails_SWHInstallerID").val(),'+t+");")}LoadDocumentManagerNewViewAjax()}}})}function LoadDocumentManagerNewViewAjax(){$.ajax({url:UrlLoadDocumentManagerNewViewAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&LoadJobDocumentNewAjax()}})}function LoadJobDocumentNewAjax(){$.ajax({url:UrlLoadJobDocumentNewAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#loader-Ajax-docstc").hide(),$("#loader-Ajax-docces").hide(),$("#loader-Ajax-docSec").hide(),$("#loader-Ajax-docpanelinvoice").hide(),$("#loader-Ajax-docelectricity").hide(),LoadDocuments(documentsJson,!1),LoadSTCJobNewScreenAjax())}})}function LoadSTCJobNewScreenAjax(){$.ajax({url:UrlLoadSTCJobNewScreenAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#loader-Ajax-stcsec").hide(),$("#loader-Ajax-stcjob").show(),$("#LoadSTCJobNewScreenAjax").append(e.STCJobNewScreenView),PricingSettlementTermOnLoad(),$("#loader-Ajax-stcjob").hide(),LoadNewJobPhotoAjax())}})}function LoadNewJobPhotoAjax(){$.ajax({url:UrlLoadNewJobPhotoAjax,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:jobId},async:!0,success:function(e){e&&($("#LoadNewJobPhotoAjax").append(e.JobPhotosNewView),$("#loader-Ajax-photosec").hide(),Executed=!1),Executed=!1}}),Executed=!1}function disableSSCdropdown(){BasicDetails_SSCID>0&&1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&4!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId&&2!=ProjectSession_UserTypeId?$("#SSCID").prop("disabled",!0):$("#SSCID").prop("disabled",!1)}function SaveJobDetail(){var e,t;fillOwnerPopup(),fillInstallationPopup();var a=!1,o=CheckShowErrorMessagesForPopup(),s=$("#frmCreateJob").valid(),i=$("#JobSTCDetails_Latitude").val(),l=$("#JobSTCDetails_Longitude").val(),r=/^[-+]?[0-9]+\.[0-9]+$/;if(""!=i&&!i.match(r))return showErrorMessage("Please enter latitude in decimal formate of STC job details."),!1;if(""!=l&&!l.match(r))return showErrorMessage("Please enter longitude in decimal formate of STC job details."),!1;var n,d=$("#JobInstallationDetails_PropertyType").val(),c=$("#JobOwnerDetails_Email").val();if("commercial"==d.toLowerCase()&&(null==c||""==c))return showErrorMessage("Owner email address is mandatory for commercial jobs."),!1;if("school"==d.toLowerCase()&&(null==c||""==c))return showErrorMessage("Owner email address is mandatory for installation property type school."),!1;n=1==$("#BasicDetails_JobType").val()?!!($("#BasicDetails_strInstallationDate").val()&&$("#JobSTCDetails_DeemingPeriod").val()&&$("#JobInstallationDetails_PostCode").val()):!!(systemXml.length>0&&systemXml[0].Brand&&systemXml[0].Model&&$("#JobInstallationDetails_PostCode").val());var u,b=$("#JobSystemDetails_SystemSize").val()>0,S=!!$("#BasicDetails_strInstallationDate").val();u=1==$("#BasicDetails_JobType").val()?!b||b&&n:!S||S&&n,"false"==isPanelSerialNumber.toLowerCase()&&8==ProjectSession_UserTypeId?e=!0:(DuplicateSerialandInverterErrorMsg="",DuplicateSerialandInverterErrorMsg="Serial numbers should not be same, ",e=DuplicateSerialNumbersValidation($("#JobSystemDetails_SerialNumbers"),$("#spanSerialNumbers"),!0),t=DuplicateSerialNumbersValidation($("#JobSystemDetails_InverterSerialNumbers"),$("#spanInverterSerialNumbers"),!1)),(e||a)&&(showErrorMessage(DuplicateSerialandInverterErrorMsg),$("#errorMsgRegionSerialPanel").show(),$("#errorMsgRegionSerialInverter").show()),s&&o&&!e&&!t&&(u?($("#loading-image").show(),checkBusinessRules(!1)):1==$("#BasicDetails_JobType").val()?showErrorMessage("Please fill Installation Date, STC DeemingPeriod, Installation postcode to set STC value."):showErrorMessage("Please fill Installation Date, System brand, System Model, Installation postcode to set STC value."))}function ReloadJobPhotoSection(e){$("#loading-image").show(),setTimeout(function(){$.get(urlReloadJobPhoto+e,function(e){$("#loadNewJobPhoto").empty(),$("#loadNewJobPhoto").append(e)})},500)}function fillInstallationPopup(){if(InstallationJson.length>0){var e=InstallationJson[0].PostalAddressType;$("#JobInstallationDetails_AddressID").val(e),1==e?($("#JobInstallationDetails_UnitTypeID").val(InstallationJson[0].UnitType),$("#JobInstallationDetails_UnitNumber").val(InstallationJson[0].UnitNumber),$("#JobInstallationDetails_StreetNumber").val(InstallationJson[0].StreetNumber),$("#JobInstallationDetails_StreetName").val(InstallationJson[0].StreetName),$("#JobInstallationDetails_StreetTypeID").val(InstallationJson[0].StreetType),$("#JobInstallationDetails_PostalAddressID").val(""),$("#JobInstallationDetails_PostalDeliveryNumber").val("")):($("#JobInstallationDetails_PostalAddressID").val(InstallationJson[0].PostalAddressID),$("#JobInstallationDetails_PostalDeliveryNumber").val(InstallationJson[0].PostalDeliveryNumber),$("#JobInstallationDetails_UnitTypeID").val(""),$("#JobInstallationDetails_UnitNumber").val(""),$("#JobInstallationDetails_StreetNumber").val(""),$("#JobInstallationDetails_StreetName").val(""),$("#JobInstallationDetails_StreetTypeID").val("")),$("#JobInstallationDetails_Town").val(InstallationJson[0].Town),$("#JobInstallationDetails_State").val(InstallationJson[0].State),$("#JobInstallationDetails_PostCode").val(InstallationJson[0].PostCode)}else $("#JobInstallationDetails_AddressID").val(1),$("#JobInstallationDetails_UnitTypeID").val(""),$("#JobInstallationDetails_UnitNumber").val(""),$("#JobInstallationDetails_StreetNumber").val(""),$("#JobInstallationDetails_StreetName").val(""),$("#JobInstallationDetails_StreetTypeID").val(""),$("#JobInstallationDetails_Town").val(""),$("#JobInstallationDetails_State").val(""),$("#JobInstallationDetails_PostCode").val(""),$("#JobInstallationDetails_PostalAddressID").val(""),$("#JobInstallationDetails_PostalDeliveryNumber").val(""),$("#JobInstallationDetails_IsSameAsOwnerAddress").prop("checked",!1),$(".InstallationDPA").show(),$(".InstallationPDA").hide()}function fillOwnerPopup(){if(OwnerAddressJson.length>0){var e=OwnerAddressJson[0].PostalAddressType;$("#JobOwnerDetails_AddressID").val(e),1==e?($("#JobOwnerDetails_UnitTypeID").val(OwnerAddressJson[0].UnitType),$("#JobOwnerDetails_UnitNumber").val(OwnerAddressJson[0].UnitNumber),$("#JobOwnerDetails_StreetNumber").val(OwnerAddressJson[0].StreetNumber),$("#JobOwnerDetails_StreetName").val(OwnerAddressJson[0].StreetName),$("#JobOwnerDetails_StreetTypeID").val(OwnerAddressJson[0].StreetType),$("#JobOwnerDetails_PostalAddressID").val(""),$("#JobOwnerDetails_PostalDeliveryNumber").val("")):($("#JobOwnerDetails_PostalAddressID").val(OwnerAddressJson[0].PostalAddressID),$("#JobOwnerDetails_PostalDeliveryNumber").val(OwnerAddressJson[0].PostalDeliveryNumber),$("#JobOwnerDetails_UnitTypeID").val(""),$("#JobOwnerDetails_UnitNumber").val(""),$("#JobOwnerDetails_StreetNumber").val(""),$("#JobOwnerDetails_StreetName").val(""),$("#JobOwnerDetails_StreetTypeID").val("")),$("#JobOwnerDetails_CompanyName").val(OwnerAddressJson[0].CompanyName),$("#JobOwnerDetails_FirstName").val(OwnerAddressJson[0].FirstName),$("#JobOwnerDetails_LastName").val(OwnerAddressJson[0].LastName),$("#JobOwnerDetails_Email").val(OwnerAddressJson[0].Email),$("#JobOwnerDetails_Mobile").val(OwnerAddressJson[0].Mobile),$("#JobOwnerDetails_Phone").val(OwnerAddressJson[0].Phone),$("#JobOwnerDetails_Town").val(OwnerAddressJson[0].Town),$("#JobOwnerDetails_State").val(OwnerAddressJson[0].State),$("#JobOwnerDetails_PostCode").val(OwnerAddressJson[0].PostCode)}else $("#JobOwnerDetails_AddressID").val(1),$("#JobOwnerDetails_UnitTypeID").val(""),$("#JobOwnerDetails_UnitNumber").val(""),$("#JobOwnerDetails_StreetNumber").val(""),$("#JobOwnerDetails_StreetName").val(""),$("#JobOwnerDetails_StreetTypeID").val(""),$("#JobOwnerDetails_Town").val(""),$("#JobOwnerDetails_State").val(""),$("#JobOwnerDetails_PostCode").val(""),$("#JobOwnerDetails_PostalAddressID").val(""),$("#JobOwnerDetails_PostalDeliveryNumber").val(""),$("#JobOwnerDetails_CompanyName").val(""),$("#JobOwnerDetails_FirstName").val(""),$("#JobOwnerDetails_LastName").val(""),$("#JobOwnerDetails_Email").val(""),$("#JobOwnerDetails_Mobile").val(""),$("#JobOwnerDetails_Phone").val(""),$(".OwnerDPA").show(),$(".OwnerPDA").hide()}function CheckShowErrorMessagesForPopup(){var e=!0,t=$("#JobSTCDetails_StatutoryDeclarations").val();return"1"==JOBType&&("Yes"==$("#JobSTCDetails_MultipleSGUAddress").val()&&""==$("#JobSTCDetails_Location").val()?($("#spanSTCLocation").show(),e=!1):$("#spanSTCLocation").hide()),"Yes"==$("#JobSTCDetails_VolumetricCapacity").val()&&("Select"!=t&&null!=t&&null!=t&&""!=t.trim()||($("#spanStatutoryDeclarations").show(),e=!1)),"Yes"==$("#JobSTCDetails_VolumetricCapacity").val()&&("Select"!=t&&null!=t&&null!=t&&""!=t.trim()||($("#spanStatutoryDeclarations").show(),e=!1)),e}function checkBusinessRules(e){""!=$("#SSCID").val()&&$("#SSCID").val()>0&&$("#BasicDetails_SSCID").val($("#SSCID").val()),""!=$("#ScoID").val()&&$("#ScoID").val()>0&&$("#BasicDetails_ScoID").val($("#ScoID").val());var t=CommonDataForSave();$.ajax({url:urlCheckBusinessRules,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:t,cache:!1,success:function(t){t.IsSuccess?(0==t.isIsValidSystemSize?($("#JobSystemDetails_SystemSize").css("border-color","red"),$("#OldSystemSize").css("border-color","red")):($("#JobSystemDetails_SystemSize").css("border-color",""),$("#OldSystemSize").css("border-color","")),null!=t.ValidationSummary&&null!=t.ValidationSummary&&""!=t.ValidationSummary?e?1!=ProjectSession_UserTypeId&&($(".STCmodelBodyMessage").html(""),$(".STCmodelBodyMessage").append(t.ValidationSummary),$("#STCwarning").modal({backdrop:"static",keyboard:!1}),"true"==t.IsEMailNotification.toString().toLowerCase()&&$.ajax({url:urlSendMailForDuplicateAddress,method:"GET",data:{jobid:$("#BasicDetails_JobID").val(),mailList:t.EMailList.trim().toString().toLowerCase()},cache:!1,async:!0,success:function(e){}})):($(".modelBodyMessage").html(""),$(".modelBodyMessage").append(t.ValidationSummary),$("#warning").modal()):e||SaveJob()):t.IsError&&(showErrorMessage(t.ValidationSummary),DisableDropDownbyUsertype())}})}function EnableDropDownbyUsertype(){"1"==JOBType&&(8==USERType&&"True"==IsUnderSSC&&($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"),$("#JobOwner").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#frmCreateJob").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#BasicDetails_strInstallationDate").removeAttr("disabled")),7!=USERType&&9!=USERType||($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"),$("#JobElectricians").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobOwner").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#frmCreateJob").find("Select").each(function(){$(this).removeAttr("disabled")})),2!=USERType&&5!=USERType||($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"),$("#JobElectricians").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobOwner").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#frmCreateJob").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#BasicDetails_strInstallationDate").removeAttr("disabled"))),"2"==JOBType&&((7==USERType||9==USERType||8==USERType&&"True"==IsUnderSSC)&&($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"),$("#JobElectricians").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobOwner").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#frmCreateJob").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#BasicDetails_strInstallationDate").removeAttr("disabled")),2!=USERType&&5!=USERType||($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"),$("#JobElectricians").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobOwner").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#Installer").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#frmCreateJob").find("Select").each(function(){$(this).removeAttr("disabled")}),$("#BasicDetails_strInstallationDate").removeAttr("disabled"))),1==JOBType?"true"==IsLockedSerialNumber?($("#aLockedSerialnumber").show(),$("#aUnLockedSerialnumber").hide(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!0)):("false"!=IsLockedSerialNumber||1!=USERType&&3!=USERType&&"True"!=IsLockUnlockSerial||$("#aUnLockedSerialnumber").show(),$("#aLockedSerialnumber").hide(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!1)):($("#aLockedSerialnumber").hide(),$("#aUnLockedSerialnumber").hide()),1==USERType||3==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val()?($("#JobOwnerDetails_OwnerType").prop("disabled",!1),$("#JobInstallationDetails_PropertyType").prop("disabled",!1),$("#JobSystemDetails_SystemSize").prop("disabled",!1),$("#BasicDetails_strInstallationDate").prop("disabled",!1)):($("#JobOwnerDetails_OwnerType").prop("disabled",!0),$("#JobInstallationDetails_PropertyType").prop("disabled",!0),$("#JobSystemDetails_SystemSize").prop("disabled",!0),$("#BasicDetails_strInstallationDate").prop("disabled",!0),$("#JobSystemDetails_SerialNumbers").prop("disabled",!0))}function DisableDropDownbyUsertype(){jobID>0&&$("#BasicDetails_JobType").attr("disabled","disabled"),"1"==JOBType&&(8==USERType&&"True"==IsUnderSSC&&($("#JobOwner").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#BasicDetails_strInstallationDate").attr("disabled","disabled")),7!=USERType&&9!=USERType||($("#JobElectricians").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobOwner").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#BasicDetails_JobStage").removeAttr("disabled")),2!=USERType&&5!=USERType||($("#JobElectricians").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobOwner").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#BasicDetails_strInstallationDate").attr("disabled","disabled"))),"2"==JOBType&&((7==USERType||9==USERType||8==USERType&&"True"==IsUnderSSC)&&($("#JobElectricians").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobOwner").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#BasicDetails_strInstallationDate").attr("disabled","disabled"),$("#BasicDetails_JobStage").removeAttr("disabled")),2!=USERType&&5!=USERType||($("#JobElectricians").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobOwner").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#JobInstallationAddress").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#Installer").find("Select").each(function(){$(this).attr("disabled","disabled")}),$("#BasicDetails_strInstallationDate").attr("disabled","disabled"))),1==USERType||3==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val()?($("#JobOwnerDetails_OwnerType").prop("disabled",!1),$("#JobInstallationDetails_PropertyType").prop("disabled",!1),$("#JobSystemDetails_SystemSize").prop("disabled",!1),$("#BasicDetails_strInstallationDate").prop("disabled",!1)):($("#JobOwnerDetails_OwnerType").prop("disabled",!0),$("#JobInstallationDetails_PropertyType").prop("disabled",!0),$("#JobSystemDetails_SystemSize").prop("disabled",!0),$("#BasicDetails_strInstallationDate").prop("disabled",!0))}function CommonDataForSave(){null!=oldaddress&&""!=oldaddress||(oldaddress=$("#JobInstallationDetails_AddressDisplay").val(),$("#JobInstallationDetails_oldInstallationAddress").val(oldaddress)),EnableDropDownbyUsertype(),$("#BasicDetails_JobType").removeAttr("disabled");var e="",t="",a=[];if(a=JSON.parse(JSON.stringify(batteryXml)),PanelXml.length>0){var o=JSON.stringify(PanelXml),s="",i=$.parseJSON(o);$.each(i,function(){s+="<panel><Brand>"+htmlEncode(this.Brand)+"</Brand><Model>"+htmlEncode(this.Model)+"</Model><NoOfPanel>"+this.Count+"</NoOfPanel><Supplier>"+htmlEncode(this.Supplier)+"</Supplier></panel>"}),e="<Panels>"+s+"</Panels>"}if(InverterXml.length>0){o=JSON.stringify(InverterXml),s="",i=$.parseJSON(o);$.each(i,function(){s+="<inverter><Brand>"+htmlEncode(this.Brand)+"</Brand><Model>"+htmlEncode(this.Model)+"</Model><Series>"+htmlEncode(this.Series)+"</Series><NoOfInverter>"+htmlEncode(this.NoOfInverter)+"</NoOfInverter></inverter>"}),t="<Inverters>"+s+"</Inverters>"}$("#panelXml").val(e),$("#inverterXml").val(t),$("#OldPanelDetails").val(JSON.stringify(OldPanelXml)),$("#NewPanelDetails").val(JSON.stringify(PanelXml)),$("#OldInverterDetails").val(JSON.stringify(OldInverterXml)),$("#NewInverterDetails").val(JSON.stringify(InverterXml));var l=$("form").find(":input:disabled").removeAttr("disabled"),r=JSON.stringify($("form").serializeToJson());l.attr("disabled","disabled");var n=JSON.parse(r);0==batteryXml.length||"select"==$("#JobSTCDetails_batterySystemPartOfAnAggregatedControl").val().toLowerCase()?n.JobSTCDetails.batterySystemPartOfAnAggregatedControl="":n.JobSTCDetails.batterySystemPartOfAnAggregatedControl=$("#JobSTCDetails_batterySystemPartOfAnAggregatedControl").val(),0==batteryXml.length||"select"==$("#JobSTCDetails_changedSettingOfBatteryStorageSystem").val().toLowerCase()?n.JobSTCDetails.changedSettingOfBatteryStorageSystem="":n.JobSTCDetails.changedSettingOfBatteryStorageSystem=$("#JobSTCDetails_changedSettingOfBatteryStorageSystem").val();for(var d=$("#customDetails").find(".spanCustomFields").length,c=0;c<d;c++)delete n["lstCustomDetails["+c+"]"];if(a.length>0){for(c=0;c<a.length;c++)delete a[c].JobBatteryManufacturerId;n.lstJobBatteryManufacturer=a}var u=$("#JobOwner").find(":input:disabled").removeAttr("disabled"),b=JSON.stringify($("#JobOwner").serializeToJson());u.attr("disabled","disabled"),n.JobOwnerDetails=JSON.parse(b).JobOwnerDetails;var S=JSON.stringify($("#JobInstallationAddress").serializeToJson()),p=JSON.parse(S);installationAddressChangeCheck(p.JobInstallationDetails);var m=JSON.stringify($("#JobInstallationDetailInfo").serializeToJson()),v=JSON.parse(m),h=JSON.stringify($("#JobExtraInstallationInfo").serializeToJson()),D=JSON.parse(h);$.extend(n.JobInstallationDetails,p.JobInstallationDetails),$.extend(n.JobInstallationDetails,v.JobInstallationDetails),$.extend(n.JobInstallationDetails,D.JobInstallationDetails),n.JobInstallationDetails.Latitude=$("#lblLatitude").text(),n.JobInstallationDetails.Longitude=$("#lblLongitude").text();var f=n.JobSystemDetails;f.ModifiedCalculatedSTC=1==$("#BasicDetails_JobType").val()?$("#JobSystemDetails_CalculatedSTC").val():$("#JobSystemDetails_CalculatedSTCForSWH").val(),f.NoOfPanel=$("#JobSystemDetails_NoOfPanel").html(),f.NoOfInverter=$("#JobSystemDetails_NoOfInverter").html(),f.InstallationType=$("#JobSystemDetails_InstallationType").val(),systemXml.length>0&&(f.SystemBrand=systemXml[0].Brand,f.SystemModel=systemXml[0].Model),n.JobSystemDetails=f;var y=[];$("#customDetails").find(".spanCustomFields").each(function(){y.push({JobCustomFieldId:$(this).attr("data-jobcustomfieldid"),FieldValue:$(this).text(),SeparatorId:$(this).attr("data-SeperatorId")})}),n.lstCustomDetails=y,n.OldStcValue=""==$("#OldStcValue").val()?0:$("#OldStcValue").val();var I="Due to change in ",g=!1;n.JobSystemDetails.PreviousSystemSize=$("#OldSystemSize").val(),$("#OldSystemSize").val()!=$("#JobSystemDetails_SystemSize").val()&&(I=I+"System Size from "+$("#OldSystemSize").val()+" to "+$("#JobSystemDetails_SystemSize").val(),g=!0);var J=moment($("#BasicDetails_strInstallationDateTemp").val()).format("dd/mm/yyyy".toUpperCase());n.BasicDetails.strInstallationDateTemp=J,J!=$("#BasicDetails_strInstallationDate").val()&&(I=I+(g?", ":"")+"Installation Date from "+J+" to "+$("#BasicDetails_strInstallationDate").val(),g=!0),$("#OldDeemingPeriod").val()!=$("#JobSTCDetails_DeemingPeriod").val()&&(I=I+(g?", ":"")+"Deeming Period from "+$("#OldDeemingPeriod").val()+" to "+$("#JobSTCDetails_DeemingPeriod").val());var T=moment($("#BasicDetails_strInstallationDate").val(),"DD/MM/YYYY").add(325,"d").format("dd/mm/yyyy".toUpperCase()),C=moment().format("DD/MM/YYYY");moment(T,"DD/MM/YYYY")<moment(C,"DD/MM/YYYY")?n.IsApproachingExpiryDate=!0:n.IsApproachingExpiryDate=!1,n.PropertyType=$("#JobInstallationDetails_PropertyType").val(),n.stcHistoryMsg=I+".",n.stcStatusId=$("#STCStatusId").val();var _=$("#BasicDetails_PreviousRefNumber").val();n.BasicDetails.PreviousRefNumber=_;var w=$("#BasicDetails_PreviousSSCID").val();n.BasicDetails.PreviousSSCID=w;var N=$("#BasicDetails_PreviousSCOID").val();n.BasicDetails.PreviousSCOID=N;var P=$("#JobInstallationDetails_PreviousNMI").val();n.JobInstallationDetails.PreviousNMI=P;var j=$("#BasicDetails_PreviousJobStage").val();n.BasicDetails.PreviousJobStage=j;var O=$("#BasicDetails_PreviousPriority").val();n.BasicDetails.PreviousPriority=O;var A=$("#JobInstallationDetails_PreviousInstallingNewPanel").val();n.JobInstallationDetails.PreviousInstallingNewPanel=A;var x=$("#JobInstallationDetails_PreviousLocation").val();n.JobInstallationDetails.PreviousLocation=x;var M=$("#JobInstallationDetails_PreviousSingleMultipleStory").val();n.JobInstallationDetails.PreviousSingleMultipleStory=M;var E=$("#JobSTCDetails_PreviousSystemMountingType").val();n.JobSTCDetails.PreviousSystemMountingType=E;var B=$("#JobSTCDetails_PreviousConnectionType").val();n.JobSTCDetails.PreviousConnectionType=B;var R=$("#JobSTCDetails_PreviousMultipleSGUAddress").val();n.JobSTCDetails.PreviousMultipleSGUAddress=R;var k=$("#JobSTCDetails_PreviousDeemingPeriod").val();n.JobSTCDetails.PreviousDeemingPeriod=k;var L=$("#JobSTCDetails_PreviousCertificateCreated").val();n.JobSTCDetails.PreviousCertificateCreated=L;var U=$("#JobSTCDetails_PreviousFailedAccreditationCode").val();n.JobSTCDetails.PreviousFailedAccreditationCode=U;var V=$("#JobSTCDetails_PreviousFailedReason").val();n.JobSTCDetails.PreviousFailedReason=V;var F=$("#JobSTCDetails_PreviousLocation").val();n.JobSTCDetails.PreviousLocation=F;var G=$("#JobSTCDetails_PreviousAdditionalLocationInformation").val();n.JobSTCDetails.PreviousAdditionalLocationInformation=G;var H=$("#JobSTCDetails_PreviousVolumetricCapacity").val();n.JobSTCDetails.PreviousVolumetricCapacity=H;var W=$("#JobSTCDetails_PreviousStatutoryDeclarations").val();n.JobSTCDetails.PreviousStatutoryDeclarations=W;var z=$("#JobSTCDetails_PreviousSecondhandWaterHeater").val();n.JobSTCDetails.PreviousSecondhandWaterHeater=z;var Y=$("#JobSTCDetails_PreviousLatitude").val();n.JobSTCDetails.PreviousLatitude=Y;var X=$("#JobSTCDetails_PreviousLongitude").val();n.JobSTCDetails.PreviousLongitude=X;var q=$("#JobSTCDetails_PreviousAdditionalSystemInformation").val();n.JobSTCDetails.PreviousAdditionalSystemInformation=q,$("#JobSystemDetails_SystemSize").val()>60&&0==$("#tbodyPnlInvoice").children().length&&0==$("#tbodyElecBill").children().length?(n.IsPanelInvoice=0,n.IsElectricityBill=0):$("#JobSystemDetails_SystemSize").val()>60&&0==$("#tbodyPnlInvoice").children().length?(n.IsPanelInvoice=0,n.IsElectricityBill=1):$("#JobSystemDetails_SystemSize").val()>60&&0==$("#tbodyElecBill").children().length?(n.IsElectricityBill=0,n.IsPanelInvoice=1):(n.IsElectricityBill=1,n.IsPanelInvoice=1);var Z=JSON.stringify(n);return Z}function LoadCommonSerialNumber(){$.ajax({url:urloadCommonSerialNumber,type:"GET",data:{jobId:Model_JobID},dataType:"json",success:function(e){if(e.commonSerialNum)if(e.commonSerialNum.length>0){for(var t='<div class="warning-notice" id="divWarning"><h5>Panel Warning Notice:</h5>',a=0;a<e.commonSerialNum.length;a++){var o="",s="";1!=ProjectSession_UserTypeId&&2!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId||(o="<b class=commonSerialNum>Company : </b>"+e.commonSerialNum[a].CompanyName),1==ProjectSession_UserTypeId&&(s=" <b class=commonSerialNum>Reseller : </b>"+e.commonSerialNum[a].ResellerName);var i="";i=1==ProjectSession_UserTypeId||4==ProjectSession_UserTypeId&&e.commonSerialNum[a].SolarCompanyId==ProjectSession_SolarCompanyId||2==ProjectSession_UserTypeId&&e.commonSerialNum[a].ResellerId==ProjectSession_ResellerId?"<p>Serial "+e.commonSerialNum[a].SerialNumber+' has been used in <a target="_blank" href="/Job/Index?id='+e.commonSerialNum[a].Id+'"> '+e.commonSerialNum[a].RefNumber+"</a>  ("+e.commonSerialNum[a].JobId+")"+o+s+"</p>":"<p>Serial "+e.commonSerialNum[a].SerialNumber+" has been used by another company</p>",t+=i}t+="</div>",$("#loadCommonSerialNumber").html(t)}else $("#loadCommonSerialNumber").html("");$("div.line-no").removeClass("verified"),$("div.line-no").removeClass("unverified"),$("div.line-no").removeClass("installationVerified"),$("div.line-no").removeClass("notverified"),$("#GlobalisAllowedSPV").val(e.GlobalisAllowedSPV),e.IsSPVRequired?(IsSPVRequired="True",VerifyUnVerifySerialNumber(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?$(".isSPVRequired").show():$(".isSPVRequired").hide()):($(".isSPVRequired").hide(),$("#SPVLabel").hide(),IsSPVRequired="False")}})}function LoadCommonInverterSerialNumber(){$.ajax({url:urloadCommonInverterSerialNumber,type:"GET",data:{jobId:Model_JobID},dataType:"json",success:function(e){if(e.commonSerialNum)if(e.commonSerialNum.length>0){for(var t='<div class="warning-notice" id="divWarning"><h5>Inverter Warning Notice:</h5>',a=0;a<e.commonSerialNum.length;a++){var o="",s="";1!=ProjectSession_UserTypeId&&2!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId||(o="<b class=commonSerialNum>Company : </b>"+e.commonSerialNum[a].CompanyName),1==ProjectSession_UserTypeId&&(s=" <b class=commonSerialNum>Reseller : </b>"+e.commonSerialNum[a].ResellerName);var i="";i=1==ProjectSession_UserTypeId||4==ProjectSession_UserTypeId&&e.commonSerialNum[a].SolarCompanyId==ProjectSession_SolarCompanyId||2==ProjectSession_UserTypeId&&e.commonSerialNum[a].ResellerId==ProjectSession_ResellerId?"<p>Serial "+e.commonSerialNum[a].SerialNumber+' has been used in <a target="_blank" href="/Job/Index?id='+e.commonSerialNum[a].Id+'"> '+e.commonSerialNum[a].RefNumber+"</a>  ("+e.commonSerialNum[a].JobId+")"+o+s+"</p>":"<p>Serial "+e.commonSerialNum[a].SerialNumber+" has been used by another company</p>",t+=i}t+="</div>",$("#loadCommonInverterSerialNumber").html(t)}else $("#loadCommonInverterSerialNumber").html("")}})}function ReloadSTCJobScreen(e,t){$("#loader-Ajax-stcjob").show(),setTimeout(function(){$.get(urlGetSTCJobNewScreen+jobID,function(e){$("#reloadSTCJobScreen").empty(),$("#reloadSTCJobScreen").append(e),PricingSettlementTermOnLoad(),t||1==ProjectSession_UserTypeId||3==ProjectSession_UserTypeId||$("#btnApplyTradeStc").hide(),10!=$("#STCStatusId").val()&&12!=$("#STCStatusId").val()&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val()&&($("#CESDocbtns").hide(),$("#STCDocBtns").hide(),$("#pnlInvoiceDocbtns").hide(),$("#elecBillDocBtns").hide(),$(".isdelete").css("display","none")),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&2!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId&&4!=ProjectSession_UserTypeId||($("#CESDocbtns").show(),$("#STCDocBtns").show(),$("#pnlInvoiceDocbtns").show(),$("#elecBillDocBtns").show()),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||$(".isdelete").css("display","block"),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&10!=$("#STCStatusId").val()&&12!=$("#STCStatusId").val()&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val()&&$("#btnSaveJob").hide(),"True"==isSaveJobAfterTrade&&$("#btnSaveJob").show(),$("#loader-Ajax-stcjob").hide(),$("#JobSystemDetails_SystemSize").val()>60?0!=$("#tbodyPnlInvoice").children().length&&0!=$("#tbodyElecBill").children().length||1==ProjectSession_UserTypeId?EnableTradeButton():DisableTradeButton():EnableTradeButton()})},500)}function SaveJob(e){$("#loading-image").show(),addLogsSerialno(),SetDataForSSCSCO(!0);var t=CommonDataForSave(),a=($("#STCStatusId").val(),"");"True"==isAddJob?a=urlCreate:"True"==isEditjob&&(a=urlEdit),setTimeout(function(){$("#loading-image").show(),$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:t,cache:!1,success:function(e){if(OldPanelXml=[],OldPanelXml=JSON.parse(JSON.stringify(PanelXml)),OldInverterXml=[],OldInverterXml=JSON.parse(JSON.stringify(InverterXml)),(e.insert||e.update)&&(0==e.IsSPVRequired&&HideSPV(),1==$("#BasicDetails_JobType").val()?e.STCValue>0?$("#JobSystemDetails_CalculatedSTC").val(e.STCValue):$("#JobSystemDetails_CalculatedSTC").val(""):e.STCValue>0?$("#JobSystemDetails_CalculatedSTCForSWH").val(e.STCValue):$("#JobSystemDetails_CalculatedSTCForSWH").val(""),$("#OldStcValue").val(e.STCValue),SavedData=CommonDataForSave()),e.update){
e.IsRecUp||""==$("#BasicDetails_strInstallationDate").val().trim()||""==$("#JobSystemDetails_SystemSize").val().trim()?showSuccessMessage("Job has been updated."):showSuccessMessage("Job has been updated but STC Value cannot be calculated since REC website is down.");var a=$("#BasicDetails_strInstallationDate").val(),o=moment(a,"DD/MM/YYYY").format("mm/dd/yyyy".toUpperCase()),s=$("#JobSystemDetails_SystemSize").val(),i=$("#BasicDetails_RefNumber").val(),l=$("#JobInstallationDetails_NMI").val(),r=$("#BasicDetails_JobStage").val(),n=$("#BasicDetails_CurrentPriority").val(),d=$("#JobInstallationDetails_InstallingNewPanel").val(),c=$("JobInstallationDetails_Location").val(),u=$("#JobInstallationDetails_SingleMultipleStory").val(),b=$("#JobSTCDetails_SystemMountingType").val(),S=$("#JobSTCDetails_TypeOfConnection").val(),p=$("#JobSTCDetails_MultipleSGUAddress").val(),m=$("#JobSTCDetails_DeemingPeriod").val(),v=$("#JobSTCDetails_CertificateCreated").val(),h=$("#JobSTCDetails_FailedAccreditationCode").val(),D=$("#JobSTCDetails_FailedReason").val(),f=$("#JobSTCDetails_Location").val(),y=$("#JobSTCDetails_AdditionalLocationInformation").val(),I=$("#JobSTCDetails_VolumetricCapacity").val(),g=$("#JobSTCDetails_StatutoryDeclarations").val(),J=$("#JobSTCDetails_SecondhandWaterHeater").val(),T=$("#JobSTCDetails_Latitude").val(),C=$("#JobSTCDetails_Longitude").val(),_=$("#JobSTCDetails_AdditionalSystemInformation").val(),w=$("#BasicDetails_SSCID").val(),N=$("#BasicDetails_ScoID").val(),P=$("#BasicDetails_ScoID option:selected").text();$("#BasicDetails_PreviousSCOName").val(P);var j=$("#BasicDetails_SSCID option:selected").text();$("#BasicDetails_PreviousSSCName").val(j),$("#BasicDetails_PreviousPriority").val(n),$("#BasicDetails_PreviousRefNumber").val(i),$("#BasicDetails_PreviousSSCID").val(w),$("#BasicDetails_PreviousSCOID").val(N),$("#OldSystemSize").val(s),$("#BasicDetails_strInstallationDateTemp").val(o),$("#JobInstallationDetails_PreviousNMI").val(l),$("#BasicDetails_PreviousJobStage").val(r),$("#JobInstallationDetails_PreviousInstallingNewPanel").val(d),$("JobInstallationDetails_PreviousLocation").val(c),$("#JobInstallationDetails_PreviousSingleMultipleStory").val(u),$("#JobSTCDetails_PreviousSystemMountingType").val(b),$("#JobSTCDetails_PreviousConnectionType").val(S),$("#JobSTCDetails_PreviousMultipleSGUAddress").val(p),$("#JobSTCDetails_PreviousDeemingPeriod").val(m),$("#JobSTCDetails_PreviousCertificateCreated").val(v),$("#JobSTCDetails_PreviousFailedAccreditationCode").val(h),$("#JobSTCDetails_PreviousFailedReason").val(D),$("#JobSTCDetails_PreviousLocation").val(f),$("#JobSTCDetails_PreviousAdditionalLocationInformation").val(y),$("#JobSTCDetails_PreviousVolumetricCapacity").val(I),$("#JobSTCDetails_PreviousStatutoryDeclarations").val(g),$("#JobSTCDetails_PreviousSecondhandWaterHeater").val(J),$("#JobSTCDetails_PreviousLatitude").val(T),$("#JobSTCDetails_PreviousLongitude").val(C),$("#JobSTCDetails_PreviousAdditionalSystemInformation").val(_);var O=jQuery.parseJSON(t);modelInstallationStreetName=$("#JobInstallationDetails_StreetName").val(),modelInstallationStreetNumber=$("#JobInstallationDetails_StreetNumber").val(),modelInstallationStreetTypeID=$("#JobInstallationDetails_StreetTypeID").val(),modelInstallationTown=$("#JobInstallationDetails_Town").val(),modelInstallationState=$("#JobInstallationDetails_State").val(),modelInstallationPostCode=$("#JobInstallationDetails_PostCode").val(),oldaddress=$("#JobInstallationDetails_AddressDisplay").val(),$("#JobInstallationDetails_oldInstallationAddress").val(oldaddress);var A=$("#JobInstallationDetails_NMI").val();0==parseInt(A)&&$("#JobInstallationDetails_NMI").val(""),$("#loadPreapprovalConnectionSTC").load(urlLoadPreapprovalConnectionSTC,{createJob:O}),ReloadSTCJobScreen(Model_JobID,e.IsRecUp),ReloadJobPhotoSection($("#BasicDetails_JobID").val()),DisableDropDownbyUsertype(),GetJobHeader(),LoadCommonSerialNumber(),LoadCommonInverterSerialNumber(),LoadCommonJobsWithSameInstallationAddress(),checkSerialNumberWithPhotoExistOrNot(),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||LoadCommonJobsWithSameInstallDateAndInstaller(),SetDataForSSCSCO(),SavedData=CommonDataForSave()}else e.error?(showErrorMessage(e.errorMessage),DisableDropDownbyUsertype()):(showErrorMessage("Job has not been saved."),DisableDropDownbyUsertype());(e.insert||e.update)&&(""!=$("#BasicDetails_GSTDocument").val()&&null!=$("#BasicDetails_GSTDocument").val()&&null!=$("#BasicDetails_GSTDocument").val()?$("#BasicDetails_GSTDocument").attr("OldFileName",$("#BasicDetails_GSTDocument").val()):$("#BasicDetails_GSTDocument").attr("OldFileName",""));var x="0",M="0",E="0",B="0";x=""!=$("#JobSystemDetails_SerialNumbers").val()&&null!=$("#JobSystemDetails_SerialNumbers").val()&&null!=$("#JobSystemDetails_SerialNumbers").val()?$("#JobSystemDetails_SerialNumbers").val().split("\n").length:"0",M=""!=$("#JobSystemDetails_NoOfPanel").text()&&null!=$("#JobSystemDetails_NoOfPanel").text()&&null!=$("#JobSystemDetails_NoOfPanel").text()?$("#JobSystemDetails_NoOfPanel").text():"0",$("#cntPanelSerialNumber").html(" ("+x+"/"+M+")"),1==$("#BasicDetails_JobType").val()&&(E=""!=$("#JobSystemDetails_InverterSerialNumbers").val()&&null!=$("#JobSystemDetails_InverterSerialNumbers").val()&&null!=$("#JobSystemDetails_InverterSerialNumbers").val()?$("#JobSystemDetails_InverterSerialNumbers").val().split("\n").length:"0",B=""!=$("#JobSystemDetails_NoOfInverter").text()&&null!=$("#JobSystemDetails_NoOfInverter").text()&&null!=$("#JobSystemDetails_NoOfInverter").text()?$("#JobSystemDetails_NoOfInverter").text():"0",$("#cntInverterSerialNumber").html(" ("+E+"/"+B+")")),VerifyUnVerifySerialNumber(),$("#btnSaveJob").removeAttr("disabled"),$("#loading-image").hide()},error:function(e){$("#btnSaveJob").removeAttr("disabled"),$("#loading-image").hide()}})},100),$("#BasicDetails_JobType").attr("disabled","disabled")}function LoadTabContent(e){$("ul.create-job-menu").each(function(){$(this).find("li").each(function(){$(this).removeClass("active")})}),0==e?($("#ActiveJob").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Job Details"),$("#invoice").hide(),$("#history").hide(),$("#createJobNotes").hide(),$("#createJobView").show(),$(".assign").show(),$("#EmailConversation").hide(),$("#createJobMessage").hide(),IsLast=!1,pageIndex=1,isParentInvoice=!1):1==e?($("#aInvoice").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Invoice"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,$("#invoice").load(urlGetJobInvoice,function(e,t,a){"success"==t&&($("#invoice").show(),$("#EmailConversation").hide(),$("#invoiceDetail").css("display","none"),loadInvoice()),"error"==t&&alert("Error: "+a.status+": "+a.statusText)})):2==e?($("#aNotes").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),"True"==isNotesView?($("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Notes"),$("#createJobView").hide(),$("#createJobNotes").show(),$.ajax({type:"GET",url:urlGetJobNotes+jobIDForScheduling,cache:!1,async:!0,ifModified:!0,success:function(e){$("#createJobNotes").html(e)},error:function(e){}}),$("#createJobMessage").hide(),$("#invoice").hide(),$("#history").hide(),$("#EmailConversation").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,setTimeout(function(){if($("#Notes").focus(),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff"),$("#hdnJobTitle").val(BasicDetails_Title),0==$("#tblCase tr").length){var e="";e+='<tr style="border:none;padding: 10px 20px;height: 34px;text-align:center;"><td colspan="3" style="padding-top:10px;">No Records Found</td></tr>',$("#tblCase").append(e)}},2e3)):$("#ActiveJob").addClass("active"),isParentInvoice=!1):3==e?("True"==isHistoryView||"true"==isHistoryViewForSCO.toLowerCase?($("#aHistory").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - History"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#EmailConversation").hide(),$("#invoice").hide(),$("#history").show(),$("#history").load(urlShowHistory+jobIDForScheduling),$(".assign").hide(),IsLast=!1,pageIndex=1):$("#ActiveJob").addClass("active"),isParentInvoice=!1):4==e?"False"==ProjectSession_IsUserEmailAccountConfigured?(EmailAccountConfigureErrorMessage(),prevSelectedTab=0,LoadTabContent(prevSelectedTab)):("True"==isMessageView||"true"==isMessageViewForSCO.toLowerCase?($("#aMessage").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Message"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").load(urlLoadMessageTab+$("#BasicDetails_JobID").val()),$("#createJobMessage").show(),$("#invoice").hide(),$("#history").hide(),$(".assign").hide(),$("#EmailConversation").hide(),IsLast=!1,pageIndex=1):$("#ActiveJob").addClass("active"),isParentInvoice=!1):5==e&&("False"==ProjectSession_IsUserEmailAccountConfigured?(prevSelectedTab=0,EmailAccountConfigureErrorMessage(),LoadTabContent(prevSelectedTab)):($("#aEmail").addClass("active"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Email"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#EmailConversation").load(urlGetMessageForJobEmailConversationForPreAndConn+$("#BasicDetails_JobID").val()),$("#EmailConversation").show(),$("#invoice").hide(),$("#history").hide(),$(".assign").hide(),isParentInvoice=!1))}function loadInvoice(){if(isParentInvoice=!1,$("#datatable")){var e=$("#datatable").DataTable();e.destroy()}$("#datatable").DataTable({iDisplayLength:10,lengthMenu:ProjectConfiguration_GetPageSize,order:[[1,"asc"]],language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"JobInvoiceID",orderable:!1,render:function(e,t,a,o){return LogInID==a.CreatedBy?'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-outgoing.png) no-repeat center;cursor:default; text-decoration:none;margin-left:-30%;"></a>':'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-incoming.png) no-repeat center;cursor:default; text-decoration:none;margin-left:-30%;"></a>'}},{data:"InvoiceNumber",orderable:!0},{data:"CreatedDate",render:function(e){return ConvertToDateWithFormat(e,ProjectConfiguration_GetDateFormat)}},{data:"Created"},{data:"InvoicedTo"},{data:"FileName",render:function(e,t,a,o){return 1==a.Status?"<p style='color:green;'>"+a.FileName+"</p>":2==a.Status?"<p style='color:gray;'>"+a.FileName+"</p>":3==a.Status?"<p style='color:orange;'>"+a.FileName+"</p>":4==a.Status?"<p style='color:red;'>"+a.FileName+"</p>":"<p style='color:red;'></p>"},orderable:!1},{data:"InvoiceTotal",orderable:!0,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.InvoiceTotal)}},{data:"InvoiceAmountDue",orderable:!0,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.InvoiceAmountDue)}},{data:"JobInvoiceID",render:function(e,t,a,o){var s="";"1"==a.FileExist?s='<a class="action view" href="javascript:void(0)" style="background:url(../../Images/pdf.png) no-repeat center; text-decoration:none;margin-left:18px;" onclick="DownloadReport(this)" filename="'+a.InvoiceNumber+'.pdf"></a>':"0"==a.FileExist&&(s='<a class="action view" style="background:none;text-decoration:none;margin-left:18px;"></a>');var i="";i=1==a.Sent?'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-right.png) no-repeat center; cursor:default;text-decoration:none;margin-left:18px;"></a>':'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-wrong.png) no-repeat center; cursor:default;text-decoration:none;margin-left:18px;"></a>';var l='&nbsp;<a href="javascript:void(0);" class="action view" style="background:url(../../Images/edit-icon.png) no-repeat center; text-decoration:none;margin-left:18px;" onclick="jobInvoiceDetail.loadData('+a.JobInvoiceID+')"></a>',r="&nbsp;&nbsp;&nbsp;";return s+r+i+l+'<a href="javascript:void(0)" onclick="deleteInvoice('+a.JobInvoiceID+')" class="action view" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;margin-left:18px;"></a>'},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetInvoiceList+$("#BasicDetails_JobID").val(),fnDrawCallback:function(){$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>1?$("#datatable_length").show():$("#datatable").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var e=$("#datatable").DataTable(),t=e.page.info();0==t.recordsTotal?document.getElementById("invoiceNumRecords").innerHTML="<b>0</b>  of  <b>"+t.recordsTotal+"</b>  Invoice(s) found":document.getElementById("invoiceNumRecords").innerHTML="<b>"+$("#datatable >tbody >tr").length+"</b>  of  <b>"+t.recordsTotal+"</b>  Invoice(s) found"}}),$(".dataTables_empty").css("text-align","left")}function onclickEvent(){var e=$("#Notes").val(),t=$("#BasicDetails_JobID").val(),a=$("#hdnJobTitle").val(),o={};o.JobID=t,o.Notes=e,o.JobTitle=a;var s=JSON.stringify(o),i=$("#frmIndex").serialize();""==e?($(".alert").hide(),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"Please enter job notes."),$("#errorMsgRegion").show()):$.ajax({url:urlSaveJobNotes,type:"post",data:s,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success?($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-danger"),$("#popuperrorMsgRegion").addClass("alert-success"),$("#popuperrorMsgRegion").html(closeButton+"Job notes has been saved successfully."),$("#popuperrorMsgRegion").show(),$("#Notes").val(""),$("#Notes").focus(),$.ajax({type:"POST",url:urlJobList,data:i+"&pageIndex=1&jobID="+t,dataType:"json",async:!1,success:function(e){$("#tblCase tr").remove();var t="";null!=e.PagedList&&$.each(e.PagedList,function(e,a){"false"==isDelete?t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+a.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}),$("#tblCase").append(t),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")},error:function(e,t,a){alert("Could not get patient name properly. Status = "+t+" Error="+a+" Req="+e)}})):($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-success"),$("#popuperrorMsgRegion").addClass("alert-danger"),$("#popuperrorMsgRegion").html(closeButton+"Job note has not been saved."),$("#popuperrorMsgRegion").show())}})}function DeleteJobNotes(e){var t=confirm("Are you sure you want to delete this note?"),a=$("#frmIndex").serialize(),o=$("#BasicDetails_JobID").val();t&&$.ajax({url:urlDeleteJobNotes,type:"POST",async:!1,data:JSON.stringify({jobNotesId:e}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($.ajax({type:"POST",url:urlJobList,data:a+"&pageIndex=1&jobID="+o,dataType:"json",async:!1,success:function(e){$("#tblCase tr").remove();var t="";null!=e.PagedList&&$.each(e.PagedList,function(e,a){"false"==isDelete?t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+a.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}),$("#tblCase").append(t),setTimeout(function(){if(0==$("#tblCase tr").length){var e="";e+='<tr style="border:none;padding: 10px 20px;height: 34px;text-align:center;"><td colspan="3" style="padding-top:10px;">No Records Found</td></tr>',$("#tblCase").append(e)}},200),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")},error:function(e,t,a){alert("Could not get patient name properly. Status = "+t+" Error="+a+" Req="+e)}}),$(".alert").hide(),$("#successMsgRegion").removeClass("alert-danger"),$("#successMsgRegion").addClass("alert-success"),$("#successMsgRegion").html(closeButton+"Job notes deleted successfully."),$("#successMsgRegion").show())}})}function scrolldvIndividual(e){$("#dvIndividual").on("scroll",function(e){$("#tblHeaderScroll").scrollLeft($(tblScroll).scrollLeft());var t=$(e.currentTarget);t[0].scrollHeight-t.scrollTop()<=t.outerHeight()&&GetRecords()})}function GetRecords(){if(!IsLast){pageIndex++;var e=$("#frmIndex").serialize(),t=$("#BasicDetails_JobID").val();$.ajax({type:"POST",url:urlJobList,data:e+"&pageIndex="+pageIndex+"&jobID="+t,dataType:"json",async:!1,success:OnSuccess,error:function(e,t,a){alert("Could not get patient name properly. Status = "+t+" Error="+a+" Req="+e)}})}}function OnSuccess(e){var t="";e.PagedList.length>0?$.each(e.PagedList,function(e,a){"false"==isDelete?t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":t+='<tr class="notesTR color"><td colspan="2" class="notes">'+a.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+a.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+a.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+a.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}):IsLast=!0,$("#tblCase").append(t),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")}function deleteInvoice(e){var t=confirm("Are you sure you want to delete this invoice ?");t&&$.ajax({url:urlDeleteInvoice,type:"POST",async:!1,data:JSON.stringify({InvoiceID:e}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Failed"==e.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+e.strErrors),$("#errorMsgRegion").show()),$("#datatable").dataTable().fnDraw()}})}function GetJobHeader(){$.ajax({url:urlGetJobHeader,type:"GET",data:{jobId:Model_JobID},dataType:"json",success:function(e){if(e.status){var t=$("#BasicDetails_RefNumber").val(),a="";a=1==JOBType?"PV SOLAR":"SWH";var o=t+'<span style="font-size: 25px;border-left: none;margin-left: 0;">('+jobId+')</span><span id="jobHeader" class="jobHeader"> '+e.header+'</span><span class="jobHeader" style="margin-left:0px !important">'+a+"</span>";$("#jobTitle").html(o)}}})}function ReloadSTCModule(){ReloadSTCJobScreen(Model_JobID)}function GetDefaultSettingForJob(){$.ajax({url:urlGetDefaultSettingsForJob,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",success:function(e){if(e.status){var t=JSON.parse(e.data);$("#onOffSwitchPreApproval").prop("checked",t.IsPreapproval),ShowHidePreapprovalBox(),$("#onOffSwitchConnection").prop("checked",t.IsConnection),ShowHideConnectionBox()}else e.error&&("sessiontimeout"==e.error.toLowerCase()?window.location.href=urlLogout:showErrorMessage(e.error))},error:function(){}})}function UpdateActionToSaveIsNewViewerUserWise(){var e={IsNewViewer:$("#onOffSwitchNewDocVIewer").prop("checked")};$.ajax({url:urlSaveIsNewViewerUserWise,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(e),success:function(e){"true"==e&&(fnDocViewerOuterPopup(),$("#IsNewViewer").val($("#onOffSwitchNewDocVIewer").prop("checked")))},error:function(){}})}function UpdateAction(){var e={IsPreapproval:$("#onOffSwitchPreApproval").prop("checked"),IsConnection:$("#onOffSwitchConnection").prop("checked"),JobId:jobID};$.ajax({url:urlSaveDefaultForJob,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(e),success:function(e){e.status||e.error&&("sessiontimeout"==e.error.toLowerCase()?window.location.href=urlLogout:showErrorMessage(e.error))},error:function(){}})}function SetDataForSSCSCO(e=!1){if("false"==isAssignSSC_LowerString?$("#BasicDetails_SSCID").val(BasicDetails_SSCID):""!=$("#SSCID").val()&&$("#SSCID").val()>0?$("#BasicDetails_SSCID").val($("#SSCID").val()):$("#BasicDetails_SSCID").val(""),"false"==isAssignSCO_LowerString?$("#BasicDetails_ScoID").val(BasicDetails_ScoID):""!=$("#ScoID").val()&&$("#ScoID").val()>0?$("#BasicDetails_ScoID").val($("#ScoID").val()):$("#BasicDetails_ScoID").val(""),0==e){var t=$("#ScoID option:selected").text();$("#BasicDetails_PreviousSCOName").val(t);var a=$("#SSCID option:selected").text();$("#BasicDetails_PreviousSSCName").val(a)}}function LoadCommonJobsWithSameInstallDateAndInstaller(){$.ajax({url:urlLoadCommonJobsWithSameInstallDateAndInstaller,type:"GET",data:{jobId:Model_JobID,installerId:$("#hdBasicDetails_InstallerID").val(),installationDate:$("#BasicDetails_strInstallationDate").val()},dataType:"json",success:function(e){if(e.commonJobs.length>0){for(var t='<div class="warning-notice" id="divWarning"><h5>Warning Notice:</h5> <br/> Installer: <b>'+e.commonJobs[0].InstallerName+"</b> has been already assigned the following jobs.",a=0;a<e.commonJobs.length;a++){var o="<b class=commonJobs>Company : </b>"+e.commonJobs[a].CompanyName,s=" <b class=commonJobs>Reseller : </b>"+e.commonJobs[a].ResellerName,i='<p>RefNumber : <a target="_blank" href="/Job/Index?id='+e.commonJobs[a].JobID+'"> '+e.commonJobs[a].RefNumber+" </a> "+o+s+"</p>";t+=i}t+="</div>",$("#loadCommonJobs").show(),$("#loadCommonJobs").html(t)}else $("#loadCommonJobs").html(""),$("#loadCommonJobs").hide();if(e.commonJobsWithFailedSTCStaus.length>0){for(t='<div class="warning-notice" id="divWarning"><h5>Warning Notice:</h5> <br/> Installer: <b>'+e.commonJobsWithFailedSTCStaus[0].InstallerName+"</b> has been already assigned the following jobs which have failed stc statuses.",a=0;a<e.commonJobsWithFailedSTCStaus.length;a++){o="<b class=commonJobs>Company : </b>"+e.commonJobsWithFailedSTCStaus[a].CompanyName,s=" <b class=commonJobs>Reseller : </b>"+e.commonJobsWithFailedSTCStaus[a].ResellerName,i='<p>RefNumber : <a target="_blank" href="/Job/Index?id='+e.commonJobsWithFailedSTCStaus[a].JobID+'"> '+e.commonJobsWithFailedSTCStaus[a].RefNumber+" </a> "+o+s+"</p>";t+=i}t+="</div>",$("#loadCommonJobsWithFailedStcStatus").show(),$("#loadCommonJobsWithFailedStcStatus").html(t)}else $("#loadCommonJobsWithFailedStcStatus").html(""),$("#loadCommonJobsWithFailedStcStatus").hide()}})}function RemoveSPVOnUnlockSerialnumber(){$.ajax({url:urlRemoveSPVOnUnlockSerialnumber,type:"GET",data:{jobId:Model_JobID},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.status?(HideSPV(),showSuccessMessage("Serialnumber has been unlocked.")):showErrorMessage("Serialnumber has not been unlocked.")}})}function SetSPVOnLockSerialNumber(){$.ajax({url:urlSetSPVOnLockSerialNumber,type:"GET",data:{jobId:Model_JobID},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.status?(e.isSPVRequired?($("#GlobalisAllowedSPV").val(e.isSPVRequired),ShowSPV()):HideSPV(),showSuccessMessage("Serialnumber has been locked.")):showErrorMessage("Serialnumber has not been locked.")}})}function LoadCommonJobsWithSameInstallationAddress(){$.ajax({url:urlLoadCommonJobsWithSameInstallationAddress,type:"GET",data:{jobId:Model_JobID},dataType:"json",success:function(e){if(e.commonJobs.length>0){for(var t='<div class="warning-notice" id="divWarning"><h5>Warning Notice:</h5> <br/> Same installation address has been already used for the following jobs.',a=0;a<e.commonJobs.length;a++){var o="<b class=commonJobs>Company : </b>"+e.commonJobs[a].CompanyName,s=" <b class=commonJobs>Reseller : </b>"+e.commonJobs[a].ResellerName,i=" <b class=commonJobs>STC Status : </b>"+e.commonJobs[a].Status,l='<p>RefNumber : <a target="_blank" href="/Job/Index?id='+e.commonJobs[a].JobID+'"> '+e.commonJobs[a].RefNumber+" </a> "+o+s+i+"</p>";t+=l}t+="</div>",$("#loadCommonJobsWithSameInstallationAddress").show(),$("#loadCommonJobsWithSameInstallationAddress").html(t),isJobWithCommonInstallationAddress=!0}else $("#loadCommonJobsWithSameInstallationAddress").html(""),$("#loadCommonJobsWithSameInstallationAddress").hide(),isJobWithCommonInstallationAddress=!1}})}function LoadSerialNumberWithPhotoExistOrNot(){var e=JSON.parse(htmlDecode(SerialNumberwithPhotosAvaibilityList).replaceAll("\\","\\\\")),t=e?e.Data:"";CommonSerialNumberWithPhotoExistOrNot(t)}function CommonSerialNumberWithPhotoExistOrNot(e){if(e.status&&e.IsPhotoUnAvailable){var t="";null!=e.lstNotExistPhoto&&e.lstNotExistPhoto.length>0&&(t=e.lstNotExistPhoto.join()),$("#errorMsgRegion").html(closeButton+"There are serial numbers ["+t+"] listed that do not have matching photos associated."),$("#successMsgRegion").hide(),$("#errorMsgRegion").show()}}function checkSerialNumberWithPhotoExistOrNot(){$.ajax({url:urlCheckSerialNumberPhotoAvailability,type:"post",data:{jobId:Model_JobID},dataType:"json",success:function(e){CommonSerialNumberWithPhotoExistOrNot(e)}})}function addLogsSerialno(){$("#JobSystemDetails_SerialNumbers").removeAttr("disabled");var e=$("#JobSystemDetails_SerialNumbers").val($("#JobSystemDetails_SerialNumbers").val().trim()).serializeToJson();$("#JobSystemDetails_SerialNumbers").attr("disabled","disabled"),$.ajax({url:urlAddlogsSerialNo,type:"GET",data:{jobId:Model_JobID,serialNumber:JSON.stringify(e)},dataType:"json",success:function(e){e.status}})}function showMessageForSTC(e,t){$(".alert").hide();var a=t?"errorMsgRegionSTCStatus":"successMsgRegionSTCStatus",o=t?"successMsgRegionSTCStatus":"errorMsgRegionSTCStatus";$("#"+o).hide(),$("#"+a).html(closeButton+e),$("#"+a).show()}function calculateTotal(e){$("#pricingTerm").html(e.data("price"))}function EnableTradeButton(){$("#tradeButton").css("visibility","visible")}function DisableTradeButton(){$("#tradeButton").css("visibility","hidden")}function STCJobNewScreenOnLoad(){var e=new Date($("#BasicDetails_strInstallationDateTemp").val()),t=new Date("2022/04/30");$("#paymentscheduleinfo").hide(),$("#stcValueForJob").html(pricingManager_STCAmount),$("#pricingTerm").html(stc_STCPrice),$("#spanSTCStatus").html(stc_Status);var a=stc_STCStatusId;10!=a&&12!=a&&14!=a&&17!=a&&($("#CESDocbtns").hide(),$("#STCDocBtns").hide(),$("#pnlInvoiceDocbtns").hide(),$("#elecBillDocBtns").hide(),$("#tbodyCES .delete").hide(),$("#tbodySTC .ganret").hide(),$("#tbodySTC .delete").hide(),$("#popupViewerDoc #btnSave").css("display","none"),$(".isdelete").css("display","none")),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||($("#CESDocbtns").show(),$("#STCDocBtns").show(),$("#pnlInvoiceDocbtns").show(),$("#elecBillDocBtns").show(),$("#tbodyCES .delete").show(),$("#tbodySTC .ganret").show(),$("#tbodySTC .delete").show(),$("#popupViewerDoc #btnSave").show(),$(".isdelete").css("display","block")),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&2!=ProjectSession_UserTypeId&&4!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId||($("#CESDocbtns").show(),$("#STCDocBtns").show(),$("#pnlInvoiceDocbtns").show(),$("#elecBillDocBtns").show()),e>t&&""==$("#imgJobRetailerSignatureJobDetailScreen").attr("src")&&$("#btnApplyTradeStc").hide(),$("#STCStatusId").val(a)}function checkSwitchStatus(){var e=!1;$(".ChecklistPoint").each(function(){if(!$(this).find("i").hasClass("active"))return e=!1,!1;e=!0}),e?$("#onoffswitchCheckAllPoints").prop("checked",!0):$("#onoffswitchCheckAllPoints").prop("checked",!1)}function MarkUnMarkItemForTrade(e,t,a,o,s,i,l,r,n,d){var c=$(t).find("i").hasClass("active");return 1==n&&parseInt(i)<parseInt(l)&&!c&&!d.toLowerCase().includes("inverter")?(alert("Please capture all serial numbers."),e.preventDefault(),!1):($.ajax({url:urlMarkUnMarkCheckListItem,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{templateId:a,itemId:o,isMark:!c,jobSchedulingId:r},success:function(e){e.id&&e.id>0?(c?$(t).find("i").removeClass("active"):$(t).find("i").addClass("active"),showMessageForSTC("CheckList item has been marked/un-marked as completed successfully.")):"sessiontimeout"==e.error.toLowerCase()?window.location.href=urlLogout:e.error?showMessageForSTC(e.error):showMessageForSTC("CheckList item has not been marked/un-marked as completed."),ReloadSTCJobScreen(jobID),checkSwitchStatus()},error:function(){showMessageForSTC("CheckList item has not been marked/un-marked as completed.")}}),e.preventDefault(),!1)}function checkListFirTradeOnLoad(){$("#onoffswitchCheckAllPoints").change(function(e){var t=e.target.checked;t?$(".ChecklistPoint").each(function(){$(this).find("i").hasClass("active")||$(this).click()}):$(".ChecklistPoint").each(function(){$(this).find("i").hasClass("active")&&$(this).click()}),checkSwitchStatus()})}function BindNotesType(){$.ajax({type:"GET",url:getnotestypeurl,dataType:"json",async:!1,data:{},success:function(e){$.each(e,function(e,t){"0"!=t.Value&&$("#post-visibility").append('<option value="'+t.Value+'">'+t.Text+"</option>"),$("#filter-postvisibility").append('<option value="'+t.Value+'">'+t.Text+"</option>")}),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||$("#filter-postvisibility").append('<option value="5">Warning</option>')},error:function(e){alert("Failed to retrieve User list."+e)}})}function SearchHistory(){var e=$("#historyCategory").val();e=null!=e?e:0;var t=document.getElementById("FilterIsImportantNote").checked,a=$("#filter-postvisibility").val(),o=$("#BasicDetails_JobID").val(),s=$("#IsDeletedJobNote").val(),i="DESC";$("#loading-image").show(),setTimeout(function(){$.ajax({url:showhistoryUrl,type:"GET",data:{jobId:o,categoryID:e,order:i,PostVisibility:a,IsImportant:t,IsDeletedJobNote:s},
cache:!1,async:!1,success:function(e){window.onbeforeunload=null,$("#showfilteredhistory").html($.parseHTML(e)),$("divCustom").mCustomScrollbar()}}),AddHistoryIcons(),tagandsearchfilter(),hideEditDeleteIcons(),$("#loading-image").hide()},10)}function LoadWarningNotes(){var e=!1,t="5",a=$("#BasicDetails_JobID").val(),o="3",s="DESC";$("#loading-image").show(),$.ajax({url:urlLoadWarningNotes,type:"GET",data:{jobId:a,categoryID:0,order:s,PostVisibility:t,IsImportant:e,IsDeletedJobNote:o},cache:!1,async:!1,success:function(e){$("#warningNotesRegion").html($.parseHTML(e)),$("divCustom").mCustomScrollbar()}}),$("#loading-image").hide()}function BindUserList(){$.ajax({type:"GET",url:userlisturl,dataType:"json",async:!1,data:{jobid:jobID},success:function(e){$("#relatedTofilter").prepend('<option value="0"> All </option>'),$.each(e,function(e,t){" "!=t.Value&&$("#relatedTofilter").append('<option value="'+t.Value+'">'+t.Text+"</option>")})},error:function(e){alert("Failed to retrieve User list."+e)}})}function tagandsearchfilter(){var e=0,t=$("#relatedTofilter").val(),a="@"+t,o=$("#JobHistorySearch").val();if("0"==t?$("#divCustom .history-box").each(function(){$(this).text().search(new RegExp(o,"i"))<0?$(this).hide():($(this).show(),$("#norecords").empty(),e++)}):$("#divCustom .history-box").each(function(){$(this).text().search(new RegExp(a,"i"))<0||$(this).text().search(new RegExp(o,"i"))<0?$(this).hide():($(this).show(),$("#norecords").empty(),e++)}),e>0)$(".history-box").css("border-top","1px solid #e3e3e3");else{$("#norecords").empty();var s="<div style='text-align:center;font-size:24px;margin-top:120px'>No Record(s) Found.</div>";$("#norecords").append(s)}}function DownloadHistoryDocument(e){var t=$(e).attr("data-folder"),a=$(e).attr("data-name");window.location.href=BaseURLForJob+"ViewDownloadFileForStc/Job?FileName="+a+"&FolderName="+t}function DeleteNote(e){var t=$(e).attr("data-noteid"),a=jobID;$.ajax({type:"GET",url:urlDeleteNote,dataType:"json",async:!1,data:{Noteid:t,JobID:a},success:function(e){e.status?(showSuccessMessageJobHistory(e.message),SearchHistory()):showErrorMessageJobHistory(e.message)},error:function(e){showErrorMessageJobHistory("Failed to delete Job Note")}})}function EditNote(e){var t=$(e).attr("data-noteid"),a=jobID;$.ajax({type:"GET",url:urlEditNote,dataType:"json",async:!1,data:{Noteid:t,JobID:a},success:function(e){if(e.status){var a=function(){CKEDITOR.instances.contenteditor.focus(),CKEDITOR.instances.contenteditor.insertHtml(e.Notes)};CKEDITOR.instances.contenteditor.setData("",a),$("#post-visibility").val(e.NotesType),$("#IsImportantNote").prop("checked",e.IsImportant),$("#hiddenNoteID").val(t)}else showErrorMessageJobHistory(e.message)},error:function(e){showErrorMessageJobHistory("Failed to Open Job Note.")}})}function ReplyNote(e){var t=$(e).attr("data-noteid"),a=jobID;$.ajax({type:"GET",url:urlReplyNote,dataType:"json",async:!1,data:{Noteid:t,JobID:a},success:function(e){e.status?($("#popupAddReplyNote").modal({backdrop:"static",keyboard:!1}),$("#hdnReplyNoteID").val(t)):showErrorMessageJobHistory("Job Note has been deleted.")}})}function SaveReplyForNotes(){var e=$("#hdnReplyNoteID").val(),t=jobID,a=CKEDITOR.instances.notecontenteditor.getData(),o=jobRefNo;""!=a?$.ajax({type:"GET",url:urlSaveReplyForNote,dataType:"json",async:!1,data:{Noteid:e,JobID:t,NotesReplyDescription:a,JobRefNo:o},success:function(e){e.status?(showSuccessMessageJobHistory("Your reply has been added to Job Note."),$("#popupAddReplyNote").modal("toggle"),$("#hdnReplyNoteID").val(""),CKEDITOR.instances.notecontenteditor.setData(""),SearchHistory()):(showErrorMessageJobHistory("Your reply has not been saved to Job Note."),$("#popupAddReplyNote").modal("toggle"))}}):($("#errorMsgRegionJobReplyNote").html(closeButton+"Reply is required"),$("#errorMsgRegionJobReplyNote").show())}function ClearReplyForNotes(){CKEDITOR.instances.notecontenteditor.setData("")}function showSuccessMessageJobHistory(e){$("#errorMsgRegionJobHistory").hide(),$("#successMsgRegionJobHistory").html(closeButton+e),$("#successMsgRegionJobHistory").show()}function showErrorMessageJobHistory(e){$("#successMsgRegionJobHistory").hide(),$("#errorMsgRegionJobHistory").html(closeButton+e),$("#errorMsgRegionJobHistory").show()}function showEditDeleteIcons(){$(".IconsEditDelete").css("display","block")}function hideEditDeleteIcons(){$(".IconsEditDelete").each(function(){$(this).css("display","none !important")})}function AddHistoryIcons(){$(".history-block li").each(function(){var e=$(this).attr("class");void 0!==e&&(e.includes("stage-status")?$(this).find(".border-icon").addClass("fa-regular fa-building"):e.includes("notes-status")?$(this).find(".border-icon").addClass("fa-regular fa-note-sticky"):e.includes("message-status")?$(this).find(".border-icon").addClass("message1"):e.includes("traded-status")?$(this).find(".border-icon").addClass("fa-regular fa-circle-dollar-to-slot"):e.includes("stc-status")?$(this).find(".border-icon").addClass("fa-solid fa-pen-to-square"):e.includes("scheduling-status")?$(this).find(".border-icon").addClass("fa-solid fa-briefcase"):e.includes("documents-status")?$(this).find(".border-icon").addClass("fa-regular fa-file-lines"):e.includes("signature-status")?$(this).find(".border-icon").addClass("fa-regular fa-file-signature"):e.includes("spvlogs-status")?$(this).find(".border-icon").addClass("fa-regular fa-clipboard-check"):e.includes("invoice-status")&&$(this).find(".border-icon").addClass("fa-regular fa-file-invoice-dollar"))})}function changeSCAModal(){$("#changeScaModal").modal()}function changeSCA(){var e=$("#inGBSCACode").val(),t=$("#GB_SCACode").val();null!=e&&""!=e&&e!=t?$.ajax({url:urlChangeSCA,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:jobId,gbSCACode:e,resellerID:resellerID,oldSCAName:SCAName,solarCompanyId:SolarCompanyId,jobInstallationYear:JobInstallationYear}),success:function(t){t.success?(showMessageForChangeSCA(t.message,!1),$("#GB_SCACode").val(e)):showMessageForChangeSCA(t.message,!0)}}):e==t?showMessageForChangeSCA("You can not enter same SCA Code.",!0):$("#gbScaCodeError").html("GBSCA Code is required.")}function showMessageForChangeSCA(e,t){$(".alert").hide();var a=t?"errorMsgRegionChangeSCA":"successMsgRegionChangeSCA",o=t?"successMsgRegionChangeSCA":"errorMsgRegionChangeSCA";$("#"+o).hide(),$("#"+a).html(closeButton+e),$("#"+a).show()}function showPnlInvoiceElecBillOver60kw(){$("#JobSystemDetails_SystemSize").val()>60?($("#divDocumentsPnlInvoice").show(),$("#divDocumentsElecBill").show()):($("#divDocumentsPnlInvoice").hide(),$("#divDocumentsElecBill").hide())}function SerialNumbersValidationOnPage(e,t,a){if(null!=e.val()&&""!=e.val().trim()){var o=e.val().trim(),s=o.split("\n");s=s.filter(function(e){return e.length>0});s.length;for(var i=0;i<s.length;i++)if(s[i].length>100){!0;break}var l=hasDuplicatesSerialNumber(s,a)}return l}function hasDuplicatesSerialNumber(e,t){ispanelorinverterduplicate=!1;for(var a=0;a<e.length;++a)for(var o=a+1;o<e.length;o++)e[a]==e[o]&&(lineNumberForDuplicateSerial=o+1,t?(DuplicatePanelSerialNumber=e[o],DuplicateSerialErrorMsg+="Panel Serial number "+DuplicatePanelSerialNumber+" is duplicate. "):(DuplicatePanelSerialNumber=e[o],DuplicateInverterErrorMsg+="Inverter Serial number "+DuplicatePanelSerialNumber+" is duplicate."),ispanelorinverterduplicate=!0);return!!ispanelorinverterduplicate}function DuplicateSerialNumbersValidation(e,t,a){if(null!=e.val()&&""!=e.val().trim()){var o=e.val().trim(),s=o.split("\n");s=s.filter(function(e){return e.length>0});s.length;for(var i=0;i<s.length;i++)if(s[i].length>100){!0;break}var l=hasDuplicatesSerialNumberOnPage(s,a)}return l}function hasDuplicatesSerialNumberOnPage(e,t){ispanelorinverterduplicate=!1;for(var a=0;a<e.length;++a)for(var o=a+1;o<e.length;o++)e[a]==e[o]&&(lineNumberForDuplicateSerial=o+1,t?(DuplicatePanelSerialNumber=e[o],DuplicateSerialandInverterErrorMsg+="Panel Serial number "+DuplicatePanelSerialNumber+" is duplicate. "):(DuplicatePanelSerialNumber=e[o],DuplicateSerialandInverterErrorMsg+="Inverter Serial number "+DuplicatePanelSerialNumber+" is duplicate. "),ispanelorinverterduplicate=!0);return!!ispanelorinverterduplicate}var DuplicatePanelSerialNumber,DuplicateInverterSerialNumber,DuplicateSerialandInverterErrorMsg,lineNumberForDuplicateSerial=0,DuplicateSerialErrorMsgStart="Serial numbers cannot be same, ",DuplicateSerialErrorMsg="",DuplicateInverterErrorMsg="",inverterSerialValOnPage=!1,serialValOnPage=!1;$(document).on("mouseenter","#divHistoryList li",function(e){$(".IconsEditDelete",this).css("display","inline-flex")}).on("mouseleave","#divHistoryList li",function(){$(".IconsEditDelete",this).css("display","none")}),(void 0!==$("#IsWholeSaler").val()&&"false"==$("#IsWholeSaler").val().toLowerCase()||"undefined"!=typeof BasicDetails_IsWholeSaler&&"false"==BasicDetails_IsWholeSaler.toLowerCase())&&($(".SettlementTerms").show(),$(".total-amonut").show()),$(document).on("mouseleave","#JobSystemDetails_SerialNumbers",function(){DuplicateSerialErrorMsg="";var e="0",t="0";serialValOnPage=SerialNumbersValidationOnPage($("#JobSystemDetails_SerialNumbers"),$("#spanSerialNumbers"),!0),serialValOnPage||inverterSerialValOnPage?(""==DuplicateSerialErrorMsg&&""==DuplicateInverterErrorMsg&&(DuplicateSerialErrorMsgStart="Serial numbers cannot be same, "),$("#errorMsgRegionSerialPanel").html(DuplicateSerialErrorMsgStart+DuplicateSerialErrorMsg+DuplicateInverterErrorMsg),$("#errorMsgRegionSerialPanel").show()):$("#errorMsgRegionSerialPanel").hide(),e=""!=$("#JobSystemDetails_SerialNumbers").val()&&null!=$("#JobSystemDetails_SerialNumbers").val()&&null!=$("#JobSystemDetails_SerialNumbers").val()?$("#JobSystemDetails_SerialNumbers").val().split("\n").length:"0",t=""!=$("#JobSystemDetails_NoOfPanel").text()&&null!=$("#JobSystemDetails_NoOfPanel").text()&&null!=$("#JobSystemDetails_NoOfPanel").text()?$("#JobSystemDetails_NoOfPanel").text():"0",$("#cntPanelSerialNumber").html(" ("+e+"/"+t+")")}),$(document).on("mouseleave","#JobSystemDetails_InverterSerialNumbers",function(){DuplicateInverterErrorMsg="";var e="0",t="0";inverterSerialValOnPage=SerialNumbersValidationOnPage($("#JobSystemDetails_InverterSerialNumbers"),$("#spanInverterSerialNumbers"),!1),inverterSerialValOnPage||serialValOnPage?(""==DuplicateSerialErrorMsg&&""==DuplicateInverterErrorMsg&&(DuplicateSerialErrorMsgStart="Serial numbers cannot be same, "),$("#errorMsgRegionSerialPanel").html(DuplicateSerialErrorMsgStart+DuplicateSerialErrorMsg+DuplicateInverterErrorMsg),$("#errorMsgRegionSerialPanel").show()):$("#errorMsgRegionSerialPanel").hide(),1==$("#BasicDetails_JobType").val()&&(e=""!=$("#JobSystemDetails_InverterSerialNumbers").val()&&null!=$("#JobSystemDetails_InverterSerialNumbers").val()&&null!=$("#JobSystemDetails_InverterSerialNumbers").val()?$("#JobSystemDetails_InverterSerialNumbers").val().split("\n").length:"0",t=""!=$("#JobSystemDetails_NoOfInverter").text()&&null!=$("#JobSystemDetails_NoOfInverter").text()&&null!=$("#JobSystemDetails_NoOfInverter").text()?$("#JobSystemDetails_NoOfInverter").text():"0",$("#cntInverterSerialNumber").html(" ("+e+"/"+t+")"))});var Executed=!0,SavedData="",showStayMsg=!0;jQuery(function(e){e(document).ajaxStop(function(){Executed||(SetDataForSSCSCO(),SavedData=CommonDataForSave()),Executed=!0})}),$(document).ready(function(){BindNotesType(),BindUserList(),SearchHistory(),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||LoadWarningNotes();var e=$("#cntWarningNotes").text();$("#btnWarningNotes").html("Warning Notes ("+e+")"),$("#btnWarningNotes").click(function(){$("#warningNotesRegion").toggle()}),$("#historyCategory").change(function(){$("#JobHistorySearch").val(""),SearchHistory(),$("#width_tmp_option").html($("#historyCategory option:selected").text()),$(this).width($("#width_tmp_select").width())}),$("#FilterIsImportantNote").change(function(){$("#JobHistorySearch").val(""),SearchHistory()}),$("#filter-postvisibility").change(function(){$("#JobHistorySearch").val(""),SearchHistory(),$("#width_tmp_option").html($("#filter-postvisibility option:selected").text()),$(this).width($("#width_tmp_select").width())}),$("#JobHistorySearch").on("keyup",function(){tagandsearchfilter()}),$("#relatedTofilter").on("change",function(){tagandsearchfilter(),$("#width_tmp_option").html($("#relatedTofilter option:selected").text()),$(this).width($("#width_tmp_select").width())}),$("#refreshJobHistory").click(function(e){SearchHistory()}),$("#IsDeletedJobNote").on("change",function(){SearchHistory()}),1==JOBType?"true"==IsLockedSerialNumber?($("#aLockedSerialnumber").show(),$("#aUnLockedSerialnumber").hide(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!0)):("false"!=IsLockedSerialNumber||1!=USERType&&3!=USERType&&"True"!=IsLockUnlockSerial||$("#aUnLockedSerialnumber").show(),$("#aLockedSerialnumber").hide(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!1)):($("#aLockedSerialnumber").hide(),$("#aUnLockedSerialnumber").hide()),$("#SerialNumberInverter").hide(),$("#aInverterSerialNumbers").click(function(){$("#SerialNumberPanel").hide(),$("#SerialNumberInverter").show(),$(this).closest("ul").find(".active").removeClass("active"),$(this).closest("li").addClass("active")}),$("#aPanelSerialNumbers").click(function(){$("#SerialNumberInverter").hide(),$("#SerialNumberPanel").show(),$(this).closest("ul").find(".active").removeClass("active"),$(this).closest("li").addClass("active")}),$("#aLockedSerialnumber").click(function(e){e.preventDefault();var t=confirm("Are you sure you want to unlock serialnumbers? if so then job will be not affiliated by SPV.");t&&(RemoveSPVOnUnlockSerialnumber(),1!=USERType&&3!=USERType&&"True"!=IsLockUnlockSerial||$("#aUnLockedSerialnumber").show(),$("#aLockedSerialnumber").hide(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!1),IsLockedSerialNumber="false")}),$("#aUnLockedSerialnumber").click(function(e){e.preventDefault(),1!=USERType&&3!=USERType&&"True"!=IsLockUnlockSerial||(SetSPVOnLockSerialNumber(),$("#aUnLockedSerialnumber").hide(),$("#aLockedSerialnumber").show(),$("#JobSystemDetails_SerialNumbers").prop("disabled",!0),IsLockedSerialNumber="true")}),0!=BasicDetails_ScoID&&BasicDetails_ScoID>0?dropDownData.push({id:"ScoID",key:"",value:BasicDetails_ScoID,hasSelect:!0,callback:null,defaultText:null,proc:"User_GetSCOUser",param:[{JobID:jobID}],bText:"Name",bValue:"UserId"}):dropDownData.push({id:"ScoID",key:"",value:null,hasSelect:!0,callback:null,defaultText:null,proc:"User_GetSCOUser",param:[{JobID:jobID}],bText:"Name",bValue:"UserId"}),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})}),$("body").on("hidden.bs.popover",function(e){$(e.target).data("bs.popover").inState.click=!1}),$("#SSCID").change(function(){var e=$("#SSCID option:selected").text();$("#BasicDetails_SSCName").val(e)}),$("#ScoID").change(function(){var e=$("#ScoID option:selected").text();$("#BasicDetails_SCOName").val(e)}),dropDownData.push({id:"SSCID",key:"",value:BasicDetails_SSCID,hasSelect:!0,callback:disableSSCdropdown,defaultText:null,proc:"User_GetSSCUserByJbID",param:[{JobID:jobID}],bText:"Name",bValue:"UserId"}),dropDownData.bindDropdown(),$("ul.create-job-menu").on("click","li",function(){return"jobAction"!=$(this).closest("ul").attr("id")&&($("ul.create-job-menu").each(function(){$(this).find("li").each(function(){$(this).removeClass("active")})}),$("#invoiceDetail").css("display","none"),"0"==$("#BasicDetails_JobID").val()?$("#ActiveJob").addClass("active"):("0"==$("#hasJobID").val()&&$("#hasJobID").val($("#BasicDetails_JobID").val()),LoadTabContent($(this).index())),prevSelectedTab=$(this).index(),!1)}),$("#btnSPVProductVerification").click(function(){SPVProductverification()}),$("#btnSPVProductVerificationErrorLog").click(function(){SPVProductionVerificationErrorLog()}),$("#btnReSPVProductVerification").click(function(){SPVProductverification(!0)}),$("#closePopupSTCJobHistory").click(function(){$("#popupSTCJobHistory").modal("toggle")}),$("#aViewSTCJobHistory").click(function(){$.get(GetSTCJobHistory+Model_JobID,function(e){$("#STCJobHistoryOfJob").empty(),$("#STCJobHistoryOfJob").append(e),$("#popupSTCJobHistory").modal({backdrop:"static",keyboard:!1})})}),$("#onOffSwitchPreApproval").on("change.bootstrapSwitch",function(e,t){ShowHidePreapprovalBox(),UpdateAction()}),$("#onOffSwitchConnection").on("change.bootstrapSwitch",function(e,t){ShowHideConnectionBox(),UpdateAction()}),$("#onOffSwitchNewDocVIewer").on("change.bootstrapSwitch",function(e,t){UpdateActionToSaveIsNewViewerUserWise()}),$(".switch").on("click",function(e){e.stopImmediatePropagation()}),$("#jobNewScreen").closest("body").addClass("grey-bg"),$("#btnSaveJob").click(function(){SaveJobDetail()}),$("#yesWarning").click(function(){$("#btnSaveJob").attr("disabled","disabled"),$("#warning").modal("hide"),SaveJob()}),$("#noWarning").click(function(){$("#warning").modal("hide"),"0"!=$("#BasicDetails_JobID").val()&&($("#BasicDetails_JobType").attr("disabled","disabled"),$("#BasicDetails_JobType").change())}),$("#CloseWarning").click(function(){$("#STCwarning").modal("hide"),"0"!=$("#BasicDetails_JobID").val()&&($("#BasicDetails_JobType").attr("disabled","disabled"),$("#BasicDetails_JobType").change())}),GetDefaultSettingForJob(),LoadSerialNumberWithPhotoExistOrNot(),($(".line-no.unverified").length>0||$(".line-no.installationVerified").length>0||$(".line-no.verified").length>0||$(".line-no.notverified").length>0)&&"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?$("#SPVLabel").show():$("#SPVLabel").hide(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?($("#btnSPVProductVerificationErrorLog").show(),$("#btnSPVProductVerification").show()):($("#btnSPVProductVerificationErrorLog").hide(),$("#btnSPVProductVerification").hide()),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&("True"==IsSPVInstallationVerified&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val()||10!=$("#STCStatusId").val()&&12!=$("#STCStatusId").val()&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val())&&$("#btnSaveJob").hide(),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&14!=$("#STCStatusId").val()&&$("#certificateBlock").hide(),14!=$("#STCStatusId").val()&&"True"!=isSaveJobAfterTrade||$("#btnSaveJob").show(),"True"==basicdetails_IsRegisteredWithGST?showSnackbar("Company is registered with GST Certificate",!1,null,"gstsnackbar"):showSnackbar("Company is not registered with GST Certificate",!1,null,"gstsnackbar"),"True"==basicdetails_IsGenerateRecZip?$("#onOffSwitchGenerateRecZip").prop("checked",!0):$("#onOffSwitchGenerateRecZip").prop("checked",!1),$("#onOffSwitchGenerateRecZip").on("change.bootstrapSwitch",function(e,t){var a=$("#onOffSwitchGenerateRecZip").prop("checked"),o=!0;if(a){if(0==$("#divDocumentsCES").find("#tbodyCES tr").length&&0==$("#divDocumentsSTC").find("#tbodySTC tr").length)return alert("There are no documents in CES/COC and STC Forms for generating zip file."),$("#onOffSwitchGenerateRecZip").prop("checked",!1),o=!1,!1;if(($("#divDocumentsCES").find("#tbodyCES tr").length>1||$("#divDocumentsSTC").find("#tbodySTC tr").length>1)&&(o=confirm("There are more than one CES/COC and STC Forms, resulting in larger zip file size."),!o))return $("#onOffSwitchGenerateRecZip").prop("checked",!1),!1}o?($("#loading-image").show(),setTimeout(function(){$.ajax({url:generateRECZipJobWise,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:jobId,isGenerateRecZip:$("#onOffSwitchGenerateRecZip").prop("checked")}),async:!1,success:function(e){if(e.status)if($('#tbodyOther tr[isreczip="true"]').length>0&&$('#tbodyOther tr[isreczip="true"]').remove(),$("#onOffSwitchGenerateRecZip").prop("checked")){var t=JSON.parse(e.data),a=$("table #tbodyOther"),o=(JobId,t[0].FileName,$("<tr/>").data("data",t[0]).data("path",t[0].Path).data("id",t[0].JobDocumentId));o.addClass("job-document-"+t[0].JobDocumentId),o.attr("id","other_"+t[0].JobDocumentId),o.attr("isreczip",t[0].IsRecZip),o.appendTo(a);$("<td/>").css("width","2%").appendTo(o),$("<td/>").text(t[0].Path.split("\\").pop()).appendTo(o),$("<td/>").addClass("action").appendTo(o);var s=$("<td/>").addClass("action").appendTo(o);params="'OTHER','','','"+t[0].Path+"','0','other_"+t[0].JobDocumentId+"','"+t[0].JobDocumentId+"'";var i=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("data-filename",t[0].Path.split("\\").pop()).attr("title","Signature Mail").data("type","OTHER").attr("onclick","viewDocument("+params+")").appendTo(s);allowdViewTypes.indexOf(t[0].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(i,0);$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(s),$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("onclick","onclick=DownloadJobDocuments("+t[0].JobDocumentId+")").appendTo(s);showSuccessMessage("Zip file generated successfully.",$("#errorMsgRegion"),$("#successMsgRegion"))}else showSuccessMessage("Zip file removed successfully.",$("#errorMsgRegion"),$("#successMsgRegion"))}})},500)):$("#onOffSwitchGenerateRecZip").prop("checked",!1)}),$("#inGBSCACode").change(function(){null!=this.value&&""!=this.value?$("#gbScaCodeError").html(""):$("#gbScaCodeError").html("GBSCA Code is required.")}),BindAllTabsAjax()}),$("#btnBackNew").click(function(e){e.preventDefault(),isParentInvoice?($(document).attr("title","GreenBot - Invoice"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,$("#invoice").load(urlGetJobInvoice),$("#invoice").show(),$("#EmailConversation").hide(),$("#invoiceDetail").css("display","none"),setTimeout(function(){loadInvoice()},1500)):window.location.href=urlIndex}),$("#btnJobPrint").click(function(){var e=queryStringJobID,t=urlPrint+e;window.open(t)});var isEmailAlreadyLoaded=!1,pageIndex=1,pageSize=10,IsLast=!1,count=0,isParentInvoice=!1,jobInvoiceDetail=jobInvoiceDetail||[];jobInvoiceDetail=function(){var e={loadInvoiceDetailData:function(t){if($("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),$("#invoice")&&$("#invoice").css("display","none"),$("#invoiceDetailList")){$("#invoiceDetailList").html("");var a=0;$("#hasJobID")&&(a=$("#hasJobID").val()),$.ajax({url:urlGetJobInvoiceDetail,type:"GET",dataType:"html",data:{invoiceID:t,jobID:a},async:!0,success:function(e){$("#invoiceDetailList").html(e)},complete:function(a){if($("#invoiceDetail").css("display","block"),$("#invoiceDetailListTable")){var o=$("#invoiceDetailListTable").DataTable();o.destroy()}e.loadtable(t),$("#hdnJobInvoiceID")&&$("#hdnJobInvoiceID").val(t),$("body").attr("style","overflow:scroll;padding-right:0px;")},error:function(e){alert(e)}}),isParentInvoice=!0}},loadtable:function(e){var t="",a="",o="";$("#drdInvoiced")&&(t=$("#drdInvoiced").val()),$("#drdInvoiceType")&&(a=$("#drdInvoiceType").val()),""!=e&&(o+="invoiceID="+e+"&"),""!=t&&(o+="isInvoiced="+t+"&"),""!=a&&(o+="jobInvoiceType="+a),""!=o&&(o="?"+o);var s=0,i="";$("#hasJobID")&&(i=$("#hasJobID").val()),$("#invoiceDetailListTable").DataTable({paging:!1,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"JobInvoiceDetailID",render:function(e,t,a,o){return 1==$("#chkAll").prop("checked")?'<input type="checkbox" id="chk_'+a.JobInvoiceDetailID+'" checked>':'<input type="checkbox" id="chk_'+a.JobInvoiceDetailID+'">'},orderable:!1},{data:"TimeStart",render:function(e){return ConvertToDateWithFormat(e,ProjectConfiguration_GetDateFormat)}},{data:"JobInvoiceType",render:function(e,t,a,o){return 1==a.JobInvoiceType?'<img src="/images/invoice-type-part.png" alt="Part" />':2==a.JobInvoiceType?'<img src="/images/invoice-type-time.png" alt="Time" />':3==a.JobInvoiceType?'<img src="/images/invoice-type-payment.png" alt="Payment" />':""},orderable:!1},{data:"Description"},{data:"StaffName",orderable:!1},{data:"Quantity",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.Quantity)}},{data:"Sale",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.Sale)}},{data:"SubTotal",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.SubTotal)}},{data:"cost",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.cost)}},{data:"Profit",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.Profit)}},{data:"Margin",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return"number"==typeof a.Margin?a.Margin===parseInt(a.Margin,10)?a.Margin:a.Margin.toFixed(0):"0"}},{data:"Tax",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.Tax)}},{data:"Total",orderable:!1,sClass:"dt-right",render:function(e,t,a,o){return PrintDecimal(a.Total)}},{data:"IsBillable",render:function(e,t,a,o){return'<img src="/images/'+a.IsBillableImage+'" alt="" />'},orderable:!1},{data:"IsInvoiced",render:function(e,t,a,o){return 1==a.IsInvoiced?"Yes":0==a.IsInvoiced?"No":""},orderable:!1},{data:"JobInvoiceDetailID",className:"hide_column"},{data:"JobInvoiceType",className:"hide_column"},{data:"Payments",className:"hide_column"},{data:"Remaning",className:"hide_column"},{data:"TaxAmountConsider",className:"hide_column"}],dom:"<<'table-responsive tbfix't><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetInvoiceDetailListing+o+"&&jobID="+i,fnDrawCallback:function(t,a,o,l,r){s=0;this.api();$("#generateInvoice").attr("data-id",urlCreateReport+e+"&jobID="+i),$("#generateInvoice").attr("style","cursor:pointer;"),$("#exportCSV").attr("href",urlCreateCSV+e),$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>1?$("#invoiceDetailListTable_length").show():$("#invoiceDetailListTable").find("tr").length>11?$("#invoiceDetailListTable_length").show():$("#invoiceDetailListTable_length").hide();var n=$("#invoiceDetailListTable").DataTable();n.page.info();$("#invoiceDetailListTable th:first").removeClass("sorting_asc"),$("#invoiceDetailListTable tbody").on("click","tr td:not(:first-child)",function(e){var t=$(e.currentTarget).closest("tr").find("td:eq(15)").html(),a=$(e.currentTarget).closest("tr").find("td:eq(16)").html(),o="";$("#hasJobID")&&(o=$("#hasJobID").val());var s="";$("#hdnXeroApprovedDate")&&(s=$("#hdnXeroApprovedDate").val()),"1"==a&&""!=t&&""!=o&&""==s?GetJobInvoiceDetailById(t,o):"2"==a&&""!=t&&""==s?loadAddTime(t):"3"==a&&""!=t&&PaymentPopup(t)})},fnServerParams:function(e){var t=$("#invoiceDetailListTable").DataTable();$("#chkAll").on("click",function(){var e=t.rows({search:"applied"}).nodes();$('input[type="checkbox"]',e).prop("checked",this.checked),s=this.checked?$("#invoiceDetailListTable >tbody >tr").length:0}),$("#invoiceDetailListTable tbody").on("change",'input[type="checkbox"]',function(){this.checked?(s++,s==$("#invoiceDetailListTable >tbody >tr").length&&$("#chkAll").prop("checked",this.checked)):(s--,$("#chkAll").prop("checked",this.checked))})},initComplete:function(e,t){}})}};return{loadData:function(t){e.loadInvoiceDetailData(t)},loadInvoiceDetailGrid:function(t){e.loadtable(t)}}}(),$(document).on("click","#AddInvoice",function(){jobInvoiceDetail.loadData("0")}),$("#aDeleteJob").click(function(e){if(e.preventDefault(),selectedRows=[],jobDetail={id:Model_Id,jobTitle:$("#BasicDetails_Title").val()},selectedRows.push(jobDetail),null!=selectedRows&&selectedRows.length>0){var t=confirm("Are you sure you want to delete selected jobs ?");t&&$.ajax({url:urlDeleteSelectedJobs,type:"POST",cache:!1,data:JSON.stringify({jobs:selectedRows}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Completed"==e.JsonResponseObj.status?(showSuccessMessage("Job has been deleted."),window.location.href="/Job/Index"):showErrorMessage(e.JsonResponseObj.strErrors)}})}else alert("Please select any job for delete.")}),$("#btnScrollToTop").click(function(e){return e.preventDefault(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1}),$("#aSwitch").click(function(e){window.location.href="/Job/Index?Id="+eJobId+"&isTabularView=true"}),window.onbeforeunload=function(e){if(showStayMsg&&!CompareJobData())return"Changes is not save please save changes.";showStayMsg=!0},$("#container").resizable({minHeight:300,handles:"s",alsoResize:"#showfilteredhistory"}),$("#aGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetSignatureSelfie").modal("show")}),$("#installerGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetinstallerSignatureSelfie").modal("show")}),$("#designerGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetdesignerSignatureSelfie").modal("show")}),$("#elecGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetelectricianSignatureSelfie").modal("show")});