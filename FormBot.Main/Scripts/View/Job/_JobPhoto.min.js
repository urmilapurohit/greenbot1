function OpenPhoto(e) { var o = Model_JobID, t = UploadedDocumentPath + "/JobDocuments/" + o + "/" + e.className; $("#loading-image").css("display", ""), $("#imgPhoto").attr("src", t).load(function () { logoWidth = this.width, logoHeight = this.height, $("#popupPhotoBox").modal({ backdrop: "static", keyboard: !1 }), $(window).height() <= logoHeight ? ($("#imgPhoto").closest("div").height($(window).height() - 150), $("#imgPhoto").closest("div").css("overflow-y", "scroll"), $("#imgPhoto").height(logoHeight)) : ($("#imgPhoto").height(logoHeight), $("#imgPhoto").closest("div").removeAttr("style")), screen.width <= logoWidth || logoWidth >= screen.width - 250 ? ($("#popupPhotoBox").find(".modal-dialog").width(screen.width - 250), $("#imgPhoto").width(logoWidth)) : ($("#imgPhoto").width(logoWidth), $("#popupPhotoBox").find(".modal-dialog").width(logoWidth)), $("#loading-image").css("display", "none") }), $("#imgPhoto").unbind("error"), $("#imgPhoto").attr("src", t).error(function () { alert("Image does not exist."), $("#loading-image").css("display", "none") }) } function OpenSerial(e) { var o = Model_JobID, t = UploadedDocumentPath + "/JobDocuments/" + o + "/" + e.className; $("#loading-image").css("display", ""), $("#imgSerial").attr("src", t).load(function () { logoWidth1 = this.width, logoHeight1 = this.height, $("#popupSerialBox").modal({ backdrop: "static", keyboard: !1 }), $(window).height() <= logoHeight1 ? ($("#imgSerial").closest("div").height($(window).height() - 150), $("#imgSerial").closest("div").css("overflow-y", "scroll"), $("#imgSerial").height(logoHeight1)) : ($("#imgSerial").height(logoHeight1), $("#imgSerial").closest("div").removeAttr("style")), screen.width <= logoWidth1 || logoWidth1 >= screen.width - 250 ? ($("#popupSerialBox").find(".modal-dialog").width(screen.width - 250), $("#imgSerial").width(logoWidth1)) : ($("#imgSerial").width(logoWidth1), $("#popupSerialBox").find(".modal-dialog").width(logoWidth1)), $("#loading-image").css("display", "none") }), $("#imgSerial").unbind("error"), $("#imgSerial").attr("src", t).error(function () { alert("Image does not exist."), $("#loading-image").css("display", "none") }) } function DeletePhoto() { $('input[name="chkBtnPhoto"]:checked').length > 0 && confirm("Are you sure you want to delete this file ?") && (photo = $.map($('input[name="chkBtnPhoto"]:checked'), function (e, o) { return e.value }).join("?"), DeletePhotoFromFolder(photo)) } function DeletePhotoFromFolder(e) { var o = Model_JobID, t = ProjectImagePath + "Job/"; $.ajax({ url: t + "DeleteFileFromFolderPhoto/Job", data: { fileName: e, FolderName: o }, method: "get", success: function () { var o = e.split("?"); $.each($("#intPhoto li"), function (e, t) { $.each(o, function (e, o) { $(t).find("a").attr("id") == o && ($(t).closest("li").remove(), totalInstallation -= 1, OpecityOfDownloadAllPhotos($(".downloadInstallation"), totalInstallation)) }) }); var t = $("#intPhoto li").length; return $("#spanPhoto").html("(" + t + ")"), $(".alert").hide(), $("#successMsgRegion").html(closeButton + "File has been deleted successfully."), $("#successMsgRegion").show(), !1 } }) } function DeleteSerial() { $('input[name="chkBtnSerial"]:checked').length > 0 && (confirm("Are you sure you want to delete this file ?") && DeleteSerialFromFolder($.map($('input[name="chkBtnSerial"]:checked'), function (e, o) { return e.value }).join("?"))) } function DeleteSerialFromFolder(e) { var o = Model_JobID, t = ProjectImagePath + "Job/"; $.ajax({ url: t + "DeleteFileFromFolderPhoto/Job", data: { fileName: e, FolderName: o }, method: "get", success: function () { var o = e.split("?"); $.each($("#SerialNumber li"), function (e, t) { $.each(o, function (e, o) { $(t).find("a").attr("id") == o && ($(t).closest("li").remove(), totalSerialNumber -= 1, OpecityOfDownloadAllPhotos($(".downloadSerialNumber"), totalSerialNumber)) }) }); var t = $("#SerialNumber li").length; return $("#spanSerial").html("(" + t + ")"), 0 == t && $.ajax({ url: urlGetSTCStatusDescription, type: "GET", dataType: "json", contentType: "application/json; charset=utf-8", processData: !1, data: "id=" + Model_JobID, success: function (e) { e.IsSuccess && (null != e.STCStatusName && null != e.STCStatusName && "" != e.STCStatusName && $("#spanSTCStatus").text(e.STCStatusName.trim()), null != e.STCDescription && null != e.STCDescription && "" != e.STCDescription && $("#STCDescription").html(e.STCDescription.trim()), null != e.STCStatusId && null != e.STCStatusId && "" != e.STCStatusId && $("#STCStatusId").val(e.STCStatusId.trim())) } }), $(".alert").hide(), $("#successMsgRegion").html(closeButton + "File has been deleted successfully."), $("#successMsgRegion").show(), !1 } }) } function checkBusinessRulesForPhotos() { EnableDropDownbyUsertype(), $("#BasicDetails_JobType").removeAttr("disabled"); var e = "", o = ""; if (PanelXml.length > 0) { var t = JSON.stringify(PanelXml), l = "", i = $.parseJSON(t); $.each(i, function () { l += "<panel><Brand>" + htmlEncode(this.Brand) + "</Brand><Model>" + htmlEncode(this.Model) + "</Model><NoOfPanel>" + this.Count + "</NoOfPanel></panel>" }), e = "<Panels>" + l + "</Panels>" } if (InverterXml.length > 0) { t = JSON.stringify(InverterXml), l = "", i = $.parseJSON(t); $.each(i, function () { l += "<inverter><Brand>" + htmlEncode(this.Brand) + "</Brand><Model>" + htmlEncode(this.Model) + "</Model><Series>" + htmlEncode(this.Series) + "</Series><NoOfInverter>" + htmlEncode(this.NoOfInverter) + "</NoOfInverter></inverter>" }), o = "<Inverters>" + l + "</Inverters>" } $("#panelXml").val(e), $("#inverterXml").val(o); var s = JSON.stringify($("form").serializeToJson()); $.ajax({ url: urlCheckBusinessRules, type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", processData: !1, data: s, success: function (e) { e.IsSuccess ? ($(".alert").hide(), $("#errorMsgRegion").hide(), $("#successMsgRegion").html(closeButton + "File has been uploaded successfully."), $("#successMsgRegion").show(), null != e.STCStatusName && null != e.STCStatusName && "" != e.STCStatusName && $("#spanSTCStatus").text(e.STCStatusName.trim()), null != e.STCDescription && null != e.STCDescription && "" != e.STCDescription && $("#STCDescription").html(e.STCDescription.trim()), null != e.STCStatusId && null != e.STCStatusId && "" != e.STCStatusId && $("#STCStatusId").val(e.STCStatusId.trim())) : "syntaxError" == e && ($(".alert").hide(), $("#errorMsgRegion").hide(), $("#successMsgRegion").html(closeButton + "File has been uploaded successfully."), $("#successMsgRegion").show()) } }) } function ShowHidePhotos() { totalInstallation = lstUserDocument_Count, totalSerialNumber = lstSerialDocument_Count, OpecityOfDownloadAllPhotos($(".downloadInstallation"), totalInstallation), OpecityOfDownloadAllPhotos($(".downloadSerialNumber"), totalSerialNumber) } function OpecityOfDownloadAllPhotos(e, o) { o > 0 ? (e.css("opacity", "1"), e.css("pointer-events", "visible")) : (e.css("opacity", "0.5"), e.css("pointer-events", "none")) } function DownLoadAllPhotoesAsZip(e) { var o = []; return e ? $.each($("#intPhoto").find("li"), function (e, t) { $(t).find("a").attr("id") && o.push($(t).find("a").attr("id")) }) : $.each($("#SerialNumber").find("li"), function (e, t) { $(t).find("a").attr("id") && o.push($(t).find("a").attr("id")) }), window.location.href = urlDownLoadAllPhotoesAsZip + "?jobid=" + Model_JobID + "&photosArray=" + JSON.stringify(o) + "&isInstallation=" + e, !1 } $(document).ready(function () { var e = $("#intPhoto li").length; $("#spanPhoto").html("(" + e + ")"); e = $("#SerialNumber li").length; $("#spanSerial").html("(" + e + ")"), ShowHidePhotos() }), $(function () { "use strict"; var e = ProjectImagePath + "Job/", o = Model_JobID, t = e + "UploadPhoto/Job", l = e + "UploadSerial/Job"; $("#uploadBtnPhoto").fileupload({ url: t, dataType: "json", done: function (e, o) { var t = []; t.length = 0; var l = []; l.length = 0; var i = []; i.length = 0; for (var s = 0; s < o.result.length; s++)if (1 == o.result[s].Status) { var a = $("#intPhoto").length + 1, n = (o.result[s].MimeType.split("/")[0], o.result[s].FileName.replace("%", "$")); if (o.result[s].FileName.length > 20) var r = n.substring(0, 20) + "..."; else r = n; var h = "<li class='checkbox' style='margin-left:2px;'>"; h += "<label> <input type='checkbox' name='chkBtnPhoto' value=\"" + n + '" >', "true" == isJobPhotoView && (h += "<a href='javascript:void(0)' style='text-decoration:none;' onclick='OpenPhoto(this);' title=\"" + n + '"  class="' + n + '" id="' + n + '">' + r + " </a>"), "false" == isJobPhotoView && (h += "<a href='javascript:void(0)' style='text-decoration:none;' title=\"" + n + '" class="' + n + '" id="' + n + '">' + r + " </a>"), h += "</label>", h += "</li>", $("#intPhoto").append(h); a = $("#intPhoto li").length; $("#spanPhoto").html("(" + a + ")"), $('<input type="hidden">').attr({ name: "FileNamesCreate", value: o.result[s].FileName, id: o.result[s].FileName }).appendTo("form"), totalInstallation += 1, OpecityOfDownloadAllPhotos($(".downloadInstallation"), totalInstallation) } else 0 == o.result[s].Status && "NotImage" == o.result[s].Message ? l.push(o.result[s].FileName) : 0 == o.result[s].Status && "BigName" == o.result[s].Message ? i.push(o.result[s].FileName) : t.push(o.result[s].FileName); l.length > 0 && ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + l.length + " Uploaded file is not .jpg , .jpeg or .png extension."), $("#errorMsgRegion").show()), t.length > 0 && ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + t.length + " File has not been uploaded."), $("#errorMsgRegion").show()), i.length > 0 && ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + i.length + " Uploaded filename is too big."), $("#errorMsgRegion").show()), 0 == i.length && 0 == t.length && 0 == l.length && ($(".alert").hide(), $("#errorMsgRegion").hide(), $("#successMsgRegion").html(closeButton + "File has been uploaded successfully."), $("#successMsgRegion").show()) }, progressall: function (e, o) { }, singleFileUploads: !1, send: function (e, t) { var l = t.files[0].type.split("/")[0]; if (1 == t.files.length) for (var i = 0; i < t.files.length; i++) { if (t.files[i].name.length > 50) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + "Please upload small filename."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1; if (CheckSpecialCharInFileName(t.files[i].name)) return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."), !1 } if (t.files.length > 1) for (i = 0; i < t.files.length; i++) { if (t.files[i].size > parseInt(MaxImageSize)) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + " " + t.files[i].name + " Maximum file size limit exceeded. Please upload a file smaller  than " + maxsize + "MB"), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1; if (CheckSpecialCharInFileName(t.files[i].name)) return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."), !1 } else if (t.files[0].size > parseInt(MaxImageSize)) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + "Maximum  file size limit exceeded.Please upload a  file smaller than " + maxsize + "MB"), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1; return 1 == t.files.length && "image" != l ? ($(".alert").hide(), $("#errorMsgRegion").html(closeButton + "Please upload a file with .jpg , .jpeg or .png extension."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1) : ($(".alert").hide(), $("#errorMsgRegion").html(""), $("#errorMsgRegion").hide(), $('<input type="hidden">').attr({ name: "Guid", value: o, id: o }).appendTo("form"), !0) }, formData: { userId: o }, change: function (e, o) { $("#uploadFile").val("C:\\fakepath\\" + o.files[0].name) } }).prop("disabled", !$.support.fileInput), $("#uploadBtnSerial").fileupload({ url: l, dataType: "json", done: function (e, o) { var t = []; t.length = 0; var l = []; l.length = 0; var i = []; i.length = 0; for (var s = 0; s < o.result.length; s++)if (1 == o.result[s].Status) { var a = $("#SerialNumber").length + 1, n = (o.result[s].MimeType.split("/")[0], o.result[s].FileName.replace("%", "$")); if (o.result[s].FileName.length > 20) var r = n.substring(0, 20) + "..."; else r = n; var h = "<li class='checkbox' style='margin-left:2px;'>"; h += "<label> <input type='checkbox' name='chkBtnSerial' value=\"" + n + '" >', "true" == isJobPhotoView && (h += "<a href='javascript:void(0)' style='text-decoration:none;' title=\"" + n + "\" onclick='OpenSerial(this);' class=\"" + n + '" id="' + n + '">' + r + " </a>"), "false" == isJobPhotoView && (h += "<a href='javascript:void(0)' style='text-decoration:none;' title=\"" + n + '" class="' + n + '" id="' + n + '">' + r + " </a>"), h += "</label>", h += "</li>", $("#SerialNumber").append(h); a = $("#SerialNumber li").length; $("#spanSerial").html("(" + a + ")"), $('<input type="hidden">').attr({ name: "FileNamesCreate", value: o.result[s].FileName, id: o.result[s].FileName }).appendTo("form"), totalSerialNumber += 1, OpecityOfDownloadAllPhotos($(".downloadSerialNumber"), totalSerialNumber) } else 0 == o.result[s].Status && "NotImage" == o.result[s].Message ? l.push(o.result[s].FileName) : 0 == o.result[s].Status && "BigName" == o.result[s].Message ? i.push(o.result[s].FileName) : t.push(o.result[s].FileName); return l.length > 0 ? ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + l.length + " Uploaded file is not .jpg , .jpeg or .png extension."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1) : t.length > 0 ? ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + t.length + " File has not been uploaded."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1) : i.length > 0 ? ($(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + i.length + " Uploaded filename is too big."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1) : void (0 == i.length && 0 == t.length && 0 == l.length && (a - 1 == 0 ? checkBusinessRulesForPhotos() : ($(".alert").hide(), $("#errorMsgRegion").hide(), $("#successMsgRegion").html(closeButton + "File has been uploaded successfully."), $("#successMsgRegion").show()))) }, progressall: function (e, o) { }, singleFileUploads: !1, send: function (e, t) { var l = t.files[0].type.split("/")[0]; if (1 == t.files.length) for (var i = 0; i < t.files.length; i++) { if (t.files[i].name.length > 50) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + "Please upload small filename."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1; if (CheckSpecialCharInFileName(t.files[i].name)) return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."), !1 } if (t.files.length > 1) for (i = 0; i < t.files.length; i++) { if (t.files[i].size > parseInt(MaxImageSize)) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + " " + t.files[i].name + " Maximum file size limit exceeded. Please upload a file smaller  than " + maxsize + "MB"), $("#errorMsgRegion").show(), !1; if (CheckSpecialCharInFileName(t.files[i].name)) return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."), !1 } else if (t.files[0].size > parseInt(MaxImageSize)) return $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + "Maximum  file size limit exceeded.Please upload a  file smaller than " + maxsize + "MB"), $("#errorMsgRegion").show(), !1; return 1 == t.files.length && "image" != l ? ($(".alert").hide(), $("#errorMsgRegion").html(closeButton + "Please upload a file with .jpg , .jpeg or .png extension."), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow"), !1) : ($(".alert").hide(), $("#errorMsgRegion").html(""), $("#errorMsgRegion").hide(), $('<input type="hidden">').attr({ name: "Guid", value: o, id: o }).appendTo("form"), !0) }, formData: { userId: o }, change: function (e, o) { $("#uploadFile").val("C:\\fakepath\\" + o.files[0].name) } }).prop("disabled", !$.support.fileInput).parent().addClass($.support.fileInput ? void 0 : "disabled") }), $("#btnClosePopUpPhotoBox").click(function () { $("#popupPhotoBox").modal("toggle") }), $("#btnClosePopUpSerialBox").click(function () { $("#popupSerialBox").modal("toggle") });