function setFiles(e,t,a){var o=e;o.html(""),o.attr("totalCount",t.length);for(var n=0;n<t.length;n++){var i=$("<tr/>").data("data",t[n]).data("path",t[n].Path).data("id",t[n].JobDocumentId);i.addClass("job-document-"+t[n].JobDocumentId),"CES"==a&&(i.attr("id","ces_"+t[n].JobDocumentId),params="'CES','','','"+t[n].Path+"','0','ces_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'"),"OTHER"==a&&(i.attr("id","other_"+t[n].JobDocumentId),i.attr("isreczip",t[n].IsRecZip),params="'OTHER','','','"+t[n].Path+"','0','other_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'"),i.appendTo(o);$("<td/>").css("width","2%").appendTo(i);if(null==t[n].IsSPVXml||!t[n].IsSPVXml||null==t[n].IsRecZip||!t[n].IsRecZip||(t[n].IsRecZip||t[n].IsSPVXml)&&("1"==USERType||"3"==USERType)){var d=$("<td/>").appendTo(i);if("CES"==a)$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","CES Document").attr("class","document-color").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocumentonPage("+params+")").text(t[n].Path.split("\\").pop()).appendTo(d);if("OTHER"==a)$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","Other Document").attr("class","document-color").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocumentonPage("+params+")").text(t[n].Path.split("\\").pop()).appendTo(d);var s=$("<td/>").addClass("action").appendTo(i)}s=$("<td/>").addClass("action").appendTo(i);if("CES"==a){params="'CES','','','"+t[n].Path+"','0','ces_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var l=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocument("+params+")").appendTo(s);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(l,0)}if(null==t[n].IsSPVXml||!t[n].IsSPVXml||null==t[n].IsRecZip||!t[n].IsRecZip||(t[n].IsRecZip||t[n].IsSPVXml)&&("1"==USERType||"3"==USERType)){if("OTHER"==a){params="'OTHER','','','"+t[n].Path+"','0','other_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var r=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("data-filename",t[n].Path.split("\\").pop()).attr("title","Signature Mail").data("type",a).attr("onclick","viewDocument("+params+")").appendTo(s);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(r,0)}if(t[n].IsRecZip||t[n].IsSPVXml)$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("onclick","onclick=DownloadJobDocuments("+t[n].JobDocumentId+")").appendTo(s);else $("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t[n].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t[n].JobDocumentId+",0)>Download final</a>").appendTo(s);$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(s)}1!=t[n].IsRecZip&&1!=t[n].IsSPVXml||"1"==USERType||"3"==USERType||$("#other_"+t[n].JobDocumentId).remove()}"CES"==a&&0==$(e).children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):"CES"==a&&$(e).children().length>0&&($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),PopoverEnable();var c=$("#STCStatusId").val();"1"!=USERType&&"3"!=USERType&&"10"!=c&&"12"!=c&&"14"!=c&&"17"!=c&&$("#tbodyCES .delete").hide()}function generateDocument(e,t,a,o,n,i,d){var s=$("#divDocumentsSTC").find("table").find("#"+i).data("data");if(eJobId){var l=!0;l&&($("#loading-image").show(),$.ajaxSetup({async:!0,cache:!1}),$.get(urlGenerateDocument+"?id="+eJobId+"&documentId=0&stage="+s.Stage+"&state=&provName=&name="+encodeURIComponent(s.Path)+"&isDeleteFirst="+$("tr#"+i).find(".hdnIsUpload").attr("val")+"&isClassic=false&jobDocumentId="+s.JobDocumentId,"",function(e){showMessage("Document has been generated successfully.",!1,"STC"),SearchHistory()}))}}function downloadDocument(e,t,a,o,n,i,d,s){var l=$("#divDocumentsSTC").find("table").find("#"+i).data("data");return eJobId&&$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&(window.location.href=urlDownloadSTCDocument+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(l.Path)+"&isEditable="+s),$(".pop").popover("hide"),SearchHistory(),!1}function uploadDocument(e,t,a,o,n,i){if(eJobId){var d=!0;d&&($(".fileUpload1").unbind("fileuploadsubmit").bind("fileuploadsubmit",function(i,d){d.formData={id:eJobId,documentid:n,stage:e,state:t,provName:a,name:o,isClassic:!1}}),doneCallBack=function(){"STC"==e?($("#divDocumentsSTC").find(".table-responsive").show(),$("#trDoc_1").css("display",""),$("#divDocumentsSTC").find(".noDocument").hide()):(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+obj,!1,!1))},$(".fileUpload1").click())}return!1}function doneCallBack(){getDocuments(!0)}function checkBusinessRulesForDocument(e){var t=CommonDataForSave();$.ajax({url:urlCheckBusinessRulesTabular,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:t,success:function(t){t.IsSuccess?(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+e,!1,!1),null!=t.STCStatusName&&null!=t.STCStatusName&&""!=t.STCStatusName&&$("#spanSTCStatus").text(t.STCStatusName.trim()),null!=t.STCDescription&&null!=t.STCDescription&&""!=t.STCDescription&&$("#STCDescription").html(t.STCDescription.trim()),null!=t.STCStatusId&&null!=t.STCStatusId&&""!=t.STCStatusId&&$("#STCStatusId").val(t.STCStatusId.trim())):t.IsError&&(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+e,!1,!1))}})}function deleteDocument(e,t,a,o,n,i){var d=$("#divDocumentsSTC").find("table").find("#"+i).data("data");eJobId&&$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&confirm("Are you sure you want to delete this file ?")&&($.ajaxSetup({async:!1,cache:!1}),$.get(urlDeleteDocument+"?id="+eJobId+"&documentId="+n+"&stage="+e+"&state="+t+"&provName="+a+"&name="+o+"&isClassic=false&jobDocumentPath="+d.Path+"&jobDocumentId="+d.JobDocumentId,"",function(t){"STC"==e&&($("#divDocumentsSTC").find("table").find("#"+i).remove(),$("#divDocumentsSTC").find("table").find("tr")&&$("#divDocumentsSTC").find("table").find("tr").length>0?($("#divDocumentsSTC").find(".table-responsive").show(),$("#divDocumentsSTC").find(".noDocument").hide()):($("#divDocumentsSTC").find(".table-responsive").hide(),$("#divDocumentsSTC").find(".noDocument").show(),$("#loading-image").show(),setTimeout(function(){ReloadSTCJobScreen(eJobId)},500))),showMessage("Document has been deleted successfully.",!1,"STC"),SearchHistory()}))}function showMessage(e,t,a){var o,n;$(".alert").hide(),"CES"==a.toUpperCase()?(o=t?"errorMsgRegionCES":"successMsgRegionCES",n=t?"successMsgRegionCES":"errorMsgRegionCES"):"STC"==a.toUpperCase()?(o=t?"errorMsgRegionSTC":"successMsgRegionSTC",n=t?"successMsgRegionSTC":"errorMsgRegionSTC"):"OTHER"==a.toUpperCase()&&(o=t?"errorMsgRegionOther":"successMsgRegionOther",n=t?"successMsgRegionOther":"errorMsgRegionOther"),$("#"+n).hide(),$("#"+o).html(closeButton+e),$("#"+o).show()}function OpacityIncreaseDecrease(e,t){t>0?(e.css("opacity","1"),e.css("pointer-events","visible")):(e.css("opacity","0.5"),e.css("pointer-events","none"))}function setViewIcon(e,t,a){var o=t?"":"disView",n=t?"disView":"",i=t?"":"notdownload",d=t?"notdownload":"",s=t?"":"semiBold",l=t?"semiBold":"";$(e).find(".view").removeClass(o).addClass(n).addClass("sprite-img"),$(e).find(".download_doc").removeClass(i).addClass(d),$(e).find(".delete").removeClass(o.replace("View","Delete")).addClass(n.replace("View","Delete")),$(e).find(".tdDoc").removeClass(l).addClass(s),$(e).find(".hdnIsExists").attr("val",t?"0":"1"),$(e).find(".hdnIsUpload").attr("val",a?"1":"0")}function assignEvent(){$("#loading-image").show();var e=BaseURL+"UploadDocument";e=e.replace("Index/",""),$("#btnUploadSTCDocument").fileupload({url:e,dataType:"json",done:function(e,t){doneCallBack&&(showMessage("Document has been Uploaded successfully.",!1,"STC"),accordiantabName="STC",doneCallBack()),SearchHistory()},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){var a=t.files[0].type.split("/"),o=a[0];if(t.files.length>1)for(var n=0;n<t.files.length;n++){if(t.files[n].size>parseInt(ProjectSession_MaxImageSize))return showMessage(" "+t.files[n].name+" Maximum document size limit exceeded. Please upload a file smaller  than "+maxsize+"MB.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[n].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}else{if(t.files[0].size>parseInt(ProjectSession_MaxImageSize))return showMessage("Maximum  document size limit exceeded.Please upload a  file smaller than "+maxsize+"MB.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[0].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}if(1==t.files.length){var i=t.files[0].name.toLowerCase().split(".").length>0?t.files[0].name.toLowerCase().split(".")[t.files[0].name.toLowerCase().split(".").length-1]:"";if("application/pdf"!=t.files[0].type&&"pdf"!=i&&"image"!=o&&"heic"!=i)return showMessage("Please upload a document with .pdf extension or image file.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[0].name))return showMessage(" "+t.files[n].name+"Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}return!0},formData:{id:eJobId,stage:"STC",isClassic:!1},change:function(e,t){}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function isImage(e){return imageTypes.indexOf(e.toLowerCase().split(".").pop())>-1}function ViewPhotoDoc(e){e=UploadedDocumentPath+e,$("#loading-image").css("display",""),$("#imgDocImage").attr("src",e).load(function(){logoWidthDoc=this.width,logoHeightDoc=this.height,$("#popupViewer").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeightDoc?($("#imgDocImage").closest("div").height($(window).height()-205),$("#imgDocImage").closest("div").css("overflow-y","scroll"),$("#imgDocImage").height(logoHeightDoc)):($("#imgDocImage").height(logoHeightDoc),$("#imgDocImage").closest("div").removeAttr("style")),screen.width<=logoWidthDoc||logoWidthDoc>=screen.width-250?($("#popupViewer").find(".modal-dialog").width(screen.width-250),$("#imgDocImage").width(logoWidthDoc)):($("#imgDocImage").width(logoWidthDoc),$("#popupViewer").find(".modal-dialog").width(logoWidthDoc)),$("#loading-image").css("display","none")}),$("#popupViewer").unbind("error"),$("#imgDocImage").attr("src",e).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}function deleteFile(e,t,a){e.data("id"),e.data("path");var o=JobId,n={id:e.data("id"),path:e.data("path"),deleteFile:t,JobId:o};confirm("Are you sure you want to delete this file ?")&&deleteDoc(n).then(function(t){t?(e.remove(),"CES"==a&&(0==$("#tbodyCES").children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),0==$("#tbodyCES").find("tr").length&&ReloadSTCModule()),"Other"==a&&(0==$('tr[isreczip="true"]').length?$("#onOffSwitchGenerateRecZip").prop("checked",!1):$("#onOffSwitchGenerateRecZip").prop("checked",!0)),SearchHistory(),showMessage("File has been deleted Successfully.",!1,a)):showMessage("There is some error while deleting file.",!0,a)})}function DownloadJobDocuments(e,t){$.ajax({type:"GET",url:urlCheckJobDocuments,dataType:"json",async:!1,data:{jobDocId:e,isEditable:t},success:function(a){a.status?window.location.href=urlDownloadJobDocuments+"?jobDocId="+e+"&isEditable="+t:alert("File not exists!!!")},error:function(e){alert("File not exists")}});urlCheckJobDocuments;$(".pop").popover("hide"),SearchHistory()}function deleteDoc(e){return new Promise(function(t){$.ajaxSetup({async:!1,cache:!1}),$.post(urlDeleteDocumentNew,e,function(e){t(e)})})}function PopoverEnable(e){void 0!==e&&(e=e||window.event,e.preventDefault()),$(".pop").popover("hide"),$(".pop").popover({html:!0})}function ShowDocumentSendSignateReuqest(e,t="STC"){$("#SendMailDocumentSignatureRequest").modal({backdrop:"static",keyboard:!1}),$("#JobDocumentPreview").load(urlDocumentPreview+"?jobdocid="+e+"&type=0")}function ShowPopupForEmailTamplete(e){$("#DocumentSignatureRequestTableBody input[type='checkbox']:checked").length>0?(SelectedUsersForSendMailRequestForDocumentSignature=[],$("#DocumentSignatureRequestTableBody input[type='checkbox']:checked").each(function(e,t){"ChkInstaller"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(2):"ChkDesigner"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(4):"ChkElectrician"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(3):"ChkHomeOwner"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(1):"ChkSolarCompany"==$(t).attr("id")&&SelectedUsersForSendMailRequestForDocumentSignature.push(6)}),FillDropDown("lstEmailTemplate",urlGetEmailTemplateList,null,!0,null),$("#SendMailDocumentSignatureRequest").modal("toggle"),$("#popupSendEmailForBulkSignature").modal({backdrop:"static",keyboard:!1})):alert("Please select any one option.")}function sendEmailForSignatureRequest(){if(""!=$("#lstEmailTemplate").val()){var e={};$.ajax({url:urlSendEmailForSignatureRequest,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({sendEmailRequest:e,emailTemplateId:$("#lstEmailTemplate").val(),jobDocId:$("#SendMailDocumentSignatureRequest").attr("jobdocid"),typesList:SelectedUsersForSendMailRequestForDocumentSignature}),success:function(e){$("#popupSendEmailForBulkSignature").modal("toggle"),$("#loading-image").hide(),SearchHistory()},error:function(){}})}else alert("please select email template ")}function ToggleModelPopup(e){$(e).modal("toggle")}function fnDocViewerOuterPopup(){$("#DocViewerOuterPopup").html(""),$("#DocViewerOuterPopup").load(urlDocViewerOuterPopup)}function viewimgonDocPage(e){$("#imgonPageview").attr("src",e),$("#onpagedivViewer").css("border","18px solid #f0f0f0"),$("#onpagedivViewer").html(""),$("#onpagedivViewer").append('<div class="row" id="showphotoOnPage">'),$('<img style="width: 100%;"/>').attr("src",""+e).attr("alt","").appendTo($("#showphotoOnPage")),$("#onpagedivViewer").show(),$("#docActionSection").css("visibility","visible")}function viewDocumentonPage(e,t,a,o,n,d,s){$("#showphotoOnPage").hide(),$("#onpageViewerDoc").show();var l,r,c;$("#STCStatusId").val();if($("#btnSendRequest").show(),d.indexOf("trDoc")>-1?(l=$("#divDocumentsSTC").find("table").find("#"+d).data("data"),r=$("#divDocumentsSTC").find("table").find("#"+d).find("td").html(),c=$("#divDocumentsSTC").find("table").find("#"+d).find("td").find("a").data("filename")):d.indexOf("ces")>-1?(l=$("#tbodyCES #"+d).data("data"),r=$("#tbodyCES #"+d).find("td:eq(1)").html(),c=$("#tbodyCES #"+d).find("td:eq(1)").find("a").data("filename")):d.indexOf("other")>-1&&(l=$("#tbodyOther #"+d).data("data"),r=$("#tbodyOther #"+d).find("td:eq(1)").html(),c=$("#tbodyOther #"+d).find("td:eq(1)").find("a").data("filename")),r=decodeURI(r),null!=r){if(null==l||"undefined"==l){var u=o.split("\\").slice(o.split("\\").length-1);c=u[0]}if(null!=r&&"undefined"!=r&&isImage(c))r=uploadPath+l.Path,viewimgonDocPage(r),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#ddlviewdocumentsName").val(s);else if(null!=l&&"undefined"!=l||!isImage(c)){if($("#docActionSection").css("visibility","hidden"),$("#onpageViewerDoc").data("data",null),$("#onpageViewerDoc").data("data",l),$("#onpageViewerDoc").attr("data-hdnIsUpload",$("tr#"+d).find(".hdnIsUpload").attr("val")),eJobId){$("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1,success:function(){$("#"+PreviousActive).css("background-color",""),$("#"+d).css("background-color","#ebdb9f"),$("#ddlviewdocumentsName").val(s),$("#lblOpenDocumentName").text(": "+$("tr#"+d).find(".document-signature-send-request").attr("data-filename"))}}),JobDocumentName=$("tr#"+d).find(".document-signature-send-request").attr("data-filename"),$("#onpagedivViewer").css("border","18px solid #f0f0f0"),null==l?$("#onpagedivViewer").load(url_OnPageViewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(o)+"&jobDocumentId="+s):$("#onpagedivViewer").load(url_OnPageViewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(l.Path)+"&jobDocumentId="+s),$("#onpageViewerDoc").find(".doc-title span").html(JobDocumentName);$("tr#"+d).find(".document-signature-send-request")}}else c=o.split("\\").slice(o.split("\\").length-1),r=uploadPath+o,viewimgonDocPage(r),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#ddlviewdocumentsName").val(s);$.get(urlGetDocumentsddlListAll+"?id="+JobId+"&distributorID="+DistributorId+"&stage=stc&jobTypeId=1","",function(e){var t=htmlDecode(e),a=JSON.parse(t),o=a.Table;$.each(o,function(e,t){if(t.JobDocumentId==s){i=e,$("#"+PreviousActive).css("background-color",""),$("#"+d).css("background-color","#ebdb9f"),$("#ddlviewdocumentsName").val(s),$("#lblOpenDocumentName").text(": "+$("tr#"+d).find(".document-signature-send-request").attr("data-filename"));var a=i-1,n=i+1;0==i?a=o.length-1:i==o.length-1&&(n=0),o[n].JobDocumentId>0&&("CES"==o[n].Type?$("#forward-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[n].Path)+'",0,"ces_'+o[n].JobDocumentId+'","'+o[n].JobDocumentId+'");'):"STC"==o[n].Type?$("#forward-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[n].Path)+'",0,"trDoc_'+e+'","'+o[n].JobDocumentId+'");'):"OTHER"==o[n].Type&&$("#forward-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[n].Path)+'",0,"other_'+o[n].JobDocumentId+'","'+o[n].JobDocumentId+'");')),o[a].JobDocumentId>0&&("CES"==o[a].Type?$("#backwards-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[a].Path)+'",0,"ces_'+o[a].JobDocumentId+'","'+o[a].JobDocumentId+'");'):"STC"==o[a].Type?$("#backwards-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[a].Path)+'",0,"trDoc_'+e+'","'+o[a].JobDocumentId+'");'):"OTHER"==o[a].Type&&$("#backwards-icon-doc").attr("onclick",'viewDocumentonPage("","","","'+replacestrings(o[a].Path)+'",0,"other_'+o[a].JobDocumentId+'","'+o[a].JobDocumentId+'");'))}})})}PreviousActive=d}function replacestrings(e){for(var t="\\",a="\\\\",o="",n=0;n<e.length;){var i=e.indexOf(t,n);if(-1===i){o+=e.substring(n);break}o+=e.substring(n,i)+a,n=i+t.length}return o}function viewDocument(e,t,a,o,n,i,d){var s,l,r=$("#STCStatusId").val();if($("#btnSendRequest").show(),i.indexOf("trDoc")>-1?(s=$("#divDocumentsSTC").find("table").find("#"+i).data("data"),l=$("#divDocumentsSTC").find("table").find("#"+i).find("td").html(),1==USERType||3==USERType||"True"==isSaveDocAfterTradeJob||"10"==r||"12"==r||"14"==r||"17"==r?$("#popupViewerDoc #btnSave").show():$("#popupViewerDoc #btnSave").hide()):i.indexOf("ces")>-1?(s=$("#tbodyCES #"+i).data("data"),l=$("#tbodyCES #"+i).find("td:eq(1)").html(),1==USERType||3==USERType||"True"==isSaveDocAfterTradeJob||"10"==r||"12"==r||"14"==r||"17"==r?$("#popupViewerDoc #btnSave").show():$("#popupViewerDoc #btnSave").hide()):i.indexOf("other")>-1&&(s=$("#tbodyOther #"+i).data("data"),l=$("#tbodyOther #"+i).find("td:eq(1)").html(),$("#popupViewerDoc #btnSave").show()),l=decodeURI(l),isImage(l))viewimgonDocPage(l),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#hdrFileName").text(s.Path.split("\\").slice(s.Path.split("\\").length-1));else if($("#popupViewerDoc").data("data",null),$("#popupViewerDoc").data("data",s),$("#popupViewerDoc").attr("data-hdnIsUpload",$("tr#"+i).find(".hdnIsUpload").attr("val")),eJobId){i.indexOf("trDoc")>-1?$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),JobDocumentName=$("tr#"+i).find(".document-signature-send-request").attr("data-filename"),$("#divViewer").load(url_Viewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(s.Path)+"&jobDocumentId="+d),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),$("#popupViewerDoc").find(".modal-title span").html(JobDocumentName),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide()):($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),JobDocumentName=$("tr#"+i).find(".document-signature-send-request").attr("data-filename"),$("#divViewer").load(url_Viewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(s.Path)+"&jobDocumentId="+d),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),$("#popupViewerDoc").find(".modal-title span").html(JobDocumentName),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide());$("tr#"+i).find(".document-signature-send-request")}}function viewDocumeneCES(e){e&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),$("#divViewer").load(url_Viewer+"?path="+e),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide())}function viewDocumentOther(e,t){eJobId&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),$("#divViewer").load(url_DocViewer+"?jobDocId="+e+"&jobid="+eJobId),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide())}function getDocuments(e){$.get(urlGetDocumentsListAll+"?id="+JobId+"&distributorID="+DistributorId+"&stage=stc&jobTypeId=1","",function(t){LoadDocuments(t,e)})}function htmlDecode(e){var t=(new DOMParser).parseFromString(e,"text/html");return t.documentElement.textContent}function ViewPreviousNextDoc(e,t,a,o,n,i,d){var s="";"Select"!=$("#ddlviewdocumentsName").find(":selected").html()&&(s=$("#ddlviewdocumentsName").find(":selected").attr("data-path")),viewDocumentonPage(e,"","",s,0,i,d)}function LoadDocuments(e,t,a){if(e){var o=htmlDecode(e),n=JSON.parse(o),i=n.Table,d=(n.Table1,i.filter(e=>"CES"===e.Type)),s=i.filter(e=>"STC"===e.Type),l=i.filter(e=>"OTHER"===e.Type),r=($("#tbodyCES"),$("#tbodySTC")),c=$("#tbodyOther");if("CES"==accordiantabName)setFiles($("#tbodyCES"),d,"CES");else if("OTHER"==accordiantabName)setFiles(c,l,"OTHER");else if("STC"==accordiantabName)if(s.length>0){$("#divDocumentsSTC").find("table").find("tr")&&$("#divDocumentsSTC").find("table").find("tr").length>0&&$("#divDocumentsSTC").find("table").find("tr").remove();for(var u=0;u<s.length;u++){var p=s[u];p.Stage="STC";var m=p.Name||p.Path.split("\\").pop();p.Name=m,p.IsExist=!0;var h="'"+p.Stage+"','','','"+escape(p.Path)+"','0','trDoc_"+u+"','"+p.JobDocumentId+"'",f=(p.Stage,escape(p.Path),p.Id,p.DocumentId,$("<td>").attr("class","action")),D="";1==p.IsCompleted?D="document-status-green":1==p.SentEmailStatus&&(D="document-status-orange"),f.append('<input type="hidden" class="hdnIsExists" val="'+(1==p.IsExist?1:0)+'" />').append('<input type="hidden" class="hdnIsUpload" val="'+(1==p.isUpload?1:0)+'" />');var g="True"==isJobDocumentManagerSignatureMail?'<a href="javascript:void(0);" class="'+D+' icon sprite-img email-ic document-signature-send-request" data-filename="'+p.Name+'" onclick="viewDocument('+h+');" title = "Signature Mail">':"";f.append(g),g="True"==isJobDocumentManagerGenerate?'<a class="ganret sprite-img" href="javascript:void(0);"onclick="generateDocument('+h+');" title="Generate">':"",f.append(g),g="True"==isJobDocumentManagerView?'<a class="sprite-img download pop '+(p.IsExist&&1==p.IsExist?"":"notdownload")+'" href="javascript:void(0);" data-container="body" data-toggle="popover" data-placement="bottom" data-content="<a href=&quot;javascript:void(0);&quot; class=&quot;editable-pdf pdf-down&quot; onclick=&quot;downloadDocument('+h+",1)&quot;>Download edit</a><a href=&quot;javascript:void(0);&quot; class=&quot;non-editable-pdf pdf-down&quot; onclick=&quot;downloadDocument("+h+',0)&quot;>Download final</a>">':"",f.append(g),g="True"==isJobDocumentManagerDelete?'<a class="delete sprite-img'+(p.IsExist&&1==p.IsExist?"":"disDelete")+'" href="javascript:void(0);"onclick="deleteDocument('+h+');" title="Delete">':"",f.append(g);var b=$('<td class="tdDoc '+(p.IsExist&&p.IsExist,"")+'">').attr("style","text-align:left!important;word-break: break-all; padding-left:4%"),v=($("<a/>").attr("href","javascript:void(0);").attr("title","STC Document").attr("class","document-color").attr("data-filename",p.Name).attr("role","button").attr("onclick","viewDocumentonPage("+h+")").text(p.Name).appendTo(b),$('<tr id="trDoc_'+u+'" class="job-document-'+p.JobDocumentId+'" >').append(b).append(f));v.data("data",p),imageTypes.indexOf($(v).find("td").html().toLowerCase().split(".").pop())>-1&&OpacityIncreaseDecrease($(v).find(".ganret"),0),r.append(v),t&&BindddlForSTCUploadCreate(p.JobDocumentId,p.Path,p.Name,u),$("#divDocumentsSTC").find(".table-responsive").show(),$("#divDocumentsSTC").find(".noDocument").hide()}t&&$("#divDocumentsSTC").find("table").find("tr")&&1==$("#divDocumentsSTC").find("table").find("tr").length&&($("#loading-image").show(),setTimeout(function(){ReloadSTCJobScreen(eJobId)},500))}else $("#divDocumentsSTC").find(".table-responsive").hide(),$("#divDocumentsSTC").find(".noDocument").show()}assignEvent(),PopoverEnable()}function DownloadGPSLogFiles(){window.location.href=urlDownloadGPSLogs+"?jobId="+JobId}function ClearHighLight(e){"liDocs"==e?($("#liPhotos").css({"font-weight":""}),$("#liPhotos > span").css({"font-weight":""}),$("#liSerials").css({"font-weight":""}),$("#liSerials > span").css({"font-weight":""}),$("#liSummary").css({"font-weight":""})):"liPhotos"==e?($("#liDocs").css({"font-weight":""}),$("#liDocs > span").css({"font-weight":""}),$("#liSerials").css({"font-weight":""}),$("#liSerials > span").css({"font-weight":""}),$("#liSummary").css({"font-weight":""})):"liSerials"==e?($("#liDocs").css({"font-weight":""}),$("#liDocs > span").css({"font-weight":""}),$("#liPhotos").css({"font-weight":""}),$("#liPhotos > span").css({"font-weight":""}),$("#liSummary").css({"font-weight":""})):"liSummary"==e&&($("#liDocs").css({"font-weight":""}),$("#liDocs > span").css({"font-weight":""}),$("#liPhotos").css({"font-weight":""}),$("#liPhotos > span").css({"font-weight":""}),$("#liSerials").css({"font-weight":""}),$("#liSerials > span").css({"font-weight":""}))}function LoadddlDocumentList(e){if(e){var t=htmlDecode(e),a=JSON.parse(t),o=a.Table,n=(a.Table1,o.filter(e=>"CES"===e.Type)),i=o.filter(e=>"STC"===e.Type),d=o.filter(e=>"OTHER"===e.Type);isCESLoaded||($.each(n,function(e,t){var a=t.Path.split("\\"),o=a[a.length-1];$("#ddlviewdocumentsName").append($("<option></option>").val(t.JobDocumentId).attr("data-id","ces_"+t.JobDocumentId).attr("data-path",t.Path).html(o))}),isCESLoaded=!0),isOtherLoaded||($.each(d,function(e,t){var a=t.Path.split("\\"),o=a[a.length-1];$("#ddlviewdocumentsName").append($("<option></option>").val(t.JobDocumentId).attr("data-id","other_"+t.JobDocumentId).attr("data-path",t.Path).html(o))}),isOtherLoaded=!0),isSTCLoaded||($.each(i,function(e,t){var a=t.Path.split("\\"),o=a[a.length-1];$("#ddlviewdocumentsName").append($("<option></option>").val(t.JobDocumentId).attr("data-id","trDoc_"+e).attr("data-path",t.Path).html(o))}),isSTCLoaded=!0)}}function CallddlListOnTabLoad(){$.get(urlGetDocumentsddlListAll+"?id="+JobId+"&distributorID="+DistributorId+"&stage=stc&jobTypeId=1","",function(e){LoadddlDocumentList(e)})}function BindddlForSTCUploadCreate(e,t,a,o){$("#ddlviewdocumentsName").append($("<option></option>").val(e).attr("data-id","trDoc_"+o).attr("data-path",t).html(a))}var logoHeightDoc,logoWidthDoc,accordiantabName="",isaccordianLoaded=!1,isSTCLoaded=!1,isCESLoaded=!1,isOtherLoaded=!1,PreviousActive="";$("#btnUploadCESDocument").click(function(e){e.preventDefault(),document.getElementById("uploadCESBtnDocument").click()}),$("#btnCreateCESDocument").click(function(e){typeOfFile="CES",e.preventDefault(),$("#mdlcreateDocsConfirm").show(),$("#mdlcreateDocsExist").hide(),$("#mdlcreateDocs").hide(),$("#popupDocumentCreateConfirmTabular").modal("show")}),$("#btnCreateCESPdf").click(function(e){var t=[],a=[];$("[data-folder=CES]").each(function(e,o){t.push($(this).attr("data-cid")),a.push($(this).attr("data-nm"))});var o=[],n=[];$("#tbodyCES").children().each(function(e,t){o.push($(this).data("id")),n.push($(this).data("path"))});var i={checkListIds:t,JobId:JobId,UserId:USERID,type:"2",pdfname:a,docid:o,docpath:n};$.ajax({url:urlUploadCESPdf,data:JSON.stringify(i),contentType:"application/json",dataType:"json",method:"post",success:function(e){getDocuments(!1)}})}),$("#uploadCESBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){$("#loading-image").show();var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyCES"),d=0;d<t.result.length;d++){if(1==t.result[d].Status){var s="JobDocuments\\"+JobId+"\\CES\\"+t.result[d].FileName,l=t.result[d].FileName;$("#ddlviewdocumentsName").append($("<option></option>").val(t.result[d].AttachmentID).attr("data-id","ces_"+t.result[d].AttachmentID).attr("data-path",s).html(l));var r=$("<tr/>").data("data",t.result[d]).data("path",s).data("id",t.result[d].AttachmentID).attr("id","ces_"+t.result[d].AttachmentID).addClass("job-document-"+t.result[d].AttachmentID).appendTo(i),c=($("<td/>").css("width","2%").appendTo(r),$("<td/>").appendTo(r)),u=($("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","CES Document").attr("class","document-color").attr("data-filename",t.result[d].Path.split("\\").pop()).attr("onclick",'viewDocumentonPage("CES","","","'+s+'",0,"ces_'+t.result[d].AttachmentID+'","'+t.result[d].AttachmentID+'");').text(t.result[d].FileName).appendTo(c),$("<td/>").addClass("action").appendTo(r),$("<td/>").addClass("action").appendTo(r)),p=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",t.result[d].FileName).attr("onclick",'viewDocument("CES","","","'+s+'",0,"ces_'+t.result[d].AttachmentID+'","'+t.result[d].AttachmentID+'");').appendTo(u);allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(p,0);$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[d].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[d].AttachmentID+",0)>Download final</a>").appendTo(u)
;if("1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(u)}else 0==t.result[d].Status&&"File Type Not Allowed."==t.result[d].Message?n.push(t.result[d].FileName):0==t.result[d].Status&&"BigName"==t.result[d].Message?o.push(t.result[d].FileName):a.push(t.result[d].FileName);PopoverEnable(),0==i.children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),1==$("#tbodyCES").find("tr").length&&ReloadSTCModule()}return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"CES"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"CES"),!1):(showMessage("File has been uploaded successfully.",!1,"CES"),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"CES"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"CES"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"CES"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"CES"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"CES"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"CES"},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#uploadOthreBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyOther"),d=0;d<t.result.length;d++)if(1==t.result[d].Status){var s="JobDocuments\\"+JobId+"\\OTHER\\"+t.result[d].FileName,l=t.result[d].FileName;$("#ddlviewdocumentsName").append($("<option></option>").val(t.result[d].AttachmentID).attr("data-id","ces_"+t.result[d].AttachmentID).attr("data-path",s).html(l));var r=$("<tr/>").data("data",t.result[d]).data("path",s).data("id",t.result[d].AttachmentID).attr("id","other_"+t.result[d].AttachmentID).addClass("job-document-"+t.result[d].AttachmentID).appendTo(i),c=($("<td/>").css("width","2%").appendTo(r),$("<td/>").appendTo(r)),u=($("<a/>").attr("href","javascript:void(0);").attr("title","Other Document").attr("class","document-color").attr("role","button").attr("data-filename",t.result[d].Path.split("\\").pop()).attr("onclick","viewDocumentonPage('OTHER','','','"+encodeURIComponent(s)+"',0,'other_"+t.result[d].AttachmentID+"','"+t.result[d].AttachmentID+"');").text(t.result[d].FileName).appendTo(c),$("<td/>").addClass("action").appendTo(r),$("<td/>").addClass("action").appendTo(r)),p=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",t.result[d].FileName).attr("onclick","viewDocument('OTHER','','','"+encodeURIComponent(s)+"',0,'other_"+t.result[d].AttachmentID+"','"+t.result[d].AttachmentID+"');").appendTo(u);allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(p,0);$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[d].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[d].AttachmentID+",0)>Download final</a>").appendTo(u),$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(u)}else 0==t.result[d].Status&&"File Type Not Allowed."==t.result[d].Message?n.push(t.result[d].FileName):0==t.result[d].Status&&"BigName"==t.result[d].Message?o.push(t.result[d].FileName):a.push(t.result[d].FileName);return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"Other"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"Other"),!1):(showMessage("File has been uploaded successfully.",!1,"Other"),PopoverEnable(),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"Other"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"Other"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"Other"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"Other"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"Other"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"OTHER"},change:function(e,t){}}).prop("disabled",!$.support.fileInput),$("#btnSTCDocument").click(function(e){e.preventDefault(),assignEvent(),document.getElementById("btnUploadSTCDocument").click()}),$("#btnCreateDoc").click(function(e){typeOfFile="other",e.preventDefault(),$("#mdlcreateDocsConfirm").show(),$("#mdlcreateDocsExist").hide(),$("#mdlcreateDocs").hide(),$("#popupDocumentCreateConfirmTabular").modal("show")}),$("#ddlCatCreateDoc").change(function(){this.value&&this.value>0&&$.get(urlGetDocumentsByStateId+"?stateId="+this.value,function(e){var t=$("#tbodyItemsCreateDoc");if(t.html(""),e)for(var a=JSON.parse(e).Table,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({name:a[o].Name,path:a[o].Path}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),d=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox">'+a[o].Name;d.html(s)}})}),$("#btnAddDocTabular").click(function(e){e.preventDefault();var t=$("#tbodyItemsCreateDoc").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),TemplateName:n.data("name")})}var i={jobId:JobId,docs:a,UserId:USERID,fillData:$("#ddlFillData").val(),UseNewDocTemplate:!1,type:typeOfFile};$.post(urlAddOtherDocuments,i,function(e){if(e){$tbody=$("#tbodyOther"),"ces"==typeOfFile.toLowerCase()&&($tbody=$("#tbodyCES"));for(var t=e.filter(e=>0===e.JobDocumentId),a=e.filter(e=>0!=e.JobDocumentId),o=0;o<a.length;o++){var n=$("<tr/>").data("data",a[o]).data("path",a[o].Path).data("id",a[o].JobDocumentId);"CES"==typeOfFile.toUpperCase()&&n.attr("id","ces_"+a[o].JobDocumentId),"OTHER"==typeOfFile.toUpperCase()&&n.attr("id","other_"+a[o].JobDocumentId),n.addClass("job-document-"+a[o].JobDocumentId),n.appendTo($tbody);$("<td/>").css("width","2%").appendTo(n);if("CES"==typeOfFile.toUpperCase()){$("#ddlviewdocumentsName").append($("<option></option>").val(a[o].JobDocumentId).attr("data-id","ces_"+a[o].JobDocumentId).attr("data-path",a[o].Path).html(a[o].name));var i=$("<td/>").appendTo(n);$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","CES Document").attr("class","document-color").attr("data-filename",a[o].Path).attr("onclick","viewDocumentonPage('CES','','','"+a[o].Path+"',0,'ces_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").text(a[o].name).appendTo(i)}if("OTHER"==typeOfFile.toUpperCase()){$("#ddlviewdocumentsName").append($("<option></option>").val(a[o].JobDocumentId).attr("data-id","other_"+a[o].JobDocumentId).attr("data-path",a[o].Path).html(a[o].name));i=$("<td/>").appendTo(n),$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","OTHER Document").attr("class","document-color").attr("data-filename",a[o].Path).attr("onclick","viewDocumentonPage('OTHER','','','"+a[o].Path+"',0,'other_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").text(a[o].name).appendTo(i)}$("<td/>").addClass("action").appendTo(n);var d=$("<td/>").addClass("action").appendTo(n);if("CES"==typeOfFile.toUpperCase())$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[o].name).attr("onclick","viewDocument('CES','','','"+a[o].Path+"',0,'ces_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(d);if("OTHER"==typeOfFile.toUpperCase()){var s=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",a[o].name).attr("onclick","viewDocument('OTHER','','','"+a[o].Path+"',0,'other_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(d);allowdViewTypes.indexOf(a[o].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(s,0)}$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",0)>Download final</a>").appendTo(d);if("1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(d)}if(t.length>0){var l="";for(o=0;o<t.length;o++)l+="- "+t[o].message+"\n";alert(l)}else showMessage("Document has been created successfully.",!1,typeOfFile);"ces"==typeOfFile.toLowerCase()&&(0==$tbody.children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),1==$("#tbodyCES").find("tr").length&&ReloadSTCModule()),PopoverEnable(),$("#popupDocumentCreateConfirmTabular").modal("hide"),SearchHistory()}})}),$("#btnClear").click(function(e){e.preventDefault()}),$("#tbodyCES,#tbodyOther").on("click",".view",function(e){e.preventDefault();var t=$(this),a=encodeURIComponent(t.closest("tr").data("path"));$("#loading-image").show(),setTimeout(function(){isImage(a)?(viewimgonDocPage(a),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#hdrFileName").text(a.split("\\").slice(a.split("\\").length-1))):viewDocumentOther(t.closest("tr").data("id"),t.data("type"))},500)}),$("#divDocumentsCES").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");deleteFile(t,!0,"CES")}),$("#tbodyOther").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");1==$('tr[isreczip="true"]').length&&$("#onOffSwitchGenerateRecZip").prop("checked",!1),deleteFile(t,!0,"Other")}),$("#btnDownloadAllCES,#btnDownloadAllOther").click(function(e){e.preventDefault();var t=$(this).data("type");$.ajax({type:"GET",url:urlisExistsDownloadAllDocumentsNew,dataType:"json",async:!1,data:{jobid:JobId,type:t},success:function(e){e.response?(alert("Files Download successful"),window.location.href=urlDownloadAllDocumentsNew+"?jobid="+JobId+"&type="+t):alert("Multiple files exists with same name")},error:function(e){alert("File not exists")}}),SearchHistory()}),$("#btnDownloadJobFullPack").click(function(e){console.log(JobId),window.location.href=urlGetFullJobPack+"?JobID="+eJobId}),$("#btnUploadOther").click(function(e){e.preventDefault(),document.getElementById("uploadOthreBtnDocument").click()}),$(document).ready(function(){$("#btnDownloadGPSLogs").click(function(e){$.ajax({type:"GET",url:urlGPSLogFilesExists,dataType:"json",async:!1,data:{jobId:JobId},success:function(e){e.status?window.location.href=urlDownloadGPSLogs+"?jobId="+JobId:alert("File not exists!!!")},error:function(e){alert("File not exists")}})}),$("#nextDocumentTemplateTabular").click(function(){if(1==$("#docTemplateIdTabular").val()){var e=0;e="ces"==typeOfFile.toLowerCase()?"true":"false",$.get(urlGetAllDocumentTemplate+"?jobTypeId="+parseInt($("#BasicDetails_JobType").val())+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&isSTC=false&isCES="+e,function(e){var t=$("#tbodyDocItemsForJobTabular");if(t.html(""),e)for(var a=e,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({path:a[o].Path,name:a[o].Path.split("/").pop(),tempName:a[o].DocumentTemplateName}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),d=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox" >'+a[o].DocumentTemplateName;d.html(s)}}),$("#mdlcreateDocsConfirm").hide(),$("#mdlcreateDocsExist").show(),$("#mdlcreateDocs").hide()}else $.get(urlGetStateList,function(e){if(e){for(var t=JSON.parse(e).Table,a="",o=0;o<t.length;o++)a+="<option value="+t[o].StateID+">"+t[o].Name+"</option>";$("#ddlCatCreateDoc").html(""),$("#ddlCatCreateDoc").append(a),$("#ddlCatCreateDoc").change()}}),$("#mdlcreateDocsConfirm").hide(),$("#mdlcreateDocsExist").hide(),$("#mdlcreateDocs").show()}),$("#btnPopupDocumentCreateConfirmtabular").click(function(){$("#popupDocumentCreateConfirmTabular").modal("toggle")}),$("#btndocumentTampleClose").click(function(){$("#DocumentTemplate").modal("toggle")}),$("#btnAddExistingDocTabular").click(function(e){e.preventDefault();var t=$("#tbodyDocItemsForJobTabular").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),TemplateName:n.data("tempName")+".pdf"})}var i={jobId:JobId,docs:a,UserId:USERID,fillData:!0,UseNewDocTemplate:!0,type:typeOfFile};$.post(urlAddOtherDocuments,i,function(e){if(e){$tbody=$("#tbodyOther"),"ces"==typeOfFile.toLowerCase()&&($tbody=$("#tbodyCES"));var t=e.filter(e=>0===e.JobDocumentId),a=e.filter(e=>0!=e.JobDocumentId);if(t.length>0){for(var o="",n=0;n<t.length;n++)o+="- "+t[n].message+"\n";alert(o)}else{for(n=0;n<a.length;n++){var i=$("<tr/>").data("data",a[n]).data("path",a[n].Path).data("id",a[n].JobDocumentId);"CES"==typeOfFile.toUpperCase()&&i.attr("id","ces_"+a[n].JobDocumentId),"OTHER"==typeOfFile.toUpperCase()&&i.attr("id","other_"+a[n].JobDocumentId),i.addClass("job-document-"+a[n].JobDocumentId),i.appendTo($tbody);$("<td/>").css("width","2%").appendTo(i);if("CES"==typeOfFile.toUpperCase()){$("#ddlviewdocumentsName").append($("<option></option>").val(a[n].JobDocumentId).attr("data-id","ces_"+a[n].JobDocumentId).attr("data-path",a[n].Path).html(a[n].name));var d=$("<td/>").appendTo(i);$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","CES Document").attr("class","document-color").attr("data-filename",a[n].Path).attr("onclick","viewDocumentonPage('CES','','','"+a[n].Path+"',0,'ces_"+a[n].JobDocumentId+"','"+a[n].JobDocumentId+"');").text(a[n].name).appendTo(d)}if("OTHER"==typeOfFile.toUpperCase()){$("#ddlviewdocumentsName").append($("<option></option>").val(a[n].JobDocumentId).attr("data-id","other_"+a[n].JobDocumentId).attr("data-path",a[n].Path).html(a[n].name));d=$("<td/>").appendTo(i),$("<a/>").attr("href","javascript:void(0);").attr("role","button").attr("title","OTHER Document").attr("class","document-color").attr("data-filename",a[n].Path).attr("onclick","viewDocumentonPage('OTHER','','','"+a[n].Path+"',0,'other_"+a[n].JobDocumentId+"','"+a[n].JobDocumentId+"');").text(a[n].name).appendTo(d)}$("<td/>").addClass("action").appendTo(i);var s=$("<td/>").addClass("action").appendTo(i);if("CES"==typeOfFile.toUpperCase())$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[n].name).attr("onclick","viewDocument('CES','','','"+a[n].Path+"',0,'ces_"+a[n].JobDocumentId+"','"+a[n].JobDocumentId+"');").appendTo(s);if("OTHER"==typeOfFile.toUpperCase()){var l=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[n].name).attr("onclick","viewDocument('OTHER','','','"+a[n].Path+"',0,'other_"+a[n].JobDocumentId+"','"+a[n].JobDocumentId+"');").appendTo(s);allowdViewTypes.indexOf(a[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(l,0)}$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[n].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[n].JobDocumentId+",0)>Download final</a>").appendTo(s);if("1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","delete").appendTo(s)}showMessage("Document has been created successfully.",!1,typeOfFile)}0==$("#tbodyCES").find("tr").length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),"ces"==typeOfFile.toLowerCase()&&1==$("#tbodyCES").find("tr").length&&ReloadSTCModule(),PopoverEnable(),$("#DocumentTemplate").modal("hide"),SearchHistory()}})})}),$("#btnCreateSTCDocument").click(function(){$.get(urlGetAllDocumentTemplate+"?jobTypeId="+parseInt($("#BasicDetails_JobType").val())+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&isSTC=true",function(e){var t=$("#tbodySTCItems");if(t.html(""),e)for(var a=e,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({path:a[o].Path,name:a[o].Path.split("/").pop(),tempName:a[o].DocumentTemplateName}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),d=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox">'+a[o].DocumentTemplateName;d.html(s)}}),$("#CrateSTCDocument").modal("show")}),$("#btnAddSTCExistingDoc").click(function(e){e.preventDefault();var t=$("#tbodySTCItems").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),stage:"STC",TemplateName:n.data("tempName")+".pdf"})}var i={jobId:JobId,docs:a,fillData:!0};$.post(urlUploadSTCDocument,i,function(e){$("#CrateSTCDocument").modal("hide"),e.response?(accordiantabName="STC",getDocuments(!1),showMessage("Document has been Created successfully.",!1,"STC"),SearchHistory()):showMessage("Something went to wrong. Please try after sometimes!",!0,"STC")})}),$("#headingAssetsDefault").click(function(){accordiantabName="CES",getDocuments(!1)}),$("#headingReference").click(function(){accordiantabName="STC",getDocuments(!1)}),$("#headingAssets1").click(function(){accordiantabName="OTHER",getDocuments(!1)}),$("#ddlviewdocumentsName").change(function(){var e=$(this).find(":selected").attr("data-id"),t=$("#ddlviewdocumentsName").val(),a=$(this).find(":selected").attr("data-path");viewDocumentonPage("","","",a,0,e,t)}),$("#btnGroupDrop2").click(function(e){uploadbtndoc?($(".arrow_doc_up").show(),$(".arrow_doc_down").hide(),uploadbtndoc=!1):($(".arrow_doc_up").hide(),$(".arrow_doc_down").show(),uploadbtndoc=!0)}),$("#btnGroupDrop1").click(function(e){createbtndoc?($(".arrow_doc_up_cr").show(),$(".arrow_doc_down_cr").hide(),createbtndoc=!1):($(".arrow_doc_up_cr").hide(),$(".arrow_doc_down_cr").show(),createbtndoc=!0)}),$("#btnddlUploadCESDocument").click(function(e){e.preventDefault(),document.getElementById("btnUploadCESDocument").click()}),$("#btnddlUploadSTCDocument").click(function(e){e.preventDefault(),document.getElementById("btnSTCDocument").click()}),$("#btnddlUploadOtherDocument").click(function(e){e.preventDefault(),document.getElementById("btnUploadOther").click()}),$("#btnddlCreateCESDocument").click(function(e){e.preventDefault(),document.getElementById("btnCreateCESDocument").click()}),$("#btnddlCreateSTCDocument").click(function(e){e.preventDefault(),document.getElementById("btnCreateSTCDocument").click()}),$("#btnddlCreateOtherDocument").click(function(e){e.preventDefault(),document.getElementById("btnCreateDoc").click()});