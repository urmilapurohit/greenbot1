function showhideAdditionalLocationInformation() { "" != $("#JobSTCDetails_Location").val() && "No" != $("#JobSTCDetails_MultipleSGUAddress").val() && "" != $("#JobSTCDetails_MultipleSGUAddress").val() ? $("#STCAdditionalLocation").show() : ($("#JobSTCDetails_AdditionalLocationInformation").text(""), $("#STCAdditionalLocation").hide()) } function showhideFailedCode(e) { "" == e || "No" == e ? ($(".DivFailedAccreditationCode").hide(), $(".failedReasonDiv").hide(), $("#JobSTCDetails_FailedReason").val(""), $("#JobSTCDetails_FailedAccreditationCode").val("")) : "Yes" == e && ($(".DivFailedAccreditationCode").show(), $(".failedReasonDiv").show()) } function CompareJobData() { return !0 } function showMessageForSTC(e, t) { $(".alert").hide(); var a = t ? "errorMsgRegionSTCStatus" : "successMsgRegionSTCStatus", s = t ? "successMsgRegionSTCStatus" : "errorMsgRegionSTCStatus"; $("#" + s).hide(), $("#" + a).html(closeButton + e), $("#" + a).show() } function GetSTCSettlementDate(e) { $.ajax({ url: urlGetSTCSettlementDate, type: "GET", data: { settlementTerm: e, CustomSettlementTerm: $("#CustomSettlementTerm").val() }, success: function (e) { e.status && ($("#selectedSettlementTerm").html(e.Days + " Settlement Selected"), null != e.SettlementDate && "" != e.SettlementDate ? $("#setSettlementDate").html(moment(e.SettlementDate).format(dateFormat.toUpperCase())) : $("#setSettlementDate").html("")) } }) } function DisableTradeButton() { $("#btnApplyTradeStc").addClass("default"), $("#btnApplyTradeStc").removeClass("primary"), $("#btnApplyTradeStc").css("pointer-events", "none"), $(".STC-summary").addClass("lock") } function EnableTradeButton() { $("#btnApplyTradeStc").addClass("primary"), $("#btnApplyTradeStc").removeClass("default"), $("#btnApplyTradeStc").css("pointer-events", ""), $(".STC-summary").addClass("unlock") } function calculateTotal(e) { $("#pricingTerm").html(e.data("price")), GetSTCSettlementDate(e.data("settlementterm")) } function deemingPeriodCallBack(e) { 0 != modelSTCDeemingPeriod && null != modelSTCDeemingPeriod && "" != modelSTCDeemingPeriod || $("#JobSTCDetails_DeemingPeriod").val($("#JobSTCDetails_DeemingPeriod option:last").val()) } function ShowHideGSTSection(e, t) { 2 == tempIsRegisteredWithGST && "true" == modelIsRegisteredWithGST ? ($(".isGSTRegistered").show(), $("#jobGST").show(), $("#BasicDetails_IsGst").val(!0)) : 1 == tempIsRegisteredWithGST && "true" == modelIsRegisteredWithGST ? "corporate body" == t || "trustee" == t ? null != modelIsOwnerRegisteredWithGST && "true" == modelIsOwnerRegisteredWithGST.toString().toLowerCase() ? ($(".isGSTRegistered").show(), $("#jobGST").show(), $("#BasicDetails_IsGst").val(!0)) : ($(".isGSTRegistered").hide(), $("#BasicDetails_IsGst").val(!1)) : "commercial" == e || "school" == e ? ($(".isGSTRegistered").show(), $("#jobGST").show(), $("#BasicDetails_IsGst").val(!0)) : ($(".isGSTRegistered").hide(), $("#BasicDetails_IsGst").val(!1)) : ($(".isGSTRegistered").hide(), $("#BasicDetails_IsGst").val(!1), $("#BasicDetails_IsGst").val(!1)) } function showSuccessMessageForPopup(e, t, a) { $(".alert").hide(), a && a.hide(), t.html(closeButton + e), t.show() } function ReloadSTCJobScreen(e) { ReloadSTCModule() } function ReloadSTCModule() { $("#loading-image").show(), setTimeout(function () { $.get(urlGetSTCJobForTabular + BasicDetails_JobID, function (e) { $("#reloadSTCJobScreen").empty(), $("#reloadSTCJobScreen").append(e), 10 != $("#STCStatusId").val() && 12 != $("#STCStatusId").val() && 14 != $("#STCStatusId").val() && 17 != $("#STCStatusId").val() && ($("#CESDocbtns").hide(), $("#STCDocBtns").hide(), $(".isdelete").css("display", "none")), 1 != ProjectSession_UserTypeId && 3 != ProjectSession_UserTypeId && 4 != ProjectSession_UserTypeId && 2 != ProjectSession_UserTypeId && 5 != ProjectSession_UserTypeId || ($("#CESDocbtns").show(), $("#STCDocBtns").show()), 1 != ProjectSession_UserTypeId && 3 != ProjectSession_UserTypeId || $(".isdelete").css("display", "block"), 1 != ProjectSession_UserTypeId && 3 != ProjectSession_UserTypeId && 10 != $("#STCStatusId").val() && 12 != $("#STCStatusId").val() && 14 != $("#STCStatusId").val() && 17 != $("#STCStatusId").val() && $("#btnsave").hide(), $("#loading-image").hide() }) }, 500) } function showErrorMessage(e) { $(".alert").hide(), $("#successMsgRegion").hide(), $("#errorMsgRegion").html(closeButton + e), $("#errorMsgRegion").show(), $("html").animate({ scrollTop: 0 }, "slow"), $("body").animate({ scrollTop: 0 }, "slow") } function CommonDataForSave() { null != oldaddress && "" != oldaddress || (oldaddress = $("#JobInstallationDetails_AddressDisplay").val(), $("#JobInstallationDetails_oldInstallationAddress").val(oldaddress)), EnableDropDownbyUsertype(), $("#BasicDetails_JobType").removeAttr("disabled"); var e = "", t = "", a = []; if (a = JSON.parse(JSON.stringify(batteryXml)), PanelXml.length > 0) { var s = JSON.stringify(PanelXml), i = "", o = $.parseJSON(s); $.each(o, function () { i += "<panel><Brand>" + htmlEncode(this.Brand) + "</Brand><Model>" + htmlEncode(this.Model) + "</Model><NoOfPanel>" + this.Count + "</NoOfPanel><Supplier>" + htmlEncode(this.Supplier) + "</Supplier></panel>" }), e = "<Panels>" + i + "</Panels>" } if (InverterXml.length > 0) { s = JSON.stringify(InverterXml), i = "", o = $.parseJSON(s); $.each(o, function () { i += "<inverter><Brand>" + htmlEncode(this.Brand) + "</Brand><Model>" + htmlEncode(this.Model) + "</Model><Series>" + htmlEncode(this.Series) + "</Series><NoOfInverter>" + htmlEncode(this.NoOfInverter) + "</NoOfInverter></inverter>" }), t = "<Inverters>" + i + "</Inverters>" } $("#panelXml").val(e), $("#inverterXml").val(t), $("#OldPanelDetails").val(JSON.stringify(OldPanelXml)), $("#NewPanelDetails").val(JSON.stringify(PanelXml)), $("#OldInverterDetails").val(JSON.stringify(OldInverterXml)), $("#NewInverterDetails").val(JSON.stringify(InverterXml)); var l = $("form").find(":input:disabled").removeAttr("disabled"), r = JSON.stringify($("form").serializeToJson()); l.attr("disabled", "disabled"); var n = JSON.parse(r); 0 == batteryXml.length || "select" == batterySystemPartOfAnAggregatedControl_Glbl.toLowerCase() ? n.JobSTCDetails.batterySystemPartOfAnAggregatedControl = "" : n.JobSTCDetails.batterySystemPartOfAnAggregatedControl = batterySystemPartOfAnAggregatedControl_Glbl, 0 == batteryXml.length || "select" == changedSettingOfBatteryStorageSystem_Glbl.toLowerCase() ? n.JobSTCDetails.changedSettingOfBatteryStorageSystem = "" : n.JobSTCDetails.changedSettingOfBatteryStorageSystem = changedSettingOfBatteryStorageSystem_Glbl; for (var d = $("#customDetails").find(".spanCustomFields").length, c = 0; c < d; c++)delete n["lstCustomDetails[" + c + "]"]; if (a.length > 0) { for (c = 0; c < a.length; c++)delete a[c].JobBatteryManufacturerId; n.lstJobBatteryManufacturer = a } var m = $("#JobOwner").find(":input:disabled").removeAttr("disabled"), S = JSON.stringify($("#JobOwner").serializeToJson()); m.attr("disabled", "disabled"), n.JobOwnerDetails = JSON.parse(S).JobOwnerDetails; var u = JSON.stringify($("#JobInstallationAddress").serializeToJson()), h = JSON.parse(u); installationAddressChangeCheck(h.JobInstallationDetails); var p = JSON.stringify($("#JobInstallationDetailInfo").serializeToJson()), b = JSON.parse(p), y = JSON.stringify($("#JobExtraInstallationInfo").serializeToJson()), T = JSON.parse(y); $.extend(n.JobInstallationDetails, h.JobInstallationDetails), $.extend(n.JobInstallationDetails, b.JobInstallationDetails), $.extend(n.JobInstallationDetails, T.JobInstallationDetails), n.JobInstallationDetails.Latitude = $("#lblLatitude").text(), n.JobInstallationDetails.Longitude = $("#lblLongitude").text(); var v = n.JobSystemDetails; v.ModifiedCalculatedSTC = 1 == $("#BasicDetails_JobType").val() ? $("#JobSystemDetails_CalculatedSTC").val() : $("#JobSystemDetails_CalculatedSTCForSWH").val(), v.NoOfPanel = $("#JobSystemDetails_NoOfPanel").html(), v.NoOfInverter = $("#JobSystemDetails_NoOfInverter").html(), v.InstallationType = $("#JobSystemDetails_InstallationType").val(), systemXml.length > 0 && (v.SystemBrand = systemXml[0].Brand, v.SystemModel = systemXml[0].Model), n.JobSystemDetails = v; var C = []; $("#customDetails").find(".spanCustomFields").each(function () { C.push({ JobCustomFieldId: $(this).attr("data-jobcustomfieldid"), FieldValue: $(this).text(), SeparatorId: $(this).attr("data-SeperatorId") }) }), n.lstCustomDetails = C, n.OldStcValue = "" == $("#OldStcValue").val() ? 0 : $("#OldStcValue").val(); var D = "Due to change in ", I = !1; n.JobSystemDetails.PreviousSystemSize = $("#OldSystemSize").val(), $("#OldSystemSize").val() != $("#JobSystemDetails_SystemSize").val() && (D = D + "System Size from " + $("#OldSystemSize").val() + " to " + $("#JobSystemDetails_SystemSize").val(), I = !0); var f = moment($("#BasicDetails_strInstallationDateTemp").val()).format("dd/mm/yyyy".toUpperCase()); n.BasicDetails.strInstallationDateTemp = f, f != $("#BasicDetails_strInstallationDate").val() && (D = D + (I ? ", " : "") + "Installation Date from " + f + " to " + $("#BasicDetails_strInstallationDate").val(), I = !0), $("#OldDeemingPeriod").val() != $("#JobSTCDetails_DeemingPeriod").val() && (D = D + (I ? ", " : "") + "Deeming Period from " + $("#OldDeemingPeriod").val() + " to " + $("#JobSTCDetails_DeemingPeriod").val()); var P = moment($("#BasicDetails_strInstallationDate").val(), "DD/MM/YYYY").add(325, "d").format("dd/mm/yyyy".toUpperCase()), J = moment().format("DD/MM/YYYY"); moment(P, "DD/MM/YYYY") < moment(J, "DD/MM/YYYY") ? n.IsApproachingExpiryDate = !0 : n.IsApproachingExpiryDate = !1, n.PropertyType = $("#JobInstallationDetails_PropertyType").val(), n.stcHistoryMsg = D + ".", n.stcStatusId = $("#STCStatusId").val(); var g = $("#BasicDetails_PreviousRefNumber").val(); n.BasicDetails.PreviousRefNumber = g; var w = $("#BasicDetails_PreviousSSCID").val(); n.BasicDetails.PreviousSSCID = w; var _ = $("#BasicDetails_PreviousSCOID").val(); n.BasicDetails.PreviousSCOID = _; var A = $("#JobInstallationDetails_PreviousNMI").val(); n.JobInstallationDetails.PreviousNMI = A; var k = $("#BasicDetails_PreviousJobStage").val(); n.BasicDetails.PreviousJobStage = k; var O = $("#BasicDetails_PreviousPriority").val(); n.BasicDetails.PreviousPriority = O; var B = $("#JobInstallationDetails_PreviousInstallingNewPanel").val(); n.JobInstallationDetails.PreviousInstallingNewPanel = B; var L = $("#JobInstallationDetails_PreviousLocation").val(); n.JobInstallationDetails.PreviousLocation = L; var R = $("#JobInstallationDetails_PreviousSingleMultipleStory").val(); n.JobInstallationDetails.PreviousSingleMultipleStory = R; var G = $("#JobSTCDetails_PreviousSystemMountingType").val(); n.JobSTCDetails.PreviousSystemMountingType = G; var N = $("#JobSTCDetails_PreviousConnectionType").val(); n.JobSTCDetails.PreviousConnectionType = N; var U = $("#JobSTCDetails_PreviousMultipleSGUAddress").val(); n.JobSTCDetails.PreviousMultipleSGUAddress = U; var F = $("#JobSTCDetails_PreviousDeemingPeriod").val(); n.JobSTCDetails.PreviousDeemingPeriod = F; var M = $("#JobSTCDetails_PreviousCertificateCreated").val(); n.JobSTCDetails.PreviousCertificateCreated = M; var E = $("#JobSTCDetails_PreviousFailedAccreditationCode").val(); n.JobSTCDetails.PreviousFailedAccreditationCode = E; var j = $("#JobSTCDetails_PreviousFailedReason").val(); n.JobSTCDetails.PreviousFailedReason = j; var x = $("#JobSTCDetails_PreviousLocation").val(); n.JobSTCDetails.PreviousLocation = x; var W = $("#JobSTCDetails_PreviousAdditionalLocationInformation").val(); n.JobSTCDetails.PreviousAdditionalLocationInformation = W; var z = $("#JobSTCDetails_PreviousVolumetricCapacity").val(); n.JobSTCDetails.PreviousVolumetricCapacity = z; var V = $("#JobSTCDetails_PreviousStatutoryDeclarations").val(); n.JobSTCDetails.PreviousStatutoryDeclarations = V; var Y = $("#JobSTCDetails_PreviousSecondhandWaterHeater").val(); n.JobSTCDetails.PreviousSecondhandWaterHeater = Y; var X = $("#JobSTCDetails_PreviousLatitude").val(); n.JobSTCDetails.PreviousLatitude = X; var H = $("#JobSTCDetails_PreviousLongitude").val(); n.JobSTCDetails.PreviousLongitude = H; var K = $("#JobSTCDetails_PreviousAdditionalSystemInformation").val(); n.JobSTCDetails.PreviousAdditionalSystemInformation = K; var q = JSON.stringify(n); return q } function EnableDropDownbyUsertype() { "1" == JOBType && (8 == USERType && "True" == IsUnderSSC && ($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"), $("#JobOwner").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobInstallationAddress").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#frmCreateJob").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#BasicDetails_strInstallationDate").removeAttr("disabled")), 7 != USERType && 9 != USERType || ($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"), $("#JobElectricians").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobOwner").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobInstallationAddress").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#frmCreateJob").find("Select").each(function () { $(this).removeAttr("disabled") })), 2 != USERType && 5 != USERType || ($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"), $("#JobElectricians").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobOwner").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobInstallationAddress").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#frmCreateJob").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#BasicDetails_strInstallationDate").removeAttr("disabled"))), "2" == JOBType && ((7 == USERType || 9 == USERType || 8 == USERType && "True" == IsUnderSSC) && ($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"), $("#JobElectricians").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobOwner").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobInstallationAddress").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#frmCreateJob").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#BasicDetails_strInstallationDate").removeAttr("disabled")), 2 != USERType && 5 != USERType || ($("#JobInstallationDetails_ExistingSystem").removeAttr("disabled"), $("#JobElectricians").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobOwner").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#JobInstallationAddress").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#Installer").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#frmCreateJob").find("Select").each(function () { $(this).removeAttr("disabled") }), $("#BasicDetails_strInstallationDate").removeAttr("disabled"))), 1 == JOBType ? "true" == IsLockedSerialNumber ? ($("#aLockedSerialnumber").show(), $("#aUnLockedSerialnumber").hide(), $("#JobSystemDetails_SerialNumbers").prop("disabled", !0)) : ("false" != IsLockedSerialNumber || 1 != USERType && 3 != USERType && "True" != IsLockUnlockSerial || $("#aUnLockedSerialnumber").show(), $("#aLockedSerialnumber").hide(), $("#JobSystemDetails_SerialNumbers").prop("disabled", !1)) : ($("#aLockedSerialnumber").hide(), $("#aUnLockedSerialnumber").hide()), 1 == USERType || 3 == USERType || 10 == $("#STCStatusId").val() || 12 == $("#STCStatusId").val() || 14 == $("#STCStatusId").val() || 17 == $("#STCStatusId").val() ? ($("#JobOwnerDetails_OwnerType").prop("disabled", !1), $("#JobInstallationDetails_PropertyType").prop("disabled", !1), $("#JobSystemDetails_SystemSize").prop("disabled", !1), $("#BasicDetails_strInstallationDate").prop("disabled", !1)) : ($("#JobOwnerDetails_OwnerType").prop("disabled", !0), $("#JobInstallationDetails_PropertyType").prop("disabled", !0), $("#JobSystemDetails_SystemSize").prop("disabled", !0), $("#BasicDetails_strInstallationDate").prop("disabled", !0), $("#JobSystemDetails_SerialNumbers").prop("disabled", !0)) } function callbackCheckList() { $("#checkListItemForTrade").find("ul").find("li").length > 0 ? $("#checkListItemForTrade").show() : $("#checkListItemForTrade").hide() } function checkSwitchStatus() { var e = !1; $(".ChecklistPoint").each(function () { if (!$(this).find("i").hasClass("active")) return e = !1, !1; e = !0 }), e ? $("#onoffswitchCheckAllPoints").prop("checked", !0) : $("#onoffswitchCheckAllPoints").prop("checked", !1) } function checkListFirTradeOnLoad() { $("#onoffswitchCheckAllPoints").change(function (e) { var t = e.target.checked; t ? $(".ChecklistPoint").each(function () { $(this).find("i").hasClass("active") || $(this).click() }) : $(".ChecklistPoint").each(function () { $(this).find("i").hasClass("active") && $(this).click() }), checkSwitchStatus() }) } function MarkUnMarkItemForTrade(e, t, a, s, i, o, l, r, n, d) { var c = $(t).find("i").hasClass("active"); return 1 == n && parseInt(o) < parseInt(l) && !c && !d.toLowerCase().includes("inverter") ? (alert("Please capture all serial numbers."), e.preventDefault(), !1) : ($.ajax({ url: urlMarkUnMarkCheckListItem, dataType: "json", contentType: "application/json; charset=utf-8", type: "get", data: { templateId: a, itemId: s, isMark: !c, jobSchedulingId: r }, success: function (e) { e.id && e.id > 0 ? (c ? $(t).find("i").removeClass("active") : $(t).find("i").addClass("active"), showMessageForSTC("CheckList item has been marked/un-marked as completed successfully.")) : "sessiontimeout" == e.error.toLowerCase() ? window.location.href = urlLogout : e.error ? showMessageForSTC(e.error) : showMessageForSTC("CheckList item has not been marked/un-marked as completed."), ReloadSTCJobScreen(jobId), checkSwitchStatus() }, error: function () { showMessageForSTC("CheckList item has not been marked/un-marked as completed.") } }), e.preventDefault(), !1) } function PricingSettlementTermOnLoad() { "False" != IsShowInDashboard && "True" != IsTradedFromJobIndex || 1 == IsSubmissionScreen || 0 == currentJobStatus || 1 != session_UserTypeId && 3 != session_UserTypeId && (2 != session_UserTypeId && 4 != session_UserTypeId && 5 != session_UserTypeId && (8 != session_UserTypeId || "True" != showbtn) || 12 != currentJobStatus && 17 != currentJobStatus && 14 != currentJobStatus) ? DisableTradeButton() : EnableTradeButton(), ($("#IsWholeSaler").val() && "true" == $("#IsWholeSaler").val().toLowerCase() || BasicDetails_IsWholeSaler && "true" == BasicDetails_IsWholeSaler.toLowerCase()) && "false" == isWholesalerSCAPricingSettlementTermView ? ($(".SettlementTerms").hide(), $("#calculatedSTCParent").hide(), $(".total-amonut").hide(), $(".stc-amount").hide(), $(".SettlementTermsCERApproved").hide()) : ($(".SettlementTerms").show(), $("#calculatedSTCParent").show(), $(".total-amonut").show(), $(".stc-amount").show(), $(".SettlementTermsCERApproved").show()), BasicDetails_IsWholeSaler && "true" == BasicDetails_IsWholeSaler.toLowerCase() && "true" == IsForDashboardPricingWholesaler.toLowerCase() && ($(".SettlementTerms").show(), $("#calculatedSTCParent").show(), $(".total-amonut").show(), $(".stc-amount").show(), $(".SettlementTermsCERApproved").show()), "True" == IsShowInDashboard && $("#calculatedSTCParent").hide(), 1 != session_UserTypeId && 3 != session_UserTypeId && 10 != model_STCStatus && 12 != model_STCStatus && 14 != model_STCStatus && 17 != model_STCStatus && ($("#PricingBlock").hide(), "undefined" != typeof TabularView && $(".subTitleSTCPricing").hide()), 12 != statucId && 17 != statucId && 1 != session_UserTypeId && ($("ul.Processing-time li.LiSettlement").addClass("cursorDefault"), $("ul.Processing-time li.LiSettlement").unbind("click")), 1 != IsSubmissionScreen && "false" == model_IsDashboardPricing && EnableDisableSettlementTerm(), $(".LiSettlement").each(function () { $(this).click(function () { SettlementTermClick($(this)) }), $(this).data("settlementterm") == settlementTerm && $(this).click(), "True" == IsShowInDashboard && ("True" == $(this).attr("data-ispriceup") ? $(this).addClass("up-caret") : $(this).addClass("down-caret")) }), "0" == settlementTerm && $(".LiSettlement:first").click(), "false" == model_IsGridView && (x = document.createElement("div"), x.innerHTML = Description, $("#lblDescription").html($(x).html()), $("#lblLastUpdatedDate").html(lastUpdatedDate)); var e = $(".Processing-time").find("li").length, t = 0; e > 0 && (t = 100 / e + "%"), $(".Processing-time").find("li").css("width", t) } function SettlementTermClick(e) { e.attr("data-settlementterm"), e.children("#CustomSettlementTerm").val() > 0 && e.children("#CustomSettlementTerm").val(); $(".LiSettlement").removeClass("active"), e.children(".ui-state-disabled").length > 0 ? e.parent().children("li").children("span:not(.ui-state-disabled)").parent("li:first").addClass("active") : e.addClass("active"), 10 != model_STCStatus && 12 != model_STCStatus && 14 != model_STCStatus && 17 != model_STCStatus || calculateTotal(e) } function ApplyTradeStc() { var e = $("#imgOwnerSign").attr("src"); if (null != e) { var t = "false" == BasicDetails_IsWholeSaler.toLowerCase() ? $(".LiSettlement.active").data("interval") : $(".LiSettlement").data("interval"), a = "false" == BasicDetails_IsWholeSaler.toLowerCase() ? $(".LiSettlement.active").data("price") : $(".LiSettlement").data("price"), s = "false" == BasicDetails_IsWholeSaler.toLowerCase() ? $(".LiSettlement.active").data("settlementterm") : $(".LiSettlement").data("settlementterm"); if (12 == s && (peakPayTimePeriodValue = peakPayTimePeriod, peakPayGstRate = PeakPayGst, peakPayFeeValue = PeakPayFee), 10 == s && 12 == customSettlementTerm && (peakPayTimePeriodValue = peakPayCustomTimePeriod, peakPayGstRate = CustomPeakPayGst, peakPayFeeValue = CustomPeakPayFee), BasicDetails_IsWholeSaler && "false" == BasicDetails_IsWholeSaler.toLowerCase() && 0 == $(".LiSettlement.active").length) alert("Please select atleast one settlement term."); else if ("true" == BasicDetails_IsWholeSaler.toLowerCase() && 1 == $(".Processing-time").find(".LiSettlement").length || "false" == BasicDetails_IsWholeSaler.toLowerCase()) if ("true" == model_IsGridView) { var i = !0, o = 0, l = 0, r = 0, n = 0, d = 0, c = 0, m = 0, S = 0, u = 0, h = 0, p = !0, b = []; $('#datatable1 tbody input[type="checkbox"]').each(function () { if (1 == $(this).prop("checked")) if ("True" == IsShowInDashboard) { if ("true" == $(this).attr("IsTraded") || "true" == $(this).attr("IsCustomPrice")) return !1, p = !1, alert("Please select jobs which are neither traded nor have custom price."), !1; if ("true" != $(this).attr("IsReadyToTrade")) return !1, p = !1, alert("Please select jobs which are ready to trade."), !1; if (i) o = parseFloat($(this).attr("PriceDay1")), l = parseFloat($(this).attr("PriceDay3")), r = parseFloat($(this).attr("PriceDay7")), n = parseFloat($(this).attr("PriceOnApproval")), d = parseFloat($(this).attr("RapidPay")), c = parseFloat($(this).attr("OptiPay")), m = parseFloat($(this).attr("Commercial")), S = parseFloat($(this).attr("Custom")), u = parseFloat($(this).attr("InvoiceStc")), h = parseFloat($(this).attr("PeakPay")), !0, b.push($(this).attr("jobid")); else { if (o != parseFloat($(this).attr("PriceDay1")) || l != parseFloat($(this).attr("PriceDay3")) || r != parseFloat($(this).attr("PriceDay7")) || n != parseFloat($(this).attr("PriceOnApproval")) || d != parseFloat($(this).attr("RapidPay")) || c != parseFloat($(this).attr("OptiPay")) || m != parseFloat($(this).attr("Commercial")) || S != parseFloat($(this).attr("Custom")) || u != parseFloat($(this).attr("InvoiceStc")) || h != parseFloat($(this).attr("PeakPay"))) return !1, p = !1, alert("Please select jobs which have same price."), !1; !0, b.push($(this).attr("jobid")) } i = !1 } else { if (4 != s && 8 != s && 12 != s && 4 != customSettlementTerm && 8 != customSettlementTerm && 12 != customSettlementTerm && "true" == $(this).attr("isApproachingExpiryDate")) return alert("Approaching 12-month expiry date for claiming STCs. This job can only be traded on approval. Please contact your account manager for further details."), p = !1, !1; b.push($(this).attr("JobId")) } }), 1 == p && (b.length > 0 ? confirm("Are you sure you want to Trade STC?") && ApplyTradeActual(b.join(","), t, a, s, peakPayGstRate, peakPayTimePeriodValue, peakPayFeeValue) : alert("Please select atleast one job.")) } else 4 != s && 8 != s && 12 != s && 4 != customSettlementTerm && 8 != customSettlementTerm && 12 != customSettlementTerm && "true" == $("#IsApproachingExpiryDate").val().toLowerCase() ? alert("Approaching 12-month expiry date for claiming STCs. This job can only be traded on approval. Please contact your account manager for further details.") : ApplyTradeActual(model_JobId, t, a, s, peakPayGstRate, peakPayTimePeriodValue, peakPayFeeValue); else alert("Oops, there is an error in the backend, please contact a Greenbot admin") } else alert("Please Upload Owner Signature To Trade STC") } function ApplyTradeActual(e, t, a, s, i, o, l) { var r = CompareJobData(); r ? $.ajax({ url: urlApplyTradeSTC, type: "POST", data: { jobId: e, interval: t, price: a, settlementterm: s, isGst: model_IsGST, stcAmt: stcAmount, CustomSettlementTerm: customSettlementTerm, peakPayGst: i, peakPayTimeperiod: o, peakPayFee: l }, success: function (e) { null != e.jobIds ? showMessageForSTC("There are some illegal characters in the serial number field. Job cannot be traded until these are amended with the correct serials.", !0) : (showMessageForSTC("Job has been traded successfully.", !1), 1 != ProjectSession_UserTypeId && 3 != ProjectSession_UserTypeId && 10 != $("#STCStatusId").val() && 12 != $("#STCStatusId").val() && 14 != $("#STCStatusId").val() && 17 != $("#STCStatusId").val() && $("#btnSaveJob").hide(), "True" == isSaveJobAfterTrade && $("#btnSaveJob").show(), ReloadSTCJobScreen(model_JobId), SearchHistory(), "undefined" != typeof isDynamicJobIndex && isDynamicJobIndex ? (filterKendo = $("#datatable").data("kendoGrid").dataSource.filter(), datatableInfo(), GridConfig[0].IsKendoGrid ? ($("#datatable").kendoGrid("destroy").empty(), drawJobIndex(filterKendo)) : ($("#datatable").DataTable().destroy(), drawJobIndex())) : ($("#JobOwnerDetails_OwnerType").prop("disabled", !0), $("#JobInstallationDetails_PropertyType").prop("disabled", !0), $("#JobSystemDetails_SystemSize").prop("disabled", !0), $("#BasicDetails_strInstallationDate").prop("disabled", !0), $("#JobSystemDetails_SerialNumbers").prop("disabled", !0), $("#PricingBlock").hide()), 10 != $("#STCStatusId").val() && 12 != $("#STCStatusId").val() && 14 != $("#STCStatusId").val() && 17 != $("#STCStatusId").val() && ($("#CESDocbtns").hide(), $("#STCDocBtns").hide(), $(".isdelete").css("display", "none")), 1 != session_UserTypeId && 3 != session_UserTypeId && 2 != session_UserTypeId && 4 != session_UserTypeId && 5 != session_UserTypeId || ($("#CESDocbtns").show(), $("#STCDocBtns").show()), 1 != session_UserTypeId && 3 != session_UserTypeId || $(".isdelete").css("display", "block")) } }) : alert("There are changes in this job that have not been saved. Before trading, please save your changes.") } function ShowHideJobs(e, t) { $("#datatable1").find("tr").show(), $("#datatable1 tr td").each(function () { $(this).find("input[type=checkbox]").each(function () { isAllowKW = $(this).attr("isallowkw"), jobSizeForOptiPay = $(this).attr("jobsizeforoptipay"), isCommercialJob = $(this).attr("iscommercialjob"), isNonCommercialJob = $(this).attr("isnoncommercialjob"), isPeakPayCommercialJob = $(this).attr("isPeakPayCommercialJob"), isPeakPayNonCommercialJob = $(this).attr("isPeakPayNonCommercialJob"), isCustomAllowKW = $(this).attr("iscustomallowkw"), jobCustomSizeForOptiPay = $(this).attr("jobcustomsizeforoptipay"), isCustomCommercialJob = $(this).attr("iscustomcommercialjob"), isCustomNonCommercialJob = $(this).attr("iscustomnoncommercialjob"), isCustomPeakPayCommercialJob = $(this).attr("isCustomPeakPayCommercialJob"), isCustomPeakPayNonCommercialJob = $(this).attr("isCustomPeakPayNonCommercialJob"), modelIsGSTSetByAdminUser = $(this).attr("modelisgstsetbyadminuser"), isGst = $(this).attr("isgst").toLowerCase(), gstDocument = $(this).attr("gstdocument"), propType = $(this).attr("proptype").toLowerCase(), sysSize = $(this).attr("jobsystemsize"), ownerType = $(this).attr("ownerType").toLowerCase() }), 7 == e ? CheckRuleofRapidPay(null, propType, $(this), ownerType) : 8 == e ? CheckRuleofOptiPay(isAllowKW, jobSizeForOptiPay, isCommercialJob, isNonCommercialJob, null, modelIsGSTSetByAdminUser, isGst, $(this), ownerType, propType) : 9 == e ? CheckRuleofCommercial(null, modelIsGSTSetByAdminUser, isGst, gstDocument, $(this), ownerType, propType) : 12 == e ? CheckRuleofPeakPay(isPeakPayCommercialJob, isPeakPayNonCommercialJob, null, modelIsGSTSetByAdminUser, isGst, $(this), ownerType, propType) : 10 == e && (7 == t ? CheckRuleofRapidPay(null, propType, $(this), ownerType) : 8 == t ? CheckRuleofOptiPay(isAllowKW, jobSizeForOptiPay, isCommercialJob, isNonCommercialJob, null, modelIsGSTSetByAdminUser, isGst, $(this), ownerType, propType) : 9 == t ? CheckRuleofCommercial(null, modelIsGSTSetByAdminUser, isGst, gstDocument, $(this), ownerType, propType) : 12 == t && CheckRuleofPeakPay(isCustomPeakPayCommercialJob, isCustomPeakPayNonCommercialJob, null, modelIsGSTSetByAdminUser, isGst, $(this), ownerType, propType)) }), $("#chkAll1").prop("checked", !0), datatable1Chkbox($("#chkAll1").prop("checked"), !1) } function SearchHistory() { var e = $("#historyCategory").val(); e = null != e ? e : 0; var t = FilterIsImportantNote_Glbl, a = $("#filter-postvisibility").val(), s = $("#BasicDetails_JobID").val(), i = $("#IsDeletedJobNote").val(), o = "DESC"; $("#loading-image").show(), setTimeout(function () { $.ajax({ url: showhistoryUrl, type: "GET", data: { jobId: s, categoryID: e, order: o, PostVisibility: a, IsImportant: t, IsDeletedJobNote: i }, cache: !1, async: !1, success: function (e) { window.onbeforeunload = null, $("#showfilteredhistory").html($.parseHTML(e)), $("divCustom").mCustomScrollbar() } }), AddHistoryIcons(), hideEditDeleteIcons(), $("#loading-image").hide() }, 10) } function showMessageForChangeSCA(e, t) { $(".alert").hide(); var a = t ? "errorMsgRegionChangeSCA" : "successMsgRegionChangeSCA", s = t ? "successMsgRegionChangeSCA" : "errorMsgRegionChangeSCA"; $("#" + s).hide(), $("#" + a).html(closeButton + e), $("#" + a).show() } function showhideAdditionalCapacityNotes() { "" != $("#JobInstallationDetails_Location").val() && "New" != $("#JobInstallationDetails_InstallingNewPanel").val() && "" != $("#JobInstallationDetails_InstallingNewPanel").val() ? $("#additionalCapacityNotes").show() : ($("#JobSTCDetails_AdditionalCapacityNotes").text(""), $("#additionalCapacityNotes").hide()) } $("#JobInstallationDetails_PropertyType").on("focus", function () { previousPropertyType = this.value }).change(function (e) { JobInstallationDetails_PropertyType = $("#JobInstallationDetails_PropertyType").val(); var t = $("#JobInstallationDetails_PropertyType").val(); return "commercial" != t.toLowerCase() || null != emailOwner && "" != emailOwner ? "school" != t.toLowerCase() || null != emailOwner && "" != emailOwner ? (ShowHideGSTSection($("#JobInstallationDetails_PropertyType").val().toLowerCase(), jobownerdetails_ownertypestc), void $.ajax({ url: urlUpdateJobInstallationPropertyType, dataType: "json", contentType: "application/json; charset=utf-8", type: "post", data: JSON.stringify({ jobId: jobId, propertyType: $("#JobInstallationDetails_PropertyType").val(), isGST: $("#BasicDetails_IsGst").val() }), async: !1, success: function (e) { e.status ? (showSuccessMessageForPopup("Installation property type has been saved successfully.", $("#successMsgRegionSTCDetails"), $("#errorMsgRegionSTCDetails")), ReloadSTCJobScreen(jobId)) : showErrorMessageForPopup(e.msg, $("#errorMsgRegionSTCDetails"), $("#successMsgRegionSTCDetails")) } })) : (showErrorMessage("Owner email address is mandatory for installtion property type school."), $("#JobInstallationDetails_PropertyType").val(previousPropertyType), !1) : (showErrorMessage("Owner email address is mandatory for commercial jobs."), $("#JobInstallationDetails_PropertyType").val(previousPropertyType), !1) }), $("#inGBSCACode").change(function () { null != this.value && "" != this.value ? $("#gbScaCodeError").html("") : $("#gbScaCodeError").html("GBSCA Code is required.") }), $("#JobInstallationDetails_InstallingNewPanel").change(function (e) { "New" != $("#JobInstallationDetails_InstallingNewPanel").val() && "" != $("#JobInstallationDetails_InstallingNewPanel").val() ? $("#installationLocation").show() : ($("#installationLocation").hide(), $("#JobInstallationDetails_Location").val("")), showhideAdditionalCapacityNotes() });