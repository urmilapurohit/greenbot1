function uploadPhotoAfterWarning(){var e=$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").add($("#headingReference").find("input:checked")).add($(".defaultPanel:checked")),t=!1;return t=$("#headingReference").find("input:checked").length>0,isDefault=$(".defaultPanel:checked").length>0,UploadData.cId=t||isDefault?"":e.data("cid"),UploadData.isRef=t,UploadData.isDefault=isDefault,UploadData.jobScId=t||isDefault?"":e.data("jobscid"),UploadData.Type=isDefault?e.data("type"):"",UploadData.PdfLocationId=e.data("loc"),UploadData.ClassTypeId=e.data("ct"),UploadData.PdfName=e.data("nm"),$("#uploadBtnPhoto").data().blueimpFileupload.options.formData=getData(),document.getElementById("uploadBtnPhoto").click(),$("#popuponuploadphoto").modal("toggle"),!1}function MakeDefaultFolderAsDefaultSubmission(){var e="<span class=submission>STC Submission <i class='sprite-img submission-icon'></i></span>";$("#divVisitList").find("#pnlMainDefault").find(".visitParent").prepend(e)}function ViewPhoto(e,t){e=uploadPath+e,logoWidthPhoto=0,logoHeightPhoto=0,$("#loading-image").css("display",""),$("#imgSlide").attr("src",e).load(function(){logoWidthPhoto=this.width,logoHeightPhoto=this.height,$("#mdlSlideShow").modal(),$("#loading-image").css("display","none")}),$("#mdlSlideShow").unbind("error"),$("#mdlSlideShow").attr("src",e).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")}),t?($("#mdlSlideShow").find("#btnPrev").hide(),$("#mdlSlideShow").find("#btnNext").hide()):($("#mdlSlideShow").find("#btnPrev").show(),$("#mdlSlideShow").find("#btnNext").show())}function setPreNextButtons(e,t,i){ViewPhoto(i),$("#hdrFileName").text(i.split("\\").slice(i.split("\\").length-1)),$("#btnPrev,#btnNext").removeAttr("disabled"),e>=t?$("#btnNext").attr("disabled","disabled"):0==e?$("#btnPrev").attr("disabled","disabled"):$("#btnPrev,#btnNext").removeAttr("disabled"),0==e&&0==t&&$("#btnPrev,#btnNext").attr("disabled","disabled")}function getData(){return{JobId:jobId,UserId:USERID,folder:UploadData.cId,isRef:UploadData.isRef,jobScId:UploadData.jobScId,IsDefault:UploadData.isDefault,ClassType:UploadData.Type,PdfLocationId:UploadData.PdfLocationId,ClassTypeId:UploadData.ClassTypeId,PdfName:UploadData.PdfName,IsAllowAccesstoUploadGPSPhoto:isAllowAccesstoUploadGPSPhoto}}function downloadAllAsZip(e){var t=$("[id*=pnlMain]"),i={},a=[];i.vclid=[],i.vsid=[],$.each(t,function(t,o){var n={};n.pl=[];var l=$(this).find("[id*=accordion]").children();n.id=$(this).find(".panel-heading").find("a").data("name"),$.each(l,function(t,a){var o={p:[],s:[]};o.fn=$(this).find(".panel-heading").find("a").data("name"),$.each(0==e?$(this).find(".panel-body").find("input[type=checkbox]:checked"):$(this).find(".panel-body").find("input[type=checkbox]"),function(e,t){$(this).parent().data("vclid")&&(o.p.push($(this).parent().data("vclid")),i.vclid.push($(this).parent().data("vclid"))),$(this).parent().data("vsid")&&(o.s.push($(this).parent().data("vsid")),i.vsid.push($(this).parent().data("vsid")))}),o.s=o.s.join(","),o.p=o.p.join(","),(o.p.length||o.s.length)>0&&n.pl.push(o)}),n.pl.length>0&&0===e?a.push(n):1===e&&a.push(n)});var o=0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),n=(0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),[]);o.length>0&&$.each(o,function(e,t){n.push($(this).parent().data("vclid"))}),i.vp=a,i.rp=n.join(","),i.vclid=i.vclid.join(",")+","+i.rp,i.vsid=i.vsid.join(","),i.isDownloadAll=0!==e;var l=$("#BasicDetails_RefNumber").val(),s=!0;return $(".submission-add > .visit-list-check").each(function(){$(this).is(":checked")||(s=!1)}),1==e&&(s=!0),i.vp.length>0||i.rp.length>0?(showStayMsg=!1,window.location.href=urlDownloadJobPhotos+"?jobid="+jobId+"&photos="+encodeURIComponent(JSON.stringify(i))+"&refno="+l+"&isall="+s,SearchHistory()):(showStayMsg=!0,alert("Please select photo first.")),!1}function clpsAll_click(){$(".collapse").collapse("hide")}function lnkDwnld_click(){downloadAllAsZip(0)}function lnkDwnldAll_click(){downloadAllAsZip(1)}function uploadBtnPhoto_click(){var e=$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").add($("#headingReference").find("input:checked")).add($(".defaultPanel:checked")),t=!1;return t=$("#headingReference").find("input:checked").length>0,isDefault=$(".defaultPanel:checked").length>0,1!=e.length?(alert("Please select one active parent."),!1):1!=e.data("ct")||"true"!=IsSPVRequired.toLowerCase()?(UploadData.cId=t||isDefault?"":e.data("cid"),UploadData.isRef=t,UploadData.isDefault=isDefault,UploadData.jobScId=t||isDefault?"":e.data("jobscid"),UploadData.Type=isDefault?e.data("type"):"",UploadData.PdfLocationId=e.data("loc"),UploadData.ClassTypeId=e.data("ct"),UploadData.PdfName=e.data("nm"),$("#uploadBtnPhoto").data().blueimpFileupload.options.formData=getData(),document.getElementById("uploadBtnPhoto").click(),!1):void $("#popuponuploadphoto").modal("toggle")}function lnkGeneratePDF_click(e){$("#loading-image").show();var t,i=0,a=null,o="",n=!1;if($("div[id^='pnlMain']").not("#pnlMainDefault").each(function(e,t){$(t).find(".panel .panel-heading .visit-list-check:checked").length>0&&(i++,a=$(t))}),1!=i||CheckRefAndDefaultPhotoStatus())if(i>1&&!CheckRefAndDefaultPhotoStatus())alert("Please select only one folder details.");else if(0!=i||CheckRefAndDefaultPhotoStatus())if(0==i&&CheckRefAndDefaultPhotoStatus()){if($(".pdf-generated-get-details.ref:checked").length>0)t={VisitChecklistItemIds:0,SchedulingId:0,JobId:JobId,UserId:USERID,UniqueVisitId:$(".pdf-generated-get-details.ref").attr("data-uniquevisistid"),IsReference:!0},n=!0;else if($("#collapseAssetsInstallation").find(".panel .panel-heading .visit-list-check:checked").length>0){var l="";$($("#collapseAssetsInstallation").find(".panel .panel-heading .visit-list-check:checked")).each(function(e,t){""!=l?l+=","+$(t).attr("data-type"):l=$(t).attr("data-type")}),t={VisitChecklistItemIds:0,SchedulingId:0,JobId:JobId,UserId:USERID,UniqueVisitId:$(".pdf-generated-get-details.def").attr("data-uniquevisistid"),IsDefault:!0,ClassType:l},n=!0}}else i>0&&CheckRefAndDefaultPhotoStatus()&&alert("Please select only one folder.");else alert("Please select one folder.");else $($(a).find(".panel .panel-heading .visit-list-check:checked")).each(function(e,t){""!=o?o+=","+$(t).attr("data-cid"):o=$(t).attr("data-cid")}),t={VisitChecklistItemIds:o,SchedulingId:$(a).find(".visitParent .visit-list-check").attr("data-jobscid"),JobId:JobId,UserId:USERID,UniqueVisitId:$(a).find(".visitParent .visit-list-check").attr("data-uniquevisistid")},n=!0;n?$.ajax({url:urlGenerateAllImagesOfVisistInPdf,type:"POST",async:!1,cache:!1,data:JSON.stringify(t),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){showMessageForJobPhoto("PDF generated successfully.",!1),getDocuments(!1),$("#loading-image").hide()},error:function(e){alert(e),$("#loading-image").hide()}}):$("#loading-image").hide(),a=null,o=""}function lnkUncheck_click(){$("#divVisitList").find("input[type=checkbox]").removeAttr("checked")}function lnkDelete_click(){if(!confirm("Are you sure you want to delete these files?"))return!1;var e=$("#accordion").find(".panel-body").find("input[type=checkbox]:checked").closest("li"),t=[],i=[],o=[],n=$("#divVisitList").find(".deleteJobVisit").find("input[type=checkbox]:checked");$.each(n,function(e,t){o.push($(this).data("jobscid"))}),$.each(e,function(e,a){t.push($(this).data("vclid")),i.push($(this).data("vsid"))}),a=t.join(",");var l=i.join(","),s=o.join(",");$.ajax({url:urlDeleteCheckListPhotos,data:{checkListIds:a,sigIds:l,pdelete:s,jobId:jobId},contentType:"application/json",method:"get",success:function(t){var i=!1;if("true"==t.status&&("true"==t.isSPVRequired.toString()?ShowSPV():HideSPV()),"true"==t.status)return showMessageForJobPhoto("Photos has been deleted successfully.",!1),$.each(e,function(e,t){1==$(this).closest(".panel").closest(".collapse").closest(".panel").find(".visitParent").find(".submission").length&&(i=!0),$(this).closest(".panel").find(".totalCount").text(parseInt($(this).closest(".panel").find(".totalCount").text())-1),$(this).remove()}),i&&ReloadSTCModule(),n.closest(".panel").remove(),!1}})}function CheckRefAndDefaultPhotoStatus(){return $(".pdf-generated-get-details.ref:checked").length>0||$("#collapseAssetsInstallation").find(".panel .panel-heading .visit-list-check:checked").length>0}function showMessageForJobPhoto(e,t){$(".alert").hide();var i=t?"errorMsgRegionJobPhoto":"successMsgRegionJobPhoto",a=t?"successMsgRegionJobPhoto":"errorMsgRegionJobPhoto";$("#"+a).hide(),$("#"+i).html(closeButton+e),$("#"+i).show()}function showMap(e,t){$(".lb-close").click(),$("#txtSource").val(e+","+t),$("#txtDestination").val($("#txtAddress").val()),loadMapScript(1),$("#distance").html(""),$("#errorMsgRegionMap").hide(),$("#pMap").modal({backdrop:"static",keyboard:!1}),setTimeout(function(){GetrouteWithMarkerWithoutRoute(1),createLine()},1e3)}function GetrouteWithMarkerWithoutRoute(e=0){if($("#dvDistance").html(""),$("#errorMsgRegionMap").hide(),source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,""!=source&&""!=destination){var t=new google.maps.LatLng(51.508742,-.12085),i={zoom:4,center:t};map=1==e?new google.maps.Map(document.getElementById("dMap"),i):new google.maps.Map(document.getElementById("dvMap"),i);var a,o=$("#lblLatitude").text(),n=$("#lblLongitude").text(),l=$("#txtSource").val().split(",")[0],s=$("#txtSource").val().split(",")[1],d=[[o,n],[l,s]];new google.maps.InfoWindow;for(a=0;a<d.length;a++)new google.maps.Marker({position:new google.maps.LatLng(d[a][0],d[a][1]),map:map})}else $("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  address are  required"),$("#errorMsgRegionMap").show()}function createLine(){address=$("#txtSource").val(),address2=$("#txtDestination").val();var e,t=$("#lblLatitude").text(),i=$("#lblLongitude").text(),a=$("#txtSource").val().split(",")[0],o=$("#txtSource").val().split(",")[1],n=[];if(n.push(t),n.push(i),e=$("#txtSource").val().split(","),address2){n;var l=new google.maps.Polyline({path:[new google.maps.LatLng(t,i),new google.maps.LatLng(a,o)],strokeColor:"#FF5E56",strokeOpacity:.6,strokeWeight:5});location1=e,location2=n;var s=distance(location1[0],location1[1],location2[0],location2[1],"K");document.getElementById("distance").innerHTML+="Distance between installation address and captured photo location is "+s+" meters long<br>",l.setMap(map),plotMap(location1,location2),address=address2}else location1=convertLocationToLatLong(e.toUrlValue()),plotMap(location1)}function distance(e,t,i,a,o){if(e==i&&t==a)return 0;var n=Math.PI*e/180,l=Math.PI*i/180,s=t-a,d=Math.PI*s/180,r=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos(d);return r>1&&(r=1),r=Math.acos(r),r=180*r/Math.PI,r=60*r*1.1515,"K"==o&&(r*=1.609344),r=Math.round(1e3*r),r}function convertLocationToLatLong(e){var t=e.split(",").map(function(e){return parseFloat(e)});return t}function GetAddress(){var e=$("#txtSource").val().split(",")[0],t=$("#txtSource").val().split(",")[1],i=new google.maps.LatLng(e,t),a=a=new google.maps.Geocoder;a.geocode({latLng:i},function(e,t){t==google.maps.GeocoderStatus.OK&&e[1]&&alert("Location: "+e[1].formatted_address)})}function plotMap(e,t){var i=new google.maps.LatLng(e[0],e[1]);if(t)var a=new google.maps.LatLng(t[0],t[1]);var o=new google.maps.LatLngBounds;o.extend(i),a&&o.extend(a),map.fitBounds(o),setZoom()}function setZoom(){google.maps.event.addListener(map,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(map,"bounds_changed",function(e){this.getZoom()>15&&1==this.initialZoom&&(this.setZoom(15),this.initialZoom=!1),google.maps.event.removeListener(zoomChangeBoundsListener)})}),map.initialZoom=!0}function LoadIsSPVRequired(){$.ajax({url:urlGetIsSPV,type:"GET",data:{jobId:jobId},dataType:"json",success:function(e){$("div.line-no").removeClass("verified"),$("div.line-no").removeClass("unverified"),$("div.line-no").removeClass("installationVerified"),$("div.line-no").removeClass("notverified"),$("#GlobalisAllowedSPV").val(e.GlobalisAllowedSPV),e.IsSPVRequired?IsSPVRequired="True":IsSPVRequired="False",$("#SerialNumberPanel").length>0?e.IsSPVRequired?(VerifyUnVerifySerialNumber(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?$(".isSPVRequired").show():$(".isSPVRequired").hide()):($(".isSPVRequired").hide(),$("#SPVLabel").hide()):VerifyUnVerifySerialNumber()}})}function lnkIgnore200mtrRule_click(){$.ajax({type:"post",url:urlIgnore200mtrValidation,dataType:"json",data:{jobId:JobId},async:!1,success:function(e){e.status?(ReloadJobPhotoSection(JobId),setTimeout(function(){"1"==e.result&&(showMessageForJobPhoto("Successfully removed 200mtr validation rule.",!1),"True"==e.isSPVRequired.toString()||"true"==e.isSPVRequired.toString()?ShowSPV():HideSPV()),"2"==e.result&&showMessageForJobPhoto("Successfully removed 200mtr validation but there is from SCA/Global/Manufacturer leval spv has been off.",!0),"3"==e.result&&showMessageForJobPhoto("Successfully removed 200mtr validation but job panel must be one for do SPV product verification.",!0)},1e3)):showMessageForJobPhoto("Something went wrong in removing 200mtr validation.",!0)},error:function(e){alert("Failed to remove 200mtr validation rule."+e)}})}function restoreDeletedVisit(){var e=[];$.each($(".visitId .visit-list-check:checked"),function(){e.push($(this).val())});var t=e.join(",");$.ajax({url:urlrestoreDeletedVisit,method:"GET",data:{jobscId:t},cache:!1,async:!1,success:function(e){}})}function lnkDeletedCheckListitem_click(){$.get(urldeletedChecklist+jobId,function(e){$("#mdlChecklistItmesdata").empty(),$("#mdlChecklistItmesdata").append(e),$("#mdlChecklistItmes").modal({backdrop:"static",keyboard:!1})})}function ReloadJobPhotoSection1(e){$("#loading-image").show(),setTimeout(function(){$.get(urlreloadphoto+e,function(e){$("#loadNewJobPhoto").empty(),$("#loadNewJobPhoto").append(e),showMessageForJobPhoto("File has been restored successfully.",!1)})},500)}var logoWidthPhoto,logoHeightPhoto;$(document).ready(function(){"True"==IsSPVInstallationVerified&&1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&"False"==isUploadPhotoAfterTrade&&$(".IsSPVinstallationVerified").css("display","none"),2!=ProjectSession_UserTypeId&&4!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId||10!=$("#STCStatusId").val()&&12!=$("#STCStatusId").val()&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val()&&$(".isdelete").css("display","none"),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&$(".AccessOnlyForFSAFCO").css("display","none")}),$("#btnYes").click(function(){uploadPhotoAfterWarning()}),$("#btnClosepopupboxUploadPhoto").click(function(){$("#popuponuploadphoto").modal("toggle")});var geocoder,map,location1,location2,address,address2,UploadData={},urlPhoto=BaseURL+"UploadReferencePhoto";$("#divVisitList .panel-heading input[type=checkbox]").change(function(){$(this).closest(".panel").find("[type=checkbox]").prop("checked",this.checked),$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length==$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]:checked").length?0!=$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length&&$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").prop("checked","checked"):$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").removeAttr("checked")}),$(document).on("click",".navbar-collapse.in",function(e){$(e.target).is("a")&&"dropdown-toggle"!=$(e.target).attr("class")&&$(this).collapse("hide")}),$("#uploadBtnPhoto").fileupload({url:urlPhoto,dataType:"json",done:function(e,t){var i=[];i.length=0;var a=[];a.length=0;var o=[];o.length=0;for(var n=UploadData.isRef?$("#ulPreference"):UploadData.isDefault?$("#pnlMainDefault").find(".defaultPanel:checked").closest(".panel").find("ul"):$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").closest(".panel").find("ul"),l=0,s=0;s<t.result.uploadStatus.length;s++){var d=t.result.uploadStatus[s].Path,r="",c="";if(1==t.result.uploadStatus[s].Status){r=t.result.uploadStatus[s].latitude>0||t.result.uploadStatus[s].longitude>0?"with-location":"",c="False"==t.result.uploadStatus[s].isUnderInstallationArea?"with-IsUnderInstallationArea":"";var h=$("<li/>").attr("data-path",d).attr("data-vclid",t.result.uploadStatus[s].AttachmentID).appendTo(n),u=($("<input/>").attr("type","checkbox").addClass("visit-list-check").appendTo(h),$("<a/>").addClass(r).addClass(c).text(" "+t.result.uploadStatus[s].FileName).attr("href",uploadPath+"//"+d).attr("data-lightbox","property").attr("data-lat",t.result.uploadStatus[s].latitude).attr("data-lon",t.result.uploadStatus[s].longitude).attr("data-isunderinstallationarea",t.result.uploadStatus[s].isUnderInstallationArea).attr("data-date",t.result.uploadStatus[s].createdDate).attr("data-PhotoTypeId",t.result.PhotoTypeId).attr("title"," ").appendTo(h));$("<span></span>").appendTo(u);l++,SearchHistory()}$("#ulPreference").children("li").length>1&&$("#liNoData").length>0&&$("#liNoData").remove(),0==t.result.uploadStatus[s].Status&&"NotImage"==t.result.uploadStatus[s].Message?a.push(t.result.uploadStatus[s].FileName):0==t.result.uploadStatus[s].Status&&"BigName"==t.result.uploadStatus[s].Message?o.push(t.result.uploadStatus[s].FileName):0==t.result.uploadStatus[s].Status&&i.push(t.result.uploadStatus[s].FileName)}n.closest(".panel").find(".totalCount").text(parseInt(n.closest(".panel").find(".totalCount").text())+l),a.length>0&&showMessageForJobPhoto(a.length+" Uploaded file is not .jpg , .jpeg or .png extension.",!0),i.length>0&&showMessageForJobPhoto(i.length+" File has not been uploaded.",!0),o.length>0&&showMessageForJobPhoto(o.length+" Uploaded filename is too big.",!0),0==o.length&&0==i.length&&0==a.length&&(showMessageForJobPhoto("File has been uploaded successfully.",!1),1==t.result.isSPVRequired?ShowSPV():HideSPV()),1==$(n).closest(".panel").closest(".collapse").closest(".panel").find(".visitParent").find(".submission").length&&ReloadSTCModule(),$("#loading-image").show(),setTimeout(function(){getDocuments(!1),$("#loading-image").hide()},500)},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){var i=t.files[0].type.split("/"),a=i[0];if(1==t.files.length)for(var o=0;o<t.files.length;o++){if(t.files[o].name.length>50)return showMessageForJobPhoto("Please upload small filename.",!0),!1;if(CheckSpecialCharInFileName(t.files[o].name))return showMessageForJobPhoto("Please upload file that not conatain <> ^ [] .",!0),!1}if(t.files.length>1)for(o=0;o<t.files.length;o++){if(t.files[o].size>parseInt(MaxImageSize))return showMessageForJobPhoto(" "+t.files[o].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0),!1;if(CheckSpecialCharInFileName(t.files[o].name))return showMessageForJobPhoto("Please upload file that not conatain <> ^ [] .",!0),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessageForJobPhoto("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0),!1;if(1==t.files.length){var n=t.files[0].name.toLowerCase().split(".").length>0?t.files[0].name.toLowerCase().split(".")[t.files[0].name.toLowerCase().split(".").length-1]:"";if("image"!=a&&"heic"!=n)return showMessageForJobPhoto("Please upload a file with .jpg , .jpeg or .png extension.",!0),!1}return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:getData(),change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#accordion .panel-body").find("input[type=checkbox]").change(function(){this.checked?$(this).closest(".panel-body").find("input[type=checkbox]").length==$(this).closest(".panel-body").find("input[type=checkbox]:checked").length&&($(this).closest(".panel").find(".panel-heading").find("[type=checkbox]").prop("checked","checked"),$(this).closest("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length==$(this).closest("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]:checked").length&&$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").prop("checked","checked")):($(this).closest(".panel").find(".panel-heading").find("[type=checkbox]").removeAttr("checked"),$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").removeAttr("checked"))}),function(){var e,t,i;e=jQuery,i=function(){function e(){this.fadeDuration=0,this.fitImagesInViewport=!0,this.resizeDuration=0,this.showImageNumberLabel=!0,this.wrapAround=!1}return e.prototype.albumLabel=function(e,t){return"Image "+e+" of "+t},e}(),t=function(){function t(e){this.options=e,this.album=[],this.SelfieAlbum=[],this.currentImageIndex=void 0,this.init()}return t.prototype.init=function(){return this.enable(),this.build()},t.prototype.enable=function(){var t=this;return e("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(i){return t.start(e(i.currentTarget)),!1})},t.prototype.GetSelfieImage=function(t){try{if($cont=this.$lightbox.find(".lb-outerContainerSelfie"),$ControlPanel=this.$lightbox.find(".lb-closeContainerSelfie"),$isAllowVisibleInstallerSelfie=isAllowVisibleInstallerSelfie,$phototypeid=null!=this.album&&this.album.length>0?this.album[0].phototypeid:0,"False"==isAllowVisibleInstallerSelfie||"False"==isAllowVisibleInstallerSelfie&&"1"!=ProjectSession_UserTypeId&&"3"!=ProjectSession_UserTypeId||2!=$phototypeid||""==UserDocs)return e($cont).css({visibility:"hidden"}),e($ControlPanel).css({visibility:"hidden"}),e(".lb-outerContainer").css("position","fixed"),e(".lb-closeContainer").css("position","absolute"),void e(".lb-data").css("display","block");e($cont).css({visibility:"visible"}),e($ControlPanel).css({visibility:"visible"}),e(".lb-outerContainer").css("position",""),e(".lb-closeContainer").css("position","relative"),e(".lb-data").css("display","flex");var i=UserDocs.split(",");return i.forEach(e=>{0!==e.trim().length&&this.SelfieAlbum.push(e.trim())}),this.SetSelfieImage(this.SelfieAlbum[0]),void(this.currentSelfieImageIndex=0)}catch(e){alert(e.message)}},t.prototype.SetSelfieImage=function(e){try{this.OuterDiv=this.$outerContainerSelfie.find(".lb-container"),this.OuterDiv.html(e.includes(".pdf")||e.includes(".doc")||e.includes(".docx")?'<iframe class="lb-imageSelfie" style="position: relative; height: 100%; width: 100%; frameborder = "0"" src="https://docs.google.com/viewer?url='+e+'&embedded=true"></iframe>':e.includes(".jpg")||e.includes(".jpeg")||e.includes(".png")?'<img class="lb-imageSelfie" style="position: relative; height: 100%; width: 100%; frameborder = "0""  src="'+e+'" ></img>':"")}catch(e){alert(e.message)}},t.prototype.setImageWidthHeight=function(t){var i,a,o=this;(new Date).getTime();this.disableKeyboardNav(),i=this.$lightbox.find(".lb-imageSelfie"),this.sizeOverlay(),this.$overlay.fadeIn(this.options.fadeDuration),e(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-imageSelfie, .lb-nav, .lb-dataContainer-selfie, .lb-numbers, .lb-caption-selfie").hide(),this.$lightbox.find(".arrow-prevSelfie, .arrow-nextSelfie").addClass("disableNavigation"),this.$lightbox.find(".lb-closeContainerSelfie").removeAttr("style").css("position","relative"),this.$outerContainer.addClass("animating"),this.$outerContainerSelfie.addClass("animating"),a=new Image,a.onload=function(){var n,l,s,d,r;return i.attr("src",t),e(a),i.width(a.width),i.height(a.height),o.options.fitImagesInViewport&&(e(window).width(),r=e(window).height(),d=r-o.containerTopPadding-o.containerBottomPadding-110,s=r-o.containerTopPadding-o.containerBottomPadding-110,(a.width>d||a.height>s)&&(a.width/d>a.height/s?(l=d,n=parseInt(a.height/(a.width/l),10),i.width(l),i.height(n)):(n=s,l=parseInt(a.width/(a.height/n),10),i.width(l),i.height(n)))),o.sizeContainer(i.width(),i.height())},this.setAngle(0),a.src=t},t.prototype.build=function(){console.log("built");var t=this;e("#lightboxOverlay").length&&(e("#lightboxOverlay").remove(),e("#lightbox").remove()),e("<div id='lightboxOverlay' class='lightboxOverlay'></div><div id='lightbox' class='lightbox'>          <div class='lb-outerContainer'><div class='lb-container'><img class='lb-image' src='' /><div class='lb-loader'><a class='lb-cancel'></a></div></div></div>            <div class='lb-outerContainerSelfie'><div id='' class='lb-container' id='CompareFile' style=\"position: relative; height: 100%; width: 100%; frameborder = '0'\"><iframe ID='iframeCompare' class='lb-imageSelfie'  src='' style=\"position: relative; height: 100%; width: 100%; frameborder = '0' \" /><div class='lb-loader'><a class='lb-cancel'></a></div></div></div><div class='lb-dataContainer'><div class='lb-data'><div class='lb-closeContainer'><div class='lb-details'style='margin-bottom: 10px;'><span class='lb-caption'></span></div><a class='lb-close sprite-img'></a><a class='lb-rotate sprite-img'></a><a class='arrow-next sprite-img'></a><a class='arrow-prev sprite-img'></a><a class='lb-save sprite-img'></a></div>              <div class='lb-closeContainerSelfie'><div class='lb-details'style='margin-bottom: 10px;'><span class='lb-caption-selfie'>Installer Profile Pictures</span></div><a class='lb-close sprite-img'></a><a class='lb-rotateSelfie sprite-img'></a><a class='arrow-nextSelfie sprite-img'></a><a class='arrow-prevSelfie sprite-img'></a><a class='lb-save sprite-img'></a></div></div></div></div>").appendTo(e("body")),e(".lb-closeContainer").draggable(),e(".lb-closeContainerSelfie").draggable(),e(".lb-details").mousedown(function(e){e.stopPropagation()}),this.$lightbox=e("#lightbox"),this.$overlay=e("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$outerContainerSelfie=this.$lightbox.find(".lb-outerContainerSelfie"),this.$container=this.$lightbox.find(".lb-container"),this.containerTopPadding=parseInt(this.$container.css("padding-top"),10),this.containerRightPadding=parseInt(this.$container.css("padding-right"),10),this.containerBottomPadding=parseInt(this.$container.css("padding-bottom"),10),this.containerLeftPadding=parseInt(this.$container.css("padding-left"),10),this.$overlay.hide(),this.$lightbox.hide(),this.$lightbox.find(".arrow-prevSelfie").off("click").on("click",function(){return 0===t.currentSelfieImageIndex?(t.SetSelfieImage(t.SelfieAlbum[t.SelfieAlbum.length-1]),t.currentSelfieImageIndex=t.SelfieAlbum.length-1):(t.SetSelfieImage(t.SelfieAlbum[t.currentSelfieImageIndex-1]),t.currentSelfieImageIndex-=1),!1}),this.$lightbox.find(".arrow-nextSelfie").off("click").on("click",function(){return t.currentSelfieImageIndex===t.SelfieAlbum.length-1?(t.SetSelfieImage(t.SelfieAlbum[0]),t.currentSelfieImageIndex=0):(t.SetSelfieImage(t.SelfieAlbum[t.currentSelfieImageIndex+1]),t.currentSelfieImageIndex+=1),!1}),this.$lightbox.find(".lb-rotateSelfie").off("click").on("click",function(){$cont=t.$lightbox.find(".lb-outerContainerSelfie"),$image=t.$lightbox.find(".lb-image"),null==e($cont).attr("angle")&&e($cont).attr("angle",0);var i=Number(e($cont).attr("angle"));return i+=90,0==i?e($cont).rotate(0):e($cont).rotate({animateTo:i}),e($cont).attr("angle",i),!1}),this.$lightbox.find(".lb-save").off("click").on("click",function(){t.$lightbox.find(".lb-image").css("transform");var i=t.$lightbox.find(".lb-image").attr("src"),a=t.$lightbox.find(".lb-outerContainerSelfie").attr("angle")%360;e.ajax({url:urlSaveImage,type:"POST",async:!1,cache:!1,data:JSON.stringify({Angle:a,Src:i}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){1==e.result?alert("Image Saved."):alert("Error Occured")},error:function(e){e.error&&alert("Error")}})}),this.$lightbox.find(".lb-loader, .lb-close").off("click").on("click",function(){return t.end(),e("body").removeClass("HideOverflow"),!1}),this.$lightbox.find(".arrow-prev").off("click").on("click",function(){return 0===t.currentImageIndex?t.changeImage(t.album.length-1):t.changeImage(t.currentImageIndex-1),!1}),this.$lightbox.find(".arrow-next").off("click").on("click",function(){return t.currentImageIndex===t.album.length-1?t.changeImage(0):t.changeImage(t.currentImageIndex+1),!1}),this.$lightbox.find(".lb-rotate").off("click").on("click",function(){$cont=t.$lightbox.find(".lb-outerContainer"),$image=t.$lightbox.find(".lb-image"),null==e($cont).attr("angle")&&e($cont).attr("angle",0);var i=Number(e($cont).attr("angle"));return i+=90,0==i?e($cont).rotate(0):e($cont).rotate({animateTo:i}),e($cont).attr("angle",i),!1}),this.$lightbox.find(".lb-save").off("click").on("click",function(){t.$lightbox.find(".lb-image").css("transform");var i=t.$lightbox.find(".lb-image").attr("src"),a=t.$lightbox.find(".lb-outerContainer").attr("angle")%360;e.ajax({url:urlSaveImage,type:"POST",async:!1,cache:!1,data:JSON.stringify({Angle:a,Src:i}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){1==e.result?alert("Image Saved."):alert("Error Occured")},error:function(e){e.error&&alert("Error")}})}),this.$lightbox.find(".lb-loader, .lb-close").off("click").on("click",function(){return t.end(),e("body").removeClass("HideOverflow"),!1})},t.prototype.setAngle=function(t){$cont=this.$lightbox.find(".lb-outerContainer"),e($cont).attr("angle")!=t&&(e($cont).rotate({animateTo:t}),e($cont).attr("angle",t))},t.prototype.start=function(t){var i,a,o,n,l,s,d,r,c,h,u,p,f;if(e(window).on("resize",this.sizeOverlay),e("select, object, embed").css({visibility:"hidden"}),this.$overlay.width(e(document).width()).height(e(document).height()).fadeIn(this.options.fadeDuration),this.album=[],l=0,o=t.attr("data-lightbox"),o)for(p=t.closest(".panel").find(t.prop("tagName")+'[data-lightbox="'+o+'"]'),n=r=0,h=p.length;r<h;n=++r)a=p[n],this.album.push({link:e(a).attr("href"),title:e(a).attr("title"),date:e(a).data("date"),lat:e(a).data("lat"),lon:e(a).data("lon"),phototypeid:e(a).data("phototypeid")}),e(a).attr("href")===t.attr("href")&&(l=n);else if("lightbox"===t.attr("rel"))this.album.push({link:t.attr("href"),title:t.attr("title")});else for(f=e(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]'),n=c=0,u=f.length;c<u;n=++c)a=f[n],this.album.push({link:e(a).attr("href"),title:e(a).attr("title")}),e(a).attr("href")===t.attr("href")&&(l=n);i=e(window),d=i.scrollTop()+i.height()/10,s=i.scrollLeft(),this.$lightbox.css({top:d+"px",left:s+"px"}).fadeIn(this.options.fadeDuration),this.setAngle(0),this.changeImage(l),this.GetSelfieImage(t.attr("href"))},t.prototype.changeImage=function(t){var i,a,o=this;(new Date).getTime();this.disableKeyboardNav(),i=this.$lightbox.find(".lb-image"),this.sizeOverlay(),this.$overlay.fadeIn(this.options.fadeDuration),e(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$lightbox.find(".arrow-prev, .arrow-next").addClass("disableNavigation"),this.$lightbox.find(".lb-closeContainer").removeAttr("style").css("position","relative"),this.$outerContainer.addClass("animating"),this.$outerContainerSelfie.addClass("animating"),a=new Image,a.onload=function(){var n,l,s,d,r;return i.attr("src",o.album[t].link),e(a),i.width(a.width),i.height(a.height),o.options.fitImagesInViewport&&(e(window).width(),r=e(window).height(),d=r-o.containerTopPadding-o.containerBottomPadding-110,s=r-o.containerTopPadding-o.containerBottomPadding-110,(a.width>d||a.height>s)&&(a.width/d>a.height/s?(l=d,n=parseInt(a.height/(a.width/l),10),i.width(l),i.height(n)):(n=s,
l=parseInt(a.width/(a.height/n),10),i.width(l),i.height(n)))),o.sizeContainer(i.width(),i.height())},this.setAngle(0),a.src=this.album[t].link,this.currentImageIndex=t},t.prototype.sizeOverlay=function(){return e("#lightboxOverlay").width(e(document).width()).height(e(document).height())},t.prototype.sizeContainer=function(e,t){var i,a,o=this;this.$outerContainer.outerWidth(),oldWidthSelfie=this.$outerContainerSelfie.outerWidth(),this.$outerContainer.outerHeight(),oldHeightSelfie=this.$outerContainerSelfie.outerHeight(),a=e+this.containerLeftPadding+this.containerRightPadding,i=t+this.containerTopPadding+this.containerBottomPadding,this.$outerContainer.animate({width:a,height:i},this.options.resizeDuration,"swing"),this.$outerContainerSelfie.animate({width:a,height:i},this.options.resizeDuration,"swing"),setTimeout(function(){o.$lightbox.find(".lb-prevLink").height(i),o.$lightbox.find(".lb-nextLink").height(i),o.showImage()},this.options.resizeDuration)},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").hide(),this.$lightbox.find(".lb-image").fadeIn("slow"),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav(),resizeImage()},t.prototype.updateNav=function(){this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?this.$lightbox.find(".arrow-prev, .arrow-next").removeClass("disableNavigation"):(this.currentImageIndex>0&&this.$lightbox.find(".arrow-prev").removeClass("disableNavigation"),this.currentImageIndex<this.album.length-1&&this.$lightbox.find(".arrow-next").removeClass("disableNavigation")))},t.prototype.updateDetails=function(){var e=this,t=e.album[this.currentImageIndex];if(void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title){var i=null;i=""==t.lat||""==t.lon?"":t.lat+","+t.lon,this.$lightbox.find(".lb-caption").html('<a href="#" title="Show on map" onclick="showMap('+t.lat+","+t.lon+') ">'+i+"      "+t.date+"</a>").fadeIn("fast")}this.album.length>1&&this.options.showImageNumberLabel?this.$lightbox.find(".lb-number").text(this.options.albumLabel(this.currentImageIndex+1,this.album.length)).fadeIn("fast"):this.$lightbox.find(".lb-number").hide(),this.$outerContainer.removeClass("animating"),this.$outerContainerSelfie.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.resizeDuration,function(){return e.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){var e,t;this.album.length>this.currentImageIndex+1&&(e=new Image,e.src=this.album[this.currentImageIndex+1].link),this.currentImageIndex>0&&(t=new Image,t.src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){e(document).on("keyup.keyboard",e.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){e(document).off(".keyboard")},t.prototype.keyboardAction=function(e){var t,i,a,o;t=37,i=39,o=e.keyCode,a=String.fromCharCode(o).toLowerCase(),"p"===a||o===t?0!==this.currentImageIndex&&this.changeImage(this.currentImageIndex-1):"n"!==a&&o!==i||this.currentImageIndex!==this.album.length-1&&this.changeImage(this.currentImageIndex+1)},t.prototype.end=function(){return this.disableKeyboardNav(),e(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),e("select, object, embed").css({visibility:"visible"})},t}(),e(function(){var e;return e=new i,new t(e)})}.call(this),$("#divVisitList .panel-heading input[type=checkbox]").change(function(){var e=$(".visitId").find(".visit-list-check:checked").add();"True"==e.data("isdeleted")?$("#restoreDeletedVisit").show():1!=e.length&&$("#restoreDeletedVisit").hide()}),$("#restorebtn").click(function(){var e=[],t=$(".restore").find(".visit-list-check:checked").add(),i=t.data("jobscid"),a=t.data("cid"),o=$(".restore-photo").find(".visit-list-check:checked").add();if(1!=o.length)return alert("Please select one Check list Item."),!1;$.each($(".photo .visit-list-check:checked"),function(){e.push($(this).val())});var n=e.join(",");a=null!=a?a:o.data("cid");var l=o.data("ct"),s=!1,d=!1;"Default_Photo_Serial"!=a&&"Default_Photo_installation"!=a||(l=o.data("type"),s=!0,a=null),"Reference_Photo"==a&&(d=!0,a=null),urlRestoreData=urlRestoreDataforReferenceAndDefault+n+"&jobid="+jobId+"&jobscId="+i+"&vclId="+a+"&type="+l+"&isReference="+d+"&isDefault="+s,$("#restoreChecklistItmes").modal("hide"),$.ajax({url:urlRestoreData,method:"GET",cache:!1,async:!1,success:function(e){e?($("#mdlChecklistItmesdata").load(urldeletedChecklist+jobId),ReloadJobPhotoSection1(jobId),$("#mdlChecklistItmes").modal("show"),showMessageForJobPhoto("File has been restored successfully.",!1)):$("#mdlChecklistItmes").modal("show")}})}),$("#cancelbtn").click(function(){$("#restoreChecklistItmes").modal("hide"),$("#mdlChecklistItmes").modal("show")}),$("#mdlcloseclitems").click(function(){$("#mdlChecklistItmes").modal("hide")});