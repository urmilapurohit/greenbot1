function setFiles(e,t,a){var o=e;o.html(""),o.attr("totalCount",t.length);for(var n=0;n<t.length;n++){var i=$("<tr/>").data("data",t[n]).data("path",t[n].Path).data("id",t[n].JobDocumentId);i.addClass("job-document-"+t[n].JobDocumentId),"CES"==a&&i.attr("id","ces_"+t[n].JobDocumentId),"PNLINVC"==a&&i.attr("id","pnlinvoice_"+t[n].JobDocumentId),"ELECBILL"==a&&i.attr("id","elecbill_"+t[n].JobDocumentId),"OTHER"==a&&(i.attr("id","other_"+t[n].JobDocumentId),i.attr("isreczip",t[n].IsRecZip)),i.appendTo(o);$("<td/>").css("width","2%").appendTo(i);if(null==t[n].IsSPVXml||!t[n].IsSPVXml||null==t[n].IsRecZip||!t[n].IsRecZip||(t[n].IsRecZip||t[n].IsSPVXml)&&("1"==USERType||"3"==USERType)){$("<td/>").text(t[n].Path.split("\\").pop()).appendTo(i);var l=$("<td/>").addClass("action").appendTo(i)}l=$("<td/>").addClass("action").appendTo(i);if("CES"==a){params="'CES','','','"+t[n].Path+"','0','ces_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var s=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocument("+params+")").appendTo(l);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(s,0)}if("PNLINVC"==a){params="'PNLINVC','','','"+t[n].Path+"','0','pnlinvoice_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var d=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocument("+params+")").appendTo(l);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(d,0)}if("ELECBILL"==a){params="'ELECBILL','','','"+t[n].Path+"','0','elecbill_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var r=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").attr("data-filename",t[n].Path.split("\\").pop()).data("type",a).attr("onclick","viewDocument("+params+")").appendTo(l);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(r,0)}if(null==t[n].IsSPVXml||!t[n].IsSPVXml||null==t[n].IsRecZip||!t[n].IsRecZip||(t[n].IsRecZip||t[n].IsSPVXml)&&("1"==USERType||"3"==USERType)){if("OTHER"==a){params="'OTHER','','','"+t[n].Path+"','0','other_"+t[n].JobDocumentId+"','"+t[n].JobDocumentId+"'";var c=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("data-filename",t[n].Path.split("\\").pop()).attr("title","Signature Mail").data("type",a).attr("onclick","viewDocument("+params+")").appendTo(l);allowdViewTypes.indexOf(t[n].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(c,0)}$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(l);if(t[n].IsRecZip||t[n].IsSPVXml)$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("onclick","onclick=DownloadJobDocuments("+t[n].JobDocumentId+")").appendTo(l);else $("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t[n].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t[n].JobDocumentId+",0)>Download final</a>").appendTo(l)}1!=t[n].IsRecZip&&1!=t[n].IsSPVXml||"1"==USERType||"3"==USERType||$("#other_"+t[n].JobDocumentId).remove()}"CES"==a&&0==$(e).children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):"CES"==a&&$(e).children().length>0&&($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),"PNLINVC"==a&&0==$(e).children().length?($("#divDocumentsPnlInvoice").find(".table-responsive").hide(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").show()):"PNLINVC"==a&&$(e).children().length>0&&($("#divDocumentsPnlInvoice").find(".table-responsive").show(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").hide()),"ELECBILL"==a&&0==$(e).children().length?($("#divDocumentsElecBill").find(".table-responsive").hide(),$("#divDocumentsElecBill").find(".noDocumentElecBill").show()):"ELECBILL"==a&&$(e).children().length>0&&($("#divDocumentsElecBill").find(".table-responsive").show(),$("#divDocumentsElecBill").find(".noDocumentElecBill").hide()),PopoverEnable();var p=$("#STCStatusId").val();"1"!=USERType&&"3"!=USERType&&"10"!=p&&"12"!=p&&"14"!=p&&"17"!=p&&$("#tbodyCES .delete").hide()}function generateDocument(e,t,a,o,n,i,l){var s=$("#divDocumentsSTC").find("table").find("#"+i).data("data");if(eJobId){var d=!0;d&&($("#loading-image").show(),$.ajaxSetup({async:!0,cache:!1}),$.get(urlGenerateDocument+"?id="+eJobId+"&documentId=0&stage="+s.Stage+"&state=&provName=&name="+encodeURIComponent(s.Path)+"&isDeleteFirst="+$("tr#"+i).find(".hdnIsUpload").attr("val")+"&isClassic=false&jobDocumentId="+s.JobDocumentId,"",function(e){showMessage("Document has been generated successfully.",!1,"STC"),SearchHistory()}))}}function downloadDocument(e,t,a,o,n,i,l,s){var d=$("#divDocumentsSTC").find("table").find("#"+i).data("data");return eJobId&&$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&(window.location.href=urlDownloadSTCDocument+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(d.Path)+"&isEditable="+s),$(".pop").popover("hide"),SearchHistory(),!1}function uploadDocument(e,t,a,o,n,i){if(eJobId){var l=!0;l&&($(".fileUpload1").unbind("fileuploadsubmit").bind("fileuploadsubmit",function(i,l){l.formData={id:eJobId,documentid:n,stage:e,state:t,provName:a,name:o,isClassic:!1}}),doneCallBack=function(){"STC"==e?($("#divDocumentsSTC").find(".table-responsive").show(),$("#trDoc_1").css("display",""),$("#divDocumentsSTC").find(".noDocument").hide()):(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+obj,!1,!1))},$(".fileUpload1").click())}return!1}function doneCallBack(){getDocuments(!0)}function checkBusinessRulesForDocument(e){var t=CommonDataForSave();$.ajax({url:urlCheckBusinessRules,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:t,success:function(t){t.IsSuccess?(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+e,!1,!1),null!=t.STCStatusName&&null!=t.STCStatusName&&""!=t.STCStatusName&&$("#spanSTCStatus").text(t.STCStatusName.trim()),null!=t.STCDescription&&null!=t.STCDescription&&""!=t.STCDescription&&$("#STCDescription").html(t.STCDescription.trim()),null!=t.STCStatusId&&null!=t.STCStatusId&&""!=t.STCStatusId&&$("#STCStatusId").val(t.STCStatusId.trim())):t.IsError&&(showMessage("Document has been generated successfully.",!1,"STC"),setViewIcon("tr#"+e,!1,!1))}})}function deleteDocument(e,t,a,o,n,i){var l=$("#divDocumentsSTC").find("table").find("#"+i).data("data");eJobId&&$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&confirm("Are you sure you want to delete this file ?")&&($.ajaxSetup({async:!1,cache:!1}),$.get(urlDeleteDocument+"?id="+eJobId+"&documentId="+n+"&stage="+e+"&state="+t+"&provName="+a+"&name="+o+"&isClassic=false&jobDocumentPath="+l.Path+"&jobDocumentId="+l.JobDocumentId,"",function(t){"STC"==e&&($("#divDocumentsSTC").find("table").find("#"+i).remove(),$("#divDocumentsSTC").find("table").find("tr")&&$("#divDocumentsSTC").find("table").find("tr").length>0?($("#divDocumentsSTC").find(".table-responsive").show(),$("#divDocumentsSTC").find(".noDocument").hide()):($("#divDocumentsSTC").find(".table-responsive").hide(),$("#divDocumentsSTC").find(".noDocument").show(),$("#loading-image").show(),setTimeout(function(){ReloadSTCJobScreen(eJobId)},500))),showMessage("Document has been deleted successfully.",!1,"STC"),SearchHistory()}))}function showMessage(e,t,a){var o,n;$(".alert").hide(),"CES"==a.toUpperCase()?(o=t?"errorMsgRegionCES":"successMsgRegionCES",n=t?"successMsgRegionCES":"errorMsgRegionCES"):"STC"==a.toUpperCase()?(o=t?"errorMsgRegionSTC":"successMsgRegionSTC",n=t?"successMsgRegionSTC":"errorMsgRegionSTC"):"OTHER"==a.toUpperCase()?(o=t?"errorMsgRegionOther":"successMsgRegionOther",n=t?"successMsgRegionOther":"errorMsgRegionOther"):"PNLINVC"==a.toUpperCase()?(o=t?"errorMsgRegionPnlInvoice":"successMsgRegionPnlInvoice",n=t?"successMsgRegionPnlInvoice":"errorMsgRegionPnlInvoice"):"ELECBILL"==a.toUpperCase()&&(o=t?"errorMsgRegionElecBill":"successMsgRegionElecBill",n=t?"successMsgRegionElecBill":"errorMsgRegionElecBill"),$("#"+n).hide(),$("#"+o).html(closeButton+e),$("#"+o).show()}function OpacityIncreaseDecrease(e,t){t>0?(e.css("opacity","1"),e.css("pointer-events","visible")):(e.css("opacity","0.5"),e.css("pointer-events","none"))}function setViewIcon(e,t,a){var o=t?"":"disView",n=t?"disView":"",i=t?"":"notdownload",l=t?"notdownload":"",s=t?"":"semiBold",d=t?"semiBold":"";$(e).find(".view").removeClass(o).addClass(n).addClass("sprite-img"),$(e).find(".download_doc").removeClass(i).addClass(l),$(e).find(".delete").removeClass(o.replace("View","Delete")).addClass(n.replace("View","Delete")),$(e).find(".tdDoc").removeClass(d).addClass(s),$(e).find(".hdnIsExists").attr("val",t?"0":"1"),$(e).find(".hdnIsUpload").attr("val",a?"1":"0")}function assignEvent(){$("#loading-image").show();var e=BaseURL+"UploadDocument";e=e.replace("Index/",""),$("#btnUploadSTCDocument").fileupload({url:e,dataType:"json",done:function(e,t){doneCallBack&&doneCallBack(),SearchHistory()},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){var a=t.files[0].type.split("/"),o=a[0];if(t.files.length>1)for(var n=0;n<t.files.length;n++){if(t.files[n].size>parseInt(ProjectSession_MaxImageSize))return showMessage(" "+t.files[n].name+" Maximum document size limit exceeded. Please upload a file smaller  than "+maxsize+"MB.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[n].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}else{if(t.files[0].size>parseInt(ProjectSession_MaxImageSize))return showMessage("Maximum  document size limit exceeded.Please upload a  file smaller than "+maxsize+"MB.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[0].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}if(1==t.files.length){var i=t.files[0].name.toLowerCase().split(".").length>0?t.files[0].name.toLowerCase().split(".")[t.files[0].name.toLowerCase().split(".").length-1]:"";if("application/pdf"!=t.files[0].type&&"pdf"!=i&&"image"!=o&&"heic"!=i)return showMessage("Please upload a document with .pdf extension or image file.",!0,"STC"),!1;if(CheckSpecialCharInFileName(t.files[0].name))return showMessage(" "+t.files[n].name+"Please upload file that not conatain <> ^ [] .",!0,"STC"),!1}return!0},formData:{id:eJobId,stage:"STC",isClassic:!1},change:function(e,t){}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function isImage(e){return imageTypes.indexOf(e.toLowerCase().split(".").pop())>-1}function ViewPhotoDoc(e){e=UploadedDocumentPath+e,$("#loading-image").css("display",""),$("#imgDocImage").attr("src",e).load(function(){logoWidthDoc=this.width,logoHeightDoc=this.height,$("#popupViewer").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeightDoc?($("#imgDocImage").closest("div").height($(window).height()-205),$("#imgDocImage").closest("div").css("overflow-y","scroll"),$("#imgDocImage").height(logoHeightDoc)):($("#imgDocImage").height(logoHeightDoc),$("#imgDocImage").closest("div").removeAttr("style")),screen.width<=logoWidthDoc||logoWidthDoc>=screen.width-250?($("#popupViewer").find(".modal-dialog").width(screen.width-250),$("#imgDocImage").width(logoWidthDoc)):($("#imgDocImage").width(logoWidthDoc),$("#popupViewer").find(".modal-dialog").width(logoWidthDoc)),$("#loading-image").css("display","none")}),$("#popupViewer").unbind("error"),$("#imgDocImage").attr("src",e).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}function deleteFile(e,t,a){e.data("id"),e.data("path");var o=JobId,n={id:e.data("id"),path:e.data("path"),deleteFile:t,JobId:o};confirm("Are you sure you want to delete this file ?")&&deleteDoc(n).then(function(t){t?(e.remove(),"CES"==a&&(0==$("#tbodyCES").children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),0==$("#tbodyCES").find("tr").length&&ReloadSTCModule()),"PNLINVC"==a&&(0==$("#tbodyPnlInvoice").children().length?($("#divDocumentsPnlInvoice").find(".table-responsive").hide(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").show()):($("#divDocumentsPnlInvoice").find(".table-responsive").show(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").hide()),0==$("#tbodyPnlInvoice").find("tr").length&&ReloadSTCModule()),"ELECBILL"==a&&(0==$("#tbodyElecBill").children().length?($("#divDocumentsElecBill").find(".table-responsive").hide(),$("#divDocumentsElecBill").find(".noDocumentElecBill").show()):($("#divDocumentsElecBill").find(".table-responsive").show(),$("#divDocumentsElecBill").find(".noDocumentElecBill").hide()),0==$("#tbodyElecBill").find("tr").length&&ReloadSTCModule()),"Other"==a&&(0==$('tr[isreczip="true"]').length?$("#onOffSwitchGenerateRecZip").prop("checked",!1):$("#onOffSwitchGenerateRecZip").prop("checked",!0)),SearchHistory(),showMessage("File has been deleted Successfully.",!1,a)):showMessage("There is some error while deleting file.",!0,a)})}function DownloadJobDocuments(e,t){window.location.href=urlDownloadJobDocuments+"?jobDocId="+e+"&isEditable="+t,$(".pop").popover("hide"),SearchHistory()}function deleteDoc(e){return new Promise(function(t){$.ajaxSetup({async:!1,cache:!1}),$.post(urlDeleteDocumentNew,e,function(e){t(e)})})}function PopoverEnable(e){void 0!==e&&(e=e||window.event,e.preventDefault()),$(".pop").popover("hide"),$(".pop").popover({html:!0})}function ShowDocumentSendSignateReuqest(e,t="STC"){$("#SendMailDocumentSignatureRequest").modal({backdrop:"static",keyboard:!1}),$("#JobDocumentPreview").load(urlDocumentPreview+"?jobdocid="+e+"&type=0")}function ShowPopupForEmailTamplete(e){$("#DocumentSignatureRequestTableBody input[type='checkbox']:checked").length>0?(SelectedUsersForSendMailRequestForDocumentSignature=[],$("#DocumentSignatureRequestTableBody input[type='checkbox']:checked").each(function(e,t){"ChkInstaller"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(2):"ChkDesigner"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(4):"ChkElectrician"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(3):"ChkHomeOwner"==$(t).attr("id")?SelectedUsersForSendMailRequestForDocumentSignature.push(1):"ChkSolarCompany"==$(t).attr("id")&&SelectedUsersForSendMailRequestForDocumentSignature.push(6)}),FillDropDown("lstEmailTemplate",urlGetEmailTemplateList,null,!0,null),$("#SendMailDocumentSignatureRequest").modal("toggle"),$("#popupSendEmailForBulkSignature").modal({backdrop:"static",keyboard:!1})):alert("Please select any one option.")}function sendEmailForSignatureRequest(){if(""!=$("#lstEmailTemplate").val()){var e={};$.ajax({url:urlSendEmailForSignatureRequest,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({sendEmailRequest:e,emailTemplateId:$("#lstEmailTemplate").val(),jobDocId:$("#SendMailDocumentSignatureRequest").attr("jobdocid"),typesList:SelectedUsersForSendMailRequestForDocumentSignature}),success:function(e){$("#popupSendEmailForBulkSignature").modal("toggle"),$("#loading-image").hide(),SearchHistory()},error:function(){}})}else alert("please select email template ")}function ToggleModelPopup(e){$(e).modal("toggle")}function fnDocViewerOuterPopup(){$("#DocViewerOuterPopup").html(""),$("#DocViewerOuterPopup").load(urlDocViewerOuterPopup)}function viewDocument(e,t,a,o,n,i,l){var s,d,r=$("#STCStatusId").val();if($("#btnSendRequest").show(),i.indexOf("trDoc")>-1?(s=$("#divDocumentsSTC").find("table").find("#"+i).data("data"),d=$("#divDocumentsSTC").find("table").find("#"+i).find("td").html(),1==USERType||3==USERType||"True"==isSaveDocAfterTradeJob||"10"==r||"12"==r||"14"==r||"17"==r?$("#popupViewerDoc #btnSave").show():$("#popupViewerDoc #btnSave").hide()):i.indexOf("ces")>-1?(s=$("#tbodyCES #"+i).data("data"),d=$("#tbodyCES #"+i).find("td:eq(1)").html(),1==USERType||3==USERType||"True"==isSaveDocAfterTradeJob||"10"==r||"12"==r||"14"==r||"17"==r?$("#popupViewerDoc #btnSave").show():$("#popupViewerDoc #btnSave").hide()):i.indexOf("pnlinvoice")>-1?(s=$("#tbodyPnlInvoice #"+i).data("data"),d=$("#tbodyPnlInvoice #"+i).find("td:eq(1)").html(),$("#popupViewerDoc #btnSave").show()):i.indexOf("elecbill")>-1?(s=$("#tbodyElecBill #"+i).data("data"),d=$("#tbodyElecBill #"+i).find("td:eq(1)").html(),$("#popupViewerDoc #btnSave").show()):i.indexOf("other")>-1&&(s=$("#tbodyOther #"+i).data("data"),d=$("#tbodyOther #"+i).find("td:eq(1)").html(),$("#popupViewerDoc #btnSave").show()),d=decodeURI(d),isImage(d))ViewPhotoDoc(s.Path),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#hdrFileName").text(s.Path.split("\\").slice(s.Path.split("\\").length-1));else if($("#popupViewerDoc").data("data",null),$("#popupViewerDoc").data("data",s),$("#popupViewerDoc").attr("data-hdnIsUpload",$("tr#"+i).find(".hdnIsUpload").attr("val")),eJobId){i.indexOf("trDoc")>-1?$("tr#"+i).find(".hdnIsExists")&&$("tr#"+i).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+i).find(".hdnIsExists").attr("val")&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),JobDocumentName=$("tr#"+i).find(".document-signature-send-request").attr("data-filename"),$("#divViewer").load(url_Viewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(s.Path)+"&jobDocumentId="+l),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),$("#popupViewerDoc").find(".modal-title span").html(JobDocumentName),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide()):($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),JobDocumentName=$("tr#"+i).find(".document-signature-send-request").attr("data-filename"),$("#divViewer").load(url_Viewer+"?jobid="+eJobId+"&docId="+n+"&isClassic=false&jobDocumentPath="+encodeURIComponent(s.Path)+"&jobDocumentId="+l),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),$("#popupViewerDoc").find(".modal-title span").html(JobDocumentName),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide());$("tr#"+i).find(".document-signature-send-request")}}function viewDocumeneCES(e){e&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),$("#divViewer").load(url_Viewer+"?path="+e),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide())}function viewDocumentOther(e,t){eJobId&&($("#loading-image").show(),$.ajaxSetup({async:!1,cache:!1}),$("#divViewer").load(url_DocViewer+"?jobDocId="+e+"&jobid="+eJobId),$("#popupViewerDoc").modal({backdrop:"static",keyboard:!1}),"false"==isJobDocumentManagerSave&&$("#divViewer").find("form").find("#btnSave").hide())}function getDocuments(e){$.get(urlGetDocumentsListAll+"?id="+JobId+"&distributorID="+DistributorId+"&stage=stc&jobTypeId=1","",function(t){LoadDocuments(t,e)})}function htmlDecode(e){var t=(new DOMParser).parseFromString(e,"text/html");return t.documentElement.textContent}function LoadDocuments(e,t){if(e){var a=JSON.parse(htmlDecode(e).replaceAll("\\","\\\\")),o=a.Table,n=(a.Table1,o.filter(e=>"CES"===e.Type)),i=o.filter(e=>"STC"===e.Type),l=o.filter(e=>"OTHER"===e.Type),s=o.filter(e=>"PNLINVC"===e.Type),d=o.filter(e=>"ELECBILL"===e.Type),r=($("#tbodyCES"),$("#tbodySTC")),c=$("#tbodyOther");if($tbodyPnlInvoice=$("#tbodyPnlInvoice"),$tbodyElecBill=$("#tbodyElecBill"),setFiles($("#tbodyCES"),n,"CES"),setFiles(c,l,"OTHER"),setFiles($tbodyPnlInvoice,s,"PNLINVC"),setFiles($tbodyElecBill,d,"ELECBILL"),i.length>0){$("#divDocumentsSTC").find("table").find("tr")&&$("#divDocumentsSTC").find("table").find("tr").length>0&&$("#divDocumentsSTC").find("table").find("tr").remove();for(var p=0;p<i.length;p++){var u=i[p];u.Stage="STC";var m=u.Name||u.Path.split("\\").pop();u.Name=m,u.IsExist=!0;var h="'"+u.Stage+"','','','"+escape(u.Path)+"','0','trDoc_"+p+"','"+u.JobDocumentId+"'",f=(u.Stage,escape(u.Path),u.Id,u.DocumentId,$("<td>").attr("class","action")),D="";1==u.IsCompleted?D="document-status-green":1==u.SentEmailStatus&&(D="document-status-orange"),f.append('<input type="hidden" class="hdnIsExists" val="'+(1==u.IsExist?1:0)+'" />').append('<input type="hidden" class="hdnIsUpload" val="'+(1==u.isUpload?1:0)+'" />');var g="True"==isJobDocumentManagerSignatureMail?'<a href="javascript:void(0);" class="'+D+' icon sprite-img email-ic document-signature-send-request" data-filename="'+u.Name+'" onclick="viewDocument('+h+');" title = "Signature Mail">':"";f.append(g),g="True"==isJobDocumentManagerGenerate?'<a class="ganret sprite-img" href="javascript:void(0);"onclick="generateDocument('+h+');" title="Generate">':"",f.append(g),g="True"==isJobDocumentManagerView?'<a class="sprite-img download pop '+(u.IsExist&&1==u.IsExist?"":"notdownload")+'" href="javascript:void(0);" data-container="body" data-toggle="popover" data-placement="bottom" data-content="<a href=&quot;javascript:void(0);&quot; class=&quot;editable-pdf pdf-down&quot; onclick=&quot;downloadDocument('+h+",1)&quot;>Download edit</a><a href=&quot;javascript:void(0);&quot; class=&quot;non-editable-pdf pdf-down&quot; onclick=&quot;downloadDocument("+h+',0)&quot;>Download final</a>">':"",f.append(g),g="True"==isJobDocumentManagerDelete?'<a class="delete sprite-img'+(u.IsExist&&1==u.IsExist?"":"disDelete")+'" href="javascript:void(0);"onclick="deleteDocument('+h+');" title="Delete">':"",f.append(g);var v=$('<tr id="trDoc_'+p+'" class="job-document-'+u.JobDocumentId+'" >').append($('<td class="tdDoc '+(u.IsExist&&1==u.IsExist?"semiBold":"")+'">').attr("style","text-align:left!important;word-break: break-all;").html(u.Name)).append(f);v.data("data",u),imageTypes.indexOf($(v).find("td").html().toLowerCase().split(".").pop())>-1&&OpacityIncreaseDecrease($(v).find(".ganret"),0),r.append(v),t&&showMessage("Document has been uploaded successfully.",!1,"STC"),$("#divDocumentsSTC").find(".table-responsive").show(),$("#divDocumentsSTC").find(".noDocument").hide()}t&&$("#divDocumentsSTC").find("table").find("tr")&&1==$("#divDocumentsSTC").find("table").find("tr").length&&($("#loading-image").show(),setTimeout(function(){ReloadSTCJobScreen(eJobId)},500))}else $("#divDocumentsSTC").find(".table-responsive").hide(),$("#divDocumentsSTC").find(".noDocument").show()}assignEvent(),PopoverEnable()}function DownloadGPSLogFiles(){window.location.href=urlDownloadGPSLogs+"?jobId="+JobId}var logoHeightDoc,logoWidthDoc;$("#btnUploadCESDocument").click(function(e){e.preventDefault(),document.getElementById("uploadCESBtnDocument").click()}),$("#btnCreateCESDocument").click(function(e){typeOfFile="CES",e.preventDefault(),$("#popupDocumentCreateConfirm").modal("show")}),$("#btnCreateCESPdf").click(function(e){var t=[],a=[];$("[data-folder=CES]").each(function(e,o){t.push($(this).attr("data-cid")),a.push($(this).attr("data-nm"))});var o=[],n=[];$("#tbodyCES").children().each(function(e,t){o.push($(this).data("id")),n.push($(this).data("path"))});var i={checkListIds:t,JobId:JobId,UserId:USERID,type:"2",pdfname:a,docid:o,docpath:n};$.ajax({url:urlUploadCESPdf,data:JSON.stringify(i),contentType:"application/json",dataType:"json",method:"post",success:function(e){getDocuments(!1)}})}),$("#uploadCESBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyCES"),l=0;l<t.result.length;l++){if(1==t.result[l].Status){var s="JobDocuments\\"+JobId+"\\CES\\"+t.result[l].FileName,d=$("<tr/>").data("data",t.result[l]).data("path",s).data("id",t.result[l].AttachmentID).attr("id","ces_"+t.result[l].AttachmentID).addClass("job-document-"+t.result[l].AttachmentID).appendTo(i),r=($("<td/>").css("width","2%").appendTo(d),$("<td/>").text(t.result[l].FileName).appendTo(d),$("<td/>").addClass("action").appendTo(d),$("<td/>").addClass("action").appendTo(d)),c=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",t.result[l].FileName).attr("onclick",'viewDocument("CES","","","'+s+'",0,"ces_'+t.result[l].AttachmentID+'","'+t.result[l].AttachmentID+'");').appendTo(r);if(allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(c,0),"1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(r);$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",0)>Download final</a>").appendTo(r)}else 0==t.result[l].Status&&"File Type Not Allowed."==t.result[l].Message?n.push(t.result[l].FileName):0==t.result[l].Status&&"BigName"==t.result[l].Message?o.push(t.result[l].FileName):a.push(t.result[l].FileName);PopoverEnable(),0==i.children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),1==$("#tbodyCES").find("tr").length&&ReloadSTCModule()}return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"CES"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"CES"),!1):(showMessage("File has been uploaded successfully.",!1,"CES"),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"CES"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"CES"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"CES"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"CES"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"CES"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"CES"},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#uploadOthreBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyOther"),l=0;l<t.result.length;l++)if(1==t.result[l].Status){var s="JobDocuments\\"+JobId+"\\OTHER\\"+t.result[l].FileName,d=$("<tr/>").data("data",t.result[l]).data("path",s).data("id",t.result[l].AttachmentID).attr("id","other_"+t.result[l].AttachmentID).addClass("job-document-"+t.result[l].AttachmentID).appendTo(i),r=($("<td/>").css("width","2%").appendTo(d),$("<td/>").text(t.result[l].FileName).appendTo(d),$("<td/>").addClass("action").appendTo(d),$("<td/>").addClass("action").appendTo(d)),c=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",t.result[l].FileName).attr("onclick","viewDocument('OTHER','','','"+encodeURIComponent(s)+"',0,'other_"+t.result[l].AttachmentID+"','"+t.result[l].AttachmentID+"');").appendTo(r);allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(c,0);$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(r),$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",0)>Download final</a>").appendTo(r)}else 0==t.result[l].Status&&"File Type Not Allowed."==t.result[l].Message?n.push(t.result[l].FileName):0==t.result[l].Status&&"BigName"==t.result[l].Message?o.push(t.result[l].FileName):a.push(t.result[l].FileName);return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"Other"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"Other"),!1):(showMessage("File has been uploaded successfully.",!1,"Other"),PopoverEnable(),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"Other"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"Other"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"Other"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"Other"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"Other"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"OTHER"},change:function(e,t){}}).prop("disabled",!$.support.fileInput),$("#btnSTCDocument").click(function(e){e.preventDefault(),document.getElementById("btnUploadSTCDocument").click()}),$("#btnCreateDoc").click(function(e){typeOfFile="other",e.preventDefault(),$("#popupDocumentCreateConfirm").modal("show")}),$("#ddlCat").change(function(){this.value&&this.value>0&&$.get(urlGetDocumentsByStateId+"?stateId="+this.value,function(e){var t=$("#tbodyItems");if(t.html(""),
e)for(var a=JSON.parse(e).Table,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({name:a[o].Name,path:a[o].Path}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),l=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox">'+a[o].Name;l.html(s)}})}),$("#btnAddDoc").click(function(e){e.preventDefault();var t=$("#tbodyItems").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),TemplateName:n.data("name")})}var i={jobId:JobId,docs:a,UserId:USERID,fillData:$("#ddlFillData").val(),UseNewDocTemplate:!1,type:typeOfFile};$.post(urlAddOtherDocuments,i,function(e){if(e){$tbody=$("#tbodyOther"),"ces"==typeOfFile.toLowerCase()&&($tbody=$("#tbodyCES"));for(var t=e.filter(e=>0===e.JobDocumentId),a=e.filter(e=>0!=e.JobDocumentId),o=0;o<a.length;o++){var n=$("<tr/>").data("data",a[o]).data("path",a[o].Path).data("id",a[o].JobDocumentId);"CES"==typeOfFile.toUpperCase()&&n.attr("id","ces_"+a[o].JobDocumentId),"OTHER"==typeOfFile.toUpperCase()&&n.attr("id","other_"+a[o].JobDocumentId),n.addClass("job-document-"+a[o].JobDocumentId),n.appendTo($tbody);$("<td/>").css("width","2%").appendTo(n),$("<td/>").text(a[o].name).appendTo(n);var i=$("<td/>").addClass("action").appendTo(n);if("CES"==typeOfFile.toUpperCase())$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[o].name).attr("onclick","viewDocument('CES','','','"+a[o].Path+"',0,'ces_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(i);if("OTHER"==typeOfFile.toUpperCase()){var l=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","CES").attr("data-filename",a[o].name).attr("onclick","viewDocument('OTHER','','','"+a[o].Path+"',0,'other_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(i);allowdViewTypes.indexOf(a[o].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(l,0)}$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",0)>Download final</a>").appendTo(i);if("1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(i)}if(t.length>0){var s="";for(o=0;o<t.length;o++)s+="- "+t[o].message+"\n";alert(s)}else showMessage("Document has been uploaded successfully.",!1,typeOfFile);"ces"==typeOfFile.toLowerCase()&&(0==$tbody.children().length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),1==$("#tbodyCES").find("tr").length&&ReloadSTCModule()),PopoverEnable(),$("#mdlDocs").modal("hide"),SearchHistory()}})}),$("#btnClear").click(function(e){e.preventDefault()}),$("#tbodyCES,#tbodyOther,#tbodyPnlInvoice,#tbodyElecBill").on("click",".view",function(e){e.preventDefault();var t=$(this),a=encodeURIComponent(t.closest("tr").data("path"));$("#loading-image").show(),setTimeout(function(){isImage(a)?(ViewPhotoDoc(a),$("#btnPrev,#btnNext").attr("disabled","disabled"),$("#hdrFileName").text(a.split("\\").slice(a.split("\\").length-1))):viewDocumentOther(t.closest("tr").data("id"),t.data("type"))},500)}),$("#divDocumentsCES").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");deleteFile(t,!0,"CES")}),$("#tbodyOther").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");1==$('tr[isreczip="true"]').length&&$("#onOffSwitchGenerateRecZip").prop("checked",!1),deleteFile(t,!0,"Other")}),$("#btnDownloadAllCES,#btnDownloadAllOther").click(function(e){e.preventDefault();var t,a=$(this).data("type");if("ces"==a&&(t=$("#tbodyCES")),t="stc"==a?$("#tbodySTC"):$("#tbodyOther"),!(t.find("tr").length>0))return alert("No documents available."),!1;window.location.href=urlDownloadAllDocumentsNew+"?jobid="+JobId+"&type="+a,SearchHistory()}),$("#btnDownloadJobFullPack").click(function(e){console.log(JobId),window.location.href=urlGetFullJobPack+"?JobID="+eJobId}),$("#btnUploadOther").click(function(e){e.preventDefault(),document.getElementById("uploadOthreBtnDocument").click()}),$(document).ready(function(){$("#btnDownloadGPSLogs").click(function(e){$.ajax({type:"GET",url:urlGPSLogFilesExists,dataType:"json",async:!1,data:{jobId:JobId},success:function(e){e.status?window.location.href=urlDownloadGPSLogs+"?jobId="+JobId:alert("File not exists!!!")},error:function(e){alert("File not exists")}})}),$("#nextDocumentTemplate").click(function(){if(1==$("#docTemplateId").val()){var e=0;e="ces"==typeOfFile.toLowerCase()?"true":"false",$.get(urlGetAllDocumentTemplate+"?jobTypeId="+parseInt($("#BasicDetails_JobType").val())+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&isSTC=false&isCES="+e,function(e){var t=$("#tbodyDocItemsForJob");if(t.html(""),e)for(var a=e,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({path:a[o].Path,name:a[o].Path.split("/").pop(),tempName:a[o].DocumentTemplateName}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),l=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox" >'+a[o].DocumentTemplateName;l.html(s)}}),$("#popupDocumentCreateConfirm").modal("toggle"),$("#DocumentTemplate").modal("show")}else $.get(urlGetStateList,function(e){if(e){for(var t=JSON.parse(e).Table,a="",o=0;o<t.length;o++)a+="<option value="+t[o].StateID+">"+t[o].Name+"</option>";$("#ddlCat").html(""),$("#ddlCat").append(a),$("#ddlCat").change()}}),$("#popupDocumentCreateConfirm").modal("hide"),$("#mdlDocs").modal("show")}),$("#btnPopupDocumentCreateConfirm").click(function(){$("#popupDocumentCreateConfirm").modal("toggle")}),$("#btndocumentTampleClose").click(function(){$("#DocumentTemplate").modal("toggle")}),$("#btnAddExistingDoc").click(function(e){e.preventDefault();var t=$("#tbodyDocItemsForJob").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),TemplateName:n.data("tempName")+".pdf"})}var i={jobId:JobId,docs:a,UserId:USERID,fillData:!0,UseNewDocTemplate:!0,type:typeOfFile};$.post(urlAddOtherDocuments,i,function(e){if(e){$tbody=$("#tbodyOther"),"ces"==typeOfFile.toLowerCase()&&($tbody=$("#tbodyCES"));for(var t=e.filter(e=>0===e.JobDocumentId),a=e.filter(e=>0!=e.JobDocumentId),o=0;o<a.length;o++){var n=$("<tr/>").data("data",a[o]).data("path",a[o].Path).data("id",a[o].JobDocumentId);"CES"==typeOfFile.toUpperCase()&&n.attr("id","ces_"+a[o].JobDocumentId),"OTHER"==typeOfFile.toUpperCase()&&n.attr("id","other_"+a[o].JobDocumentId),n.addClass("job-document-"+a[o].JobDocumentId),n.appendTo($tbody);$("<td/>").css("width","2%").appendTo(n),$("<td/>").text(a[o].name).appendTo(n);var i=$("<td/>").addClass("action").appendTo(n);if("CES"==typeOfFile.toUpperCase())$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[o].name).attr("onclick","viewDocument('CES','','','"+a[o].Path+"',0,'ces_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(i);if("OTHER"==typeOfFile.toUpperCase()){var l=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type",typeOfFile.toUpperCase()).attr("data-filename",a[o].name).attr("onclick","viewDocument('OTHER','','','"+a[o].Path+"',0,'other_"+a[o].JobDocumentId+"','"+a[o].JobDocumentId+"');").appendTo(i);allowdViewTypes.indexOf(a[o].Path.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(l,0)}$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+a[o].JobDocumentId+",0)>Download final</a>").appendTo(i);if("1"==USERType||"3"==USERType||10==$("#STCStatusId").val()||12==$("#STCStatusId").val()||14==$("#STCStatusId").val()||17==$("#STCStatusId").val())$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","delete").appendTo(i)}if(t.length>0){var s="";for(o=0;o<t.length;o++)s+="- "+t[o].message+"\n";alert(s)}else showMessage("Document has been uploaded successfully.",!1,typeOfFile);0==$("#tbodyCES").find("tr").length?($("#divDocumentsCES").find(".table-responsive").hide(),$("#divDocumentsCES").find(".noDocumentCES").show()):($("#divDocumentsCES").find(".table-responsive").show(),$("#divDocumentsCES").find(".noDocumentCES").hide()),"ces"==typeOfFile.toLowerCase()&&1==$("#tbodyCES").find("tr").length&&ReloadSTCModule(),PopoverEnable(),$("#DocumentTemplate").modal("hide"),SearchHistory()}})})}),$("#btnCreateSTCDocument").click(function(){$.get(urlGetAllDocumentTemplate+"?jobTypeId="+parseInt($("#BasicDetails_JobType").val())+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&isSTC=true",function(e){var t=$("#tbodySTCItems");if(t.html(""),e)for(var a=e,o=0;o<a.length;o++){var n=$("<li/>").addClass("list-group-item").data({path:a[o].Path,name:a[o].Path.split("/").pop(),tempName:a[o].DocumentTemplateName}).appendTo(t),i=$("<div/>").addClass("checkbox").appendTo(n),l=$("<label/>").css({"word-wrap":"break-word"}).appendTo(i),s='<input type="checkbox">'+a[o].DocumentTemplateName;l.html(s)}}),$("#CrateSTCDocument").modal("show")}),$("#btnAddSTCExistingDoc").click(function(e){e.preventDefault();var t=$("#tbodySTCItems").find("input[type=checkbox]:checked").closest("li"),a=[];if(t.length<1)return alert("Please select atleast one document"),!1;for(var o=0;o<t.length;o++){var n=$(t[o]);a.push({name:n.data("name"),path:n.data("path"),stage:"STC",TemplateName:n.data("tempName")+".pdf"})}var i={jobId:JobId,docs:a,fillData:!0};$.post(urlUploadSTCDocument,i,function(e){$("#CrateSTCDocument").modal("hide"),e?(doneCallBack(),SearchHistory()):showMessage("Something went to wrong. Please try after sometimes!",!1,"STC")})}),$("#btnUploadPnlInvoiceDocument").click(function(e){e.preventDefault(),document.getElementById("uploadPnlInvoiceBtnDocument").click()}),$("#btnUploadElecBillDocument").click(function(e){e.preventDefault(),document.getElementById("uploadElecBillBtnDocument").click()}),$("#uploadPnlInvoiceBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyPnlInvoice"),l=0;l<t.result.length;l++){if(1==t.result[l].Status){var s="JobDocuments\\"+JobId+"\\Panel Invoice\\"+t.result[l].FileName,d=$("<tr/>").data("data",t.result[l]).data("path",s).data("id",t.result[l].AttachmentID).attr("id","pnlinvoice_"+t.result[l].AttachmentID).addClass("job-document-"+t.result[l].AttachmentID).appendTo(i),r=($("<td/>").css("width","2%").appendTo(d),$("<td/>").text(t.result[l].FileName).appendTo(d),$("<td/>").addClass("action").appendTo(d),$("<td/>").addClass("action").appendTo(d)),c=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","PNLINVC").attr("data-filename",t.result[l].FileName).attr("onclick",'viewDocument("PNLINVC","","","'+s+'",0,"pnlinvoice_'+t.result[l].AttachmentID+'","'+t.result[l].AttachmentID+'");').appendTo(r);if(allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(c,0),"1"==USERType||"3"==USERType)$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(r);$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",0)>Download final</a>").appendTo(r)}else 0==t.result[l].Status&&"File Type Not Allowed."==t.result[l].Message?n.push(t.result[l].FileName):0==t.result[l].Status&&"BigName"==t.result[l].Message?o.push(t.result[l].FileName):a.push(t.result[l].FileName);PopoverEnable(),0==i.children().length?($("#divDocumentsPnlInvoice").find(".table-responsive").hide(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").show()):($("#divDocumentsPnlInvoice").find(".table-responsive").show(),$("#divDocumentsPnlInvoice").find(".noDocumentPnlInvoice").hide()),1==$("#tbodyPnlInvoice").find("tr").length&&ReloadSTCModule()}return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"PNLINVC"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"PNLINVC"),!1):(showMessage("File has been uploaded successfully.",!1,"PNLINVC"),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"PNLINVC"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"PNLINVC"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"PNLINVC"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"PNLINVC"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"PNLINVC"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"PNLINVC"},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#uploadElecBillBtnDocument").fileupload({url:urlDocumentCES,dataType:"json",done:function(e,t){var a=[];a.length=0;var o=[];o.length=0;var n=[];n.length=0;for(var i=$("#tbodyElecBill"),l=0;l<t.result.length;l++){if(1==t.result[l].Status){var s="JobDocuments\\"+JobId+"\\Electricity Bill\\"+t.result[l].FileName,d=$("<tr/>").data("data",t.result[l]).data("path",s).data("id",t.result[l].AttachmentID).attr("id","elecbill_"+t.result[l].AttachmentID).addClass("job-document-"+t.result[l].AttachmentID).appendTo(i),r=($("<td/>").css("width","2%").appendTo(d),$("<td/>").text(t.result[l].FileName).appendTo(d),$("<td/>").addClass("action").appendTo(d),$("<td/>").addClass("action").appendTo(d)),c=$("<a/>").addClass("icon sprite-img email-ic document-signature-send-request").attr("href","javascript:void(0);").attr("title","Signature Mail").data("type","PNLINVC").attr("data-filename",t.result[l].FileName).attr("onclick",'viewDocument("ELECBILL","","","'+s+'",0,"elecbill_'+t.result[l].AttachmentID+'","'+t.result[l].AttachmentID+'");').appendTo(r);if(allowdViewTypes.indexOf(s.toLowerCase().split(".").pop())>-1||OpacityIncreaseDecrease(c,0),"1"==USERType||"3"==USERType)$("<a/>").addClass("sprite-img delete").attr("href","#").attr("title","Delete").appendTo(r);$("<a/>").addClass("sprite-img download pop").attr("href","javascript:void(0)").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content","<a href=javascript:void(0); class='editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",1)>Download edit</a><a href=javascript:void(0); class='non-editable-pdf pdf-down' onclick=DownloadJobDocuments("+t.result[l].AttachmentID+",0)>Download final</a>").appendTo(r)}else 0==t.result[l].Status&&"File Type Not Allowed."==t.result[l].Message?n.push(t.result[l].FileName):0==t.result[l].Status&&"BigName"==t.result[l].Message?o.push(t.result[l].FileName):a.push(t.result[l].FileName);PopoverEnable(),0==i.children().length?($("#divDocumentsElecBill").find(".table-responsive").hide(),$("#divDocumentsElecBill").find(".noDocumentElecBill").show()):($("#divDocumentsElecBill").find(".table-responsive").show(),$("#divDocumentsElecBill").find(".noDocumentElecBill").hide()),1==$("#tbodyElecBill").find("tr").length&&ReloadSTCModule()}return a.length>0?(showMessage(a.length+" File has not been uploaded.",!0,"ELECBILL"),!1):n.length>0?(showMessage(n.length+" Uploaded file type is not supported.",!0,"ELECBILL"),!1):(showMessage("File has been uploaded successfully.",!1,"ELECBILL"),void SearchHistory())},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){if(1==t.files.length)for(var a=0;a<t.files.length;a++){if(t.files[a].name.length>50)return showMessage("Please upload small filename.",!0,"ELECBILL"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"ELECBILL"),!1}if(t.files.length>1)for(a=0;a<t.files.length;a++){if(t.files[a].size>parseInt(MaxImageSize))return showMessage(" "+t.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0,"ELECBILL"),!1;if(CheckSpecialCharInFileName(t.files[a].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0,"ELECBILL"),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0,"ELECBILL"),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{UserId:USERID,JobId:JobId,Type:"ELECBILL"},change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#divDocumentsPnlInvoice").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");deleteFile(t,!0,"PNLINVC")}),$("#divDocumentsElecBill").on("click",".delete",function(e){e.preventDefault();var t=$(this).closest("tr");deleteFile(t,!0,"ELECBILL")});