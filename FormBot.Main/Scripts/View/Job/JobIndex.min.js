function ExportDatatableExcel(){var e=$("#datatable").data("kendoGrid").dataSource.filter(),t=$("#datatable").data("kendoGrid").dataSource.total(),a=null!=$("#hdnsolarCompanyid").val()?$("#hdnsolarCompanyid").val():"";null==document.getElementById("ResellerId")?window.location.href=urlExportDatattableExcel+"?filter= "+JSON.stringify(e)+"&search="+$("#txtSearchfor").val()+"&year="+$("#ddlYear").val()+"&isarchive="+$("#chkIsArchive").prop("checked")+"&Searchcols="+arrAdvanceSearchFilters+"&solarcompanyid="+a+"&isAllScaJobView="+isAllScaJobView+"&isShowOnlyAssignJobsSCO="+isShowOnlyAssignJobsSCO+"&defaultGrid="+isDefaultGrid+"&total="+t:window.location.href=urlExportDatattableExcel+"?filter= "+JSON.stringify(e)+"&search="+$("#txtSearchfor").val()+"&year="+$("#ddlYear").val()+"&isarchive="+$("#chkIsArchive").prop("checked")+"&Searchcols="+arrAdvanceSearchFilters+"&solarcompanyid="+a+"&sResellerId="+document.getElementById("ResellerId").value+"&isAllScaJobView="+isAllScaJobView+"&isShowOnlyAssignJobsSCO="+isShowOnlyAssignJobsSCO+"&defaultGrid="+isDefaultGrid+"&total="+t}function UnlockChanges(){if("Lock"==$("#btnLock").val()){$("#btnLock").prop("value","Unlock");var e=$("#datatable").DataTable();datatableInfo(),e.destroy(),drawJobIndex(filterKendo);e=$("#datatable").DataTable();$.fn.dataTable.ColReorder(e),e.on("column-reorder",function(e,t,a){DataTableColResizeNotAll($("#trHeadersDynamic th").length-1)}),DataTableColResizeNotAll($("#trHeadersDynamic th").length)}else"Unlock"==$("#btnLock").val()&&($("#btnLock").prop("value","Lock"),DataTableColResize($("#trHeadersDynamic th").length),DisableAllColReorder())}function DisableAllColReorder(){}function DataTableColResizeNotAll(e){var t=[];t.push(0),(6==UserTypeID||"true"==isAssignSSC&&(4==UserTypeID&&"true"==IsSSCReseller||8==UserTypeID&&"false"==IsSubContractor&&"true"==IsSSCReseller))&&t.push(e-2),$("#datatable").colResizable({fixed:!0,liveDrag:!0,postbackSafe:!0,partialRefresh:!0,flush:!0,resizeMode:"fit",disabledColumns:t,onResize:a});var a=function(e){$(e.currentTarget)}}function BindSolarCompany(e){$("#searchSolarCompany").val("");var t=!1;return $.ajax({type:"POST",url:urlGetSolarCompanyByResellerId,dataType:"json",async:!1,data:{id:e,isAll:!0},success:function(e){solarCompanyList=[],$.each(e,function(e,a){solarCompanyList.push({value:a.Value,text:a.Text}),0==t&&a.Value==localStorage.getItem("JobList_SolarCompanyId")&&(t=!0)}),t?$("#hdnsolarCompanyid").val(localStorage.getItem("JobList_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val())),""==localStorage.getItem("JobList_SolarCompanyId")&&($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val())),$.each(solarCompanyList,function(e,t){t.value==localStorage.getItem("JobList_SolarCompanyId")&&($("#searchSolarCompany").val(t.text),$("#hdnsolarCompanyid").val(localStorage.getItem("JobList_SolarCompanyId")))})},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),!1}function ResetSearchFilters(e){$("#txtSearchfor").val(""),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),filterKendo=null,drawJobIndex(filterKendo),$("#btnChangeSearchFilter").val("Change Filter")}function SearchJobs(){$(".loading-image").show(),isArchiveScreenVar||(filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty()),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo),$("#btotalTradedSTC").text(0),1!=UserTypeID&&3!=UserTypeID||localStorage.setItem("JobList_ResellerId",document.getElementById("ResellerId").value),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID&&6!=UserTypeID||localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val()),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("JobList_IsArchive",document.getElementById("chkIsArchive").checked),1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(document.getElementById("chkIsArchive").checked?($("#btnOpenDeletedJobs").removeAttr("Style"),$("#btnDeleteJobs").attr("Style","display:none")):($("#btnOpenDeletedJobs").attr("Style","display:none"),$("#btnDeleteJobs").removeAttr("Style"))),7==UserTypeID&&9==UserTypeID&&10==UserTypeID||GetJobStageCount(),$("#loading-image").css("display","none")}function FilterIsArchiveData(){null!=document.getElementById("chkIsArchive")&&document.getElementById("chkIsArchive").checked?$.fn.dataTable.ext.search.push(function(e,t,a){return-1!==t[jobIndexTable.columns().column("IsDeleted:name").index()].toLowerCase().indexOf("true")}):$.fn.dataTable.ext.search.push(function(e,t,a){return-1!==t[jobIndexTable.columns().column("IsDeleted:name").index()].toLowerCase().indexOf("false")})}function ConvertToDate(e){if(null!=e){var t=new Date(parseInt(e.replace("/Date(","")));return("0"+t.getDate()).slice(-2)+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+t.getFullYear()}return""}function GetJobStageCount(){}function DeleteSelectedJobs(){if(selectedRows=[],$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var e={id:$(this).attr("id").substring(4),jobTitle:$(this).attr("jobtitle")};selectedRows.push(e)}}),null!=selectedRows&&selectedRows.length>0){var e=confirm("You are about to delete ("+selectedRows.length+") jobs are you sure you want to continue?");if(e){var t=confirm("Are you really sure want to continue?");if(t){var a='<button type="button" class="close" onclick="$(this).parent().hide();" aria-hidden="true">&times;</button>';$.ajax({url:urlDeleteSelectedJobs,type:"POST",async:!1,data:JSON.stringify({jobs:selectedRows}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Failed"==e.JsonResponseObj.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(a+e.JsonResponseObj.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(a+e.JsonResponseObj.strErrors),$("#errorMsgRegion").show()),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo)}})}}}else alert("Please select any job for delete.");HideToolTip()}function OpenDeletedJobs(){if(selectedRows=[],$('#datatable tbody input[type="checkbox"]').each(function(){if(1==$(this).prop("checked")){var e={id:$(this).attr("id").substring(4)};selectedRows.push(e)}}),null!=selectedRows&&selectedRows.length>0){var e=confirm("Are you sure want to open deleted job(s)?");if(e){var t='<button type="button" class="close" onclick="$(this).parent().hide();" aria-hidden="true">&times;</button>';$.ajax({url:urlOpenDeletedJobs,type:"POST",async:!1,data:JSON.stringify({jobs:selectedRows}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){"Failed"==e.JsonResponseObj.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(t+e.JsonResponseObj.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(t+e.JsonResponseObj.strErrors),$("#errorMsgRegion").show()),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo)}})}}else alert("Please select any job for open again.")}function AssignSSC(e){$("#loading-image").show(),FillDropDown("SSCID",urlGetSSCUser,null,!0,null),setTimeout(function(){$.get(urlAssignSSC,function(t){$("#divAssignJobSSC").empty(),$("#divAssignJobSSC").append(t),$("#popupProof").modal({backdrop:"static",keyboard:!1}),$("#SSCJobID").val(e),$("#SSCID").focus(),$.ajax({url:urlGetSSCUserByJbID+"/"+e,type:"get",async:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){AssignSSCClickEvent(),0==e.length?($("#SSCID").empty(),$("#SSCID").append('<option value="">Select</option>')):($("#SSCID").empty(),$("#SSCID").append('<option value="">Select</option>'),$.each(e,function(e,t){$("#SSCID").append('<option value="'+t.Value+'">'+t.Text+"</option>")}))}}),$.ajax({url:urlGetSSCID+"/"+e,type:"get",async:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.length>0?($("#SSCID").prop("disabled",!0),$("#SSCID").val(parseInt(e[0].SSCID)),$("#RemoveSSCNote").val(e[0].Notes),$("#btnJobSSCMapping").hide(),$("#sscNotes").show(),$("#btnSSCRemove").show(),1==e[0].IsSSCRemove?($("#btnSSCRemove").hide(),$("#btnSSCCancelRemovalRequest").show(),$("#divRequestedBy").show(),$("#requestBy").html(e[0].RequestedBy),$("#RemoveSSCNote").prop("disabled",!0)):($("#btnSSCCancelRemovalRequest").hide(),$("#RemoveSSCNote").prop("disabled",!1),$("#divRequestedBy").hide())):($("#SSCID").prop("disabled",!1),$("#btnJobSSCMapping").show(),$("#sscNotes").hide(),$("#btnSSCRemove").hide(),$("#btnSSCCancelRemovalRequest").hide(),$("#RemoveSSCNote").prop("disabled",!1))}}),$("#loading-image").hide()})},500)}function validateForm(){return $.validator.unobtrusive.parse("#UserDetails"),!!$("#UserDetails").valid()}function validateForm1(){return $.validator.unobtrusive.parse("#UserDetail"),!!$("#UserDetail").valid()}function SetStageId(e){var t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#bdbdbd",SelectedStageId=e;t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#5F5D5D",1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||localStorage.setItem("JobList_IsArchive",!1),localStorage.setItem("JobList_JobScheduleTypeId",0),document.getElementById("JobScheduleTypeId").selectedIndex=0,localStorage.setItem("JobList_JobTypeId",0),document.getElementById("JobTypeId").selectedIndex=0,localStorage.setItem("JobList_JobPriorityId",0),document.getElementById("JobPriorityId").selectedIndex=0,localStorage.setItem("JobList_Searchfor",""),localStorage.setItem("JobList_PreApprovalStatusId",0),document.getElementById("PreApprovalStatusId").selectedIndex=0,localStorage.setItem("JobList_ConnectionStatusId",0),document.getElementById("ConnectionStatusId").selectedIndex=0,$("#txtFromDate").val(""),$("#txtToDate").val(""),document.getElementById("chkJobRef").checked=!0,document.getElementById("chkJobDescription").checked=!0,document.getElementById("chkJobAddress").checked=!0,document.getElementById("chkClient").checked=!0,document.getElementById("chkStaff").checked=!1,document.getElementById("chkInvoiced").checked=!0,document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkReadyToTrade").checked=!0,document.getElementById("chkNotReadyToTrade").checked=!0,document.getElementById("chkTraded").checked=!0,document.getElementById("chkNotTraded").checked=!0,document.getElementById("chkPreApprovalNotBeenApproved").checked=!0,document.getElementById("chkPreApprovalApproved").checked=!0,document.getElementById("chkConnectionCompleted").checked=!0,document.getElementById("chkConnectionNotCompleted").checked=!0,document.getElementById("chkACT").checked=!0,document.getElementById("chkNSW").checked=!0,document.getElementById("chkNT").checked=!0,document.getElementById("chkQLD").checked=!0,document.getElementById("chkSA").checked=!0,document.getElementById("chkTAS").checked=!0,document.getElementById("chkWA").checked=!0,document.getElementById("chkVIC").checked=!0,SetParamsFromLocalStorage(),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo)}function GetDates(e){if(""!=e){var t=ConvertDateToTick(e,dateFormat);return moment(t).format("YYYY-MM-DD")}return""}function LoadStc(){var e=!0,t=!0,a=0,o=0,n=0,l=0,r=0,s=0,i=0,d=0,c=0,p=0,u=0,m=0,h=!1,g=0,f=[];selectedRows=[],$("#datatable tbody input:checkbox").each(function(){if(1==$(this).prop("checked")){var e={id:$(this).attr("id").substring(4),jobTitle:$(this).attr("jobtitle")};selectedRows.push(e)}}),null!=selectedRows&&selectedRows.length>0?$.ajax({url:urlGetDataForTradeJob,type:"POST",async:!1,data:JSON.stringify({jobs:selectedRows}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(S){var b=S.data;if("All"==$("#searchSolarCompany").val())return e=!1,alert("Please select single solar company to trade jobs."),!1;if(b.length>0)for(var y=0;y<b.length;y++){if(!(parseFloat(b[y].SystemSize)<=60))return e=!1,alert("You can not trade for job from here which has system size greater than 60."),!1;if(1==b[y].IsTraded||1==b[y].IsCustomPrice)return e=!1,alert("Please select jobs which are neither traded nor have custom price."),!1;if(1!=b[y].IsReadyToTrade)return e=!1,alert("Please select jobs which are ready to trade."),!1;if(IsAllowKW=b[y].UnderKW,JobSizeForOptiPay=parseFloat(b[y].KWValue),IsCustomAllowKW=b[y].IsCustomUnderKW,JobCustomSizeForOptiPay=parseFloat(b[y].CustomKWValue),CustTerm=b[y].CustomSettlementTerm,SystemSize=parseFloat(b[y].SystemSize),1==IsAllowKW&&SystemSize>JobSizeForOptiPay||8==CustTerm&&1==IsCustomAllowKW&&SystemSize>JobCustomSizeForOptiPay)return e=!1,alert("Please select jobs which have system size less than or equal to OptiPay KW."),!1;if(t)a=parseFloat(b[y].PriceDay1),o=parseFloat(b[y].PriceDay3),n=parseFloat(b[y].PriceDay7),l=parseFloat(b[y].UpFront),r=parseFloat(b[y].PriceOnApproval),s=parseFloat(b[y].PartialPayment),i=parseFloat(b[y].RapidPay),d=parseFloat(b[y].OptiPay),c=parseFloat(b[y].Commercial),p=parseFloat(b[y].Custom),u=parseFloat(b[y].InvoiceStc),m=b[y].PropertyType,h=b[y].IsGst,g=b[y].GSTDocument,e=!0,f.push(b[y].JobID);else{if(a!=parseFloat(b[y].PriceDay1)||o!=parseFloat(b[y].PriceDay3)||n!=parseFloat(b[y].PriceDay7)||l!=parseFloat(b[y].UpFront)||r!=parseFloat(b[y].PriceOnApproval)||s!=parseFloat(b[y].PartialPayment)||i!=parseFloat(b[y].RapidPay)||d!=parseFloat(b[y].OptiPay)||c!=parseFloat(b[y].Commercial)||p!=parseFloat(b[y].Custom)||u!=parseFloat(b[y].InvoiceStc)||m!=b[y].PropertyType||h!=b[y].IsGst||g.length>0!=b[y].GSTDocument.length>0)return e=!1,alert("Please select jobs which have same price and installation property type."),!1;e=!0,f.push(b[y].JobID)}t=!1}}}):alert("Please select any job for trade."),e?f.length>0?$.ajax({url:urlBindJobSTCPriceView,type:"POST",data:{jobId:f.join(","),IsGridView:!0,IsTradedFromJobIndex:!0},success:function(e){""==e?alert("Select Custom Price"):($("#SettleMentBlock").html(e),$("#errorMsgRegionSTCStatus").hide(),$("#errorMsgRegionSTCStatus").html(""),$("#StcModal").modal({backdrop:"static",keyboard:!1}),$(".LiSettlement:first").click())}}):alert("Atleast one job should be selected."):$('#datatable tbody input[type="checkbox"]').each(function(){$(this).attr("checked",!1),$("#chkAll").attr("checked",!1),chkCount=0,$("#btotalTradedSTC").html(0)})}function AcceptRejectJobToSSC(e,t){$.ajax({url:urlAcceptRejectJobToSSC,type:"POST",async:!1,data:JSON.stringify({jobID:e,role:t}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Job has been "+e.success+" successfully."),$("#errorMsgRegion").show(),GetJobStageCount(),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo))}})}function DeleteRemoveSSCRequest(e){$.ajax({url:urlCancelRemovalRequest,type:"POST",async:!1,data:JSON.stringify({jobId:e}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-danger"),$("#popuperrorMsgRegion").addClass("alert-success"),$("#popuperrorMsgRegion").html(closeButton+"Cancel removal request removed successfully from the job."),$("#popuperrorMsgRegion").show(),location.reload(),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo))}})}function BulkChangeJobStage(){document.getElementById("JobStageID").selectedIndex>0?(selectedRows=[],$('#datatable tbody input[type="checkbox"]').each(function(){1==$(this).prop("checked")&&selectedRows.push($(this).attr("JobId"))}),null!=selectedRows&&selectedRows.length>0?$.ajax({type:"POST",url:urlBulkChangeJobStage,async:!1,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({jobstage:document.getElementById("JobStageID").value,jobids:selectedRows.join(",")}),success:function(e){e.success&&($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+"Job Stages updated successfully."),$("#errorMsgRegion").show(),GetJobStageCount(),filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo),document.getElementById("JobStageID").selectedIndex=0)},error:function(e){}}):alert("Please select any Job to update Stage.")):alert("Please select Job Stage first.")}function HideToolTip(){$(".tooltip").hide()}function ShowToolTip(e){$(".tooltip").show()}function ToDate(e){if(null!=e){var t=ConvertDateToTick(e,"dd/mm/yyyy");tDate=moment(t).format("MM/DD/YYYY");var a=new Date(tDate);return moment(a).format(dateFormatMoment)}return""}function BindJobStages(){return $("#JobStageID").empty(),$.ajax({type:"POST",url:urlGetJobStages,dataType:"json",async:!1,data:{usertypeid:UserTypeID},success:function(e){$("#JobStageID").append('<option value="0">Select job stage</option>'),$.each(e,function(e,t){$("#JobStageID").append('<option value="'+t.Value+'">'+t.Text+"</option>")})},error:function(e){alert("Failed to retrieve Job Stages."+e)}}),!1}function SetParamsFromLocalStorage(){}function SetChangeFilter(){for(var e=!1,t=1;t<=11;t++)null!=localStorage.getItem("locFilter_"+t)&&($("#Filter_"+t).text(localStorage.getItem("locFilter_"+t)),e=!0),null!=localStorage.getItem("lochdnFilter_"+t)&&($("#hdnFilter_"+t).text(localStorage.getItem("lochdnFilter_"+t)),e=!0);e&&$("#btnChangeSearchFilter").val("Change Filter *")}function DataTableColResize(e){}function drawJobIndex(e){$(".dropdown-filter-dropdown").remove(),kendo.ui.FilterMenu.fn.options.operators.date={gte:"Begin Date",lte:"End Date"},$("#datatable").kendoGrid({columns:kendoCols,dataSource:{type:"json",transport:{read:{url:urlGetJobListUserWiseColumns1,data:{},contentType:"application/json",dataType:"json",type:"POST"},parameterMap:function(e){if(null!=e.filter)for(i=0;i<e.filter.filters.length;i++)"InstallationDate"!=e.filter.filters[i].field&&"CreatedDate"!=e.filter.filters[i].field&&"SignatureDate"!=e.filter.filters[i].field&&"InstallerSignatureDate"!=e.filter.filters[i].field&&"DesignerSignatureDate"!=e.filter.filters[i].field&&"ElectricianSignatureDate"!=e.filter.filters[i].field||(e.filter.filters[i].value=moment(new Date(e.filter.filters[i].value.toString().substr(0,16))).format("DD-MM-YYYY"));return e.search=$("#txtSearchfor").val(),e.year=$("#ddlYear").val(),e.isarchive=$("#chkIsArchive").prop("checked"),e.Searchcols=arrAdvanceSearchFilters,e.defaultGrid=isDefaultGrid,null!=document.getElementById("ResellerId")?(e.solarcompanyid=$("#hdnsolarCompanyid").val(),e.sResellerId=document.getElementById("ResellerId").value):e.solarcompanyid=$("#hdnsolarCompanyid").val(),e.isAllScaJobView=isAllScaJobView,e.isShowOnlyAssignJobsSCO=isShowOnlyAssignJobsSCO,JSON.stringify(e)}},filter:e,schema:{data:"data",total:"total",model:{fields:{InstallationDate:{type:"date"},CreatedDate:{type:"date"},InstallerSignatureDate:{type:"date"},DesignerSignatureDate:{type:"date"},SignatureDate:{type:"date"},ElectricianSignatureDate:{type:"date"}}}},pageSize:GridConfig[0].PageSize,serverPaging:!0,serverFiltering:!0,serverSorting:!0,requestStart:function(e){setTimeout(function(e){$(".k-loading-image").hide()},50)},requestEnd:function(e){$(".loading-image").hide()}},groupable:!1,sortable:!0,pageable:{buttonCount:5,pageSizes:[10,25,50,100,200]},resizable:!0,columnResize:function(e){SaveUserWiseColumnDetails()},scrollable:!0,reorderable:!0,filterable:{extra:!1},dataBound:function(e){$(".k-pager-sizes").find("select").on("change",function(){SetPageSizeForGrid($(this).val(),!0,ViewPageId),GridConfig[0].PageSize=$(this).val(),GridConfig[0].IsKendoGrid=!0,GridConfig[0].ViewPageId=parseInt(ViewPageId)})},columnReorder:onReorder,filterMenuInit:function(e){if($(".loading-image").hide(),e.field.includes("Date")){this.thead.find("[data-field='"+e.field+"'] .k-grid-filter").click(function(e){t()});var t=function(){var t=e.container.find("select:eq(0)").data("kendoDropDownList");t.value("gte"),t.trigger("change"),t.enable(!1);var a=e.container.find("select:eq(1)").data("kendoDropDownList");a.wrapper.hide();var o=e.container.find("select:eq(2)").data("kendoDropDownList");o.enable(!1),o.value("lte"),o.trigger("change")};t()}else if("contains"==e.container.find("select").val()){var a=e.container.find("select:eq(0)").data("kendoDropDownList");a.enable(!1)}else if(null!=e.container.find("select:eq(0)").data("kendoDropDownList")&&1==e.container.find("select:eq(0)").data("kendoDropDownList").dataSource.options.data.length){a=e.container.find("select:eq(0)").data("kendoDropDownList");a.enable(!1)}else if("JobID"==e.field||"STC"==e.field){a=e.container.find("select:eq(0)").data("kendoDropDownList");a.value("eq"),a.trigger("change"),a.enable(!1),e.container.find("input").attr("onkeypress","return isNumber(event);")}}}),$("#datatable").data("kendoGrid").thead.kendoTooltip({filter:"th:not(':first')",content:function(e){var t=e.target;return $(t).text()}}),$("#datatable").data("kendoGrid").resizable.bind("start",function(e){"Id"==$(e.currentTarget).data("th").data("field")&&(e.preventDefault(),setTimeout(function(){$("#datatable").data("kendoGrid").wrapper.removeClass("k-grid-column-resizing"),$(document.body).add(".k-grid th").css("cursor","")}))})}function datatableInfo(){function CheckRender(functionName){var isDefined=eval("(typeof kendo_"+functionName+"=='function');");return!!isDefined}cols=[],kendoCols=[],colsDefs=[];var dbFields=[];dbFields=listColumns.split(",");var dbFieldsWidth=[];dbFieldsWidth=listColumnsWidth.split(","),kendoCols.push({title:"Chkbox",field:"Id",encoded:!1,template:"#=kendo_Chkbox(data)#",filterable:!1,sortable:!1,headerTemplate:'<input type="checkbox" id="chkAll" name="select_all" onclick="selectAllJobs()" class="k-checkbox"><label class="k-checkbox-label" for="chkAll"></label>',width:50,stickyPosition:0,reorderable:!1,resizable:!1}),$.each(dbFields,function(i,e){var var_orderable=!1;"Priority"!=e&&"RefNumber"!=e&&"ClientName"!=e&&"CreatedDate"!=e&&"JobStage"!=e&&"InstallationDate"!=e&&"STC"!=e&&"StaffName"!=e&&"SCOName"!=e&&"JobID"!=e||(var_orderable=!0);var filterarray=$.grep(obj.filterColumn,function(t){return t.hasOwnProperty(e)}),columnData=$.grep(UserWiseColumnsData,function(t,a){return t.Name==e});"SolarCompany"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:{transport:{read:{url:urlGetSolarCompanyForFilter,dataType:"json",data:{id:$("#ResellerId").val(),solarCompanyId:$("#hdnsolarCompanyid").val(),isAllScaJobView:isAllScaJobView}}}},itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allsc' name='SolarComanyId' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allsc'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='SolarComanyId' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},sortable:!0}):"StaffName"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),filterable:{multi:!0,search:!0,dataSource:{transport:{read:{url:urlGetStaffNameValueForFilter,dataType:"json",data:{ResellerId:$("#ResellerId").val(),SolarCompanyId:$("#hdnsolarCompanyid").val(),isAllScaJobView:isAllScaJobView,year:$("#ddlYear").val()}}}},itemTemplate:function(e){return"all"==e.field?"<li><input type='checkbox' id='allstaff' name='"+e.field+"' value='#= all#' class='k-checkbox'/><label class='k-checkbox-label' for='allstaff'>#= all#</li>":"<li><input type='checkbox' id='#=Value#' name='"+e.field+"' value='#=Value#' class='k-checkbox'/><label class='k-checkbox-label' for='#=Value#'>#= Text #</li>"}},sortable:!0}):CheckRender(e)&&"DocumentCount"!=e?filterarray.length>0?filterarray[0][e]?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to"}},extra:!1,ui:filterYesNo},sortable:!0}):e.includes("Date")?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!0,ui:eval("filter_"+e)},sortable:!0}):kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=kendo_"+e+"(data) #",filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!1,ui:eval("filter_"+e)},sortable:!0}):kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),template:"#=kendo_"+e+"(data) #",sortable:!0,filterable:{operators:{string:{contains:"Contains"}},extra:!1}}):filterarray.length>0?filterarray[0][e]?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),sortable:!0,filterable:{operators:{string:{eq:"Is equal to"}},extra:!1,ui:filterYesNo}}):kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),sortable:!0,filterable:{operators:{string:{eq:"Is equal to",neq:"Is not equal to"}},extra:!1,ui:eval("filter_"+e)}}):"SystemSize"==e||"NoOfPanel"==e||"CalculatedSTC"==e||"DocumentCount"==e?kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),sortable:!0,filterable:{operators:{string:{eq:"Is equal to"}},extra:!1}}):kendoCols.push({title:columnData[0].DisplayName,field:e,encoded:!1,headerAttributes:{"data-field":columnData[0].Name,"data-columnid":columnData[0].ColumnID,"data-order":columnData[0].OrderNumber},headerTemplate:"<span>"+columnData[0].DisplayName+"</span>",width:parseInt(dbFieldsWidth[i]),sortable:!0,filterable:{operators:{string:{contains:"Contains"}},extra:!1}})}),kendoCols.push({title:"Action",field:"Id",encoded:!1,template:"#=kendo_Action(data) #",filterable:!1,sortable:!1,width:75,resizable:!1,hidden:!(6==UserTypeID||"true"==isAssignSSC&&(1==UserTypeID||2==UserTypeID||5==UserTypeID||4==UserTypeID&&"true"==IsSSCReseller||8==UserTypeID&&"false"==IsSubContractor&&"true"==IsSSCReseller))}),listColumns.indexOf("CreatedDate")}function funTrHeadersDynamic(e){var t="";t+="<th style='width: 2%; background-image: none !important;'><input type='checkbox' id='chkAll' name='select_all'></th>",$.each(e,function(e,a){t+="<th style='width:"+a.Width+"%' data-columnid='"+a.ColumnID+"' data-order='"+a.OrderNumber+"'><span>"+a.DisplayName+"</span></th>"}),null!=t&&(t+="<th style='width: 2%;' class='action'>Action</th>",$("#trHeadersDynamic").empty(),$("#datatable > tbody").html(""))}function selectAllJobs(){if($("#chkAll").prop("checked")){$("#datatable").find("[type='checkbox']").prop("checked",!0);var e=0;$('#datatable tbody input[type="checkbox"]').each(function(){var t=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text();e=parseFloat(parseFloat(e)+parseFloat(t)).toFixed(2)}),$("#btotalTradedSTC").html(e)}else $("#datatable").find("[type='checkbox']").prop("checked",!1),$("#btotalTradedSTC").html(0)}function SaveFilter(){arrAdvanceSearchFilters=[],$('div[id*="popup_"]').each(function(){var e=$(this).attr("id"),t=$("#"+e+" input[type=checkbox]:checked").map(function(){if(this.id!="DeSel_"+e.replace("popup_","")&&this.id!="Sel_"+e.replace("popup_",""))return this.id.replace("popup_","")}).get().join(","),a=$("#"+e+" input[type=checkbox]:checked").map(function(){if(this.id!="DeSel_"+e.replace("popup_","")&&this.id!="Sel_"+e.replace("popup_",""))return this.value}).get().join(",");$("#Filter_"+e.replace("popup_","")).text(a),$("#hdnFilter_"+e.replace("popup_","")).text(t),localStorage.setItem("locFilter_"+e.replace("popup_",""),a),localStorage.setItem("lochdnFilter_"+e.replace("popup_",""),t),3==e.replace("popup_","")||4==e.replace("popup_","")||5==e.replace("popup_","")||6==e.replace("popup_","")||7==e.replace("popup_","")||8==e.replace("popup_","")||9==e.replace("popup_","")||10==e.replace("popup_","")||11==e.replace("popup_","")?""==$(this).data("columnname")&&null==$(this).data("columnname")||""!=t&&null!=t&&arrAdvanceSearchFilters.push($(this).data("columnname")):t.split(",").map(function(e){""!=e&&null!=e&&arrAdvanceSearchFilters.push(e)})}),$("#Advancefilter").modal("hide"),$("#btnChangeSearchFilter").val("Change Filter *")}function SetAdvanceSearchFiltersColumns(){arrAdvanceSearchFilters=[],$('[id*="hdnFilter_"]').each(function(){var e=$(this).attr("id");3==e.replace("hdnFilter_","")||4==e.replace("hdnFilter_","")||5==e.replace("hdnFilter_","")||6==e.replace("hdnFilter_","")||7==e.replace("hdnFilter_","")||8==e.replace("hdnFilter_","")||9==e.replace("hdnFilter_","")||10==e.replace("hdnFilter_","")||11==e.replace("hdnFilter_","")?""==$(this).data("columnname")&&null==$(this).data("columnname")||arrAdvanceSearchFilters.push($(this).data("columnname")):$(this).text().split(",").map(function(e){""!=e&&null!=e&&arrAdvanceSearchFilters.push(e)})})}function SelectAdvanceSearchCategory(e){$("#DeSel_"+e).prop("checked",!1),$("#popup_"+e+" ul input[type=checkbox]").map(function(){this.checked=!0})}
function DeSelectAdvanceSearchCategory(e){$("#Sel_"+e).prop("checked",!1),$("#popup_"+e+" ul input[type=checkbox]").map(function(){this.checked=!1})}function SelectAllAdvanceSearchCategory(){SelectDeselectSectionWise(),$("#DeSel_All").prop("checked",!1),$(".filters-block ul input[type=checkbox]").map(function(){this.checked=!0}),$('.filters-block ul input[type=checkbox][id="popup_JobDescription"]').prop("checked",!1),$('.filters-block ul input[type=checkbox][id="popup_StaffName"]').prop("checked",!1),$('.filters-block ul input[type=checkbox][id="popup_InstallerFullName"]').prop("checked",!1),$('.filters-block ul input[type=checkbox][id="popup_DesignerFullName"]').prop("checked",!1),$('.filters-block ul input[type=checkbox][id="popup_ElectricianFullName"]').prop("checked",!1)}function DeSelectAllAdvanceSearchCategory(){SelectDeselectSectionWise(),$("#Sel_All").prop("checked",!1),$(".filters-block ul input[type=checkbox]").map(function(){this.checked=!1})}function SelectDeselectSectionWise(){$(".filters-title input[type=checkbox]").map(function(){this.checked=!1})}function checkIsWholeSaler(e){$.ajax({url:urlCheckIsWholeSaler_ByResellerId+e,type:"get",async:!1,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){var t=JSON.parse(e);void 0!==t&&null!=t.Table[0]&&(t.Table[0].IsWholeSaler?($("#IsWholeSaler").val(!0),$("#UserId_WholeSaler").val(t.Table[0].UserId)):$("#IsWholeSaler").val(!1))}})}function AssignSSCClickEvent(){$("#btnJobSSCMapping").click(function(e){if(""!=$("#SSCID").val()){var t=$("#SSCID").val(),a=$("#SSCJobID").val(),o=$("#SSCID option:selected").text();t=$("#SSCID").val(),a=$("#SSCJobID").val();$.ajax({url:urlSaveJobToSSC,type:"GET",data:{ramId:t,jobId:a,SSCName:o},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-danger"),$("#popuperrorMsgRegion").addClass("alert-success"),$("#popuperrorMsgRegion").html(closeButton+"Job assigned to SSC successfully."),$("#popuperrorMsgRegion").show(),location.reload())}})}else $(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-success"),$("#popuperrorMsgRegion").addClass("alert-danger"),$("#popuperrorMsgRegion").html(closeButton+"Please select SSC first."),$("#popuperrorMsgRegion").show();return e.preventDefault(),!1}),$("#btnSSCRemove").click(function(){var e=$("#SSCID").val(),t=$("#RemoveSSCNote").val(),a=$("#SSCJobID").val();""==t?($("#RemoveSSCNote").next("span").attr("class","field-validation-error"),$("#RemoveSSCNote").next("span").html("Notes is required.")):$.ajax({url:urlRemoveSSCRequest,type:"GET",data:{notes:t,jobId:a,sscID:e},dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.success&&($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-danger"),$("#popuperrorMsgRegion").addClass("alert-success"),$("#popuperrorMsgRegion").html(closeButton+"Remove request send successfully."),$("#popuperrorMsgRegion").show(),window.setTimeout(function(){location.reload()},100))}})})}function showErrorMessage(e){$(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+e),$("#errorMsgRegion").show()}function showSuccessMessage(e){$(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+e),$("#successMsgRegion").show()}function onReorder(e){if(void 0!==e.column.reorderable&&!e.column.reorderable){var t=$("#datatable").data("kendoGrid");setTimeout(function(){t.reorderColumn(e.oldIndex,t.columns[e.newIndex])},0)}setTimeout(function(){SaveUserWiseColumnDetails()},150)}function SaveUserWiseColumnDetails(){$("#loading-image").css("display","");var e=[],t=0,a=$("#datatable").data("kendoGrid").columns;$("#datatable th").each(function(o,n){t+=1;var l=$("#datatable").data("kendoGrid").dataSource.pageSize();e.push({Width:a[o].width,ColumnID:$(n).attr("data-columnid"),OrderNumber:t,PageSize:l})}),e.length>0?$.ajax({url:"/Job/SaveUserWiseColumnsDetails",type:"POST",async:!1,data:JSON.stringify({columns:e,MenuId:JobView}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.status?(listColumns=e.ListColumnName,listColumnsWidth=e.ListColumnWidth,UserWiseColumnsData=e.JSUserColumnList,DefaultPageSize=e.PageSize):alert("Try again.")},error:function(e){alert("Try again. "+e)}}):alert("Add atleast one column."),$("#loading-image").css("display","none")}var cols=[],colsDefs=[],jobIndexTable,arrAdvanceSearchFilters=[],IsServerCallForSearch=!1,filterSolarCompanyList=[],filterKendo={},isArchiveScreenVar="undefined"==typeof isArchiveScreen?0:isArchiveScreen?1:0,obj={filterColumn:[{Priority:!1},{JobStage:!1},{JobTypeId:!1},{OwnerType:!1},{DeemingPeriod:!1},{SolarCompany:!1},{StaffName:!1},{IsGst:!0},{PropertyType:!1},{IsCustPrice:!0},{IsSTCForm:!0},{IsCESForm:!0},{IsBasicValidation:!0},{IsInvoiced:!1},{IsPreApprovaApproved:!1},{IsConnectionCompleted:!1},{IsOwnerSiganture:!0},{IsInstallerSiganture:!0},{IsGroupSiganture:!0},{IsSerialNumberCheck:!0},{IsSTCSubmissionPhotos:!0},{IsTraded:!1},{CreatedDate:!1},{InstallationDate:!1},{InstallerSignatureDate:!1},{DesignerSignatureDate:!1},{SignatureDate:!1},{ElectricianSignatureDate:!1},{JobID:!1},{STC:!1}]};$(document).ready(function(){if($("#ResellerId").select2(),4==UserTypeID&&checkIsWholeSaler(ResellerId),$("#job-search-form").submit(function(){return!1}),$("#searchSolarCompany").autocomplete({minLength:0,source:function(e,t){var a=[];$.each(solarCompanyList,function(e,t){t.text.toLowerCase().indexOf($("#searchSolarCompany").val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value})}),t($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id}}))},select:function(e,t){$("#hdnsolarCompanyid").val(t.item.id),IsServerCallForSearch=!0}}).on("focus",function(){$(this).keydown()}),$.ui.autocomplete.prototype._renderItem=function(e,t){var a=new RegExp($.trim(this.term.toLowerCase())),o=t.label.replace(a,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");return $("<li style='font-size:14px;'></li>").data("item.autocomplete",t).append("<a>"+o+"</a>").appendTo(e)},JobStage){SelectedStageId=JobStage;var e=0,t=document.getElementById("jobstage_"+e);t.style.backgroundColor="#bdbdbd";t=document.getElementById("jobstage_"+SelectedStageId);t.style.backgroundColor="#5F5D5D",1!=UserTypeID&&3!=UserTypeID&&2!=UserTypeID&&5!=UserTypeID||(document.getElementById("chkIsArchive").checked=!1),$("#txtSearchfor").val(""),document.getElementById("JobScheduleTypeId").selectedIndex=0,document.getElementById("JobTypeId").selectedIndex=0,document.getElementById("JobPriorityId").selectedIndex=0,$("#txtFromDate").val(""),$("#txtToDate").val(""),document.getElementById("chkJobRef").checked=!0,document.getElementById("chkJobDescription").checked=!0,document.getElementById("chkJobAddress").checked=!0,document.getElementById("chkClient").checked=!0,document.getElementById("chkStaff").checked=!1,document.getElementById("chkInvoiced").checked=!0,document.getElementById("chkNotInvoiced").checked=!0,document.getElementById("chkReadyToTrade").checked=!0,document.getElementById("chkNotReadyToTrade").checked=!0,document.getElementById("chkTraded").checked=!0,document.getElementById("chkNotTraded").checked=!0,document.getElementById("chkPreApprovalNotBeenApproved").checked=!0,document.getElementById("chkPreApprovalApproved").checked=!0,document.getElementById("chkConnectionCompleted").checked=!0,document.getElementById("chkConnectionNotCompleted").checked=!0,document.getElementById("chkACT").checked=!0,document.getElementById("chkNSW").checked=!0,document.getElementById("chkNT").checked=!0,document.getElementById("chkQLD").checked=!0,document.getElementById("chkSA").checked=!0,document.getElementById("chkTAS").checked=!0,document.getElementById("chkWA").checked=!0,document.getElementById("chkVIC").checked=!0}if(1==UserTypeID||3==UserTypeID?$("#ResellerId").focus():2==UserTypeID||5==UserTypeID?$("#searchSolarcompany").focus():$("#JobScheduleTypeId").focus(),1==UserTypeID||3==UserTypeID){var a=!1;$.ajax({type:"get",url:urlGetReseller,dataType:"json",data:"",async:!1,success:function(e){$.each(e,function(e,t){$("#ResellerId").append('<option value="'+t.Value+'">'+t.Text+"</option>"),0==a&&t.Value==localStorage.getItem("JobList_ResellerId")&&(a=!0)}),a?document.getElementById("ResellerId").value=localStorage.getItem("JobList_ResellerId"):($("#ResellerId").val($("#ResellerId option:first").val()),localStorage.setItem("JobList_ResellerId",$("#ResellerId option:first").val())),$("#ResellerId").val()>0&&(1==UserTypeID||3==UserTypeID)&&(BindSolarCompany(document.getElementById("ResellerId").value),GetJobStageCount(),checkIsWholeSaler($("#ResellerId").val()))},error:function(e){alert("Failed to retrieve Resellers."+e)}})}else if(2==UserTypeID)BindSolarCompany(ResellerId),GetJobStageCount();else if(5==UserTypeID)if("true"==isAllScaJobView)BindSolarCompany(ResellerId);else{$("#searchSolarCompany").val("");var o=!1;$.ajax({type:"POST",url:urlGetAssignedSolarCompanyToRAM,dataType:"json",async:!1,data:{isAll:!0},success:function(e){solarCompanyList=[],$.each(e,function(e,t){solarCompanyList.push({value:t.Value,text:t.Text}),0==o&&t.Value==localStorage.getItem("JobList_SolarCompanyId")&&(o=!0)}),o?$("#hdnsolarCompanyid").val(localStorage.getItem("JobList_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val())),""==localStorage.getItem("JobList_SolarCompanyId")&&($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val())),$.each(solarCompanyList,function(e,t){t.value==localStorage.getItem("JobList_SolarCompanyId")&&($("#searchSolarCompany").val(t.text),$("#hdnsolarCompanyid").val(localStorage.getItem("JobList_SolarCompanyId")))}),GetJobStageCount()},error:function(e){alert("Failed to retrieve Solar Companies."+e)}})}else if(6==UserTypeID){o=!1;$.ajax({type:"POST",url:urlGetRequestedSolarCompanyToSSC,dataType:"json",data:"",async:!1,success:function(e){solarCompanyList=[],$.each(e,function(e,t){solarCompanyList.push({value:t.Value,text:t.Text})}),o?$("#hdnsolarCompanyid").val(localStorage.getItem("JobList_SolarCompanyId")):($("#hdnsolarCompanyid").val(solarCompanyList.length>0?solarCompanyList[0].value:0),localStorage.setItem("JobList_SolarCompanyId",$("#hdnsolarCompanyid").val()))},error:function(e){alert("Failed to retrieve Solar Companies."+e)}}),GetJobStageCount()}SetParamsFromLocalStorage(),SaveFilter(),datatableInfo(),isArchiveScreenVar||drawJobIndex(filterKendo),DisableAllColReorder(),DataTableColResize($("#trHeadersDynamic th").length),SetChangeFilter(),$(document).on("change","#datatable tbody input[type='checkbox']",function(){if(this.checked){chkCount++,chkCount==$("#datatable >tbody >tr").length&&$("#chkAll").prop("checked",this.checked);var e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html();$("#btotalTradedSTC").html(parseFloat(parseFloat(e)+parseFloat(t)).toFixed(2))}else{chkCount--,$("#chkAll").prop("checked",this.checked);e=""==$(this).parent().parent().find(".clsLabel").text()||null==$(this).parent().parent().find(".clsLabel").text()?0:$(this).parent().parent().find(".clsLabel").text(),t=$("#btotalTradedSTC").html();$("#btotalTradedSTC").html(parseFloat(parseFloat(t)-parseFloat(e)).toFixed(2))}}),$("#ResellerId").change(function(){$("#ResellerId").val()>0&&(1==UserTypeID||3==UserTypeID)&&(IsServerCallForSearch=!0,BindSolarCompany(document.getElementById("ResellerId").value),$("#searchSolarCompany").focus(),checkIsWholeSaler($("#ResellerId").val()))}),$("#btnExportExcel").click(function(){ExportDatatableExcel()})}),$("#txtFromDate2").datepicker({format:dateFormat,autoclose:!0}).on("changeDate",function(){if(""!=$("#txtToDate2").val()){var e=new Date(ConvertDateToTick($("#txtFromDate2").val(),dateFormat)),t=new Date(ConvertDateToTick($("#txtToDate2").val(),dateFormat));e>t&&$("#txtToDate2").val("")}var a=ConvertDateToTick($("#txtFromDate2").val(),dateFormat);tDate=moment(a).format("MM/DD/YYYY"),$("#txtToDate2").data("datepicker")&&$("#txtToDate2").data("datepicker").setStartDate(new Date(tDate))}),$("#txtToDate2").datepicker({format:dateFormat,autoclose:!0}),$("#txtToDate2").change(function(){new Date(ConvertDateToTick($("#txtFromDate").val(),dateFormat)),new Date(ConvertDateToTick($("#txtToDate").val(),dateFormat))}),$(document).off("click","#btnJobSSCMapping").on("click","#btnJobSSCMapping",function(e){if(e.preventDefault(),e.stopPropagation(),"function"==typeof validateExtraFields&&0==validateExtraFields())return!1;("function"!=typeof validateForm||"function"==typeof validateForm&&validateForm())&&$(this).closest("form").ajaxformSubmit()}),$(document).off("click","#btnJobSCOMapping").on("click","#btnJobSCOMapping",function(e){if(e.preventDefault(),e.stopPropagation(),"function"==typeof validateExtraFields&&0==validateExtraFields())return!1;("function"!=typeof validateForm||"function"==typeof validateForm&&validateForm1())&&$(this).closest("form").ajaxformSubmit()}),$("#btnAssignSSCClose").click(function(){$("#SSCID").next("span").attr("class","field-validation-valid")}),$("#btnCancel").click(function(){$("#SSCID").next("span").attr("class","field-validation-valid")}),$(".panel-heading input[type=checkbox]").change(function(){$(this).closest(".panel").find("[type=checkbox]").prop("checked",this.checked),$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length==$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]:checked").length?0!=$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length&&$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").prop("checked","checked"):$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").removeAttr("checked"),$('.columnmaster li[data-columnid="2"]').find('input[type="checkbox"]').prop("checked",!0)}),$("#btnSaveChanges").click(function(e){$("#loading-image").css("display","");var t=[],a=0,o=($("#datatable").width(),$("#datatable").data("kendoGrid").columns);$("#datatable th").each(function(e,n){a+=1;var l=$("#datatable").data("kendoGrid").dataSource.pageSize();t.push({Width:o[e].width,ColumnID:$(n).attr("data-columnid"),OrderNumber:a,PageSize:l})}),t.length>0?$.ajax({url:"/Job/SaveUserWiseColumnsDetails",type:"POST",async:!1,data:JSON.stringify({columns:t,MenuId:JobView}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){e.status?(alert("Columns have been saved successfully."),listColumns=e.ListColumnName,listColumnsWidth=e.ListColumnWidth,UserWiseColumnsData=e.JSUserColumnList,DefaultPageSize=e.PageSize,filterKendo=$("#datatable").data("kendoGrid").dataSource.filter(),$("#datatable").kendoGrid("destroy").empty(),SaveFilter(),datatableInfo(),drawJobIndex(filterKendo)):alert("Try again.")},error:function(e){alert("Try again. "+e)}}):alert("Add atleast one column."),$("#loading-image").css("display","none")});var kendo_Priority=function(e){return 1==e.Priority?1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="/Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="/Images/prio-high.png" alt="" / ><span style="display:none">High</span></span></div>':'<div class="ic_cover"><span class="priority"><img src="/Images/prio-high.png" alt="High" title="High"><span style="display:none">High</span></span></div>':2==e.Priority?1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="/Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="/Images/prio-mid.png" alt="" /><span style="display:none">Normal</span></span></div>':'<div class="ic_cover"><span class="priority"><img src="/Images/prio-mid.png" alt="Normal" title="Normal"><span style="display:none">Normal</span></span></div>':1==e.Urgent?'<div class="ic_cover"><span class="urgent" data-toggle="tooltip" data-placement="right" title="Urgent"><img src="/Images/ic-urgent.png" alt="" /></span><span class="priority"><img src="/Images/prio-low.png" alt="" /></span><span style="display:none">Low</span></div>':'<div class="ic_cover"><span class="priority"><img src="/Images/prio-low.png" alt="Low" title="Low"><span style="display:none">Low</span></span></div>'},kendo_RefNumber=function(e){if(null!=e.RefNumber){var t=urlIndex+e.Id;return'<a href="'+t+'" style="text-decoration:none;">'+e.RefNumber+"</a>"}return""},kendo_JobAddress=function(e){return null!=e.JobAddress||""!=e.JobAddress?e.JobAddress:""},kendo_JobStage=function(e){return null!=e.JobStage||""!=e.JobStage?'<p style="color:'+e.ColorCode+'">'+e.JobStage+"</p>":""},kendo_CreatedDate=function(e){return ToDate(e.strCreatedDate)},kendo_InstallationDate=function(e){return ToDate(e.strInstallationDate)},kendo_SignatureDate=function(e){return ToDate(e.strSignatureDate)},kendo_InstallerSignatureDate=function(e){return ToDate(e.strInstallerSignatureDate)},kendo_DesignerSignatureDate=function(e){return ToDate(e.strDesignerSignatureDate)},kendo_ElectricianSignatureDate=function(e){return ToDate(e.strElectricianSignatureDate)},kendo_IsPreApprovaApproved=function(e){return e.IsPreApprovaApproved?'<img src="/Images/active.png" alt="Active" title="Active"><span style="display:none">Approved</span>':'<img src="/Images/inactive.png" alt="In Active" title="In Active"><span style="display:none">Pending</span>'},kendo_IsConnectionCompleted=function(e){return e.IsConnectionCompleted?'<img src="/Images/active.png" alt="Active" title="Active"><span style="display:none">Completed</span>':'<img src="/Images/inactive.png" alt="In Active" title="In Active"><span style="display:none">Pending</span>'},kendo_IsInvoiced=function(e){return e.IsInvoiced?'<img src="/Images/ar_green.png"/><span style="display:none">Invoiced</span>':'<img src="/Images/ic_reject.png"/><span style="display:none">Pending</span>'},kendo_DocumentCount=function(e){return e.IsLatestDocument?'<b style="color:red">'+e.DocumentCount+"</b>":"<p>"+e.DocumentCount+"</p>"},kendo_STC=function(e){return'<lable class="clsLabel">'+PrintDecimal(e.STC)+"</lable>"},kendo_StaffName=function(e){return null!=e.StaffName?e.StaffName:""},kendo_SCOName=function(e){return null!=e.SCOName?e.SCOName:""},kendo_JobTypeId=function(e){return e.JobTypeId>0?1==e.JobTypeId?"PVD":2==e.JobTypeId?"SWH":void 0:""},kendo_IsGst=function(e){return e.IsGst?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},kendo_STCStatus=function(e){return null!=e.STCStatus?e.STCStatus:""},kendo_IsCustPrice=function(e){return e.IsCustPrice?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>'},kendo_IsTraded=function(e){return 1==e.TradeStatus?'<img src="/Images/ar_green.png"/><span style="display:none">Traded</span>':2==e.TradeStatus?'<img src="/Images/ic_ReadyToTrade.png"/><span style="display:none">ReadyToTrade</span>':3==e.TradeStatus?'<img src="/Images/ic_reject.png"/><span style="display:none">NotTraded</span>':void 0},kendo_Action=function(e){if(6!=UserTypeID){var t="";if(1==e.JobTypeId){null==e.SSCID||0==e.SSCID?imgassignSSC="background:url(/Images/ic_assign.png) no-repeat center; text-decoration:none;width:100%;":imgassignSSC="background:url(/Images/ic_assign_green.png) no-repeat center; text-decoration:none;width:100%;";var a="javascript:AssignSSC('"+e.Id+"')";t='<a href="'+a+'" class="action delete" style="'+imgassignSSC+'" title="Assign SSC">&nbsp; &nbsp; &nbsp; &nbsp;</a>'}else imgassignSSC="background:url(/Images/ic_assign.png) no-repeat center; text-decoration:none;width:100%;opacity:0.5;cursor:default;",t='<a  class="action delete" style="'+imgassignSSC+'" title="Assign SSC">&nbsp; &nbsp; &nbsp; &nbsp;</a>';return t}if(6==UserTypeID){if(imgaccept="background:url(/Images/ic-accept.png) no-repeat center; text-decoration:none;",imgreject="background:url(/Images/ic-reject.png) no-repeat center; text-decoration:none;",1==e.IsAccept){var o="javascript:void(0)";acceptButton='&nbsp;&nbsp;<a href="'+o+'" class="action delete disabled" style="'+imgaccept+'" title="Accept">&nbsp; &nbsp; &nbsp; &nbsp;</a>'}else{o="javascript:AcceptRejectJobToSSC('"+e.Id+"','accepted')";acceptButton='&nbsp;&nbsp;<a href="'+o+'" class="action delete" style="'+imgaccept+'" title="Accept">&nbsp; &nbsp; &nbsp; &nbsp;</a>'}var n="javascript:AcceptRejectJobToSSC('"+e.Id+"','rejected')";return rejectButton='&nbsp;&nbsp;<a href="'+n+'" class="action delete" style="'+imgreject+'" title="Reject">&nbsp; &nbsp; &nbsp; &nbsp;</a>',acceptButton+rejectButton}},kendo_Chkbox=function(e){return 1==$("#chkAll").prop("checked")?'<input type="checkbox" class="k-checkbox" JobId="'+e.JobID+'" id="chk_'+e.Id+'"jobtitle="'+e.JobTitle+'" checked><label class="k-checkbox-label" for="chk_'+e.Id+'"></label>':'<input type="checkbox" class="k-checkbox" JobId="'+e.JobID+'" id="chk_'+e.Id+'"jobtitle="'+e.JobTitle+'"><label class="k-checkbox-label" for="chk_'+e.Id+'"></label>'},kendo_IsSTCForm=function(e){return null!=e.IsSTCForm?e.IsSTCForm?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsCESForm=function(e){return null!=e.IsCESForm?e.IsCESForm?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsBasicValidation=function(e){return null!=e.IsBasicValidation?e.IsBasicValidation?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsOwnerSiganture=function(e){return null!=e.IsOwnerSiganture?e.IsOwnerSiganture?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsInstallerSiganture=function(e){return null!=e.IsInstallerSiganture?e.IsInstallerSiganture?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsGroupSiganture=function(e){return null!=e.IsGroupSiganture?e.IsGroupSiganture?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsSerialNumberCheck=function(e){return null!=e.IsSerialNumberCheck?e.IsSerialNumberCheck?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},kendo_IsSTCSubmissionPhotos=function(e){return null!=e.IsSTCSubmissionPhotos?e.IsSTCSubmissionPhotos?'<span style="font-weight: bold;color: Green;">Yes</span>':'<span style="font-weight: bold;color: Red;">No</span>':""},filter_Priority=function(e){var t=JSON.parse(colPriority);e.kendoDropDownList({dataTextField:"Name",dataValueField:"ID",dataSource:t,optionLabel:"--Select Value--"})},filter_PropertyType=function(e){e.kendoDropDownList({dataSource:PropertyType,optionLabel:"--Select Value--"})},filter_JobStage=function(e){JobStageList;$.each(JobStageList,function(e,t){t.field="JobStage"}),e.kendoDropDownList({dataTextField:"Text",dataValueField:"Text",dataSource:JobStageList,optionLabel:"--Select Value--"})},filter_OwnerType=function(e){var t=["Individual","Goverment body","New Installation","Corporate body","Trustee"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filterYesNo=function(e){var t=[{Text:"Yes",Value:1},{Text:"No",Value:0}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_DeemingPeriod=function(e){var t=[{Text:"One Year",Value:"One Year"},{Text:"Five Year",Value:"Five Year"},{Text:"Twelve Year",Value:"Twelve Year"}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_CreatedDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_InstallationDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_SignatureDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_InstallerSignatureDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_DesignerSignatureDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_ElectricianSignatureDate=function(e){e.kendoDatePicker({format:"dd/MM/yyyy"})},filter_IsPreApprovaApproved=function(e){var t=[{Text:"Approved",Value:1},{Text:"Pending",Value:0}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_IsConnectionCompleted=function(e){var t=[{Text:"Completed",Value:1},{Text:"Pending",Value:0}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_IsInvoiced=function(e){var t=[{Text:"Invoiced",Value:1},{Text:"Pending",Value:0}];e.kendoDropDownList({dataTextField:"Text",dataValueField:"Value",dataSource:t,optionLabel:"--Select Value--"})},filter_JobTypeId=function(e){var t=JSON.parse(colJobType);$.each(t,function(e,t){t.field="JobType"}),e.kendoDropDownList({dataTextField:"Name",dataValueField:"ID",dataSource:t,optionLabel:"--Select Value--"})},filter_IsGst=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsCustPrice=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsTraded=function(e){var t=JSON.parse(colTradeStatus);e.kendoDropDownList({dataTextField:"Name",dataValueField:"ID",dataSource:t,optionLabel:"--Select Value--"})},filter_IsSTCForm=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsCESForm=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsBasicValidation=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsOwnerSiganture=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsInstallerSiganture=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsGroupSiganture=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsSerialNumberCheck=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_IsSTCSubmissionPhotos=function(e){var t=["Yes","No"];e.kendoDropDownList({dataSource:t,optionLabel:"--Select Value--"})},filter_JobID=function(e){e.addClass("k-textbox"),e.attr("onkeypress","return isNumber(event);")},filter_STC=function(e){e.addClass("k-textbox"),e.attr("onkeypress","return isNumber(event);")};$("#btnChangeSearchFilter").click(function(e){for(var t=[],a=1;a<=11;a++)null!=localStorage.getItem("lochdnFilter_"+a)&&""!=localStorage.getItem("lochdnFilter_"+a)&&$.each(localStorage.getItem("lochdnFilter_"+a).split(","),function(e,a){t[t.length]=a});0==t.length?SelectAllAdvanceSearchCategory():(DeSelectAllAdvanceSearchCategory(),$.each(t,function(e,t){$('.filters-block ul input[type=checkbox][id="popup_'+t+'"]').prop("checked",!0)}))}),$("#aSwitch").click(function(e){window.location.href="/Job/Index?IsStaticSearch=true"}),$("#clearJobCreatedDate").click(function(e){$("#txtFromDate").val(""),$("#txtToDate").val("")}),$("#clearJobInstallationDate").click(function(e){$("#txtFromDate2").val(""),$("#txtToDate2").val("")});