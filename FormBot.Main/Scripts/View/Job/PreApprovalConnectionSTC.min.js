function ApplyPreapprovalConnection(o,n){var t=$(o).attr("email"),e=$(o).attr("link"),a=$(o).attr("documentstepid"),p=$(o).attr("documentStepType");$("#PreApprovalConnOrStcClicked").val(n),$.ajax({url:GetEmailSendViewForPreApprovalAndConnectionURL,type:"GET",data:{JobId:BasicDetails_JobID,Type:p,isClassic:!1},cache:!1,success:function(o){$("#loadPreapprovalConnectionStepApply").empty(),$("#loadPreapprovalConnectionStepApply").html(o),1==p&&($("#preApproTo").val(t.replace(/,/g,";")),$(".CloseEmailPreApproval").hide()),2==p&&($("#onlineLink").attr("href",e),$("#txtCommentOnReference").val($("#hdnComment"+a).val())),3==p&&$("#DrpAlreadyApplied").val($("#hdnComment"+a).val()),$(".topbord").hide(),$("#popupDocumentStepId").val(a),$("#popupboxPreapprovalConnectionApply").modal({backdrop:"static",keyboard:!1})}})}function SavePreapprovalConnectionComment(o){var n=0,t="",e="";1==$("#preApprovalConnectionVal").val()?(n=$("#JobStatusForPreApproval").val(),t=$("#JobStatusForPreApproval option:selected").text()):(n=$("#JobStatusForConnection").val(),t=$("#JobStatusForConnection option:selected").text()),e=1==o?($("#preApprovalConnectionVal").val(),t):1==$("#preApprovalConnectionVal").val()?$("#txtPreapprovalComment").val():$("#txtConnComment").html();var a=JSON.stringify({JobId:$("#BasicDetails_JobID").val(),JobStatusId:n,PreApprovalAndConnectionId:$("#preApprovalConnectionVal").val(),Comment:e,ModifiedBy:ProjectSession_LoggedInUserId,Status:t});$.ajax({url:AddUpdateJobCommentForPreApprAndConnURL,type:"POST",dataType:"json",data:a,contentType:"application/json; charset=utf-8",success:function(n){n?1==$("#preApprovalConnectionVal").val()?1==o?(showSuccessMessage("Preapproval status has been changed successfully."),$("#spanPreapprovalComment").text(t),$("#txtPreapprovalComment").val(t)):($("#spanPreapprovalComment").text($("#txtPreapprovalComment").val()),showSuccessMessage("Preapproval comment has been saved successfully."),$("#popupboxPreapprovalConnectionComment").modal("hide")):1==o?(showSuccessMessage("Connection status has been changed successfully."),$("#spanConnectionComment").text(t),$("#txtConnComment").val(t)):($("#spanConnectionComment").text($("#txtConnComment").val()),showSuccessMessage("Connection comment has been saved successfully."),$("#popupboxPreapprovalConnectionComment").modal("hide")):1==$("#preApprovalConnectionVal").val()?1==o?showErrorMessage("Preapproval status has not been changed."):showErrorMessage("Preapproval comment has not been saved."):1==o?showErrorMessage("Connection status has not been changed."):showErrorMessage("Connection comment has not been saved.")}})}function ClearComment(){$("#txtPreapprovalComment").val(""),$("#txtConnComment").val("")}function ShowHidePreapprovalBox(){$("#onOffSwitchPreApproval").prop("checked")?($("#preApprovalBox").show(),$("#onOffSwitchPreApproval").attr("ison",0)):($("#preApprovalBox").hide(),$("#onOffSwitchPreApproval").attr("ison",1))}function ShowHideConnectionBox(){$("#onOffSwitchConnection").prop("checked")?($("#connectionBox").show(),$("#onOffSwitchConnection").attr("ison",0)):($("#connectionBox").hide(),$("#onOffSwitchConnection").attr("ison",1))}ShowHidePreapprovalBox(),ShowHideConnectionBox();var distributorID=modelInstallationDistributorID;$(document).ready(function(){var o,n;$("#spanPreapprovalComment").html(viewBagPreApprovalComment),$("#spanConnectionComment").html(viewBagConnectionComment),$("#txtPreapprovalComment").val($("#spanPreapprovalComment").html()),$("#preApprovalConnectionVal").val(1),$("#txtConnComment").val($("#spanConnectionComment").html()),$("#preApprovalConnectionVal").val(2),$("#JobStatusForPreApproval").on("focus",function(){o=this.value}).change(function(){confirm("Are you sure you want to change preApproval status?")?($("#preApprovalConnectionVal").val(1),SavePreapprovalConnectionComment(1),o=this.value):$("#JobStatusForPreApproval").val(o)}),$("#JobStatusForConnection").on("focus",function(){n=this.value}).change(function(){confirm("Are you sure you want to change connection status?")?($("#preApprovalConnectionVal").val(2),SavePreapprovalConnectionComment(1),n=this.value):$("#JobStatusForConnection").val(n)}),$("#btnPopupPreApproval").click(function(o){$("#txtPreOrConnComment").val($("#spanPreapprovalComment").html()),$("#preApprovalConnectionVal").val(1),$("#popupboxPreapprovalConnectionComment").modal({backdrop:"static",keyboard:!1}),o.preventDefault()}),$("#btnPopupConnection").click(function(o){$("#txtPreOrConnComment").val($("#spanConnectionComment").html()),$("#preApprovalConnectionVal").val(2),$("#popupboxPreapprovalConnectionComment").modal({backdrop:"static",keyboard:!1}),o.preventDefault()}),""!=viewBagPreApprovalStatus?$("#JobStatusForPreApproval option:contains("+viewBagPreApprovalStatus+")").attr("selected",!0):$("#JobStatusForPreApproval").val(1),""!=viewBagConnectionStatus?$("#JobStatusForConnection option:contains("+viewBagConnectionStatus+")").attr("selected",!0):$("#JobStatusForConnection").val(6),$("#preapprovalUL").find("li").each(function(){$(this).find("#hdnIsApplied").attr("isApplied")&&"isapplied"==$(this).find("#hdnIsApplied").attr("isApplied").toString().toLowerCase()?($(this).find(".appliedApprovalButton").show(),$(this).find(".applyApprovalButton").hide()):($(this).find(".applyApprovalButton").show(),$(this).find(".appliedApprovalButton").hide())}),$("#connectionUL").find("li").each(function(){$(this).find("#hdnIsApplied").attr("isApplied")&&"isapplied"==$(this).find("#hdnIsApplied").attr("isApplied").toString().toLowerCase()?($(this).find(".appliedConnectionButton").show(),$(this).find(".applyConnectionButton").hide()):($(this).find(".applyConnectionButton").show(),$(this).find(".appliedConnectionButton").hide())})});