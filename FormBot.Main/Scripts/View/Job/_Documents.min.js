function generateDocument(stage,state,provName,name,id,obj){if(jobId){var isValid=!0;"1"==$("tr#"+obj).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+obj).find(".hdnIsUpload").attr("val")&&(confirm("File has been already uploaded. If you are generating file then uploaded file will be removed and new file will be generated. Are you still want to generate ?")||(isValid=!1)),isValid&&($("#loading-image").show(),$.ajaxSetup({async:!0,cache:!1}),$.get(urlGenerateDocument+"?id="+jobId+"&documentId="+id+"&stage="+stage+"&state="+state+"&provName="+provName+"&name="+name+"&isDeleteFirst="+$("tr#"+obj).find(".hdnIsUpload").attr("val"),"",function(data){"STC"==stage?($("#loading-image").show(),checkBusinessRulesForDocument(obj)):(IncreaseCountOfDocumentOnGenerate(),showMessage("Document has been generated successfully.",!1),setViewIcon("tr#"+obj,!1,!1))}))}}function uploadDocument(stage,state,provName,name,id,objId){if(jobId){var isValid=!0,obj=$("#"+objId).closest("tr").attr("id");"1"==$("tr#"+obj).find(".hdnIsExists").attr("val")&&"0"==$("tr#"+obj).find(".hdnIsUpload").attr("val")?confirm("File has been already generated. If you are uploading file then generated file will be removed and new file will be uploaded. Are you still want to upload ?")||(isValid=!1):"1"==$("tr#"+obj).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+obj).find(".hdnIsUpload").attr("val")&&(confirm("File has been already uploaded. If you are uploading file then uploaded file will be removed and new file will be uploaded. Are you still want to upload ?")||(isValid=!1)),isValid&&($(".fileUpload1").unbind("fileuploadsubmit").bind("fileuploadsubmit",function(e,data){data.formData={id:jobId,documentid:id,stage:stage,state:state,provName:provName,name:name}}),doneCallBack=function(){"STC"==stage?checkBusinessRulesForDocument(obj):(showMessage("Document has been generated successfully.",!1),setViewIcon("tr#"+obj,!1,!1))},$("#"+objId).siblings(".fileUpload1").click())}return!1}function downloadDocument(stage,state,provName,name,id,obj,isExist){return jobId&&$("tr#"+obj).find(".hdnIsExists")&&$("tr#"+obj).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+obj).find(".hdnIsExists").attr("val")&&(window.location.href=urlDownloadSTCDocument+"?jobid="+jobId+"&docId="+id),!1}function deleteDocument(stage,state,provName,name,id,obj){jobId&&$("tr#"+obj).find(".hdnIsExists")&&$("tr#"+obj).find(".hdnIsExists").attr("val")&&"1"==$("tr#"+obj).find(".hdnIsExists").attr("val")&&confirm("Are you sure you want to delete this file ?")&&($.ajaxSetup({async:!1,cache:!1}),$.get(urlDeleteDocument+"?id="+jobId+"&documentId="+id+"&stage="+stage+"&state="+state+"&provName="+provName+"&name="+name,"",function(data){"STC"==stage&&$.ajax({url:urlGetSTCStatusDescription,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:"id="+Model_JobID,success:function(result){result.IsSuccess&&(result.STCStatusName&&$("#spanSTCStatus").text(result.STCStatusName.trim()),result.STCDescription&&$("#STCDescription").html(result.STCDescription.trim()),result.STCStatusId&&$("#STCStatusId").val(result.STCStatusId.trim()))}}),showMessage("Document has been deleted successfully.",!1),setViewIcon("tr#"+obj,!0,!1),DecreaseCountOfDocumentOnDelete()}))}function assignEvent(){$("#loading-image").show();var BaseURL,urlDocument=ProjectImagePath+"Job/"+"UploadDocument/Job";$(".fileUpload1").fileupload({url:urlDocument,dataType:"json",done:function(e,data){doneCallBack&&doneCallBack(),doneCallBack=void 0},progressall:function(e,data){},singleFileUploads:!1,send:function(e,data){var documentType,mimeType=data.files[0].type.split("/")[0];if(data.files.length>1)for(var i=0;i<data.files.length;i++){if(data.files[i].size>parseInt(MaxImageSize))return showMessage(" "+data.files[i].name+" Maximum document size limit exceeded. Please upload a file smaller  than "+maxsize+"MB.",!0),!1;if(CheckSpecialCharInFileName(data.files[i].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0),!1}else if(data.files[0].size>parseInt(MaxImageSize))return showMessage("Maximum  document size limit exceeded.Please upload a  file smaller than "+maxsize+"MB.",!0),!1;if(1==data.files.length){var ext=data.files[0].name.toLowerCase().split(".").length>0?data.files[0].name.toLowerCase().split(".")[data.files[0].name.toLowerCase().split(".").length-1]:"";if("application/pdf"!=data.files[0].type&&"pdf"!=ext)return showMessage("Please upload a document with .pdf extension.",!0),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(data.files[0].name))return showMessage("Please upload file that not conatain <> ^ [] .",!0),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1}return!0},change:function(e,data){}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function setViewIcon(obj,isRemove,isUpload){var removeCls=isRemove?"":"disView",addCls=isRemove?"disView":"",removedownloadCls=isRemove?"":"notdownload",adddownloadCls=isRemove?"notdownload":"",tdaddCls=isRemove?"":"semiBold",tdremoveCls=isRemove?"semiBold":"";$(obj).find(".view").removeClass(removeCls).addClass(addCls),$(obj).find(".download_doc").removeClass(removedownloadCls).addClass(adddownloadCls),$(obj).find(".delete").removeClass(removeCls.replace("View","Delete")).addClass(addCls.replace("View","Delete")),$(obj).find(".tdDoc").removeClass(tdremoveCls).addClass(tdaddCls),$(obj).find(".hdnIsExists").attr("val",isRemove?"0":"1"),$(obj).find(".hdnIsUpload").attr("val",isUpload?"1":"0")}function showMessage(msg,isError){$(".alert").hide();var visible=isError?"errorMsgRegion":"successMsgRegion",inVisible;$("#"+(isError?"successMsgRegion":"errorMsgRegion")).hide(),$("#"+visible).html(closeButton+msg),$("#"+visible).show()}function DeleteOtherDocument(){$('input[name="chkBtnDocument"]:checked').length>0&&confirm("Are you sure you want to delete this file ?")&&$('input[name="chkBtnDocument"]:checked').each(function(){DeleteDocumetFromFolder(this.value)})}function OpenOtherDocument(e){var path=UploadedDocumentPath,fullPath=JobDocumentsToSavePath,USERID=Model_JobID,imagePath;SRC=path+fullPath+USERID+"/Other"+"/"+e.className,$("#loading-image").css("display",""),$("#imgDocument").attr("src",SRC).load(function(){logoWidth=this.width,logoHeight=this.height,$("#popupDocumentBox").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeight?($("#imgDocument").closest("div").height($(window).height()-150),$("#imgDocument").closest("div").css("overflow-y","scroll"),$("#imgDocument").height(logoHeight)):($("#imgDocument").height(logoHeight),$("#imgDocument").closest("div").removeAttr("style")),screen.width<=logoWidth||logoWidth>=screen.width-250?($("#popupDocumentBox").find(".modal-dialog").width(screen.width-250),$("#imgDocument").width(logoWidth)):($("#imgDocument").width(logoWidth),$("#popupDocumentBox").find(".modal-dialog").width(logoWidth)),$("#loading-image").css("display","none")}),$("#imgDocument").unbind("error"),$("#imgDocument").attr("src",SRC).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}function OpenOtherDocumentDownload(e){var BaseURL=ProjectImagePath+"Job/",foldername=Model_JobID;window.location.href=BaseURL+"ViewDownloadFile/Job?FileName="+encodeURIComponent(e.className)+"&FolderName="+foldername}function DeleteDocumetFromFolder(fileDelete){var USERID,FolderName=Model_JobID,BaseURL=ProjectImagePath+"Job/";$.ajax({url:BaseURL+"DeleteFileFromFolderDocument/Job",data:{fileName:fileDelete,FolderName:FolderName},method:"get",success:function(){return $.each($("#otherTblDoc").find("li"),function(i,e){$(e).find("a").attr("id")==fileDelete&&($(this).remove(),DecreaseCountOfDocumentOnDelete())}),$(".alert").hide(),$("#successMsgRegion").html(closeButton+"File has been deleted successfully."),$("#successMsgRegion").show(),!1}})}function checkBusinessRulesForDocument(objDoc){EnableDropDownbyUsertype(),$("#BasicDetails_JobType").removeAttr("disabled");var panelData="",xmlPanel="",inverterData="",xmlInverter="";if(PanelXml.length>0){var jsonp=JSON.stringify(PanelXml),sName="",obj=$.parseJSON(jsonp);$.each(obj,function(){sName+="<panel><Brand>"+htmlEncode(this.Brand)+"</Brand><Model>"+htmlEncode(this.Model)+"</Model><NoOfPanel>"+this.Count+"</NoOfPanel></panel>"}),xmlPanel="<Panels>"+sName+"</Panels>"}if(InverterXml.length>0){var jsonp=JSON.stringify(InverterXml),sName="",obj=$.parseJSON(jsonp);$.each(obj,function(){sName+="<inverter><Brand>"+htmlEncode(this.Brand)+"</Brand><Model>"+htmlEncode(this.Model)+"</Model><Series>"+htmlEncode(this.Series)+"</Series><NoOfInverter>"+htmlEncode(this.NoOfInverter)+"</NoOfInverter></inverter>"}),xmlInverter="<Inverters>"+sName+"</Inverters>"}$("#panelXml").val(xmlPanel),$("#inverterXml").val(xmlInverter);var data=JSON.stringify($("form").serializeToJson());$.ajax({url:urlCheckBusinessRules,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",processData:!1,data:data,success:function(result){result.IsSuccess?(showMessage("Document has been generated successfully.",!1),setViewIcon("tr#"+objDoc,!1,!1),null!=result.STCStatusName&&null!=result.STCStatusName&&""!=result.STCStatusName&&$("#spanSTCStatus").text(result.STCStatusName.trim()),null!=result.STCDescription&&null!=result.STCDescription&&""!=result.STCDescription&&$("#STCDescription").html(result.STCDescription.trim()),null!=result.STCStatusId&&null!=result.STCStatusId&&""!=result.STCStatusId&&$("#STCStatusId").val(result.STCStatusId.trim())):result.IsError&&(showMessage("Document has been generated successfully.",!1),setViewIcon("tr#"+objDoc,!1,!1)),IncreaseCountOfDocumentOnGenerate()}})}function ShowHideDownloadAllActiveButton(count){count?(totalActiveTabDocumentCount=count,OpacityIncreaseDecrease($(".downloadAllActive"),totalActiveTabDocumentCount)):OpacityIncreaseDecrease($(".downloadAllActive"),0)}function ShowHideDownloadAllButton(count){count?(totalDocumentCount=count,OpacityIncreaseDecrease($(".downloadAll"),totalDocumentCount)):OpacityIncreaseDecrease($(".downloadAll"),0)}function DecreaseCountOfDocumentOnDelete(){totalActiveTabDocumentCount>0&&(totalActiveTabDocumentCount-=1),totalDocumentCount>0&&(totalDocumentCount-=1),OpacityIncreaseDecrease($(".downloadAllActive"),totalActiveTabDocumentCount),OpacityIncreaseDecrease($(".downloadAll"),totalDocumentCount)}function IncreaseCountOfDocumentOnGenerate(){totalActiveTabDocumentCount+=1,totalDocumentCount+=1,OpacityIncreaseDecrease($(".downloadAllActive"),totalActiveTabDocumentCount),OpacityIncreaseDecrease($(".downloadAll"),totalDocumentCount)}function OpacityIncreaseDecrease(obj,count){count>0?(obj.css("opacity","1"),obj.css("pointer-events","visible")):(obj.css("opacity","0.5"),obj.css("pointer-events","none"))}function downloadAllActiveTabAsZip(){$.each($("#ulJobStage").find("li"),function(i,e){if("resp-tab-active"==$(e).attr("class")){var tabValue=$(e).attr("val");return window.location.href=urlDownloadAllAndActiveTabDocument+"?jobid="+jobId+"&distributorID="+distributorID+"&stage="+tabValue+"&jobTypeId="+jobTypeId+"&isAll=0",!1}})}function downloadAllAsZip(){var stage=[];return $.each($("#ulJobStage").find("li"),function(i,e){"stc"!=$(e).attr("val").toLowerCase()&&stage.push($(e).attr("val"))}),window.location.href=urlDownloadAllAndActiveTabDocument+"?jobid="+jobId+"&distributorID="+distributorID+"&stage="+stage.join(",")+"&jobTypeId="+jobTypeId+"&isAll=1",!1}$(document).ready(function(){distributorID=$("#JobInstallationDetails_DistributorID").val(),nmi=$("#JobInstallationDetails_NMI").val(),prepareDocs(JobStage_STC),$("ul#ulJobStage").find("li").click(function(){$("ul#ulJobStage").find("li").removeClass("resp-tab-active"),$(this).addClass("resp-tab-active"),prepareDocs($(this).attr("val")),Model_JobID>0&&("Other"==$(this).attr("val")?($("#Other").show(),$("#otherTable").show()):"PreApprovals"!=$(this).attr("val")&&"Connections"!=$(this).attr("val")&&"STC"!=$(this).attr("val")||($("#Other").hide(),$("#otherTable").hide()))})}),$(function(){"use strict";var BaseURL=ProjectImagePath+"Job/",USERID=Model_JobID,urlDocumentOther=BaseURL+"UploadDocumentOther/Job";$("#uploadBtnDocument").fileupload({url:urlDocumentOther,dataType:"json",done:function(e,data){var UploadFailedFiles=[];UploadFailedFiles.length=0;var UploadFailedFilesType=[];UploadFailedFilesType.length=0;for(var i=0;i<data.result.length;i++)if(1==data.result[i].Status){var rowcount=$("#otherTblDoc").length,documentType,mimeType=data.result[i].MimeType.split("/")[0],ids=data.result[i].FileName.replace("%","$"),sortFileName;if(data.result[i].FileName.length>20)var path=ids.substring(0,20)+"...";else path=ids;var content="<li class='checkbox' style='margin-left:2px;'>";content+="<label> <input type='checkbox' name='chkBtnDocument' value=\""+ids+'" >',content+="image"==mimeType?"<a href='javascript:void(0)' style='text-decoration:none;' title=\""+ids+'" class="'+ids+'" id="'+ids+"\" onclick='OpenOtherDocument(this);'>"+path+" </a>":"<a href='javascript:void(0)' style='text-decoration:none;' title=\""+ids+'" class="'+ids+'" id="'+ids+"\" onclick='OpenOtherDocumentDownload(this);'>"+path+" </a>",content+="</label>",content+="</li>",$("#otherTblDoc").append(content),$('<input type="hidden">').attr({name:"FileNamesCreate",value:data.result[i].FileName,id:data.result[i].FileName}).appendTo("form"),IncreaseCountOfDocumentOnGenerate()}else 0==data.result[i].Status&&"BigName"==data.result[i].Message?UploadFailedFilesType.push(data.result[i].FileName):UploadFailedFiles.push(data.result[i].FileName);return UploadFailedFiles.length>0?($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+UploadFailedFiles.length+" File has not been uploaded."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):UploadFailedFilesType.length>0?($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+UploadFailedFilesType.length+" Uploaded filename is too big."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):($(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+"File has been uploaded successfully."),void $("#successMsgRegion").show())},progressall:function(e,data){},singleFileUploads:!1,send:function(e,data){if(1==data.files.length)for(var i=0;i<data.files.length;i++){if(data.files[i].name.length>50)return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Please upload small filename."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(data.files[i].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}if(data.files.length>1)for(var i=0;i<data.files.length;i++){if(data.files[i].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+" "+data.files[i].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(data.files[i].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}else if(data.files[0].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:{userId:USERID},change:function(e,data){$("#uploadFile").val("C:\\fakepath\\"+data.files[0].name)}}).prop("disabled",!$.support.fileInput)}),$("#btnClosePopUpDocumentBox").click(function(){$("#popupDocumentBox").modal("toggle")});