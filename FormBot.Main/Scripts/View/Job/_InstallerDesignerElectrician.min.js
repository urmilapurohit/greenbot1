function SWHInstallerSignatureUpload(){var e=ProjectSession_UploadedDocumentPath;if(""!=$("#imgSignSWHInstall").attr("src")&&""!=JobInstallerDetailsSWH_SESignature){var s=$("#imgSignSWHInstall").attr("src"),t=ProjectSession_LoggedInUserId,l=e+"UserDocuments/"+t,a=l+"/"+s;SRCSignSWHInstall=a,$("#imgSignSWHInstall").attr("class",s),$("#imgSWHSignatureInstaller").show()}null!=BasicDetails_InstallerSignature&&""!=BasicDetails_InstallerSignature&&null!=BasicDetails_InstallerSignature?$("#imgInstallerSign").attr("src",e+BasicDetails_InstallerSignature_Replace+"?"+(new Date).getTime()):$("#imgInstallerSign").attr("src",SRCSignSWHInstall),$("#imgSWHSignatureInstaller").click(function(){$("#loading-image").css("display",""),$("#imgSignSWHInstall").attr("src",SRCSignSWHInstall).load(function(){logoWidthSignSWHInstall=this.width,logoHeightSignSWHInstall=this.height,$("#popupboxSWHInsaller").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeightSignSWHInstall?($("#imgSignSWHInstall").closest("div").height($(window).height()-205),$("#imgSignSWHInstall").closest("div").css("overflow-y","scroll"),$("#imgSignSWHInstall").height(logoHeightSignSWHInstall)):($("#imgSignSWHInstall").height(logoHeightSignSWHInstall),$("#imgSignSWHInstall").closest("div").removeAttr("style")),screen.width<=logoWidthSignSWHInstall||logoWidthSignSWHInstall>=screen.width-250?($("#popupboxSWHInsaller").find(".modal-dialog").width(screen.width-250),$("#imgSignSWHInstall").width(logoWidthSignSWHInstall)):($("#imgSignSWHInstall").width(logoWidthSignSWHInstall),$("#popupboxSWHInsaller").find(".modal-dialog").width(logoWidthSignSWHInstall)),$("#loading-image").css("display","none")}),$("#popupboxSWHInsaller").unbind("error"),$("#imgSignSWHInstall").attr("src",SRCSignSWHInstall).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}),$("#uploadBtnSignatureSWHInstaller").fileupload({url:Upload_User,dataType:"json",done:function(e,s){var t=[];t.length=0;var l=[];l.length=0;for(var a=0;a<s.result.length;a++)if(1==s.result[a].Status){var i=ProjectSession_LoggedInUserId,n=$("#imgSignSWHInstall").attr("class");$("[name='JobInstallerDetails.SESignature']").each(function(){$(this).remove()}),null!=n&&""!=n&&DeleteFileFromLogoOnUpload(n,i,JobInstallerDetailsSWH_SESignature,ProjectImagePath);var r=UploadedDocumentPath,o=r+"UserDocuments/"+i;SRCSignSWHInstall=o+"/"+s.result[a].FileName,$("#imgSignSWHInstall").attr("src",SRCSignSWHInstall),$("#imgSignSWHInstall").attr("class",s.result[a].FileName),$("#imgSWHSignatureInstaller").show(),$('<input type="hidden">').attr({name:"JobInstallerDetails.SESignature",value:s.result[a].FileName,id:s.result[a].FileName}).appendTo("form")}else 0==s.result[a].Status&&"BigName"==s.result[a].Message?l.push(s.result[a].FileName):t.push(s.result[a].FileName);t.length>0&&showErrorMessageForPopup(t.length+" File has not been uploaded.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),l.length>0&&showErrorMessageForPopup(l.length+" Uploaded filename is too big.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),0==l.length&&0==t.length&&showSuccessMessageForPopup("File has been uploaded successfully.",$("#successMsgRegionSWHInstallerPopup"),$("#errorMsgRegionSWHInstallerPopup"))},progressall:function(e,s){},singleFileUploads:!1,send:function(e,s){var t=s.files[0].type.split("/"),l=t[0];if(1==s.files.length)for(var a=0;a<s.files.length;a++){if(s.files[a].name.length>50)return showErrorMessageForPopup("Please upload small filename.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(s.files[a].name))return showErrorMessageForPopup("Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1}if(s.files.length>1)for(a=0;a<s.files.length;a++){if(s.files[a].size>parseInt(MaxLogoSize))return showErrorMessageForPopup(" "+s.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxLogoSize+"MB",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),!1;if(CheckSpecialCharInFileName(s.files[a].name))return showErrorMessageForPopup("Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),!1}else if(s.files[0].size>parseInt(MaxLogoSize))return showErrorMessageForPopup("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxLogoSize+"MB",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),!1;return"image"!=l?(showErrorMessageForPopup("Please upload a file with .jpg , .jpeg or .png extension.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):($(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:ProjectSession_LoggedInUserId,id:ProjectSession_LoggedInUserId}).appendTo("form"),!0)},formData:{userId:ProjectSession_LoggedInUserId},change:function(e,s){$("#uploadFile").val("C:\\fakepath\\"+s.files[0].name)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function JobInstallerDetails_ElectricianChange(){var e=$("#JobInstallerDetails_ElectricianID").val(),s=$("#BasicDetails_JobType").val();$.ajax({url:GetElectricianDetailbySolarcompanyURL,data:{Id:e,JobType:s},contentType:"application/json",method:"get",success:function(e){if(0!=e){var s=JSON.parse(e);if(null!=s[0].SESignature&&""!=s[0].SESignature){var t=s[0].SESignature,l=ProjectSession_LoggedInUserId,a=ProjectSession_UploadedDocumentPath,i=a+"UserDocuments/"+l;SRCSignSWHInstall=i+"/"+t,$("#imgSignSWHInstall").attr("class",t),$("#imgSWHSignatureInstaller").show()}else $("#imgSWHSignatureInstaller").hide();$("#JobInstallerDetails_FirstName").val(s[0].FirstName),$("#JobInstallerDetails_Surname").val(s[0].LastName),$("#JobInstallerDetails_Email").val(s[0].Email),$("#JobInstallerDetails_Phone").val(s[0].Phone),$("#JobInstallerDetails_Mobile").val(s[0].Mobile),$("#JobInstallerDetails_LicenseNumber").val(s[0].ElectricalContractorsLicenseNumber),$("#JobInstallerDetails_LicenseNumber").attr("readonly","readonly"),$("#JobInstallerDetails_LicenseNumber").attr("onblur","");var n,r="False";"False"==s[0].IsPostalAddress?(r="1",$(".InstallerPDA").hide(),$(".InstallerDPA").show()):(r="2",$(".InstallerDPA").hide(),$(".InstallerPDA").show()),$("#JobInstallerDetails_AddressID").val(r),$("#JobInstallerDetails_UnitTypeID").val(s[0].UnitTypeID),$("#JobInstallerDetails_UnitNumber").val(s[0].UnitNumber),$("#JobInstallerDetails_StreetNumber").val(s[0].StreetNumber),$("#JobInstallerDetails_StreetName").val(s[0].StreetName),$("#JobInstallerDetails_StreetTypeID").val(s[0].StreetTypeID),$("#JobInstallerDetails_Town").val(s[0].Town),$("#JobInstallerDetails_State").val(s[0].State),$("#JobInstallerDetails_PostCode").val(s[0].PostCode),$("#JobInstallerDetails_PostalDeliveryNumber").val(s[0].PostalDeliveryNumber),$("#JobInstallerDetails_PostalAddressID").val(s[0].PostalAddressID),ElectrianAddressJson=[];var o=$("#JobInstallerDetails").find("option:selected").text(),c=$("#JobInstallerDetails.UnitNumber").val(),d=$("#JobInstallerDetails_StreetNumber").val(),g=$("#JobInstallerDetails_StreetName").val(),u=$("#JobInstallerDetails_StreetTypeID").find("option:selected").text(),I=$("#JobInstallerDetails_Town").val(),p=$("#JobInstallerDetails_State").val(),D=$("#JobInstallerDetails_PostCode").val(),S=$("#JobInstallerDetails_FirstName").val(),m=$("#JobInstallerDetails_LastName").val(),h=$("#JobInstallerDetails_Email").val(),b=$("#JobInstallerDetails_Phone").val(),v=$("#JobInstallerDetails_Mobile").val();1==$("#JobElectricians_AddressID").val()?(""!=c?(n=o+" "+c+"/"+d+" "+g+" "+u+", "+I+" "+p+" "+D,n=n.replace("Select","")):(n=o+" "+d+" "+g+" "+u+", "+I+" "+p+" "+D,n=n.replace("Select","")),ElectrianAddressJson.push({PostalAddressType:$("#JobInstallerDetails_AddressID").val(),UnitType:$("#JobInstallerDetails.UnitTypeID").val(),UnitNumber:$("#JobInstallerDetails.UnitNumber").val(),StreetNumber:$("#JobInstallerDetails_StreetNumber").val(),StreetName:$("#JobInstallerDetails_StreetName").val(),StreetType:$("#JobInstallerDetails_StreetTypeID").val(),Town:$("#JobInstallerDetails_Town").val(),State:$("#JobInstallerDetails_State").val(),PostCode:$("#JobInstallerDetails_PostCode").val(),FirstName:S,LastName:m,Email:h,Phone:b,Mobile:v})):(n=I+" "+p+" "+D,ElectrianAddressJson.push({PostalAddressType:$("#JobInstallerDetails_AddressID").val(),Town:$("#JobInstallerDetails_Town").val(),State:$("#JobInstallerDetails_State").val(),PostCode:$("#JobInstallerDetails_PostCode").val(),FirstName:S,LastName:m,Email:h,Phone:b,Mobile:v})),$("#txtInstallerName").val($("#JobInstallerDetails_FirstName").val()+" "+$("#JobInstallerDetails_Surname").val()),$("#spantxtInstallerNames").hide()}}})}function ElectricianSignature(){var e=ProjectSession_UploadedDocumentPath;if(null!=JobElectricians_Signature&&""!=JobElectricians_Signature&&null!=JobElectricians_Signature){var s=JobElectricians_Signature;$("#imgSign").attr("src",s);var t=$("#imgSign").attr("src"),l=Model_Guid,a=e+"JobDocuments/"+l;s=a+"/"+t;SRCSign=s,$("#imgSign").attr("class",t),$("#imgSignature").show()}BasicDetails_ElectricianSignature?$("#imgElectricianSign").attr("src",e+BasicDetails_ElectricianSignature_Replace+"?"+(new Date).getTime()):$("#imgElectricianSign").attr("src",SRCSign),$("#imgSignature").click(function(){$("#loading-image").css("display",""),$("#imgSign").attr("src",SRCSign).load(function(){logoWidth=this.width,logoHeight=this.height,$("#popupbox").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeight?($("#imgSign").closest("div").height($(window).height()-205),$("#imgSign").closest("div").css("overflow-y","scroll"),$("#imgSign").height(logoHeight)):($("#imgSign").height(logoHeight),$("#imgSign").closest("div").removeAttr("style")),screen.width<=logoWidth||logoWidth>=screen.width-250?($("#popupbox").find(".modal-dialog").width(screen.width-250),$("#imgSign").width(logoWidth)):($("#imgSign").width(logoWidth),$("#popupbox").find(".modal-dialog").width(logoWidth)),$("#loading-image").css("display","none")}),$("#imgSign").unbind("error"),$("#imgSign").attr("src",SRCSign).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}),$("#btnClosePopUpBox").click(function(){$("#popupbox").modal("toggle")}),ElectricianSignUpload()}function ElectricianSignUpload(){$("#uploadBtnJobSignature").fileupload({url:UploadURL,dataType:"json",done:function(e,s){var t=[];t.length=0;for(var l=0;l<s.result.length;l++)if(1==s.result[l].Status){var a=JobElectricians_Signature,i=Model_Guid,n=$("#imgSign").attr("class");$("[name='Signature']").each(function(){$(this).remove()}),null!=n&&""!=n&&DeleteFileFromFolderAndElectrician(n,i,a);var r=ProjectSession_UploadedDocumentPath,o=r+"JobDocuments/"+i,c=o+"/"+s.result[l].FileName.replace("%","$");SRCSign=c,$("#imgSign").attr("class",s.result[l].FileName.replace("%","$")),$("#imgSignature").show(),$('<input type="hidden">').attr({name:"Signature",value:s.result[l].FileName.replace("%","$"),id:s.result[l].FileName.replace("%","$")}).appendTo("form")}else t.push(s.result[l].FileName.replace("%","$"));t.length>0?($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"File has not been uploaded."),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+"File has been uploaded successfully."),$("#successMsgRegion").show())},progressall:function(e,s){},singleFileUploads:!1,send:function(e,s){var t=s.files[0].type.split("/"),l=t[0];if(s.files.length>1)for(var a=0;a<s.files.length;a++){if(s.files[a].size>parseInt(ProjectSession_MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+" "+s.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(s.files[a].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}else{if(s.files[0].size>parseInt(ProjectSession_MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(s.files[a].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}return"image"!=l?($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Please upload a file with .jpg , .jpeg or .png extension."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):s.files[0].size>parseInt(1024e3)?(showErrorMessageForPopup("Please upload Signature Within 1 MB otherwise it slow down your job performance",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1):($(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:Model_Guid,id:Model_Guid}).appendTo("form"),!0)},formData:{userId:Model_Guid}})}function DeleteFileFromFolderAndElectrician(e,s,t){$.ajax({url:DeleteFileFromFolderAndElectricianURL,data:{fileName:e,FolderName:s,OldEleSign:t},contentType:"application/json",method:"get",success:function(e){}})}function RegisterElectricianSignClickEvent(){InstDesignElectSignUploadByIcon($("#eleGetSignByUpload")),$("#eleGetSignFromVisit").click(function(e){$("#hdBasicDetails_ElectricianID").val()>0&&($("#divElectricianSignDraw").hide(),GetSignatureFromVisit(3)),e.preventDefault()}),$("#eleGetSignByDrawing").click(function(e){$("#hdBasicDetails_ElectricianID").val()>0&&(0==isDrawSignatureOn?(isDrawSignatureOn=1,$("#divElectricianSign").hide(),$("#divElectricianSignDraw").show(),$(".eleCSign").jSignature("clear")):alert("First save installer/designer signature.")),e.preventDefault()})}function RegisterDesignerSignClickEvent(){InstDesignElectSignUploadByIcon($("#designerGetSignByUpload")),$("#designerGetSignFromVisit").click(function(e){$("#popupboxSetSignature").modal({backdrop:"static",keyboard:!1}),$("#installerDesignerType").attr("instDesignerType",4),$("[name=getSign][value=1]").prop("checked",!0),e.preventDefault()}),$("#designerGetSignByDrawing").click(function(e){e.preventDefault(),$("#BasicDetails_DesignerID").val()>0&&(0==isDrawSignatureOn?(isDrawSignatureOn=1,$("#divDesignerSign").hide(),$("#divDesignerSignDraw").show(),$(".designerCSign").jSignature("clear")):alert("First save installer/electrician signature."))})}function RegisterInstallerSignClickEvent(){InstDesignElectSignUploadByIcon($("#installerGetSignByUpload")),$("#installerGetSignFromVisit").click(function(e){$("#popupboxSetSignature").modal({backdrop:"static",keyboard:!1}),$("#installerDesignerType").attr("instDesignerType",2),$("[name=getSign][value=1]").prop("checked",!0),e.preventDefault()}),$("#installerGetSignByDrawing").click(function(e){$("#BasicDetails_InstallerID").val()>0&&(0==isDrawSignatureOn?(isDrawSignatureOn=1,$("#divInstallerSign").hide(),$("#divInstallerSignDraw").show(),$(".installerCSign").jSignature("clear")):alert("First save designer/electrician signature.")),e.preventDefault()})}function InstDesignElectSignUploadByIcon(e){var s=e.attr("typeOfSignature");e.fileupload({url:UploadJobSignatureURL,dataType:"json",done:function(e,t){var l=[];l.length=0;for(var a=0;a<t.result.length;a++)if(1==t.result[a].Status){var i=ProjectSession_UploadedDocumentPath,n=i+"JobDocuments/"+Model_JobID+"/"+t.result[a].FileName;3==s?($("#imgElectricianSign").attr("src",n),$("#divElectricianSignDraw").hide()):4==s?($("#imgDesignerSign").attr("src",n),$("#divDesignerSignDraw").hide()):2==s?($("#imgInstallerSign").attr("src",n),$("#divInstallerSignDraw").hide()):1==s&&$("#imgOwnerSign").attr("src",n)}else l.push(t.result[a].FileName.replace("%","$"));l.length>0?1==s?showErrorMessageForPopup("File has not been uploaded.",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup("File has not been uploaded.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")):1==s?showSuccessMessageForPopup("File has been uploaded successfully.",$("#successMsgRegionOwnerInstallation"),$("#errorMsgRegionOwnerInstallation")):showSuccessMessageForPopup("File has been uploaded successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails"))},progressall:function(e,s){},singleFileUploads:!1,send:function(e,t){var l=t.files[0].type.split("/"),a=l[0];if(t.files.length>1)for(var i=0;i<t.files.length;i++){if(t.files[i].size>parseInt(ProjectSession_MaxImageSize))return 1==s?showErrorMessageForPopup(" "+t.files[i].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup(" "+t.files[i].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1;if(CheckSpecialCharInFileName(t.files[i].name))return 1==s?showErrorMessageForPopup(" Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup(" Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1}else{if(t.files[0].size>parseInt(ProjectSession_MaxImageSize))return 1==s?showErrorMessageForPopup("Maximum file size limit exceeded.Please upload a file smaller than "+maxsize+"MB",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup("Maximum file size limit exceeded.Please upload a file smaller than "+maxsize+"MB",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1;if(CheckSpecialCharInFileName(t.files[0].name))return 1==s?showErrorMessageForPopup(" Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup(" Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1}return"image"!=a?(1==s?showErrorMessageForPopup("Please upload a file with .jpg , .jpeg or .png extension.",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup("Please upload a file with .jpg , .jpeg or .png extension.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):t.files[0].size>parseInt(1024e3)?(1==s?showErrorMessageForPopup("Please upload Signature Within 1 MB otherwise it slow down your job performance",$("#errorMsgRegionOwnerInstallation"),$("#successMsgRegionOwnerInstallation")):showErrorMessageForPopup("Please upload Signature Within 1 MB otherwise it slow down your job performance",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),!1):($(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),!0)},formData:{jobId:BasicDetails_JobID,typeOfSignature:s}})}function UpdateJobSignature(e,s,t){$.ajax({url:UpdateJobSignatureURL,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:BasicDetails_JobID,signPath:e,typeOfSignature:s}),success:function(e){e.status?showSuccessMessageForPopup("Signature has been saved successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")):showErrorMessageForPopup(e.error,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),t&&$("#popupboxSetSignature").modal("toggle")},error:function(){showErrorMessageForPopup("Signature has not been saved.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function GetSignatureFromVisit(e,s){if(0==$("#jobVisitDetail").attr("visitCount"))return alert("Please add visit first."),!1;$.ajax({url:GetSignatureFromVisitURL,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:BasicDetails_JobID,typeOfSignature:e}),success:function(t){if(t.status){var l=ProjectSession_UploadedDocumentPath;t.signPath?(3==e?$("#imgElectricianSign").attr("src",l+t.signPath):2==e?$("#imgInstallerSign").attr("src",l+t.signPath):4==e?$("#imgDesignerSign").attr("src",l+t.signPath):1==e&&$("#imgOwnerSign").attr("src",l+t.signPath),showSuccessMessageForPopup("Signature has been saved successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails"))):alert("No signature found from default submission visit."),s&&$("#popupboxSetSignature").modal("toggle")}else showErrorMessageForPopup(t.error,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))},error:function(){showErrorMessageForPopup("Signature has not been saved.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function CDMouseOut(){cdIsmouseIn=!1}function SaveElectricianDrawSignature(e){var s;if(3==e&&(s=$(".eleCSign").jSignature("getData")),2==e&&(s=$(".installerCSign").jSignature("getData")),4==e&&(s=$(".designerCSign").jSignature("getData")),""==s||null==s||null==s||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAABQCAYAAAByKBsiAAAB3ElEQVR4Xu3TQQ0AAAgDMebfNC7uVQwsabidI0AgE1i2ZIgAgROcJyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQE5wcIhAKCC7FNERCcHyAQCgguxDZFQHB+gEAoILgQ2xQBwfkBAqGA4EJsUwQepAwAUbuAgcwAAAAASUVORK5CYII="==s)return alert("Please draw signature."),!1;$.ajax({url:DrawJobSignatureURL,contentType:"application/json",data:JSON.stringify({jobId:BasicDetails_JobID,StringOwnerBaseSignature:s,typeOfSignature:e}),method:"post",success:function(s){if(s.status){var t=ProjectSession_UploadedDocumentPath,l=t+s.signPath+"?"+(new Date).getTime();3==e&&($("#divElectricianSignDraw").hide(),$("#imgElectricianSign").attr("src",l),$("#divElectricianSign").show()),4==e&&($("#divDesignerSignDraw").hide(),$("#imgDesignerSign").removeAttr("src"),$("#imgDesignerSign").attr("src",l),$("#divDesignerSign").show()),2==e&&($("#divInstallerSignDraw").hide(),$("#divInstallerSign").show(),$("#imgInstallerSign").attr("src",l)),isDrawSignatureOn=0,showSuccessMessageForPopup("Signature has been saved successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails"))}else showErrorMessageForPopup(s.error,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))},error:function(){showErrorMessageForPopup("Signature has not been saved.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function deleteImageJob(){var e=Model_Guid,s=$("#imgSign").attr("class"),t=JobElectricians_Signature;confirm("Are you sure you want to delete this file ?")&&$.ajax({url:DeleteFileFromFolderAndElectricianURL,data:{fileName:s,FolderName:e,OldEleSign:t},contentType:"application/json",method:"get",success:function(){$("#imgSign").attr("class");return $("[name='Signature']").each(function(){$(this).remove()}),$("#imgSign").removeAttr("src"),$("#imgSign").removeAttr("class"),$("#popupbox").modal("hide"),$("#imgSignature").hide(),$(".alert").hide(),SRCSign="",!1}})}function MakeEnableDisableGetInstallerSignature(e){e>0?($("#installerGetSignByUpload").prop("disabled",!1),$("#installerGetSignByUpload").removeClass("disInstallerSignature"),$("#installerGetSignByUploadIcon").removeClass("disInstallerSignature"),$("#installerGetSignFromVisit").removeClass("disInstallerSignature"),$("#installerGetSignByDrawing").removeClass("disInstallerSignature"),$("#installerGetSignFromPopup").removeClass("disInstallerSignature")):($("#installerGetSignByUpload").prop("disabled",!0),$("#installerGetSignByUpload").addClass("disInstallerSignature"),$("#installerGetSignByUploadIcon").addClass("disInstallerSignature"),$("#installerGetSignFromVisit").addClass("disInstallerSignature"),$("#installerGetSignByDrawing").addClass("disInstallerSignature"),$("#installerGetSignFromPopup").addClass("disInstallerSignature"))}function MakeEnableDisableGetDesignerSignature(e){e>0?($("#designerGetSignByUpload").prop("disabled",!1),$("#designerGetSignByUpload").removeClass("disDesignerSignature"),$("#designerGetSignByUploadIcon").removeClass("disInstallerSignature"),$("#designerGetSignFromVisit").removeClass("disDesignerSignature"),$("#designerGetSignByDrawing").removeClass("disDesignerSignature"),$("#designerGetSignFromPopup").removeClass("disDesignerSignature")):($("#designerGetSignByUpload").prop("disabled",!0),$("#designerGetSignByUpload").addClass("disDesignerSignature"),$("#designerGetSignByUploadIcon").addClass("disInstallerSignature"),$("#designerGetSignFromVisit").addClass("disDesignerSignature"),$("#designerGetSignByDrawing").addClass("disDesignerSignature"),$("#designerGetSignFromPopup").addClass("disDesignerSignature"))}function MakeEnableDisableGetElectricianSignature(e){e>0?($("#eleGetSignByUpload").prop("disabled",!1),$("#eleGetSignByUpload").removeClass("disElectricianSignature"),$("#eleGetSignByUploadIcon").removeClass("disInstallerSignature"),$("#eleGetSignFromVisit").removeClass("disElectricianSignature"),$("#eleGetSignByDrawing").removeClass("disElectricianSignature"),$("#eleGetSignFromPopup").removeClass("disElectricianSignature")):($("#eleGetSignByUpload").prop("disabled",!0),$("#eleGetSignByUpload").addClass("disElectricianSignature"),$("#eleGetSignByUploadIcon").addClass("disInstallerSignature"),$("#eleGetSignFromVisit").addClass("disElectricianSignature"),$("#eleGetSignByDrawing").addClass("disElectricianSignature"),$("#eleGetSignFromPopup").addClass("disElectricianSignature"))}function FillInstallerDesigner(e,s){$.ajax({url:FillInstallerDesignerURL,type:"GET",data:{InstallerDesignerId:e,jobId:$("#BasicDetails_JobID").val()},dataType:"json",contentType:"application/json; charset=utf-8",async:!1,success:function(e){if(e&&e.InstallerDesignerId){if(null!=e.SESignature&&""!=e.SESignature){var t=e.SESignature,l=ProjectSession_LoggedInUserId,a=ProjectSession_UploadedDocumentPath,i=a+"UserDocuments/"+l;SRCSignInstallerDesigner=i+"/"+t,$("#imgSignInstallerDesigner").attr("class",t),$("#imgSignatureInstallerDesigner").show()}else $("#imgSignatureInstallerDesigner").hide();$("#IsInstaller").val(s),$("#InstallerDesignerView_InstallerDesignerId").val(e.InstallerDesignerId),s?$("#hdBasicDetails_InstallerID").val(e.InstallerDesignerId):$("#hdBasicDetails_DesignerID").val(e.InstallerDesignerId),$("#FindInstaller_CECAccreditationNumber").val(e.CECAccreditationNumber),$("#FindInstaller_FirstName").val(e.FirstName),$("#FindInstaller_LastName").val(e.LastName),$("#InstallerDesignerView_FirstName").val(e.FirstName),$("#InstallerDesignerView_LastName").val(e.LastName),$("#frmInstallerDesigner").find("[name='SEDesignRoleId']").filter("[value="+e.SERole+"]").prop("checked",!0),$("#InstallerDesignerView_CECAccreditationNumber").val(e.CECAccreditationNumber),$("#InstallerDesignerView_CECAccreditationNumber").attr("readonly","readonly"),$("#InstallerDesignerView_CECAccreditationNumber").attr("onblur",""),$("#InstallerDesignerView_Email").val(e.Email),$("#InstallerDesignerView_Phone").val(e.Phone),$("#InstallerDesignerView_Mobile").val(e.Mobile),$("#InstallerDesignerView_ElectricalContractorsLicenseNumber").val(e.ElectricalContractorsLicenseNumber),$("#InstallerDesignerView_IsVisitScheduled").val(e.IsVisitScheduled),1==e.IsPostalAddress?($("#InstallerDesignerView_AddressID").val(2),HideShowAddressFieldOverAddressType(2,"PDA","DPA")):($("#InstallerDesignerView_AddressID").val(1),HideShowAddressFieldOverAddressType(1,"PDA","DPA"),setTimeout(function(){ChangeUnitTypeId("InstallerDesignerView")},100)),$("#InstallerDesignerView_UnitTypeID").val(0==e.UnitTypeID?"":e.UnitTypeID),$("#InstallerDesignerView_UnitNumber").val(e.UnitNumber),$("#InstallerDesignerView_StreetNumber").val(e.StreetNumber),$("#InstallerDesignerView_StreetName").val(e.StreetName),$("#InstallerDesignerView_StreetTypeID").val(e.StreetTypeID),$("#InstallerDesignerView_Town").val(e.Town),$("#InstallerDesignerView_State").val(e.State),$("#InstallerDesignerView_PostCode").val(e.PostCode),$("#InstallerDesignerView_PostalAddressID").val(e.PostalAddressID),$("#InstallerDesignerView_PostalDeliveryNumber").val(e.PostalDeliveryNumber)}else message="Installer/Designer has not been opened.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))},error:function(){message="Installer/Designer has not been opened.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function checkExistInstallerDesigner(e,s,t){var l=e.id,a="",i=e.value,n=0;n=companyId,""!=i&&null!=i&&$.ajax({url:CheckUserExistURL,data:{UserValue:i,FieldName:l,userId:null,resellerID:null,solarCompanyId:parseInt(n)},contentType:"application/json",method:"get",success:function(e){var s;0==e.status?(s=e.message,a=!1,showErrorMessageForPopup(s,$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup"))):a=!0;if($("#imgSignatureInstallerDesigner").hide(),$("[name='InstallerDesignerView_SESignature']").val(""),0==a)return $("#InstallerDesignerView_InstallerDesignerId").val(0),$("#FindInstaller_FirstName").val(""),$("#FindInstaller_LastName").val(""),$("#frmInstallerDesigner").find("[name='InstallerDesignerView_SEDesignRoleId']").filter("[value=2]").prop("checked",!0),$("#InstallerDesignerView_FirstName").val(""),$("#InstallerDesignerView_LastName").val(""),$("#InstallerDesignerView_Email").val(""),$("#InstallerDesignerView_Phone").val(""),$("#InstallerDesignerView_Mobile").val(""),$("#InstallerDesignerView_ElectricalContractorsLicenseNumber").val(""),$("#frmInstallerDesigner").find("[name='SEDesignRoleId']").filter("[value=2]").prop("checked",!0),$("#InstallerDesignerView_AddressID").val(1),$("#InstallerDesignerView_UnitTypeID").val(""),$("#InstallerDesignerView_UnitNumber").val(""),$("#InstallerDesignerView_StreetNumber").val(""),$("#InstallerDesignerView_StreetName").val(""),$("#InstallerDesignerView_StreetTypeID").val(""),$("#InstallerDesignerView_Town").val(""),$("#InstallerDesignerView_State").val(""),$("#InstallerDesignerView_PostCode").val(""),!1;$("#errorMsgRegionInstallerDesignerPopup").hide();var t=JSON.parse(e.accreditedData);return $("#InstallerDesignerView_InstallerDesignerId").val(0),$("#InstallerDesignerView_CECAccreditationNumber").val(t.AccreditationNumber),$("#FindInstaller_CECAccreditationNumber").val(t.AccreditationNumber),$("#FindInstaller_FirstName").val(t.FirstName),$("#FindInstaller_LastName").val(t.LastName),$("#frmInstallerDesigner").find("[name='InstallerDesignerView_SEDesignRoleId']").filter("[value="+t.RoleId+"]").prop("checked",!0),$("#InstallerDesignerView_FirstName").val(t.FirstName),$("#InstallerDesignerView_LastName").val(t.LastName),$("#InstallerDesignerView_Email").val(t.Email),
$("#InstallerDesignerView_Phone").val(t.Inst_Phone),$("#InstallerDesignerView_Mobile").val(t.Inst_Mobile),$("#InstallerDesignerView_ElectricalContractorsLicenseNumber").val(t.LicensedElectricianNumber),$("#frmInstallerDesigner").find("[name='SEDesignRoleId']").filter("[value="+t.RoleId+"]").prop("checked",!0),$("#InstallerDesignerView_AddressID").val(1),parseInt(t.Inst_UnitTypeID)>0?$("#InstallerDesignerView_UnitTypeID").val(t.Inst_UnitTypeID):$("#InstallerDesignerView_UnitTypeID").val(0),$("#InstallerDesignerView_UnitNumber").val(t.MailingAddressUnitNumber),$("#InstallerDesignerView_StreetNumber").val(t.MailingAddressStreetNumber),$("#InstallerDesignerView_StreetName").val(t.MailingAddressStreetName),parseInt(t.StreetTypeID)>0?$("#InstallerDesignerView_StreetTypeID").val(t.StreetTypeID):$("#InstallerDesignerView_StreetTypeID").val(0),$("#InstallerDesignerView_Town").val(t.MailingCity),$("#InstallerDesignerView_State").val(t.Abbreviation),$("#InstallerDesignerView_PostCode").val(t.PostalCode),$("#InstallerDesignerView_PostalAddressID").val(0),!1}})}function SaveInstallerDesigner(){var e=addressValidationRules("InstallerDesignerView");if(e&&(IsFromFindInstaller||$("#frmInstallerDesigner").valid())){$("[name='InstallerDesignerView_SESignature']").val();var s=JSON.stringify($("#frmInstallerDesigner").serializeToJson()),t=JSON.parse(s),l={};if(l=t,!$("#InstallerDesignerView_SEDesignRoleId").is(":visible")){if("true"==$("#IsInstaller").val()&&2==t.SEDesignRoleId)return alert("Please choose installer or designer/installer role."),!1;if("false"==$("#IsInstaller").val()&&1==t.SEDesignRoleId)return alert("Please choose designer or designer/installer role."),!1}l.SESignature=$("#imgSignInstallerDesigner").attr("class"),l.SEDesignRoleId=$("#InstallerDesignerView_SEDesignRoleId").is(":visible")?$("input[name='InstallerDesignerView_SEDesignRoleId']:checked").val():t.SEDesignRoleId,l.SolarCompanyId=companyId,l.CreatedBy=ProjectSession_LoggedInUserId;var a={};a.installerDesignerView=l,$("#InstallerDesignerView_SEDesignRoleId").is(":visible")||$("#SEDesignRoleId").is(":visible")||("true"==$("#IsInstaller").val()?a.profileType=2:a.profileType=4),$("#SEDesignRoleId").is(":visible")&&(1==a.installerDesignerView.SEDesignRoleId?a.profileType=2:2==a.installerDesignerView.SEDesignRoleId?a.profileType=4:3==a.installerDesignerView.SEDesignRoleId&&(a.profileType=5)),a.signPath=SRCSignInstallerDesigner,$.ajax({url:AddInstallerDesignerURL,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(a),async:!1,success:function(e){if(e.status){if(showSuccessMessageForPopup(e.message,$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),isSCADashboard)GetInstallers();else{var s=""==$("#IsInstaller").val()?e.InstallerDesignerId:"true"==$("#IsInstaller").val()?$("#hdBasicDetails_DesignerID").val():$("#hdBasicDetails_InstallerID").val();FillInstallerDesignerElectrician(GetInstallerDesignerWithStatus+"?isInstaller=true&existUserId="+s+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&jobId="+BasicDetails_JobID,$("#hdBasicDetails_InstallerID").val(),$("#txtBasicDetails_InstallerID"),$("#hdBasicDetails_InstallerID"),$("#hdBasicDetails_DesignerID").val(),$("#txtBasicDetails_DesignerID"),$("#hdBasicDetails_DesignerID"),$("#hdBasicDetails_ElectricianID").val(),$("#txtBasicDetails_ElectricianID"),$("#hdBasicDetails_ElectricianID")),"true"==$("#IsInstaller").val()&&(MakeEnableDisableGetInstallerSignature(e.InstallerDesignerId),$("#SEDesignRoleId").is(":visible")&&($("#InstallerView_Mobile").val($("#InstallerDesignerView_Mobile").val()),$("#InstallerView_FirstName").val($("#InstallerDesignerView_FirstName").val()),$("#InstallerView_LastName").val($("#InstallerDesignerView_LastName").val()))),"false"==$("#IsInstaller").val()&&(MakeEnableDisableGetDesignerSignature(e.InstallerDesignerId),$("#SEDesignRoleId").is(":visible")&&($("#DesignerView_Mobile").val($("#InstallerDesignerView_Mobile").val()),$("#DesignerView_FirstName").val($("#InstallerDesignerView_FirstName").val()),$("#DesignerView_LastName").val($("#InstallerDesignerView_LastName").val())))}$("#popupInstallerDesigner").modal("hide")}else $(".FindInstaller").hide(),$(".AddEditInstaller").show(),showErrorMessageForPopup(e.message,$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerPopup"))},error:function(){showErrorMessageForPopup("Installer/Designer has not been added.",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerPopup"))}})}else $(".FindInstaller").hide(),$(".AddEditInstaller").show(),$("#loading-image").hide()}function ResetInstallerDesigner(){$("#frmInstallerDesigner").find("[idClass='installerDesignerRequired']").each(function(){$(this).removeClass("input-validation-error"),$(this).next().find("span").length>0&&$(this).next().find("span").remove()}),$("#imgSignatureInstallerDesigner").hide(),$("#InstallerDesignerView_Phone").val(""),$("#InstallerDesignerView_Mobile").val(""),$("#IsInstaller").val()?($("#frmInstallerDesigner").find("[name='SEDesignRoleId']").filter("[value=1]").prop("checked",!0),SRCSignInstallerDesignererDesigner=""):($("#frmInstallerDesigner").find("[name='SEDesignRoleId']").filter("[value=2]").prop("checked",!0),SRCSignInstallerDesignererDesigner=""),$("#InstallerDesignerView_AddressID").val(1),$("#InstallerDesignerView_UnitTypeID").val(""),$("#InstallerDesignerView_UnitNumber").val(""),$("#InstallerDesignerView_StreetNumber").val(""),$("#InstallerDesignerView_StreetName").val(""),$("#InstallerDesignerView_StreetTypeID").val(""),$("#InstallerDesignerView_Town").val(""),$("#InstallerDesignerView_State").val(""),$("#InstallerDesignerView_PostCode").val(""),$("[name='InstallerDesignerView_SESignature']").val(""),$("#InstallerDesignerView_LocationValidation").hide(),HideShowAddressFieldOverAddressType($("#InstallerDesignerView_AddressID").val(),"PDA","DPA"),$("#imgSignDesigner").removeAttr("class")}function TownPostcodeAutoComplete(e,s,t){e.autocomplete({minLength:3,source:function(e,s){$.ajax({type:"GET",url:ProcessRequest_User,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var t=JSON.parse(e);console.log(t),t.localities.locality instanceof Array?s($.map(t.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}})):s($.map(t.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.location,state:e.state,postcode:e.postcode}}))}})},select:function(e,l){s.val(l.item.state),t.val(l.item.postcode)}}),t.autocomplete({minLength:3,source:function(e,s){$.ajax({type:"GET",url:ProcessRequest_User,dataType:"json",data:{excludePostBoxFlag:!0,q:e.term},success:function(e){var t=JSON.parse(e);t.localities.locality instanceof Array?s($.map(t.localities.locality,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}})):s($.map(t.localities,function(e){return{label:e.location+", "+e.state+", "+e.postcode,value:e.postcode,state:e.state,location:e.location}}))}})},select:function(t,l){s.val(l.item.state),e.val(l.item.location)}})}function InstallerDesignerSignatureUpload(){var e=ProjectSession_UploadedDocumentPath;if(""==$("#IsInstaller").val()&&(null!=BasicDetails_InstallerSignature&&""!=BasicDetails_InstallerSignature&&null!=BasicDetails_InstallerSignature&&$("#imgInstallerSign").attr("src",e+BasicDetails_InstallerSignature_Replace+"?"+(new Date).getTime()),null!=BasicDetails_DesignerSignature&&""!=BasicDetails_DesignerSignature&&null!=BasicDetails_DesignerSignature&&$("#imgDesignerSign").attr("src",e+BasicDetails_DesignerSignature_Replace+"?"+(new Date).getTime())),"true"==$("#IsInstaller").val()){if(""!=$("#imgSignInstallerDesigner").attr("src")&&""!=InstallerView_SESignature){var s=$("#imgSignInstallerDesigner").attr("src"),t=ProjectSession_LoggedInUserId,l=e+"UserDocuments/"+t,a=l+"/"+s;SRCSignInstallerDesigner=a,$("#imgSignInstallerDesigner").attr("class",s),$("#imgSignatureInstallerDesigner").show()}null!=BasicDetails_InstallerSignature&&""!=BasicDetails_InstallerSignature&&null!=BasicDetails_InstallerSignature?$("#imgInstallerSign").attr("src",e+BasicDetails_InstallerSignature_Replace+"?"+(new Date).getTime()):$("#imgInstallerSign").attr("src",SRCSignInstallerDesigner)}if("false"==$("#IsInstaller").val()){if(""!=$("#imgSignInstallerDesigner").attr("src")&&""!=DesignerView_SESignature){s=$("#imgSignInstallerDesigner").attr("src"),t=ProjectSession_LoggedInUserId,l=e+"UserDocuments/"+t,a=l+"/"+s;SRCSignInstallerDesigner=a,$("#imgSignInstallerDesigner").attr("class",s),$("#imgSignatureInstallerDesigner").show()}null!=BasicDetails_DesignerSignature&&""!=BasicDetails_DesignerSignature&&null!=BasicDetails_DesignerSignature?$("#imgDesignerSign").attr("src",e+BasicDetails_DesignerSignature_Replace+"?"+(new Date).getTime()):$("#imgDesignerSign").attr("src",SRCSignInstallerDesigner)}$("#imgSignatureInstallerDesigner").click(function(){$("#loading-image").css("display",""),$("#imgSignInstallerDesigner").attr("src",SRCSignInstallerDesigner).load(function(){logoWidthSignInstall=this.width,logoHeightSignInstall=this.height,$("#popupboxInsallerDesigner").modal({backdrop:"static",keyboard:!1}),$(window).height()<=logoHeightSignInstall?($("#imgSignInstallerDesigner").closest("div").height($(window).height()-205),$("#imgSignInstallerDesigner").closest("div").css("overflow-y","scroll"),$("#imgSignInstallerDesigner").height(logoHeightSignInstall)):($("#imgSignInstallerDesigner").height(logoHeightSignInstall),$("#imgSignInstallerDesigner").closest("div").removeAttr("style")),screen.width<=logoWidthSignInstall||logoWidthSignInstall>=screen.width-250?($("#popupboxInsallerDesigner").find(".modal-dialog").width(screen.width-250),$("#imgSignInstallerDesigner").width(logoWidthSignInstall)):($("#imgSignInstallerDesigner").width(logoWidthSignInstall),$("#popupboxInsallerDesigner").find(".modal-dialog").width(logoWidthSignInstall)),$("#loading-image").css("display","none")}),$("#popupboxInsallerDesigner").unbind("error"),$("#imgSignInstallerDesigner").attr("src",SRCSignInstallerDesigner).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")})}),$("#uploadBtnSignatureInstallerDesigner").fileupload({url:Upload_User,dataType:"json",done:function(e,s){var t=[];t.length=0;var l=[];l.length=0;for(var a=0;a<s.result.length;a++)if(1==s.result[a].Status){var i=ProjectSession_LoggedInUserId,n=$("#imgSignInstallerDesigner").attr("class");$("[name='InstallerDesignerView_SESignature']").each(function(){$(this).remove()}),null!=n&&""!=n&&DeleteFileFromLogoOnUpload(n,i,InstallerView_SESignature,ProjectImagePath);var r=UploadedDocumentPath,o=r+"UserDocuments/"+i;SRCSignInstallerDesigner=o+"/"+s.result[a].FileName,$("#imgSignInstallerDesigner").attr("src",SRCSignInstallerDesigner),$("#imgSignInstallerDesigner").attr("class",s.result[a].FileName),$("#imgSignatureInstallerDesigner").show(),$('<input type="hidden">').attr({name:"InstallerDesignerView_SESignature",value:s.result[a].FileName,id:s.result[a].FileName}).appendTo("form")}else 0==s.result[a].Status&&"BigName"==s.result[a].Message?l.push(s.result[a].FileName):t.push(s.result[a].FileName);t.length>0&&showErrorMessageForPopup(t.length+" File has not been uploaded.",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),l.length>0&&showErrorMessageForPopup(l.length+" Uploaded filename is too big.",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),0==l.length&&0==t.length&&showSuccessMessageForPopup("File has been uploaded successfully.",$("#successMsgRegionInstallerDesignerPopup"),$("#errorMsgRegionInstallerDesignerPopup"))},progressall:function(e,s){},singleFileUploads:!1,send:function(e,s){var t=s.files[0].type.split("/"),l=t[0];if(1==s.files.length)for(var a=0;a<s.files.length;a++){if(s.files[a].name.length>50)return showErrorMessageForPopup("Please upload small filename.",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1;if(CheckSpecialCharInFileName(s.files[a].name))return showErrorMessageForPopup("Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1}if(s.files.length>1)for(a=0;a<s.files.length;a++){if(s.files[a].size>parseInt(MaxLogoSize))return showErrorMessageForPopup(" "+s.files[a].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxLogoSize+"MB",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),!1;if(CheckSpecialCharInFileName(s.files[a].name))return showErrorMessageForPopup("Please upload file that not conatain <> ^ [] .",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),!1}else if(s.files[0].size>parseInt(MaxLogoSize))return showErrorMessageForPopup("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxLogoSize+"MB",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),!1;return"image"!=l?(showErrorMessageForPopup("Please upload a file with .jpg , .jpeg or .png extension.",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup")),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):($(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:ProjectSession_LoggedInUserId,id:ProjectSession_LoggedInUserId}).appendTo("form"),!0)},formData:{userId:ProjectSession_LoggedInUserId},change:function(e,s){$("#uploadFile").val("C:\\fakepath\\"+s.files[0].name)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}function deleteSignature(e){var s="",t="";2==BasicDetails_JobType?(t=JobInstallerDetailsSWH_SESignature,s=SRCSignSWHInstall):(s=SRCSignInstallerDesigner,t="true"==e.toLowerCase()?InstallerView_SESignature:DesignerView_SESignature),confirm("Are you sure you want to delete this signature ?")&&$.ajax({url:DeleteInstallerDesignerSignature,data:{filePath:s,OldLogo:t},contentType:"application/json",method:"get",success:function(e){return e&&(2==BasicDetails_JobType?($("#imgSignSWHInstall").removeAttr("src"),$("#imgSignSWHInstall").removeAttr("class"),$("#popupboxSWHInsaller").modal("hide"),$("#imgSWHSignatureInstaller").hide(),SRCSignSWHInstall=""):($("#imgSignInstallerDesigner").removeAttr("src"),$("#imgSignInstallerDesigner").removeAttr("class"),$("#popupboxInsallerDesigner").modal("hide"),$("#imgSignatureInstallerDesigner").hide(),SRCSignInstallerDesigner="")),!1},error:function(){showErrorMessageForPopup("Signature has not been deleted",$("#errorMsgRegionInstallerDesignerPopup"),$("#successMsgRegionInstallerDesignerPopup"))}})}function RemoveInstallerDesignerValidationMsgAndBorder(){$("#frmInstallerDesigner").find("[idClass='installerDesignerRequired']").each(function(){$(this).removeClass("input-validation-error"),$(this).next().find("span").length>0&&$(this).next().find("span").remove()})}function FillInstallerDesignerElectrician(e,s,t,l,a,i,n,r,o,c){installerList=[],designerList=[],electricianList=[],t.val(""),i.val(""),o.val(""),$.ajax({url:e,contentType:"application/json",dataType:"json",method:"get",cache:!1,success:function(e){DesignerList=[],InstallerList=[],electricianList=[],$.each(e.installerList,function(e,s){InstallerList.push({value:s.Value,text:s.Text,issystemuser:s.IsSystemUser,userid:s.UserId})}),$.each(e.designerList,function(e,s){DesignerList.push({value:s.Value,text:s.Text,issystemuser:s.IsSystemUser,userid:s.UserId})}),$.each(e.electricianList,function(e,s){electricianList.push({value:s.Value,text:s.Text,issystemuser:s.IsSystemUser,iscustomelectrician:s.IsCustomElectrician})}),installerList=InstallerList,designerList=DesignerList,""!=s?(l.val(s),$.each(InstallerList,function(e,l){l.value==s&&t.val(l.text)})):(l.val(""),t.val("")),""!=a?(n.val(a),$.each(DesignerList,function(e,s){s.value==a&&i.val(s.text)})):(n.val(""),i.val("")),""!=r?(c.val(r),$.each(electricianList,function(e,s){s.value==r&&(o.val(s.text),o.attr("isCustomElectrician",s.iscustomelectrician),o.attr("isSystemUser",s.issystemuser))})):(c.val(""),o.val(""))}})}function InstallerDesignerAutocomplete(e,s,t){e.autocomplete({minLength:0,source:function(l,a){var i=[],n=[];n=t?installerList:designerList,s.val(0),$.each(n,function(s,t){t.text.toLowerCase().indexOf(e.val().toLowerCase())>-1&&i.push({Title:t.text,id:t.value,issystemuser:t.issystemuser,userid:t.userid})}),a($.map(i,function(e){return{label:e.Title,value:e.Title,id:e.id,issystemuser:e.issystemuser,userid:e.userid}}))},select:function(l,a){s.val(a.item.id),e.val(a.item.value),e.attr("isSystemUser",a.item.issystemuser),e.attr("userId",a.item.userid),InstallerDesignerOnChange(e,s,t,a.item.issystemuser,a.item.userid)}}).bind("focus",function(){$(this).val().trim()||$(this).keydown()}),e.autocomplete("instance")._renderItem=function(e,s){var t=new RegExp($.trim(this.term.toLowerCase())),l=s.label.replace(t,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>"),a="";a=s.label.indexOf("(Current)")>=0?s.issystemuser?"green":"grey":s.label.indexOf("(")>=0&&s.label.indexOf("(Current)")<0?"red":"";var i="<a style=color:"+a+">"+l+"</a>";return $("<li style='font-size:14px;'></li>").data("item.autocomplete",s).append(i).appendTo(e)}}function InstallerDesignerOnChange(e,s,t,l,a){$.ajax({url:urlUpdateJobDetailInstallerDesigner,contentType:"application/json",dataType:"json",method:"get",cache:!1,async:!1,data:{installerDesignerId:s.val(),jobId:BasicDetails_JobID,profileType:t?2:4,IsSWHUser:!1,userId:a},success:function(a){if($("#successMsgRegionInstallerDetails").hide(),$("#errorMsgRegionInstallerDetails").hide(),a.status){if(l){if(t){2!=a.SEStatus&&alert("Installer has been added successfully but not a part of solar company, so visits can't be scheduled.");var i=$(".visit-id:visible").length;0!=i||2!=a.SEStatus||8==ProjectSession_UserTypeId&&"true"!=isScheduleAnInstaller.toLowerCase()?ShowHideVisitScheduledIcon(!0,2==a.SEStatus,a.SEStatus):addQuickVisit(s.val(),e.val(),a.SEStatus,"Installer has been added successfully.Do you want to schedule visit?")}ShowHideSystemUserIcon(!!t,!0)}else t?(ShowHideSystemUserIcon(!0,!1),ShowHideVisitScheduledIcon(!1,!1,1)):ShowHideSystemUserIcon(!1,!1);InstallerView_SEStatus=a.SEStatus,0==s.val()?(t?(ShowHideSystemUserIcon(!0,!1),ShowHideVisitScheduledIcon(!1,!1,1)):ShowHideSystemUserIcon(!1,!1),showErrorMessageForPopup("Installer/Designer has been removed.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))):showSuccessMessageForPopup("Installer/Designer has been added successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),t?($("#InstallerView_FirstName").val(a.FirstName),$("#InstallerView_LastName").val(a.LastName),$("#InstallerView_Email").val(a.Email),$("#InstallerView_Mobile").val(a.Mobile),MakeEnableDisableGetInstallerSignature(s.val()),ShowHideEditIcon(s.attr("name"),s.val())):($("#DesignerView_FirstName").val(a.FirstName),$("#DesignerView_LastName").val(a.LastName),$("#DesignerView_Email").val(a.Email),$("#DesignerView_Mobile").val(a.Mobile),MakeEnableDisableGetDesignerSignature(s.val()),ShowHideEditIcon(s.attr("name"),s.val()))}1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId||LoadCommonJobsWithSameInstallDateAndInstaller(),ReloadSTCJobScreen(BasicDetails_JobID),SearchHistory(),getJobRetailerSettingDataForJobScreen(BasicDetails_JobID)},error:function(){showErrorMessageForPopup("Installer/Designer has not been added.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function addQuickVisit(e,s,t,l,a=!1){var i;i=""==l||void 0===l?"Are you sure you want to schedule visit":l,2!=t?alert("Selected installer is a Greenbot user but not a part of solar company, so visits can't be scheduled."):a||confirm(i)?($("#loading-image").show(),setTimeout(function(){visitCheckListItemIds=[],TempCheckListTemplateItemAdd(defaultTemplateId,!0,$("#BasicDetails_JobID").val());var l={JobSchedulingID:0};l.Label=$("#BasicDetails_Title").val(),l.Detail=$("#BasicDetails_Description").val();var i=BasicDetails_InstallationDate.toString().split(" ")[0],n=ConvertDateToTick(i,getDateFormat);l.strVisitStartDate=moment(n).format("YYYY-MM-DD"),l.strVisitStartTime=BasicDetails_InstallationDate.toString().split(" ")[1],l.JobID=$("#BasicDetails_JobID").val(),l.UserId=e,l.Status=0,l.isNotification=a,l.isDrop=!1,l.userName=s.split("(")[0];var r=$("#JobTitle").val();""!=r&&null!=r&&null!=r||(r=$("#JobID option:selected").text()),l.JobTitle=r,l.TemplateId=defaultTemplateId,l.IsFromCalendarView=$("#IsFromCalendarView").val(),l.SolarCompanyId=companyId,l.VisitCheckListItemIds=visitCheckListItemIds.toString(),l.TempJobSchedulingId=$("#TempJobSchedulingId").val(),l.IsClassic=$("#BasicDetails_IsClassic").val();var o={};o.jobSchedulingPopup=l,o.isQuickAddvisit=!0,$.ajax({url:url_JobSchedulingDetail,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(o),async:!1,success:function(e){if(e){var s=e.split("^")[0],l=e.replace(s+"^","");ret=ResponseSaveScheduleOnDropAndInsertEdit(e,s,l,!1,!0),ShowHideVisitScheduledIcon(!0,s>0,t)}},error:function(){message="Job Schedule has not been saved.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})},500)):ShowHideVisitScheduledIcon(!0,!1,t)}function FillDropDownElectrician(e,s,t,l){electricianList=[],t.val(""),$.ajax({url:e,contentType:"application/json",dataType:"json",method:"get",cache:!1,async:!1,success:function(e){electricianList=[],$.each(e,function(e,s){electricianList.push({value:s.Value,text:s.Text,issystemuser:s.IsSystemUser,iscustomelectrician:s.IsCustomElectrician})}),""!=s?(l.val(s),$.each(electricianList,function(e,l){l.value==s&&(t.val(l.text),t.attr("isCustomElectrician",l.iscustomelectrician),t.attr("isSystemUser",l.issystemuser))})):(l.val(""),t.val(""))}})}function ElectricianAutocomplete(e,s){e.autocomplete({minLength:0,source:function(t,l){var a=[];List=electricianList,s.val(0),$.each(List,function(s,t){t.text.toLowerCase().indexOf(e.val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value,issystemuser:t.issystemuser,iscustomelectrician:t.iscustomelectrician})}),l($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id,issystemuser:e.issystemuser,iscustomelectrician:e.iscustomelectrician}}))},select:function(t,l){return"deleteCustomElectrician"!=$(t.toElement).attr("id")&&(s.val(l.item.id),e.val(l.item.value),e.attr("isSystemUser",l.item.issystemuser),e.attr("isCustomElectrician",l.item.iscustomelectrician),ElectricianOnChange(s.val(),e.attr("isCustomElectrician")),!1)}}).bind("focus",function(){$(this).val().trim()||$(this).keydown()}),e.autocomplete("instance")._renderItem=function(e,s){var t,l=new RegExp($.trim(this.term.toLowerCase())),a="";a=s.label.indexOf("(Current)")>=0?s.issystemuser?"green":"grey":s.label.indexOf("(")>=0&&s.label.indexOf("(Current)")<0?"red":"#35B0D1",t=s.iscustomelectrician?s.label.replace(l,"<input type='button' id='deleteCustomElectrician' class='icon-link delete sprite-img' onclick=deleteCustomElectrician("+s.id+",$('#BasicDetails_JobID').val()) style = 'margin-left: 180px; margin-bottom: -30px;border: none;'></input><span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>"):s.label.replace(l,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>");var i="<a style='color:"+a+"'lisolarElectricianId='"+s.id+"'>"+t+"</a>";return $("<li class='electrician-delete'></li>").data("item.autocomplete",s).append(i).appendTo(e)}}function FillElectrician(e,s){var t="true"==s.toLowerCase()?GetElectricianDetailbySolarcompanyURL:GetElectricianDetailbyInstallerURL;$.ajax({url:t,data:{Id:e},contentType:"application/json",method:"get",async:!1,success:function(e){if(e){var t=JSON.parse(e);if(null!=t[0].Signature&&""!=t[0].Signature){var l="0",a="",i=t[0].Signature,n=ProjectSession_UploadedDocumentPath;"false"==s.toLowerCase()?(l=t[0].UserID,a=n+"UserDocuments/"+l):(l=t[0].JobElectricianID,a=n+"JobDocuments/"+l);var r=a+"/"+i;i=$("#imgSign").attr("src");SRCSign=r,$("#imgSign").attr("class",i),$("#imgSignature").show(),"false"==s.toLowerCase()&&($("input[type='hidden'][name='Signature']").val(t[0].Signature),$('<input type="hidden">').attr({name:"ProfileSignature",value:t[0].Signature,id:t[0].Signature}).appendTo("form"),$('<input type="hidden">').attr({name:"ProfileSignatureID",value:t[0].UserID,id:t[0].UserID}).appendTo("form"))}else $("#imgSign").attr("class",""),$("#imgSign").removeAttr("src"),$("#imgSignature").hide();"true"==s.toLowerCase()?($("#JobElectricians_ElectricianID").val(t[0].JobElectricianID),$("#JobElectricians_InstallerID").val(0)):($("#JobElectricians_InstallerID").val(t[0].InstallerID),$("#JobElectricians_ElectricianID").val(0)),$("#JobElectricians_LicenseNumber").val(t[0].ElectricalContractorsLicenseNumber),$("#JobElectricians_CompanyName").val(t[0].CompanyName),$("#JobElectricians_FirstName").val(t[0].FirstName),$("#JobElectricians_LastName").val(t[0].LastName),$("#JobElectricians_Email").val(t[0].Email),$("#JobElectricians_Phone").val(t[0].Phone),$("#JobElectricians_Mobile").val(t[0].Mobile),1==t[0].IsPostalAddress?HideShowAddressFieldOverAddressType(2,"PDA","DPA"):(HideShowAddressFieldOverAddressType(1,"PDA","DPA"),ChangeUnitTypeId("JobElectricians")),$("#JobElectricians_UnitNumber").val(t[0].UnitNumber),$("#JobElectricians_UnitTypeID").val(0==t[0].UnitTypeID?"":t[0].UnitTypeID),$("#JobElectricians_StreetNumber").val(t[0].StreetNumber),$("#JobElectricians_StreetName").val(t[0].StreetName),$("#JobElectricians_StreetTypeID").val(t[0].StreetTypeID),$("#JobElectricians_Town").val(t[0].Town),$("#JobElectricians_State").val(t[0].State),$("#JobElectricians_PostCode").val(t[0].PostCode),$("#JobElectricians_PostalDeliveryNumber").val(t[0].PostalDeliveryNumber),$("#JobElectricians_PostalAddressID").val(t[0].PostalAddressID)}else message="Electrician has not been opened.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function SaveElectrician(e,s){var t=addressValidationRules("JobElectricians");if(t&&$("#frmJobElectricians").valid()){var l=JSON.stringify($("#frmJobElectricians").serializeToJson()),a=JSON.parse(l),i={};i.jobElectricians=a.JobElectricians,1==e&&(i.jobElectricians.InstallerID=0,i.jobElectricians.ElectricianID=0),1==$("#JobElectricians_AddressID").val()?i.jobElectricians.IsPostalAddress=0:i.jobElectricians.IsPostalAddress=1,i.jobElectricians.SolarCompanyId=companyId;var n={};n.jobId=BasicDetails_JobID,n.profileType=3,n.jobElectricians=a.JobElectricians,n.isCreateNew=s,$.ajax({url:urlJobElectricians,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",async:!1,data:JSON.stringify(n),success:function(e){e.status?(FillDropDownElectrician(urlGetElectricianListForJob+"?&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&jobId="+BasicDetails_JobID,$("#hdBasicDetails_ElectricianID").val(),$("#txtBasicDetails_ElectricianID"),$("#hdBasicDetails_ElectricianID")),$("#popupElectrician").modal("hide"),showSuccessMessageForPopup("Job Electricians has been saved successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),MakeEnableDisableGetElectricianSignature($("#hdBasicDetails_ElectricianID").val()),ShowHideEditIcon($("#hdBasicDetails_ElectricianID").attr("name"),$("#hdBasicDetails_ElectricianID").val())):showErrorMessageForPopup(e.error,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))},error:function(){showErrorMessageForPopup("Job Electricians has not been saved.")}})}}function ElectricianOnChange(e,s){$.ajax({url:urlUpdateJobDetailJobElectrician,data:{jobId:BasicDetails_JobID,solarCompanyId:company_Id,jobElectricianId:e,isCustomElectrician:s},contentType:"application/json",method:"get",async:!1,success:function(e){e.status&&(showSuccessMessageForPopup("Job Electricians has been saved successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),0==$("#hdBasicDetails_ElectricianID").val()&&showErrorMessageForPopup("Electrician has been removed.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails")),ReloadSTCJobScreen(BasicDetails_JobID),MakeEnableDisableGetElectricianSignature($("#hdBasicDetails_ElectricianID").val()),ShowHideEditIcon($("#hdBasicDetails_ElectricianID").attr("name"),$("#hdBasicDetails_ElectricianID").val()))},error:function(){showErrorMessageInstallerDetails("Job Electricians has not been saved.")}})}function clearPopupElectrician(){$(".popupElectrician").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$(".popupElectrician").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobElectricians_InstallerID").val(0),$("#JobElectricians_ElectricianID").val(0),$("#JobElectricians_UnitTypeID").val($("#JobElectricians_UnitTypeID option:first").val()),$("#JobElectricians_StreetTypeID").val($("#JobElectricians_StreetTypeID option:first").val()),$("#JobElectricians_PostalAddressID").val($("#JobElectricians_PostalAddressID option:first").val())}function deleteCustomElectrician(e,s){return confirm("Are you sure you want to delete electrician.")&&$.ajax({url:urlDeleteCustomElectrician,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify({jobElectricianId:e,jobId:s}),async:!1,success:function(e){return message="Electrician has been deleted.",showSuccessMessageForPopup(message,$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),FillDropDownElectrician(urlGetElectricianListForJob+"?&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&jobId="+BasicDetails_JobID,null,$("#txtBasicDetails_ElectricianID"),$("#hdBasicDetails_ElectricianID"),!0),!1},error:function(){message="Electrician has been not deleted.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}}),!1}function checkExistingCustomElectrician(){var e=$("#JobElectricians_FirstName").val()+" "+$("#JobElectricians_LastName").val();jobId=BasicDetails_JobID,solarCompanyId=company_Id,$.ajax({url:urlCheckExistingCustomElectrician,data:JSON.stringify({fullName:e,jobId:jobId,solarCompanyID:parseInt(solarCompanyId)}),contentType:"application/json",method:"Post",aync:!1,success:function(e){if(e.status){var s=!1;e.isExist&&confirm("Electrician with same First name and Last name already exists, do you want to create a new electrician with same name. ")&&(s=!0),e.isExist&&!s||SaveElectrician(1,!0)}else showErrorMessageForPopup(e.error,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function FillDropDownSWHInstaller(e,s,t,l){t.val(""),$.ajax({url:e,contentType:"application/json",dataType:"json",method:"get",cache:!1,success:function(e){swhInstallerList=[],$.each(e,function(e,s){swhInstallerList.push({value:s.Value,text:s.Text,issystemuser:s.IsSystemUser,userid:s.UserId})}),""!=s?(l.val(s),$.each(swhInstallerList,function(e,l){l.value==s&&t.val(l.text)})):(l.val(""),t.val(""))}})}function SWHInstallerAutocomplete(e,s){e.autocomplete({minLength:0,source:function(t,l){var a=[];s.val(0),$.each(swhInstallerList,function(s,t){t.text.toLowerCase().indexOf(e.val().toLowerCase())>-1&&a.push({Title:t.text,id:t.value,issystemuser:t.issystemuser,userid:t.userid})}),l($.map(a,function(e){return{label:e.Title,value:e.Title,id:e.id,issystemuser:e.issystemuser,userid:e.userid}}))},
select:function(t,l){s.val(l.item.id),e.val(l.item.value),e.attr("isSystemUser",l.item.issystemuser),SWHInstallerOnChange(e,s,l.item.issystemuser,l.item.userid)}}).bind("focus",function(){$(this).val().trim()||$(this).keydown()}),e.autocomplete("instance")._renderItem=function(e,s){var t=new RegExp($.trim(this.term.toLowerCase())),l=s.label.replace(t,"<span style='font-weight:600;'>"+$.trim(this.term.toLowerCase())+"</span>"),a="";a=s.issystemuser?"green":"grey";var i="<a style=color:"+a+">"+l+"</a>";return $("<li style='font-size:14px;'></li>").data("item.autocomplete",s).append(i).appendTo(e)}}function SWHInstallerOnChange(e,s,t,l){$.ajax({url:urlUpdateJobDetailInstallerDesigner,contentType:"application/json",dataType:"json",method:"get",cache:!1,async:!1,data:{installerDesignerId:s.val(),jobId:BasicDetails_JobID,profileType:0,IsSWHUser:!0,userId:l},success:function(l){if($("#successMsgRegionInstallerDetails").hide(),$("#errorMsgRegionInstallerDetails").hide(),l.status){if(t){2!=l.SEStatus&&alert("Selected installer is a Greenbot user but not a part of solar company, so visits can't be scheduled.");var a=$(".visit-id:visible").length;0!=a||2!=l.SEStatus||8==ProjectSession_UserTypeId&&"true"!=isScheduleAnInstaller.toLowerCase()?ShowHideVisitScheduledIcon(!0,2==l.SEStatus,l.SEStatus):addQuickVisit(s.val(),e.val(),l.SEStatus,"Installer has been added successfully.Do you want to schedule visit?"),ShowHideSystemUserIcon(!0,!0)}else ShowHideSystemUserIcon(!0,!1),ShowHideVisitScheduledIcon(!1,!1,1);t||showSuccessMessageForPopup("SWH Installer has been added successfully.",$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails")),0==s.val()&&(ShowHideSystemUserIcon(!0,!1),ShowHideVisitScheduledIcon(!1,!1,1),showErrorMessageForPopup("SWH Installer has been removed.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))),$("#JobInstallerDetails_FirstName").val(l.FirstName),$("#JobInstallerDetails_Surname").val(l.LastName),$("#JobInstallerDetails_Email").val(l.Email),$("#JobInstallerDetails_Mobile").val(l.Mobile),MakeEnableDisableGetInstallerSignature(s.val()),ShowHideEditIcon(s.attr("name"),s.val())}},error:function(){showErrorMessageForPopup("SWH Installer has not been added.",$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function checkExistSWHInstaller(e){var s="SearchGreenbotSWHInstaller_LicenseNumber",t=e,l=0;if(l=company_Id,$("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide(),""==t||null==t)return alert("Please enter license number"),!1;$.ajax({url:CheckSWHUserExistURL,data:{FieldName:s,userId:null,resellerID:null,solarCompanyId:parseInt(l),LicenseNumber:t},contentType:"application/json",method:"get",success:function(e){if($(".mulitpleSWHInstallerNote").hide(),$("#datatableSWHInstaller").dataTable().fnClearTable(),0==e.status){var s;s=e.message,$(".alert").hide(),$("#errorMsgRegionSWHInstallerPopup").html(closeButton+s),$("#errorMsgRegionSWHInstallerPopup").show()}else{var t=JSON.parse(e.accreditedData),l=[];t.length>1?($(".mulitpleSWHInstallerNote").show(),$(".mulitpleSWHInstallerNote").html("There are mulitple users with same license number.Please add appropriate one.")):$(".mulitpleSWHInstallerNote").hide(),$.each(t,function(e,s){l.push({AccreditedInstallerId:s.AccreditedInstallerId,FullName:s.FullName,CECAccreditationNumber:s.AccreditationNumber,IsPVDUser:s.IsPVDUser,IsSWHUser:s.IsSWHUser,FullAddress:s.FullAddress,Phone:s.Phone,Email:s.Email,IsSystemUser:s.IsSystemUser,UserId:s.UserId,AddressID:s.IsPostalAddress,UnitTypeID:s.UnitTypeID,UnitNumber:s.UnitNumber,StreetNumber:s.StreetNumber,StreetName:s.StreetName,StreetTypeID:s.StreetTypeID,Town:s.Town,State:s.State,PostCode:s.PostCode,IsPostalAddress:s.IsPostalAddress,FirstName:s.FirstName,LastName:s.Surname,Mobile:s.Mobile})});var a=$("#datatableSWHInstaller").DataTable({bDestroy:!0,iDisplayLength:10,columns:[{data:"Id",render:function(e,s,t,l){return t.StreetNumber=""==t.StreetNumber||null==t.StreetNumber?0:t.StreetNumber,t.UnitNumber=""==t.UnitNumber||null==t.UnitNumber?0:t.UnitNumber,t.UnitTypeID=t.UnitTypeID>0?t.UnitTypeID:0,t.StreetTypeID=t.StreetTypeID>0?t.StreetTypeID:0,t.StreetName=""==t.StreetName||null==t.StreetName?null:t.StreetName,t.Town=""==t.Town||null==t.Town?null:t.Town,t.State=""==t.State||null==t.State?null:t.State,t.PostCode=""==t.PostCode||null==t.PostCode?null:t.PostCode,t.FirstName=""==t.FirstName||null==t.FirstName?null:t.FirstName,t.LastName=""==t.LastName||null==t.LastName?null:t.LastName,t.Mobile=""==t.Mobile||null==t.Mobile?null:t.Mobile,t.Phone=""==t.Phone||null==t.Phone?null:t.Phone,t.Email=""==t.Email||null==t.Email?null:t.Email,t.PostalDeliveryNumber=""==t.PostalDeliveryNumber||null==t.PostalDeliveryNumber?null:t.PostalDeliveryNumber,t.PostalAddressID=t.PostalAddressID>0?t.PostalAddressID:0,'<input type="radio" name="swhInstaller" class="rbSWHInstaller" accreditedInstallerId="'+t.AccreditedInstallerId+'" IsPostalAddress="'+t.IsPostalAddress+'"  userId="'+t.UserId+'"  email="'+t.Email+'" UnitTypeID="'+t.UnitTypeID+'" UnitNumber="'+t.UnitNumber+'" StreetName="'+t.StreetName+'" StreetTypeID="'+t.StreetTypeID+'" StreetNumber="'+t.StreetNumber+'" Town="'+t.Town+'" State="'+t.State+'" PostCode="'+t.PostCode+'" isSystemUser="'+t.IsSystemUser+'" FirstName="'+t.FirstName+'" LastName="'+t.LastName+'" Mobile="'+t.Mobile+'" Phone="'+t.Phone+'" PostalDeliveryNumber="'+t.PostalDeliveryNumber+'" PostalAddressID="'+t.PostalAddressID+'" >'}},{data:"FullName"},{data:"CECAccreditationNumber"},{data:"FullAddress"},{data:"Phone"},{data:"Email"}],dom:"<<'table-responsive tbfix't>>",createdRow:function(e,s,t){1==s.IsSystemUser&&$(e.cells).css("color","green")}});a.rows.add(l).draw(),$("#datatableSWHInstaller").show(),$("#swhInstallerList").show()}}})}function FillSWHInstaller(e,s){$.ajax({url:GetElectricianDetailbySolarcompanyURL,data:{Id:e,JobType:s},contentType:"application/json",method:"get",success:function(e){if(0!=e){var s=JSON.parse(e);if(null!=s[0].SESignature&&""!=s[0].SESignature){var t=s[0].SESignature,l=ProjectSession_LoggedInUserId,a=ProjectSession_UploadedDocumentPath,i=a+"UserDocuments/"+l;SRCSignSWHInstall=i+"/"+t,$("#imgSignSWHInstall").attr("class",t),$("#imgSWHSignatureInstaller").show()}else $("#imgSWHSignatureInstaller").hide();$("#JobInstallerDetails_FirstName").val(s[0].FirstName),$("#JobInstallerDetails_Surname").val(s[0].LastName),$("#JobInstallerDetails_Email").val(s[0].Email),$("#JobInstallerDetails_Phone").val(s[0].Phone),$("#JobInstallerDetails_Mobile").val(s[0].Mobile),$("#JobInstallerDetails_LicenseNumber").val(s[0].ElectricalContractorsLicenseNumber),$("#JobInstallerDetails_LicenseNumber").attr("readonly","readonly"),$("#JobInstallerDetails_LicenseNumber").attr("onblur",""),"true"==s[0].IsPostalAddress.toLowerCase()?HideShowAddressFieldOverAddressType(2,"PDA","DPA"):HideShowAddressFieldOverAddressType(1,"PDA","DPA"),$("#JobInstallerDetails_UnitTypeID").val(0==s[0].UnitTypeID?"":s[0].UnitTypeID),$("#JobInstallerDetails_UnitNumber").val(s[0].UnitNumber),$("#JobInstallerDetails_StreetNumber").val(s[0].StreetNumber),$("#JobInstallerDetails_StreetName").val(s[0].StreetName),$("#JobInstallerDetails_StreetTypeID").val(s[0].StreetTypeID),$("#JobInstallerDetails_Town").val(s[0].Town),$("#JobInstallerDetails_State").val(s[0].State),$("#JobInstallerDetails_PostCode").val(s[0].PostCode),$("#JobInstallerDetails_PostalDeliveryNumber").val(s[0].PostalDeliveryNumber),$("#JobInstallerDetails_PostalAddressID").val(s[0].PostalAddressID),$("#JobInstallerDetails_AccreditationNumber").val(s[0].CECAccreditationNumber)}else message="SWH Installer has not been opened.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))},error:function(){message="SWH Installer has not been opened.",showErrorMessageForPopup(message,$("#errorMsgRegionInstallerDetails"),$("#successMsgRegionInstallerDetails"))}})}function SaveSWHInstaller(e,s){var t={},l=!1,a=!0;if(e||s){var i=addressValidationRules("JobInstallerDetails");if(i&&$("#frmSWHInstaller").valid()){var n=JSON.stringify($("#frmSWHInstaller").serializeToJson()),r=JSON.parse(n),o={};o=r.JobInstallerDetails,o.InstallerDesignerId=s?0:$("#hdBasicDetails_SWHInstallerID").val(),o.SESignature=$("#imgSignSWHInstall").attr("class"),o.LastName=$("#JobInstallerDetails_Surname").val(),o.ElectricalContractorsLicenseNumber=$("#JobInstallerDetails_LicenseNumber").val(),o.CECAccreditationNumber=s?"":$("#JobInstallerDetails_AccreditationNumber").val(),o.SEDesignRoleId=0,o.SolarCompanyId=companyId,o.CreatedBy=ProjectSession_LoggedInUserId,o.IsSWHUser=!0,t.installerDesignerView=o,t.signPath=SRCSignSWHInstall,t.accreditedInstallerId=1,t.jobId=BasicDetails_JobID,l=!0}}else{if($("#SearchGreenbotSWHInstaller_LicenseNumber").is("visible")&&""==$("#SearchGreenbotSWHInstaller_LicenseNumber").val())return alert("Please enter license number"),!1;if(0==$("input[name='swhInstaller']:checked").length||$("input[name='swhInstaller']:checked").length>1)return alert("Please select one record to add installer."),!1;if(1==$("input[name='swhInstaller']:checked").length){t.installerDesignerView={},t.installerDesignerView.SolarCompanyId=companyId,t.installerDesignerView.ElectricalContractorsLicenseNumber=$("#SearchGreenbotSWHInstaller_LicenseNumber").val(),t.installerDesignerView.Email=$("input[name='swhInstaller']:checked").attr("email"),t.accreditedInstallerId=s?1:$("input[name='swhInstaller']:checked").attr("accreditedinstallerid"),t.userId=$("input[name='swhInstaller']:checked").attr("userid"),t.installerDesignerView.UnitNumber="0"==$("input[name='swhInstaller']:checked").attr("unitnumber")?null:$("input[name='swhInstaller']:checked").attr("unitnumber"),t.installerDesignerView.StreetNumber="0"==$("input[name='swhInstaller']:checked").attr("streetnumber")?null:$("input[name='swhInstaller']:checked").attr("streetnumber"),t.installerDesignerView.StreetName="null"==$("input[name='swhInstaller']:checked").attr("streetname")?null:$("input[name='swhInstaller']:checked").attr("streetname"),t.installerDesignerView.UnitTypeID="0"==$("input[name='swhInstaller']:checked").attr("unittypeid")?null:$("input[name='swhInstaller']:checked").attr("unittypeid"),t.installerDesignerView.StreetTypeID="0"==$("input[name='swhInstaller']:checked").attr("streettypeid")?null:$("input[name='swhInstaller']:checked").attr("streettypeid"),t.installerDesignerView.Town="null"==$("input[name='swhInstaller']:checked").attr("town")?null:$("input[name='swhInstaller']:checked").attr("town"),t.installerDesignerView.State="null"==$("input[name='swhInstaller']:checked").attr("state")?null:$("input[name='swhInstaller']:checked").attr("state"),t.installerDesignerView.PostCode="null"==$("input[name='swhInstaller']:checked").attr("postcode")?null:$("input[name='swhInstaller']:checked").attr("postcode"),t.installerDesignerView.IsPostalAddress=$("input[name='swhInstaller']:checked").attr("ispostaladdress"),"true"==t.installerDesignerView.IsPostalAddress?t.installerDesignerView.AddressID=2:t.installerDesignerView.AddressID=1,t.installerDesignerView.FirstName="null"==$("input[name='swhInstaller']:checked").attr("firstname")?null:$("input[name='swhInstaller']:checked").attr("firstname"),t.installerDesignerView.LastName="null"==$("input[name='swhInstaller']:checked").attr("lastname")?null:$("input[name='swhInstaller']:checked").attr("lastname"),t.installerDesignerView.Phone="null"==$("input[name='swhInstaller']:checked").attr("phone")?null:$("input[name='swhInstaller']:checked").attr("phone"),t.installerDesignerView.Mobile="null"==$("input[name='swhInstaller']:checked").attr("mobile")?null:$("input[name='swhInstaller']:checked").attr("mobile"),t.installerDesignerView.PostalDeliveryNumber="null"==$("input[name='swhInstaller']:checked").attr("PostalDeliveryNumber")?null:$("input[name='swhInstaller']:checked").attr("PostalDeliveryNumber"),t.installerDesignerView.PostalAddressID="0"==$("input[name='swhInstaller']:checked").attr("PostalAddressID")?null:$("input[name='swhInstaller']:checked").attr("PostalAddressID"),$("#JobInstallerDetails_FirstName").val("null"==t.installerDesignerView.FirstName?"":t.installerDesignerView.FirstName),$("#JobInstallerDetails_Surname").val("null"==t.installerDesignerView.LastName?"":t.installerDesignerView.LastName),$("#JobInstallerDetails_Email").val("null"==t.installerDesignerView.Email?"":t.installerDesignerView.Email),$("#JobInstallerDetails_Phone").val("null"==t.installerDesignerView.Phone?"":t.installerDesignerView.Phone),$("#JobInstallerDetails_Mobile").val("null"==t.installerDesignerView.Mobile?"":t.installerDesignerView.Mobile),$("#JobInstallerDetails_LicenseNumber").val(t.installerDesignerView.ElectricalContractorsLicenseNumber),$("#JobInstallerDetails_LicenseNumber").attr("readonly","readonly"),$("#JobInstallerDetails_LicenseNumber").attr("onblur",""),"true"==t.installerDesignerView.IsPostalAddress?($("#JobInstallerDetails_AddressID").val(2),HideShowAddressFieldOverAddressType(2,"PDA","DPA")):($("#JobInstallerDetails_AddressID").val(1),HideShowAddressFieldOverAddressType(1,"PDA","DPA")),$("#JobInstallerDetails_UnitTypeID").val(null==t.installerDesignerView.UnitTypeID?"":t.installerDesignerView.UnitTypeID),$("#JobInstallerDetails_UnitNumber").val(null==t.installerDesignerView.UnitNumber?"":t.installerDesignerView.UnitNumber),$("#JobInstallerDetails_StreetNumber").val(null==t.installerDesignerView.StreetNumber?"":t.installerDesignerView.StreetNumber),$("#JobInstallerDetails_StreetName").val(null==t.installerDesignerView.StreetName?"":t.installerDesignerView.StreetName),$("#JobInstallerDetails_StreetTypeID").val(null==t.installerDesignerView.StreetTypeID?"":t.installerDesignerView.StreetTypeID),$("#JobInstallerDetails_Town").val(null==t.installerDesignerView.Town?"":t.installerDesignerView.Town),$("#JobInstallerDetails_State").val(null==t.installerDesignerView.State?"":t.installerDesignerView.State),$("#JobInstallerDetails_PostCode").val(null==t.installerDesignerView.PostCode?"":t.installerDesignerView.PostCode),$("#JobInstallerDetails_PostalDeliveryNumber").val(null==t.installerDesignerView.PostalDeliveryNumber?"":t.installerDesignerView.PostalDeliveryNumber),$("#JobInstallerDetails_PostalAddressID").val(null==t.installerDesignerView.PostalAddressID?"":t.installerDesignerView.PostalAddressID),addressValidationRules("JobInstallerDetails");var c=t.installerDesignerView.Town,d=t.installerDesignerView.State,g=t.installerDesignerView.PostCode;null!=c&&null!=d&&null!=g&&$.ajax({type:"GET",url:actionProcessRequest,dataType:"json",data:{excludePostBoxFlag:!0,q:c.substring(0,3)},async:!1,success:function(e){var s=JSON.parse(e);if(null!=s.localities.locality&&null!=s.localities.locality)if(s.localities.locality.length>0)$.each(s.localities.locality,function(){if(a=!1,this.location.toLowerCase()==c.toLowerCase()&&this.state.toLowerCase()==d.toLowerCase()&&this.postcode==g)return a=!0,!1});else if(null!=s.localities.locality.location&&null!=s.localities.locality.location){var t=s.localities.locality;if(t.location.toLowerCase()==c.toLowerCase()&&t.state.toLowerCase()==d.toLowerCase()&&t.postcode==g)return a=!0,!1}else a=!1;else a=!1;a?$("#errorMsgRegionSWHInstallerPopup").hide():($(".FindSWHInstaller").hide(),$(".SearchGreenbotSWHInstaller").hide(),$(".AddEditSWHInstaller").show(),$("#btnAddSWHInstaller").attr("onclick"," SaveSWHInstaller(false,true);"),$("#btnAddUpdateSWHInstaller").attr("onclick"," SaveSWHInstaller(false,true);"),showErrorMessageForPopup("Please enter valid state, town and postcode.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")))}}),l=!0}}t.profileType=3,t.jobElectricians=null,t.isSWHInstaller=!0,l&&a&&$.ajax({url:AddInstallerDesignerURL,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify(t),success:function(e){e.status?(e.InstallerDesignerId>0&&FillDropDownSWHInstaller(GetElectricianURL+"?JobID="+$("#BasicDetails_JobID").val()+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&JobType="+$("#BasicDetails_JobType").val(),$("#hdBasicDetails_SWHInstallerID").val(),$("#txtBasicDetails_SWHInstallerID"),$("#hdBasicDetails_SWHInstallerID")),$("#popupSWHInstaller").modal("hide"),showSuccessMessageForPopup(e.message,$("#successMsgRegionInstallerDetails"),$("#errorMsgRegionInstallerDetails"))):($(".FindSWHInstaller").hide(),$(".SearchGreenbotSWHInstaller").hide(),$(".AddEditSWHInstaller").show(),$("#btnAddSWHInstaller").attr("onclick"," SaveSWHInstaller(false,true);"),$("#btnAddUpdateSWHInstaller").attr("onclick"," SaveSWHInstaller(false,true);"),showErrorMessageForPopup(e.message,$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup")))},error:function(){showErrorMessageForPopup("SWH installer has not been saved.",$("#errorMsgRegionSWHInstallerPopup"),$("#successMsgRegionSWHInstallerPopup"))}})}function ClearSearchGreenbotSWHInstaller(){$("#SearchGreenbotSWHInstaller_LicenseNumber").val(""),$(".mulitpleSWHInstallerNote").hide(),$("#datatableSWHInstaller").dataTable().fnClearTable(),$("#swhInstallerList").hide(),$("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide()}function ClearPopupSWHInstaller(e){$(".popupSWHInstaller").find("input[type=text]").each(function(){"swhInstallerNotRequired"==$(this).attr("idclass")&&$(this).val(""),e&&"swhInstallerRequired"==$(this).attr("idclass")&&$(this).val(""),$(this).attr("class","form-control valid")}),$(".popupSWHInstaller").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobInstallerDetails_UnitTypeID").val($("#JobInstallerDetails_UnitTypeID option:first").val()),$("#JobInstallerDetails_StreetTypeID").val($("#JobInstallerDetails_StreetTypeID option:first").val()),$("#JobInstallerDetails_PostalAddressID").val($("#JobInstallerDetails_PostalAddressID option:first").val()),$("#JobInstallerDetails_SESignature").val(""),$("#imgSWHSignatureInstaller").hide(),$("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide()}function RemoveInstallerDesignerElectrician(e,s){0==s.val()&&("Electrician"==s.attr("name")?(clearPopupElectrician(),ElectricianOnChange(s.val(),e.attr("isCustomElectrician"))):"pvdInstaller"==s.attr("name")?InstallerDesignerOnChange(e,s,!0,!1):"Designer"==s.attr("name")?InstallerDesignerOnChange(e,s,!1,!1):"swhInstaller"==s.attr("name")&&SWHInstallerOnChange(e,s,!1),e.val(""))}function ShowHideSystemUserIcon(e,s){e?s?($("#btnInstaller_SystemUser").find("img").attr("src",ProjectImagePath+"Images/system-user-a.svg"),$("#btnInstaller_SystemUser").attr("title","Is a Greenbot user, this user will be able to receive visits and view job details if scheduled.")):($("#btnInstaller_SystemUser").find("img").attr("src",ProjectImagePath+"Images/system-user.svg"),$("#btnInstaller_SystemUser").attr("title"," Is not a registered Greenbot user, job details are not visible to this person.")):s?($("#btnDesigner_SystemUser").find("img").attr("src",ProjectImagePath+"Images/system-user-a.svg"),$("#btnDesigner_SystemUser").attr("title","Is a Greenbot user.")):($("#btnDesigner_SystemUser").find("img").attr("src",ProjectImagePath+"Images/system-user.svg"),$("#btnDesigner_SystemUser").attr("title"," Is not a registered Greenbot user."))}function ShowHideVisitScheduledIcon(e,s,t){e?s?($("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/scheduled-visit.svg"),$("#btnInstallerQuickVisit").attr("title","This installer has been scheduled a visit and can see this job data"),$("#btnInstallerQuickVisit").removeAttr("onclick")):($("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").attr("title"," Job data cannot be seen by this user because no scheduled visit has been created."),$("#btnInstallerQuickVisit").attr("onClick",BasicDetails_InstallerID>0?'addQuickVisit($("#hdBasicDetails_InstallerID").val(), $("#txtBasicDetails_InstallerID").val(),'+t+");":'addQuickVisit($("#hdBasicDetails_SWHInstallerID").val(), $("#txtBasicDetails_SWHInstallerID").val(),'+t+");")):($("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").attr("title"," Job data cannot be seen by this user because no scheduled visit has been created."),$("#btnInstallerQuickVisit").removeAttr("onclick")),0==$("#btnAddVisit:visible").length?($(".assign-installer").hide(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").removeAttr("onclick")):($(".assign-installer").show(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").attr("onClick",BasicDetails_InstallerID>0?'addQuickVisit($("#hdBasicDetails_InstallerID").val(), $("#txtBasicDetails_InstallerID").val(),'+t+");":'addQuickVisit($("#hdBasicDetails_SWHInstallerID").val(), $("#txtBasicDetails_SWHInstallerID").val(),'+t+");"))}function ShowHideEditIcon(e,s){s>0?"pvdinstaller"==e.toLowerCase()?$("#btnUpdateInstaller").show():"designer"==e.toLowerCase()?$("#btnUpdateDesigner").show():"electrician"==e.toLowerCase()?$("#btnUpdateElectrician").show():"swhinstaller"==e.toLowerCase()&&$("#btnUpdateSWHInstaller").show():"pvdinstaller"==e.toLowerCase()?$("#btnUpdateInstaller").hide():"designer"==e.toLowerCase()?$("#btnUpdateDesigner").hide():"electrician"==e.toLowerCase()?$("#btnUpdateElectrician").hide():"swhinstaller"==e.toLowerCase()&&$("#btnUpdateSWHInstaller").hide()}function UpdateInstaller(e){event.preventDefault(),FillInstallerDesigner(e,!0),$("#errorMsgRegionInstallerDesignerPopup").hide(),$("#successMsgRegionInstallerDesignerPopup").hide(),$("#InstallerDesignerView_LocationValidation").hide(),$(".FindInstaller").hide(),$("#popupInstallerDesigner").modal({backdrop:"static",keyboard:!1}),$("#popupInstallerDesigner").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$("#popupInstallerDesigner").find(".field-validation-error").attr("class","field-validation-valid"),$(".AddEditInstaller").show()}function getJobRetailerSettingDataForJobScreen(e){$.ajax({url:urlGetJobRetailerSettingDataByJobId,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",data:{JobId:e},cache:!1,success:function(e){e.success?$("#statement").html(e.data.Statement):showErrorMessageForJobAutoSign("Something wrong happen")}})}$(document).ready(function(){var e="undefined"!=typeof JobElectricians_PostalAddressID&&JobElectricians_PostalAddressID||0,s="undefined"!=typeof JobElectricians_UnitTypeID&&JobElectricians_UnitTypeID||0,t="undefined"!=typeof JobElectricians_StreetTypeID&&JobElectricians_StreetTypeID||0;dropDownData.push({id:"JobElectricians_UnitTypeID",key:"UnitType",value:s,hasSelect:!0,callback:null,defaultText:null,proc:"UnitType_BindDropdown",param:[],bText:"UnitTypeName",bValue:"UnitTypeID"},{id:"JobElectricians_StreetTypeID",key:"StreetType",value:t,hasSelect:!0,callback:null,defaultText:null,proc:"StreetType_BindDropdown",param:[],bText:"StreetTypeName",bValue:"StreetTypeID"},{id:"JobElectricians_PostalAddressID",key:"PostalAddress",value:e,hasSelect:!0,callback:null,defaultText:null,proc:"PostalAddress_BindDropdown",param:[],bText:"PostalDeliveryType",bValue:"PostalAddressID"});var l="undefined"!=typeof InstallerDesignerView_PostalAddressID&&InstallerDesignerView_PostalAddressID||0,a="undefined"!=typeof InstallerDesignerView_UnitTypeID&&InstallerDesignerView_UnitTypeID||0,i="undefined"!=typeof InstallerDesignerView_StreetTypeID&&InstallerDesignerView_StreetTypeID||0;dropDownData.push({id:"InstallerDesignerView_UnitTypeID",key:"UnitType",value:a,hasSelect:!0,callback:null,defaultText:null,proc:"UnitType_BindDropdown",param:[],bText:"UnitTypeName",bValue:"UnitTypeID"},{id:"InstallerDesignerView_StreetTypeID",key:"StreetType",value:i,hasSelect:!0,callback:null,defaultText:null,proc:"StreetType_BindDropdown",param:[],bText:"StreetTypeName",bValue:"StreetTypeID"},{id:"InstallerDesignerView_PostalAddressID",key:"PostalAddress",value:l,hasSelect:!0,callback:null,defaultText:null,proc:"PostalAddress_BindDropdown",param:[],bText:"PostalDeliveryType",bValue:"PostalAddressID"});var n="undefined"!=typeof JobInstallerDetails_PostalAddressID&&JobInstallerDetails_PostalAddressID||0,r="undefined"!=typeof JobInstallerDetails_UnitTypeID&&JobInstallerDetails_UnitTypeID||0,o="undefined"!=typeof JobInstallerDetails_StreetTypeID&&JobInstallerDetails_StreetTypeID||0;if(dropDownData.push({id:"JobInstallerDetails_UnitTypeID",key:"UnitType",value:r,hasSelect:!0,callback:null,defaultText:null,proc:"UnitType_BindDropdown",param:[],bText:"UnitTypeName",bValue:"UnitTypeID"},{id:"JobInstallerDetails_StreetTypeID",key:"StreetType",value:o,hasSelect:!0,callback:null,defaultText:null,proc:"StreetType_BindDropdown",param:[],bText:"StreetTypeName",bValue:"StreetTypeID"},{id:"JobInstallerDetails_PostalAddressID",key:"PostalAddress",value:n,hasSelect:!0,callback:null,defaultText:null,proc:"PostalAddress_BindDropdown",param:[],bText:"PostalDeliveryType",bValue:"PostalAddressID"}),dropDownData.bindDropdown(),!isSCADashboard){if($("#InstallerDetailHelp").click(function(){1==BasicDetails_JobType&&$("#popupInstallerDetailsHelp").modal({backdrop:"static",keyboard:!1})}),"true"==InstallerView_IsSystemUser.toLowerCase()?(ShowHideSystemUserIcon(!0,!0),"true"==InstallerView_IsVisitScheduled.toLowerCase()?ShowHideVisitScheduledIcon(!0,!0,InstallerView_SEStatus):ShowHideVisitScheduledIcon(!0,!1,InstallerView_SEStatus)):(ShowHideSystemUserIcon(!0,!1),ShowHideVisitScheduledIcon(!1,!1,InstallerView_SEStatus)),1==BasicDetails_JobType){"true"==DesignerView_IsSystemUser.toLowerCase()?ShowHideSystemUserIcon(!1,!0):ShowHideSystemUserIcon(!1,!1);var c=BasicDetails_InstallerID||0,d=BasicDetails_DesignerID||0,g=BasicDetails_JobElectricianID||0;FillInstallerDesignerElectrician(GetInstallerDesignerWithStatus+"?isInstaller=true&existUserId="+c+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&jobId="+BasicDetails_JobID,c,$("#txtBasicDetails_InstallerID"),$("#hdBasicDetails_InstallerID"),d,$("#txtBasicDetails_DesignerID"),$("#hdBasicDetails_DesignerID"),BasicDetails_JobElectricianID,$("#txtBasicDetails_ElectricianID"),$("#hdBasicDetails_ElectricianID")),ShowHideEditIcon("pvdinstaller",c),ShowHideEditIcon("designer",d),ShowHideEditIcon("electrician",g),MakeEnableDisableGetElectricianSignature(BasicDetails_JobElectricianID),MakeEnableDisableGetInstallerSignature(c),MakeEnableDisableGetDesignerSignature(d),ElectricianSignature(),TownPostcodeAutoComplete($("#InstallerDesignerView_Town"),$("#InstallerDesignerView_State"),$("#InstallerDesignerView_PostCode")),TownPostcodeAutoComplete($("#JobElectricians_Town"),$("#JobElectricians_State"),$("#JobElectricians_PostCode")),RegisterElectricianSignClickEvent(),RegisterDesignerSignClickEvent(),RegisterInstallerSignClickEvent(),InstDesignElectSignUploadByIcon($("#ownerGetSignByUpload")),InstallerDesignerSignatureUpload()}else{var u=$("#JobInstallerDetails_SWHInstallerDesignerId").val()||0;FillDropDownSWHInstaller(GetElectricianURL+"?JobID="+$("#BasicDetails_JobID").val()+"&solarCompanyId="+$("#BasicDetails_SolarCompanyId").val()+"&JobType="+$("#BasicDetails_JobType").val(),u,$("#txtBasicDetails_SWHInstallerID"),$("#hdBasicDetails_SWHInstallerID")),ShowHideEditIcon("swhinstaller",u),InstDesignElectSignUploadByIcon($("#ownerGetSignByUpload")),TownPostcodeAutoComplete($("#JobInstallerDetails_Town"),$("#JobInstallerDetails_State"),$("#JobInstallerDetails_PostCode")),MakeEnableDisableGetInstallerSignature(u),SWHInstallerSignatureUpload(),RegisterInstallerSignClickEvent()}$("#btnSetSignature").click(function(e){var s=$("[name=getSign]:checked").val(),t=$("#installerDesignerType").attr("instDesignerType");1==s?2==t?$("#hdBasicDetails_InstallerID").val()>0?($("#divInstallerSignDraw").hide(),GetSignatureFromVisit(2,!0)):$("#JobInstallerDetails_SWHInstallerDesignerId").val()>0&&($("#divInstallerSignDraw").hide(),GetSignatureFromVisit(2,!0)):$("#hdBasicDetails_DesignerID").val()>0&&($("#divDesignerSignDraw").hide(),GetSignatureFromVisit(4,!0)):2==t?$("#hdBasicDetails_InstallerID").val()>0?($("#imgInstallerSign").attr("src",SRCSignInstallerDesigner),UpdateJobSignature($("#imgInstallerSign").attr("src"),2,!0)):$("#JobInstallerDetails_SWHInstallerDesignerId").val()>0&&($("#divInstallerSignDraw").hide(),$("#imgInstallerSign").attr("src",SRCSignSWHInstall),UpdateJobSignature($("#imgInstallerSign").attr("src"),2,!0)):$("#hdBasicDetails_DesignerID").val()>0&&($("#imgDesignerSign").attr("src",SRCSignInstallerDesigner),UpdateJobSignature($("#imgDesignerSign").attr("src"),4,!0))}),InstallerDesignerAutocomplete($("#txtBasicDetails_InstallerID"),$("#hdBasicDetails_InstallerID"),!0),InstallerDesignerAutocomplete($("#txtBasicDetails_DesignerID"),$("#hdBasicDetails_DesignerID"),!1),ElectricianAutocomplete($("#txtBasicDetails_ElectricianID"),$("#hdBasicDetails_ElectricianID")),SWHInstallerAutocomplete($("#txtBasicDetails_SWHInstallerID"),$("#hdBasicDetails_SWHInstallerID"))}$("#InstallerDesignerView_AddressID").on("change",function(){HideShowAddressFieldOverAddressType($("#InstallerDesignerView_AddressID").val(),"PDA","DPA")}),$("#InstallerDesignerView_UnitTypeID").change(function(){ChangeUnitTypeId("InstallerDesignerView")}),$("#JobElectricians_AddressID").change(function(){HideShowAddressFieldOverAddressType($("#JobElectricians_AddressID").val(),"PDA","DPA")}),$("#JobElectricians_UnitTypeID").change(function(){ChangeUnitTypeId("JobElectricians")}),$("#JobInstallerDetails_AddressID").change(function(){HideShowAddressFieldOverAddressType($("#JobInstallerDetails_AddressID").val(),"PDA","DPA")}),$("#JobInstallerDetails_UnitTypeID").change(function(){ChangeUnitTypeId("JobInstallerDetails")}),$("#btnFindInstaller").click(function(e){1==$("#BasicDetails_JobType").val()||isSCADashboard?($("#errorMsgRegionInstallerDesignerPopup").hide(),$("#successMsgRegionInstallerDesignerPopup").hide(),$(".AddEditInstaller").hide(),$("#FindInstaller_CECAccreditationNumber").val(""),$("#FindInstaller_FirstName").val(""),$("#FindInstaller_LastName").val(""),$(".FindInstaller").show(),IsFromFindInstaller=!0,$("#popupInstallerDesigner").modal({backdrop:"static",keyboard:!1})):($("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide(),$(".SearchGreenbotSWHInstaller").hide(),$(".AddEditSWHInstaller").hide(),$("#btnBackFindInstaller").hide(),ClearPopupSWHInstaller(!0),ClearSearchGreenbotSWHInstaller(),$(".modalTitleSWHInstaller").html("Find Installer"),$(".FindSWHInstaller").show(),$(".SWHInstallerOptions").show(),IsFromFindInstaller=!0,$("#popupSWHInstaller").modal({backdrop:"static",keyboard:!1})),e.preventDefault()}),$("#btnResetFindInstaller").click(function(e){$("#FindInstaller_CECAccreditationNumber").val(""),$("#FindInstaller_FirstName").val(""),$("#FindInstaller_LastName").val(""),e.preventDefault()}),$("#btnUpdateInstaller").click(function(e){if(IsFromFindInstaller=!1,!($("#hdBasicDetails_InstallerID").val()>0))return alert("Please select Installer."),!1;UpdateInstaller($("#hdBasicDetails_InstallerID").val()),e.preventDefault()}),$("#btnUpdateDesigner").click(function(e){if(IsFromFindInstaller=!1,!($("#hdBasicDetails_DesignerID").val()>0))return alert("Please select Designer."),!1;FillInstallerDesigner($("#hdBasicDetails_DesignerID").val(),!1),$("#errorMsgRegionInstallerDesignerPopup").hide(),$("#successMsgRegionInstallerDesignerPopup").hide(),$("#InstallerDesignerView_LocationValidation").hide(),$(".FindInstaller").hide(),$("#popupInstallerDesigner").modal({backdrop:"static",keyboard:!1}),$("#popupInstallerDesigner").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$("#popupInstallerDesigner").find(".field-validation-error").attr("class","field-validation-valid"),
$(".AddEditInstaller").show(),e.preventDefault()}),$("#addInstallerDesigner").click(function(){$("#loading-image").css("display",""),SaveInstallerDesigner(),$("#loading-image").css("display","none")}),$("#btnClosePopUpBoxInsallerDesigner").click(function(){$("#popupboxInsallerDesigner").modal("toggle")}),$("#btnAddElectrician").click(function(e){IsFromFindInstaller=!1,$(".popupElectrician").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$("#JobElectricians_AddressID").val($("#JobElectricians_AddressID option:first").val()),$("#JobElectricians_UnitTypeID").val($("#JobElectricians_UnitTypeID option:first").val()),$("#JobElectricians_StreetTypeID").val($("#JobElectricians_StreetTypeID option:first").val()),$("#JobElectricians_PostalAddressID").val($("#JobElectricians_PostalAddressID option:first").val()),HideShowAddressFieldOverAddressType($("#JobElectricians_AddressID").val(),"PDA","DPA"),$("#btnSaveElectrician").attr("onclick","checkExistingCustomElectrician();"),$("#popupElectrician").modal({backdrop:"static",keyboard:!1}),e.preventDefault()}),$("#btnUpdateElectrician").click(function(e){if(IsFromFindInstaller=!1,""==$("#txtBasicDetails_ElectricianID").val())return alert("Please select Electrician."),!1;FillElectrician($("#hdBasicDetails_ElectricianID").val(),$("#txtBasicDetails_ElectricianID").attr("isCustomElectrician")),$("#btnSaveElectrician").attr("onclick",'SaveElectrician($("#txtBasicDetails_ElectricianID").attr("isCustomElectrician"),false);'),HideShowAddressFieldOverAddressType($("#JobElectricians_AddressID").val(),"PDA","DPA"),$("#popupElectrician").modal({backdrop:"static",keyboard:!1}),$("#popupElectrician").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$("#popupElectrician").find(".field-validation-error").attr("class","field-validation-valid"),$("#JobElectricians_LocationValidation").hide(),e.preventDefault()}),$("#btnUpdateSWHInstaller").click(function(e){if(!($("#hdBasicDetails_SWHInstallerID").val()>0))return alert("Please select SWH Installer."),!1;FillSWHInstaller($("#hdBasicDetails_SWHInstallerID").val(),$("#BasicDetails_JobType").val()),$("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide(),$(".FindSWHInstaller").hide(),$(".SWHInstallerOptions").hide(),$(".SearchGreenbotSWHInstaller").hide(),$(".modalTitleSWHInstaller").html("Installer Detail"),$("#btnAddUpdateSWHInstaller").attr("onclick"," SaveSWHInstaller(true);"),$("#btnClearPopupSWHInstaller").attr("onclick","ClearPopupSWHInstaller(false)"),$(".AddEditSWHInstaller").show(),$("#popupSWHInstaller").modal({backdrop:"static",keyboard:!1}),$("#popupSWHInstaller").find("input[type=text]").each(function(){$(this).attr("class","form-control valid")}),$("#popupSWHInstaller").find(".field-validation-error").attr("class","field-validation-valid"),e.preventDefault()}),$("#btnClosePopUpBoxSWHInsaller").click(function(){$("#popupboxSWHInsaller").modal("toggle")}),$("#btnSearchGreenbotSWHInstaller").click(function(e){$(".SWHInstallerOptions").hide(),$(".modalTitleSWHInstaller").html("Search Greenbot Installer"),$(".SearchGreenbotSWHInstaller").show(),$("#btnAddSWHInstaller").attr("onclick"," SaveSWHInstaller(false,false);"),$("#btnBackFindInstaller").show()}),$("#btnBackFindInstaller").click(function(e){$(".SearchGreenbotSWHInstaller").hide(),$(".AddEditSWHInstaller").hide(),$("#btnBackFindInstaller").hide(),ClearPopupSWHInstaller(!0),ClearSearchGreenbotSWHInstaller(),$(".modalTitleSWHInstaller").html("Find Installer"),$(".SWHInstallerOptions").show()}),$("#btnAddNewSWHInstaller").click(function(e){$(".SearchGreenbotSWHInstaller").hide(),$(".SWHInstallerOptions").hide(),$("#errorMsgRegionSWHInstallerPopup").hide(),$("#successMsgRegionSWHInstallerPopup").hide(),$(".FindSWHInstaller").hide(),$(".modalTitleSWHInstaller").html("Add Installer"),$(".AddEditSWHInstaller").show(),$("#JobInstallerDetails_LicenseNumber").removeAttr("readonly"),$("#JobInstallerDetails_Email").removeAttr("readonly"),$("#JobInstallerDetails_UnitTypeID").val($("#JobInstallerDetails_UnitTypeID option:first").val()),$("#JobInstallerDetails_StreetTypeID").val($("#JobInstallerDetails_StreetTypeID option:first").val()),$("#JobInstallerDetails_PostalAddressID").val($("#JobInstallerDetails_PostalAddressID option:first").val()),$("#btnAddUpdateSWHInstaller").attr("onclick","SaveSWHInstaller(false,true);"),$("#btnClearPopupSWHInstaller").attr("onclick","ClearPopupSWHInstaller(true)"),$("#btnBackFindInstaller").show()})}),$("#eleGetSignFromPopup,#designerGetSignFromPopup,#installerGetSignFromPopup").click(function(e){e.preventDefault();var s=$(this).data("type");$("#mdlGetSignature").data("type",s),"installer"==s?$("#drpSendMail").val("2"):"designer"==s?$("#drpSendMail").val("4"):"electrician"==s&&$("#drpSendMail").val("3"),$("#mdlGetSignature").modal("show")}),$("#installerGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetinstallerSignatureSelfie").modal("show")}),$("#designerGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetdesignerSignatureSelfie").modal("show")}),$("#elecGetSignatureSelfie").click(function(e){e.preventDefault(),$("#mdlGetelectricianSignatureSelfie").modal("show")});