function ShowHideVisitNotes(e,t){0==t?e.find("li").each(function(){1==$(this).attr("number")||2==$(this).attr("number")?$(this).show():$(this).hide()}):e.find("li").each(function(){$(this).show(),$(".mCustomScrollbar").mCustomScrollbar()})}function addTemplate(){$("#addTemplateForm").valid()&&CommonAddTemplate(isCheckListView)}function OpenaAddTemplate(e,t,i=!0){if(""==e&&0==$("#chkListOfScheduling").find(".checklist").find("li").length)return alert("Please add checklist item first."),!1;CommonOpenaAddTemplate(e,t,i)}function ResponseSaveScheduleOnDropAndInsertEdit(e,t,i,s,a=!1){return t>0?($("#loading-image").show(),message="Job schedule has been saved successfully.",$.ajax({url:urlReloadSectionOnVisitSave,dataType:"json",data:{id:visitJobId,isCheckListView:!0,isReloadGridView:!0,solarCompanyId:$("#BasicDetails_SolarCompanyId").val()},contentType:"application/json; charset=utf-8",type:"get",async:!1,success:function(e){null!=e&&(visitCheckListItemIds=[],HideInstaller(),$("#notification").modal("hide"),$("#popUpJobDetail").modal("hide"),$("#divVisitGridView").html(e.visitPartialView),$(".schedule-option li #visitDefaultSubmission").click(function(){MakeVisitAsDefaultSubmission($(this).attr("jobid"),$(this).attr("jobSchedulingId"),$(this).is(":checked"))}),0==$("#btnAddVisit:visible").length?($(".assign-installer").hide(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),$("#btnInstallerQuickVisit").removeAttr("onclick")):($(".assign-installer").show(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),2==InstallerView_SEStatus?$("#btnInstallerQuickVisit").attr("onClick",BasicDetails_InstallerID>0?'addQuickVisit($("#hdBasicDetails_InstallerID").val(), $("#txtBasicDetails_InstallerID").val(),'+InstallerView_SEStatus+");":'addQuickVisit($("#hdBasicDetails_SWHInstallerID").val(), $("#txtBasicDetails_SWHInstallerID").val(),'+InstallerView_SEStatus+");"):$("#btnInstallerQuickVisit").removeAttr("onClick")),$("#VisitHeader").html($("#jobHeader").html()),$(".reloadCustomJobField").empty(),$(".reloadCustomJobField").append(e.customFieldView),$("#loadNewJobPhoto").empty(),$("#loadNewJobPhoto").append(e.photoView),$("#checkListItemForTrade").html(e.checkListView).promise().done(function(){callbackCheckList()}),$("#loading-image").hide())},error:function(){}}),showSuccessMessageJobVisit(message)):-1==parseInt(e)?($("#notification").modal(),a&&$("#yesNotification").attr("isAutoScheduleVisit",!0)):0==parseInt(t)?(message=i,showErrorMessageSchedulingPopup(message),$("#notification").modal("hide")):(message="Job Schedule has not been saved.",showErrorMessageSchedulingPopup(message),$("#notification").modal("hide")),!1}function showErrorMessageSchedulingPopup(e){$(".alert").hide(),$("#errorMsgRegionForPopUp").html(closeButton+e),$("#errorMsgRegionForPopUp").show()}function showErrorMessageCalendar(e){showErrorMessageJobVisit(e)}function showJobSchedulingDetail(e,t){t.preventDefault(),$(".visitPopupMsg").hide(),$("#loading-image").show(),setTimeout(function(){FillJobSchedulingDetail(e),GenerateRandomNumber(),visitCheckListItemIds=[],isVisitCheckListTemplateChange=!1},500)}function DeleteJobScheduling(e,t,i){i.preventDefault(),DeleteJobSchedulingDetail(e,t,modelJobId)}function ResponseShowJobSchedulingDetail(e){var t=modelJobId;$("#JobID").val(t),$("#JobID").attr("disabled","disabled")}function ResponseDelete(e,t){if(e&&e>0){var i="";"False"==sessionIsUserEmailAccountConfigured&&(i="(Can not send mail because email account is not configured)"),message="Job schedule has been deleted successfully. "+i,$("#jobVisitDetail").find("[data-panelid="+t+"]").remove(),$("#btnAddVisit").show(),$(".assign-installer").show(),$("#btnInstallerQuickVisit").find("img").attr("src",ProjectImagePath+"Images/unscheduled-visit.svg"),2==InstallerView_SEStatus?$("#btnInstallerQuickVisit").attr("onClick",BasicDetails_InstallerID>0?'addQuickVisit($("#hdBasicDetails_InstallerID").val(), $("#txtBasicDetails_InstallerID").val(),'+InstallerView_SEStatus+");":'addQuickVisit($("#hdBasicDetails_SWHInstallerID").val(), $("#txtBasicDetails_SWHInstallerID").val(),'+InstallerView_SEStatus+");"):$("#btnInstallerQuickVisit").removeAttr("onClick");$("#divVisitList").find("[data-jobSchedulingId="+t+"]").find(".visitParent").addClass("deleteJobVisit").prepend('<span class="deleteInfo" title="Visit item has been deleted">&nbsp;</span>'),$("#divVisitList").find("[data-jobSchedulingId="+t+"]").find(".visitParent").find(".submission").length>0&&($("#divVisitList").find("[data-jobSchedulingId="+t+"]").find(".visitParent").find(".submission").remove(),MakeDefaultFolderAsDefaultSubmission());var s=modelJobId;ReloadSTCJobScreen(s),showSuccessMessageJobVisit(message),$("#jobVisitDetail").find(".panel").length<1&&($(".installer-text").css("display",""),$(".schedule-an-installer").css("display",""))}else message="Job schedule has not been deleted.",showErrorMessageJobVisit(message)}function ReloadJobPhotoSection(e){$("#loading-image").show(),setTimeout(function(){$.get(urlreloadphoto+e,function(e){$("#loadNewJobPhoto").empty(),$("#loadNewJobPhoto").append(e)})},500)}function MakeVisitAsDefaultSubmission(e,t,i){$.ajax({url:sessionMakeVisitAsDefaultSubmission,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:e,jobSchedulingId:t,isDefault:i},success:function(e){e.status?(1==i?($(".schedule-option li").find("#visitDefaultSubmission").each(function(){if($(this).attr("jobSchedulingId")!=t){$(this).prop("checked",!1);var e=$("#divVisitList").find("[data-jobSchedulingId="+$(this).attr("jobSchedulingId")+"]").find(".visitParent").find(".submission");e&&e.remove()}else{$("#divVisitList").find("[data-jobSchedulingId="+$(this).attr("jobSchedulingId")+"]").find(".visitParent").prepend("<span class=submission>STC Submission <i class='sprite-img submission-icon'></i></span>")}}),$("#divVisitList").find("#pnlMainDefault").find(".visitParent").find(".submission").remove(),showSuccessMessageJobVisit("Visit has been marked as default successfully.")):($("#divVisitList").find("[data-jobSchedulingId="+t+"]").find(".visitParent").find(".submission").remove(),showSuccessMessageJobVisit("Visit has been re-Marked as default successfully."),MakeDefaultFolderAsDefaultSubmission()),ReloadSTCJobScreen(jobID)):("sessiontimeout"==e.error.toLowerCase()&&(window.location.href=urlLogout),e.error?showErrorMessageJobVisit(e.error):showErrorMessageJobVisit(1==i?"Visit has not been marked as default successfully.":"Visit has not been re-Marked as default successfully."))},error:function(){showErrorMessageJobVisit(1==i?"Visit has not been marked as default.":"Visit has not been re-Marked as default.")}})}function ChangeVisitStatus(e,t,i){$.ajax({url:changeVisitStatus,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobSchedulingId:e,visitStatus:t},success:function(s){s.status?(i.attr("visitStatus",t),i.closest("#headingOne").next("div").find(".visit-completed").attr("status",t),ShowHideCompletedDate(0,s.completedDate,e),showSuccessMessageJobVisit("Visit status has been changed successfully."),"1"==t?$(".clsVisitStatus").text("Open"):"2"==t&&$(".clsVisitStatus").text("Completed"),SearchHistory()):("sessiontimeout"==s.error.toLowerCase()&&(window.location.href=urlLogout),s.error?showErrorMessageJobVisit(s.error):showErrorMessageJobVisit("Visit status has not been changed."))},error:function(){showErrorMessageJobVisit("Visit status has not been changed.")}})}function PopulateSignature(e,t,i){i.preventDefault(),$("#jobDocumentPopulate").empty(),$("#hdnJobSchedulingId").val(""),$.ajax({url:urlGetCheckListDocument,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobId:e},success:function(e){if(e.length>0){for(var i=0;i<e.length;i++)if("pdf"==e[i].FileName.substr(e[i].FileName.lastIndexOf(".")+1).toString().toLowerCase()){var s='<li><input type=checkbox class="checkbox" jobDocumentId='+e[i].JobDocumentId+" jobId="+e[i].JobId+" DownloadURLPath="+e[i].DownloadURLPath+" name="+e[i].FileName+" />"+e[i].FileName+"</li>";$("#jobDocumentPopulate").append(s)}$("#hdnJobSchedulingId").val(t),$("#popupboxPopulateSignature").modal({backdrop:"static",keyboard:!1})}else alert("This job has not any document")},error:function(){showErrorMessageJobVisit("Error while populating signature to documents")}})}function RequestJobData(e,t,i){i.preventDefault(),$.ajax({url:urlRequestJobData,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({jobId:e,jobSchedulingId:t}),success:function(e){e.status?showSuccessMessageJobVisit("Request for data created successfully"):showErrorMessageJobVisit("Error while requesting job data")},error:function(){showErrorMessageJobVisit("Error while requesting job data")}})}function SaveSignatureToDocument(){var e=[];$("#jobDocumentPopulate").find("input[type=checkbox]").each(function(){$(this).is(":checked")&&e.push({JobId:$(this).attr("jobId"),JobDocumentId:$(this).attr("jobDocumentId"),DownloadURLPath:$(this).attr("DownloadURLPath")})});var t=JSON.stringify(e),i=$("#hdnJobSchedulingId").val();$.ajax({url:urlSaveSignatureToDocument,dataType:"json",contentType:"application/json; charset=utf-8",type:"post",data:JSON.stringify({documentIds:t,jobSchedulingId:i}),success:function(e){e.status?($("#popupboxPopulateSignature").modal("toggle"),showSuccessMessageJobVisit("Visit signature has been populated successfully.")):e.error?showErrorMessageJobVisit("Visit signature has not been populated."):showErrorMessageJobVisit(e.error)},error:function(){showErrorMessageJobVisit("Visit signature has not been populated.")}})}function ClearSignatureToDocument(){$("#jobDocumentPopulate").find("input[type=checkbox]").each(function(){$(this).prop("checked",!1)})}function ViewVisitSignature(e,t){t.preventDefault(),$.ajax({url:urlViewVisitSignature,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",data:{jobSchedulingId:e},success:function(e){if(e.status){for(var t=0;t<e.signatures.length;t++){var i=sessionUploadedDocPath+e.signatures[t].Path;4==e.signatures[t].SignatureTypeId&&$("#imgDesignerSignature").attr("src",i),3==e.signatures[t].SignatureTypeId&&$("#imgElectricianSignature").attr("src",i),1==e.signatures[t].SignatureTypeId&&$("#imgOwnerSignature").attr("src",i),2==e.signatures[t].SignatureTypeId&&$("#imgInstallerSignature").attr("src",i),5==e.signatures[t].SignatureTypeId&&$("#imgOtherSignature").attr("src",i)}$("#popupboxViewSignature").modal({backdrop:"static",keyboard:!1})}},error:function(){}})}function ShowHideCompletedDate(e,t,i){$(".visit-completed").each(function(){1==$(this).attr("status")?($(this).find("#openStatus").show(),$(this).find("#completedStatus").hide(),$(this).find("#displayCompletedDate").hide()):($(this).find("#openStatus").hide(),$(this).find("#completedStatus").show(),$(this).find("#displayCompletedDate").show(),0==e&&i==$(this).attr("id")&&$(this).find("#displayCompletedDate").find("span").html(t))})}function GenerateRandomNumber(){$.ajax({url:urlGenerateRandomNumber,dataType:"json",contentType:"application/json; charset=utf-8",type:"get",async:!0,success:function(e){if(e.status){var t=e.randomNumber;$("#TempJobSchedulingId").val(t)}},error:function(){}})}function addVisit(){$(".visitPopupMsg").hide(),$("#JobSchedulingID").val(0),$("#UserId").val(""),$("#popUpJobDetail").modal({backdrop:"static",keyboard:!1}),$("#popUpJobDetail").find("input[type=text]").each(function(){$(this).val(""),$(this).attr("class","form-control valid")}),$("#popUpJobDetail").find(".field-validation-error").attr("class","field-validation-valid"),$("#popUpJobDetail").find("Select").each(function(){$(this).find("option:first").attr("selected","selected")}),$("#popUpJobDetail").find("textarea").each(function(){$(this).val("")});var e=modelJobId;$("#jobScheduling").find("select[id='JobID']").html('<option value=" ">Select</option><option value="'+e+'">'+$("#BasicDetails_RefNumber").val()+"</option>"),$("#jobScheduling").find("select[id='JobID']").val(e),$("#jobScheduling").find("select[id='JobID']").attr("disabled","disabled"),$("#popUpJobDetail").find("#RefNumber").val($("#BasicDetails_RefNumber").val()),$("#popUpJobDetail").find("#Detail").val($("#BasicDetails_Description").val()),GenerateRandomNumber(),visitCheckListItemIds=[],isVisitCheckListTemplateChange=!1,TempCheckListTemplateItemAdd(modelDefaultTemplateId,!0,$("#BasicDetails_JobID").val())}function HideInstaller(){$('[name="JobSchedule"]').length>0&&($("#btnAssignInstaller").css("display","none"),$("#btnScheduleInstaller").css("display","none"),$(".installer-text").css("display","none"),$(".schedule-an-installer").css("display","none"))}function showErrorMessageJobVisit(e){$(".alert").hide(),$("#successMsgRegionJobVisit").hide(),$("#errorMsgRegionJobVisit").html(closeButton+e),$("#errorMsgRegionJobVisit").show()}function showSuccessMessageJobVisit(e){$(".alert").hide(),$("#errorMsgRegionJobVisit").hide(),$("#successMsgRegionJobVisit").html(closeButton+e),$("#successMsgRegionJobVisit").show()}function VisitStatusChange(e){var t=$(e).attr("visitStatus");t=1==t?2:1,ChangeVisitStatus($(e).attr("jobScedulingId"),t,$(e))}$(document).ready(function(){$("#VisitHeader").html($("#jobHeader").html()),ShowHideCompletedDate(1),$(".switch").on("click",function(e){e.stopImmediatePropagation()}),$(".schedule-option li #visitDefaultSubmission").click(function(){MakeVisitAsDefaultSubmission($(this).attr("jobid"),$(this).attr("jobSchedulingId"),$(this).is(":checked"))}),$("#jobVisitDetail").find(".panel").each(function(){ShowHideVisitNotes($(this).find("#jobNotesUL"),!1),$(this).find("#viewMoreNotes").click(function(e){"0"==$(this).attr("isShowMore")?(ShowHideVisitNotes($(this).parent().find("#jobNotesUL"),!0),$(this).attr("isShowMore","1"),$(this).text("Show Less Notes")):(ShowHideVisitNotes($(this).parent().find("#jobNotesUL"),!1),$(this).attr("isShowMore","0"),$(this).text("Show More Notes")),e.preventDefault()})}),Array.prototype.pushArray=function(){for(var e=this.concat.apply([],arguments),t=0,i=e.length;t<i;++t)this.push(e[t])},$.fn.serializeToJson=function(){var e=$(this[0]).serializeArray(),t={},i=[];return $.each(e,function(e,s){if(-1!=s.name.indexOf(".")){var a=s.name.split(".");i.indexOf(a[0])<0&&i.push(a[0]);var o=t[i[i.indexOf(a[0])]]||{};o[a[1]]||(o[a[1]]=s.value),t[i[i.indexOf(a[0])]]=o}else t[s.name]||(t[s.name]=s.value)}),t},$("#btnClosepopupboxPopulateSignature").click(function(){$("#popupboxPopulateSignature").modal("toggle")}),$("#btnClosepopupboxViewSignature").click(function(){$("#popupboxViewSignature").modal("toggle")})}),$("#btnAssignInstaller").length>0&&$("#btnAssignInstaller").click(function(e){e.preventDefault(),addVisit()}),$("#btnScheduleInstaller").length>0&&$("#btnScheduleInstaller").click(function(e){e.preventDefault(),$("#horizontalTab ul li:eq(7)").trigger("click"),addVisit()}),HideInstaller();