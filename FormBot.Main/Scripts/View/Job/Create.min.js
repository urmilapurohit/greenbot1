var SRCSign;$(document).on("ajaxStart",function(){1===++count&&$("#loading-image").show()}).on("ajaxComplete",function(){--count||$("#loading-image").hide()}),$("#loading-image").show(),$("#divSchedulingEdit").on("load",function(){$("#loading-image").delay(9e3).fadeOut()});var isSendMessageRights=isSendMessage,isEmailAlreadyLoaded=!1,pageIndex=1,pageSize=10,IsLast=!1,count=0,isParentInvoice=!1;function onclickEvent(){var notes=$("#Notes").val(),jobID=$("#BasicDetails_JobID").val(),title=$("#hdnJobTitle").val(),obj={};obj.JobID=jobID,obj.Notes=notes,obj.JobTitle=title;var dataNotes=JSON.stringify(obj),parameters=$("#frmIndex").serialize();""==notes?($(".alert").hide(),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+"Please enter job notes."),$("#errorMsgRegion").show()):$.ajax({url:urlSaveJobNotes,type:"post",data:dataNotes,dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){data.success?($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-danger"),$("#popuperrorMsgRegion").addClass("alert-success"),$("#popuperrorMsgRegion").html(closeButton+"Job notes has been saved successfully."),$("#popuperrorMsgRegion").show(),$("#Notes").val(""),$("#Notes").focus(),$.ajax({type:"POST",url:urlJobList,data:parameters+"&pageIndex=1&jobID="+jobID,dataType:"json",async:!1,success:function(response){$("#tblCase tr").remove();var trHTML="";null!=response.PagedList&&$.each(response.PagedList,function(i,item){"false"==isDelete?trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+item.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}),$("#tblCase").append(trHTML),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")},error:function(req,status,error){alert("Could not get patient name properly. Status = "+status+" Error="+error+" Req="+req)}})):($(".alert").hide(),$("#popuperrorMsgRegion").removeClass("alert-success"),$("#popuperrorMsgRegion").addClass("alert-danger"),$("#popuperrorMsgRegion").html(closeButton+"Job note has not been saved."),$("#popuperrorMsgRegion").show())}})}function scrolldvIndividual(obj){$("#dvIndividual").on("scroll",function(e){$("#tblHeaderScroll").scrollLeft($(tblScroll).scrollLeft());var $o=$(e.currentTarget);$o[0].scrollHeight-$o.scrollTop()<=$o.outerHeight()&&GetRecords()})}function GetRecords(){if(!IsLast){pageIndex++;var parameters=$("#frmIndex").serialize(),jobID=$("#BasicDetails_JobID").val();$.ajax({type:"POST",url:urlJobList,data:parameters+"&pageIndex="+pageIndex+"&jobID="+jobID,dataType:"json",async:!1,success:OnSuccess,error:function(req,status,error){alert("Could not get patient name properly. Status = "+status+" Error="+error+" Req="+req)}})}}function OnSuccess(response){var trHTML="";response.PagedList.length>0?$.each(response.PagedList,function(i,item){"false"==isDelete?trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+item.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}):IsLast=!0,$("#tblCase").append(trHTML),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")}function DeleteJobNotes(jobNotesId){var result=confirm("Are you sure you want to delete this note?"),parameters=$("#frmIndex").serialize(),jobID=$("#BasicDetails_JobID").val();result&&$.ajax({url:urlDeleteJobNotes,type:"POST",async:!1,data:JSON.stringify({jobNotesId:jobNotesId}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){data.success&&($.ajax({type:"POST",url:urlJobList,data:parameters+"&pageIndex=1&jobID="+jobID,dataType:"json",async:!1,success:function(response){$("#tblCase tr").remove();var trHTML="";null!=response.PagedList&&$.each(response.PagedList,function(i,item){"false"==isDelete?trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>":trHTML+='<tr class="notesTR color"><td colspan="2" class="notes">'+item.Notes+'</td><td style="text-align:center;width:34px;"><a href="javascript:DeleteJobNotes('+item.JobNotesID+')" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a></td></tr><tr class="createdTR color1"><td class="createdBy"><b style="color:#555;">Created By : </b>'+item.Created+'</td><td class="createdDate"><b style="color:#555;">Created Date : </b>'+item.strCreatedDate+"</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>"}),$("#tblCase").append(trHTML),setTimeout(function(){if(0==$("#tblCase tr").length){var trHTML="";trHTML+='<tr style="border:none;padding: 10px 20px;height: 34px;text-align:center;"><td colspan="3" style="padding-top:10px;">No Records Found</td></tr>',$("#tblCase").append(trHTML)}},200),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff")},error:function(req,status,error){alert("Could not get patient name properly. Status = "+status+" Error="+error+" Req="+req)}}),$(".alert").hide(),$("#successMsgRegion").removeClass("alert-danger"),$("#successMsgRegion").addClass("alert-success"),$("#successMsgRegion").html(closeButton+"Job notes deleted successfully."),$("#successMsgRegion").show())}})}function LoadTabContent(index){$("ul.create-job-menu").each(function(){$(this).find("li").each(function(){$(this).removeClass("active")})}),0==index?($("#ActiveJob").addClass("active"),$("#jobTitle").html("Job Details"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Job Details"),$("#invoice").hide(),$("#history").hide(),$("#createJobNotes").hide(),$("#createJobView").show(),$(".assign").show(),$("#EmailConversation").hide(),$("#createJobMessage").hide(),IsLast=!1,pageIndex=1,isParentInvoice=!1):1==index?($("#aInvoice").addClass("active"),$("#jobTitle").html("Invoice"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Invoice"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,$("#invoice").load(urlGetJobInvoice,function(responseTxt,statusTxt,xhr){"success"==statusTxt&&($("#invoice").show(),$("#EmailConversation").hide(),$("#invoiceDetail").css("display","none"),loadInvoice()),"error"==statusTxt&&alert("Error: "+xhr.status+": "+xhr.statusText)})):2==index?($("#aNotes").addClass("active"),$("#jobTitle").html("Notes"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),"True"==isNotesView?($("#jobTitle").html("Notes"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Notes"),$("#createJobView").hide(),$("#createJobNotes").show(),$.ajax({type:"GET",url:urlGetJobNotes+QueryId,cache:!1,async:!0,ifModified:!0,success:function(Data){$("#createJobNotes").html(Data)},error:function(Error){}}),$("#createJobMessage").hide(),$("#invoice").hide(),$("#history").hide(),$("#EmailConversation").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,setTimeout(function(){if($("#Notes").focus(),$(".color:odd").css("background-color","#fff"),$(".color1:odd").css("background-color","#fff"),$("#hdnJobTitle").val(BasicDetails_Title),0==$("#tblCase tr").length){var trHTML="";trHTML+='<tr style="border:none;padding: 10px 20px;height: 34px;text-align:center;"><td colspan="3" style="padding-top:10px;">No Records Found</td></tr>',$("#tblCase").append(trHTML)}},2e3)):$("#ActiveJob").addClass("active"),isParentInvoice=!1):3==index?("True"==isHistoryView?($("#aHistory").addClass("active"),$("#jobTitle").html("History"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - History"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#EmailConversation").hide(),$("#invoice").hide(),$("#history").show(),$("#history").load(urlShowHistory+RouteId),$(".assign").hide(),IsLast=!1,pageIndex=1):$("#ActiveJob").addClass("active"),isParentInvoice=!1):4==index?"False"==IsUserEmailAccountConfigured?(EmailAccountConfigureErrorMessage(),LoadTabContent(prevSelectedTab)):("True"==isMessageView?($("#aMessage").addClass("active"),$("#jobTitle").html("Message"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Message"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").load(urlLoadMessageTab+$("#BasicDetails_JobID").val()),$("#createJobMessage").show(),$("#invoice").hide(),$("#history").hide(),$(".assign").hide(),$("#EmailConversation").hide(),IsLast=!1,pageIndex=1):$("#ActiveJob").addClass("active"),isParentInvoice=!1):5==index&&("False"==IsUserEmailAccountConfigured?(EmailAccountConfigureErrorMessage(),LoadTabContent(prevSelectedTab)):($("#aEmail").addClass("active"),$("#jobTitle").html("Email"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Email"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#EmailConversation").load(urlGetMessageForJobEmailConversationForPreAndConn+$("#BasicDetails_JobID").val()),$("#EmailConversation").show(),$("#invoice").hide(),$("#history").hide(),$(".assign").hide(),isParentInvoice=!1))}$("#loading-image").show(),$("#divSchedulingEdit").load(urlJobSchedulingDetail+"?id="+ModelId,function(response,status,xhr){"error"==status&&(window.location.href=urlLogin)}),$("#loading-image").hide(),$(document).ready(function(){$("#uploadBtnJobSignature").fileupload({url:urlUpload,dataType:"json",done:function(e,data){var UploadFailedFiles=[];UploadFailedFiles.length=0;for(var i=0;i<data.result.length;i++)if(1==data.result[i].Status){var OldEleSign=Electricians_Signature,guid=Model_Guid,signName=$("#imgSign").attr("class");$("[name='Signature']").each(function(){$(this).remove()}),null!=signName&&""!=signName&&DeleteFileFromFolderAndElectrician(signName,guid,OldEleSign);var proofDocumentURL,imagePath,SRC=UploadedDocumentPath+"JobDocuments/"+guid+"/"+data.result[i].FileName.replace("%","$");SRCSign=SRC,$("#imgSign").attr("class",data.result[i].FileName.replace("%","$")),$("#imgSignature").show(),$('<input type="hidden">').attr({name:"Signature",value:data.result[i].FileName.replace("%","$"),id:data.result[i].FileName.replace("%","$")}).appendTo("form")}else UploadFailedFiles.push(data.result[i].FileName.replace("%","$"));UploadFailedFiles.length>0?($(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"File has not been uploaded."),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").hide(),$("#successMsgRegion").html(closeButton+"File has been uploaded successfully."),$("#successMsgRegion").show())},progressall:function(e,data){},singleFileUploads:!1,send:function(e,data){var documentType,mimeType=data.files[0].type.split("/")[0];if(data.files.length>1)for(var i=0;i<data.files.length;i++){if(data.files[i].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+" "+data.files[i].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(data.files[i].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}else{if(data.files[0].size>parseInt(MaxImageSize))return $(".alert").hide(),$("#successMsgRegion").hide(),$("#errorMsgRegion").html(closeButton+"Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB"),$("#errorMsgRegion").show(),!1;if(CheckSpecialCharInFileName(data.files[0].name))return ShowErrorMsgForFileName("Please upload file that not conatain <> ^ [] ."),!1}return"image"!=mimeType?($(".alert").hide(),$("#errorMsgRegion").html(closeButton+"Please upload a file with .jpg , .jpeg or .png extension."),$("#errorMsgRegion").show(),$("html").animate({scrollTop:0},"slow"),$("body").animate({scrollTop:0},"slow"),!1):($(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:Model_Guid,id:Model_Guid}).appendTo("form"),!0)},formData:{userId:Model_Guid}})}),$("ul.create-job-menu").on("click","li",function(){return $("ul.create-job-menu").each(function(){$(this).find("li").each(function(){$(this).removeClass("active")})}),$("#invoiceDetail").css("display","none"),"0"==$("#BasicDetails_JobID").val()?$("#ActiveJob").addClass("active"):("0"==$("#hasJobID").val()&&$("#hasJobID").val($("#BasicDetails_JobID").val()),LoadTabContent($(this).index())),prevSelectedTab=$(this).index(),!1});var jobInvoiceDetail=jobInvoiceDetail||[];function deleteInvoice(invoiceID){var result;confirm("Are you sure you want to delete this invoice ?")&&$.ajax({url:urlDeleteInvoice,type:"POST",async:!1,data:JSON.stringify({InvoiceID:invoiceID}),dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){"Failed"==data.status?($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-success"),$("#errorMsgRegion").addClass("alert-danger"),$("#errorMsgRegion").html(closeButton+data.strErrors),$("#errorMsgRegion").show()):($(".alert").hide(),$("#errorMsgRegion").removeClass("alert-danger"),$("#errorMsgRegion").addClass("alert-success"),$("#errorMsgRegion").html(closeButton+data.strErrors),$("#errorMsgRegion").show()),$("#datatable").dataTable().fnDraw()}})}function DownloadReport(obj){var JobId=$("#hasJobID").val(),fileName=$(obj).attr("filename");window.location.href=urlViewDownloadInvoiceReportFile+fileName+"&JobID="+JobId}function loadInvoice(){isParentInvoice=!1;var LogInID=LoggedInUserId,table;$("#datatable")&&$("#datatable").DataTable().destroy();$("#datatable").DataTable({iDisplayLength:10,lengthMenu:GetPageSize,order:[[1,"asc"]],language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"JobInvoiceID",orderable:!1,render:function(data,type,full,meta){return LogInID==full.CreatedBy?'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-outgoing.png) no-repeat center;cursor:default; text-decoration:none;margin-left:-30%;"></a>':'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-incoming.png) no-repeat center;cursor:default; text-decoration:none;margin-left:-30%;"></a>'}},{data:"InvoiceNumber",orderable:!0},{data:"CreatedDate",render:function(data){return ConvertToDateWithFormat(data,GetDateFormat)}},{data:"Created"},{data:"InvoicedTo"},{data:"FileName",render:function(data,type,full,meta){return 1==full.Status?"<p style='color:green;'>"+full.FileName+"</p>":2==full.Status?"<p style='color:gray;'>"+full.FileName+"</p>":3==full.Status?"<p style='color:orange;'>"+full.FileName+"</p>":4==full.Status?"<p style='color:red;'>"+full.FileName+"</p>":"<p style='color:red;'></p>"},orderable:!1},{data:"InvoiceTotal",orderable:!0,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.InvoiceTotal)}},{data:"InvoiceAmountDue",orderable:!0,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.InvoiceAmountDue)}},{data:"JobInvoiceID",render:function(data,type,full,meta){var pdf="";"1"==full.FileExist?pdf='<a class="action view" href="javascript:void(0)" style="background:url(../../Images/pdf.png) no-repeat center; text-decoration:none;margin-left:18px;" onclick="DownloadReport(this)" filename="'+full.InvoiceNumber+'.pdf"></a>':"0"==full.FileExist&&(pdf='<a class="action view" style="background:none;text-decoration:none;margin-left:18px;"></a>');var sent="",edit,space;return pdf+"&nbsp;&nbsp;&nbsp;"+(sent=1==full.Sent?'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-right.png) no-repeat center; cursor:default;text-decoration:none;margin-left:18px;"></a>':'<a href="javascript:void(0)" class="action view" style="background:url(../../Images/ic-wrong.png) no-repeat center; cursor:default;text-decoration:none;margin-left:18px;"></a>')+('&nbsp;<a href="javascript:void(0);" class="action view" style="background:url(../../Images/edit-icon.png) no-repeat center; text-decoration:none;margin-left:18px;" onclick="jobInvoiceDetail.loadData('+full.JobInvoiceID+')"></a>')+'<a href="javascript:void(0)" onclick="deleteInvoice('+full.JobInvoiceID+')" class="action view" style="background:url(../../Images/delete-icon.png) no-repeat center; text-decoration:none;margin-left:18px;"></a>'},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetInvoiceList+$("#BasicDetails_JobID").val(),fnDrawCallback:function(){$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>1?$("#datatable_length").show():$("#datatable").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var table,info=$("#datatable").DataTable().page.info();0==info.recordsTotal?document.getElementById("invoiceNumRecords").innerHTML="<b>0</b>  of  <b>"+info.recordsTotal+"</b>  Invoice(s) found":document.getElementById("invoiceNumRecords").innerHTML="<b>"+$("#datatable >tbody >tr").length+"</b>  of  <b>"+info.recordsTotal+"</b>  Invoice(s) found"}}),$(".dataTables_empty").css("text-align","left")}jobInvoiceDetail=function(){var pub={loadInvoiceDetailData:function(invoiceID){if($("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),$("#invoice")&&$("#invoice").css("display","none"),$("#invoiceDetailList")){$("#invoiceDetailList").html("");var jobID=0;$("#hasJobID")&&(jobID=$("#hasJobID").val()),$.ajax({url:urlGetJobInvoiceDetail,type:"GET",dataType:"html",data:{invoiceID:invoiceID,jobID:jobID},async:!0,success:function(data){$("#invoiceDetailList").html(data)},complete:function(data){var table;($("#invoiceDetail").css("display","block"),$("#invoiceDetailListTable"))&&$("#invoiceDetailListTable").DataTable().destroy();pub.loadtable(invoiceID),$("#hdnJobInvoiceID")&&$("#hdnJobInvoiceID").val(invoiceID),$("body").attr("style","overflow:scroll;padding-right:0px;")},error:function(data){alert(data)}}),isParentInvoice=!0}},loadtable:function(invoiceID){var isInvoiced="",invoiceType="",queryString="";$("#drdInvoiced")&&(isInvoiced=$("#drdInvoiced").val()),$("#drdInvoiceType")&&(invoiceType=$("#drdInvoiceType").val()),""!=invoiceID&&(queryString+="invoiceID="+invoiceID+"&"),""!=isInvoiced&&(queryString+="isInvoiced="+isInvoiced+"&"),""!=invoiceType&&(queryString+="jobInvoiceType="+invoiceType),""!=queryString&&(queryString="?"+queryString);var chkCount=0,jobID="";$("#hasJobID")&&(jobID=$("#hasJobID").val()),$("#invoiceDetailListTable").DataTable({paging:!1,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"JobInvoiceDetailID",render:function(data,type,full,meta){return 1==$("#chkAll").prop("checked")?'<input type="checkbox" id="chk_'+full.JobInvoiceDetailID+'" checked>':'<input type="checkbox" id="chk_'+full.JobInvoiceDetailID+'">'},orderable:!1},{data:"TimeStart",render:function(data){return ConvertToDateWithFormat(data,GetDateFormat)}},{data:"JobInvoiceType",render:function(data,type,full,meta){return 1==full.JobInvoiceType?'<img src="/images/invoice-type-part.png" alt="Part" />':2==full.JobInvoiceType?'<img src="/images/invoice-type-time.png" alt="Time" />':3==full.JobInvoiceType?'<img src="/images/invoice-type-payment.png" alt="Payment" />':""},orderable:!1},{data:"Description"},{data:"StaffName",orderable:!1},{data:"Quantity",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.Quantity)}},{data:"Sale",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.Sale)}},{data:"SubTotal",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.SubTotal)}},{data:"cost",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.cost)}},{data:"Profit",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.Profit)}},{data:"Margin",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return"number"==typeof full.Margin?full.Margin===parseInt(full.Margin,10)?full.Margin:full.Margin.toFixed(0):"0"}},{data:"Tax",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.Tax)}},{data:"Total",orderable:!1,sClass:"dt-right",render:function(data,type,full,meta){return PrintDecimal(full.Total)}},{data:"IsBillable",render:function(data,type,full,meta){return'<img src="/images/'+full.IsBillableImage+'" alt="" />'},orderable:!1},{data:"IsInvoiced",render:function(data,type,full,meta){return 1==full.IsInvoiced?"Yes":0==full.IsInvoiced?"No":""},orderable:!1},{data:"JobInvoiceDetailID",className:"hide_column"},{data:"JobInvoiceType",className:"hide_column"},{data:"Payments",className:"hide_column"},{data:"Remaning",className:"hide_column"},{data:"TaxAmountConsider",className:"hide_column"}],dom:"<<'table-responsive tbfix't><'bottom'l><'clear'>>",bServerSide:!0,sAjaxSource:urlGetInvoiceDetailListing+queryString+"&&jobID="+jobID,fnDrawCallback:function(row,data,start,end,display){chkCount=0;var api=this.api(),data,intVal=function(i){return"string"==typeof i?1*i.replace(/[\$,]/g,""):"number"==typeof i?i:0};$("#generateInvoice").attr("data-id",urlCreateReport+invoiceID+"&jobID="+jobID),$("#generateInvoice").attr("style","cursor:pointer;"),$("#exportCSV").attr("href",urlCreateCSV+invoiceID),$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>1?$("#invoiceDetailListTable_length").show():$("#invoiceDetailListTable").find("tr").length>11?$("#invoiceDetailListTable_length").show():$("#invoiceDetailListTable_length").hide();var table,info=$("#invoiceDetailListTable").DataTable().page.info();$("#invoiceDetailListTable th:first").removeClass("sorting_asc"),$("#invoiceDetailListTable tbody").on("click","tr td:not(:first-child)",function(e){var jobInvoiceDetailID=$(e.currentTarget).closest("tr").find("td:eq(15)").html(),jobInvoiceDetailType=$(e.currentTarget).closest("tr").find("td:eq(16)").html(),jobID="";$("#hasJobID")&&(jobID=$("#hasJobID").val());var xeroApprovedDate="";$("#hdnXeroApprovedDate")&&(xeroApprovedDate=$("#hdnXeroApprovedDate").val()),"1"==jobInvoiceDetailType&&""!=jobInvoiceDetailID&&""!=jobID&&""==xeroApprovedDate?GetJobInvoiceDetailById(jobInvoiceDetailID,jobID):"2"==jobInvoiceDetailType&&""!=jobInvoiceDetailID&&""==xeroApprovedDate?loadAddTime(jobInvoiceDetailID):"3"==jobInvoiceDetailType&&""!=jobInvoiceDetailID&&PaymentPopup(jobInvoiceDetailID)})},fnServerParams:function(aoData){var table=$("#invoiceDetailListTable").DataTable();$("#chkAll").on("click",function(){var rows=table.rows({search:"applied"}).nodes();$('input[type="checkbox"]',rows).prop("checked",this.checked),chkCount=this.checked?$("#invoiceDetailListTable >tbody >tr").length:0}),$("#invoiceDetailListTable tbody").on("change",'input[type="checkbox"]',function(){this.checked?++chkCount==$("#invoiceDetailListTable >tbody >tr").length&&$("#chkAll").prop("checked",this.checked):(chkCount--,$("#chkAll").prop("checked",this.checked))})},initComplete:function(settings,json){}})}};return{loadData:function(invoiceID){pub.loadInvoiceDetailData(invoiceID)},loadInvoiceDetailGrid:function(invoiceID){pub.loadtable(invoiceID)}}}(),$(document).on("click","#AddInvoice",function(){jobInvoiceDetail.loadData("0")});var modelHeading="";function LoadPreApprovalOrConnection(PreApprovalsOrConnectionsId){$("#PreApprovalConnOrStcClicked").val(PreApprovalsOrConnectionsId),$("#preapprovalsAndConnectionContent").empty();var distributor=$("#JobInstallationDetails_DistributorID").val();$.ajax({url:urlApplyForPreApprovalAndConnection,type:"GET",data:{jobID:Model_JobId,preApprOrConne:PreApprovalsOrConnectionsId,distributorID:distributor},cache:!1,async:!0,success:function(Data){$("#preapprovalsAndConnectionmodal").modal({backdrop:"static",keyboard:!1}),$("#preapprovalsAndConnectionContent").html(Data)}})}function LoadStc(){$.ajax({url:url_STCJobPopup,type:"POST",data:{jobId:Model_JobId,IsSubmissionScreen:0},async:!1,success:function(Data){$("#STcBasicDetails").html(Data),$("#StcModal").modal({backdrop:"static",keyboard:!1})}})}initSample(),$(".date-pick").keydown(function(e){return 9==e.which}),ddaccordion.init({headerclass:"expandable",contentclass:"sidebar-list",revealtype:"click",collapseprev:!1,defaultexpanded:[],onemustopen:!1,animatedefault:!1,persiststate:!1,toggleclass:["","openheader"],togglehtml:["prefix","",""],animatespeed:"normal",oninit:function(headers,expandedindices){},onopenclose:function(header,index,state,isuseractivated){}}),Model_JobId>0?$('<input type="hidden">').attr({name:"Signature",value:Model_Signature,id:Model_Signature}).appendTo("form"):$("#btnJobPrint").hide(),$("#btnJobPrint").click(function(){var jobID=QueryId,url=urlPrint+jobID;window.open(url)}),$("#btnBack").click(function(){isParentInvoice?($("#jobTitle").html("Invoice"),$("#jobTitle1").html("<span>"+Model_Header+"</span>"),$(document).attr("title","GreenBot - Invoice"),$("#createJobView").hide(),$("#createJobNotes").hide(),$("#createJobMessage").hide(),$("#history").hide(),$(".assign").hide(),IsLast=!1,pageIndex=1,$("#invoice").load(urlGetJobInvoice),$("#invoice").show(),$("#EmailConversation").hide(),$("#invoiceDetail").css("display","none"),setTimeout(function(){loadInvoice()},1500)):window.location.href=urlIndex}),$("#date-pick, #date-pick1, .date-pick").datepicker({format:GetDateFormat,autoclose:!0}).on("change",function(){$(this).valid()}),modelHeading=Model_Header,$("#BasicDetails_strSoldByDate").keydown(function(e){return 9==e.which}),$("#date-pick, #date-pick1, .date-pick").datepicker({format:GetDateFormat,autoclose:!0}).on("change",function(){$(this).valid()}),$(".date-pick").keydown(function(e){return 9==e.which});