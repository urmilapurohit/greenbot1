function uploadPhotoAfterWarning(){var e=$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").add($("#headingReference").find("input:checked")).add($(".defaultPanel:checked")),t=!1;return t=$("#headingReference").find("input:checked").length>0,isDefault=$(".defaultPanel:checked").length>0,UploadData.cId=t||isDefault?"":e.data("cid"),UploadData.isRef=t,UploadData.isDefault=isDefault,UploadData.jobScId=t||isDefault?"":e.data("jobscid"),UploadData.Type=isDefault?e.data("type"):"",UploadData.PdfLocationId=e.data("loc"),UploadData.ClassTypeId=e.data("ct"),UploadData.PdfName=e.data("nm"),$("#uploadBtnPhoto").data().blueimpFileupload.options.formData=getData(),document.getElementById("uploadBtnPhoto").click(),$("#popuponuploadphoto").modal("toggle"),!1}function MakeDefaultFolderAsDefaultSubmission(){var e="<span class=submission>STC Submission <i class='sprite-img submission-icon'></i></span>";$("#divVisitList").find("#pnlMainDefault").find(".visitParent").prepend(e)}function ViewPhoto(e,t){e=uploadPath+e,logoWidthPhoto=0,logoHeightPhoto=0,$("#loading-image").css("display",""),$("#imgSlide").attr("src",e).load(function(){logoWidthPhoto=this.width,logoHeightPhoto=this.height,$("#mdlSlideShow").modal(),$("#loading-image").css("display","none")}),$("#mdlSlideShow").unbind("error"),$("#mdlSlideShow").attr("src",e).error(function(){alert("Image does not exist."),$("#loading-image").css("display","none")}),t?($("#mdlSlideShow").find("#btnPrev").hide(),$("#mdlSlideShow").find("#btnNext").hide()):($("#mdlSlideShow").find("#btnPrev").show(),$("#mdlSlideShow").find("#btnNext").show())}function setPreNextButtons(e,t,o){ViewPhoto(o),$("#hdrFileName").text(o.split("\\").slice(o.split("\\").length-1)),$("#btnPrev,#btnNext").removeAttr("disabled"),e>=t?$("#btnNext").attr("disabled","disabled"):0==e?$("#btnPrev").attr("disabled","disabled"):$("#btnPrev,#btnNext").removeAttr("disabled"),0==e&&0==t&&$("#btnPrev,#btnNext").attr("disabled","disabled")}function getData(){return{JobId:jobid,UserId:USERID,folder:UploadData.cId,isRef:UploadData.isRef,jobScId:UploadData.jobScId,IsDefault:UploadData.isDefault,ClassType:UploadData.Type,PdfLocationId:UploadData.PdfLocationId,ClassTypeId:UploadData.ClassTypeId,PdfName:UploadData.PdfName,IsAllowAccesstoUploadGPSPhoto:isAllowAccesstoUploadGPSPhoto}}function downloadAllAsZipForTabular(e){var t=$("[id*=pnlMain]"),o={},a=[];o.vclid=[],o.vsid=[],$.each(t,function(t,n){var i={};i.pl=[];var s=$(this).find("[id*=accordion]").children();i.id=$(this).find(".panel-heading").find("a").data("name"),$.each(s,function(t,a){var n={p:[],s:[]};n.fn=$(this).find(".panel-heading").find("a").data("name"),$.each(0==e?$(this).find(".panel-body").find("input[type=checkbox]:checked"):$(this).find(".panel-body").find("input[type=checkbox]"),function(e,t){$(this).parent().data("vclid")&&(n.p.push($(this).parent().data("vclid")),o.vclid.push($(this).parent().data("vclid"))),$(this).parent().data("vsid")&&(n.s.push($(this).parent().data("vsid")),o.vsid.push($(this).parent().data("vsid")))}),n.s=n.s.join(","),n.p=n.p.join(","),(n.p.length||n.s.length)>0&&i.pl.push(n)}),i.pl.length>0&&0===e?a.push(i):1===e&&a.push(i)});var n=0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),i=(0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),[]);n.length>0&&$.each(n,function(e,t){i.push($(this).parent().data("vclid"))}),o.vp=a,o.rp=i.join(","),o.vclid=o.vclid.join(",")+","+o.rp,o.vsid=o.vsid.join(","),o.isDownloadAll=0!==e;$("#BasicDetails_RefNumber").val();return $(".submission-add > .visit-list-check").each(function(){$(this).is(":checked")||!1}),1==e&&!0,o.vp.length>0||o.rp.length>0?(showStayMsg=!1,window.location.href=urlDownloadJobPhotosAllTabular+"?jobid="+jobid+"&photos="+encodeURIComponent(JSON.stringify(o)),SearchHistory()):(showStayMsg=!0,alert("Please select photo first.")),!1}function downloadAllAsZip(e){var t=$("[id*=pnlMain]"),o={},a=[];o.vclid=[],o.vsid=[],$.each(t,function(t,n){var i={};i.pl=[];var s=$(this).find("[id*=ChecklistItmes]").children();i.id=$(this).find(".panel-heading").find("a").data("name"),$.each(s,function(t,a){var n={p:[],s:[]};n.fn=$(this).find(".panel-heading").find("a").data("name"),$.each(0==e?$(this).find(".panel-body").find("input[type=checkbox]:checked"):$(this).find(".panel-body").find("input[type=checkbox]"),function(e,t){$(this).parent().data("vclid")&&(n.p.push($(this).parent().data("vclid")),o.vclid.push($(this).parent().data("vclid"))),$(this).parent().data("vsid")&&(n.s.push($(this).parent().data("vsid")),o.vsid.push($(this).parent().data("vsid")))}),n.s=n.s.join(","),n.p=n.p.join(","),(n.p.length||n.s.length)>0&&i.pl.push(n)}),i.pl.length>0&&0===e?a.push(i):1===e&&a.push(i)});var n=0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),i=(0==e?$("#ulPreference").find("input[type=checkbox]:checked"):$("#ulPreference").find("input[type=checkbox]"),[]);n.length>0&&$.each(n,function(e,t){i.push($(this).parent().data("vclid"))}),o.vp=a,o.rp=i.join(","),o.vclid=o.vclid.join(",")+","+o.rp,o.vsid=o.vsid.join(","),o.isDownloadAll=0!==e;var s=$("#BasicDetails_RefNumber").val(),l=!0;return $(".submission-add > .visit-list-check").each(function(){$(this).is(":checked")||(l=!1)}),1==e&&(l=!0),o.vp.length>0||o.rp.length>0?(showStayMsg=!1,window.location.href=urlDownloadJobPhotos+"?jobid="+jobid+"&photos="+encodeURIComponent(JSON.stringify(o))+"&refno="+s+"&isall="+l,SearchHistory()):(showStayMsg=!0,alert("Please select photo first.")),!1}function lnkDwnld_click(){downloadAllAsZip(0)}function lnkDwnldAll_click(){downloadAllAsZipForTabular(1)}function uploadBtnPhoto_click(){var e=$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").add($("#headingReference").find("input:checked")).add($(".defaultPanel:checked")).add($(".headingReference:checked")),t=!1;return t=$(".headingReference:checked").length>0,isDefault=$(".defaultPanel:checked").length>0,1!=e.length?(alert("Please select one active parent."),!1):1!=e.data("ct")||"true"!=IsSPVRequired.toLowerCase()?(UploadData.cId=t||isDefault?"":e.data("cid"),UploadData.isRef=t,UploadData.isDefault=isDefault,UploadData.jobScId=t||isDefault?"":e.data("jobscid"),UploadData.Type=isDefault?e.data("type"):"",UploadData.PdfLocationId=e.data("loc"),UploadData.ClassTypeId=e.data("ct"),UploadData.PdfName=e.data("nm"),$("#uploadBtnPhoto").data().blueimpFileupload.options.formData=getData(),document.getElementById("uploadBtnPhoto").click(),!1):void $("#popuponuploadphoto").modal("toggle")}function lnkUncheck_click(){$("#divVisitList").find("input[type=checkbox]").removeAttr("checked")}function lnkDelete_click(){if(!confirm("Are you sure you want to delete these files?"))return!1;var e=$("#accordion").find(".panel-body").find("input[type=checkbox]:checked").closest("li"),t=[],o=[],n=[],i=$("#divVisitList").find(".deleteJobVisit").find("input[type=checkbox]:checked");$.each(i,function(e,t){n.push($(this).data("jobscid"))}),$.each(e,function(e,a){t.push($(this).data("vclid")),o.push($(this).data("vsid"))}),a=t.join(",");var s=o.join(","),l=n.join(",");$.ajax({url:urlDeleteCheckListPhotos,data:{checkListIds:a,sigIds:s,pdelete:l,jobId:jobid},contentType:"application/json",method:"get",success:function(t){var o=!1;if("true"==t.status&&("true"==t.isSPVRequired.toString()?ShowSPV():HideSPV()),"true"==t.status)return showMessageForJobPhoto("Photos has been deleted successfully.",!1),$.each(e,function(e,t){1==$(this).closest(".panel").closest(".collapse").closest(".panel").find(".visitParent").find(".submission").length&&(o=!0),$(this).closest(".panel").find(".totalCount").text(parseInt($(this).closest(".panel").find(".totalCount").text())-1),$(this).remove()}),o&&ReloadSTCModule(),i.closest(".panel").remove(),!1}})}function CheckRefAndDefaultPhotoStatus(){return $(".pdf-generated-get-details.ref:checked").length>0||$("#collapseAssetsInstallation").find(".panel .panel-heading .visit-list-check:checked").length>0}function showMessageForJobPhoto(e,t){$(".alert").hide();var o=t?"errorMsgRegionJobPhoto":"successMsgRegionJobPhoto",a=t?"successMsgRegionJobPhoto":"errorMsgRegionJobPhoto";$("#"+a).hide(),$("#"+o).html(closeButton+e),$("#"+o).show()}function loadMap(e=0){1==e?new google.maps.Map(document.getElementById("dMap")):new google.maps.Map(document.getElementById("dvMap")),directionsService=new google.maps.DirectionsService,new google.maps.places.SearchBox(document.getElementById("txtSource")),new google.maps.places.SearchBox(document.getElementById("txtDestination")),directionsDisplay=new google.maps.DirectionsRenderer({draggable:!1}),google.maps.event.addListener(directionsDisplay,"directions_changed",function(){directions=directionsDisplay.getDirections();var e=directions.routes[0].legs[0].distance.text,t=directions.routes[0].legs[0].duration.text,o=directions.routes[0].legs[0].start_address,a=directions.routes[0].legs[0].end_address,n=document.getElementById("dvDistance");n.innerHTML="",n.innerHTML+="Distance: "+e+"   ",n.innerHTML+="Duration:"+t,$("#txtSource").val(o),$("#txtDestination").val(a)})}function geocodeAddress(e,t=!1,o=!1){$("#errorMsgRegionMap").hide();var a=new google.maps.Geocoder;""==e.trim()?createMarker("Victoria , Australia",-37.4713,144.7852):a.geocode({address:e},function(a,n){var i=e.split(" "),s=[];if(null!=a&&null!=a[0].address_components&&a[0].address_components.length>0)for(var l=0;l<a[0].address_components.length;l++)s.push((a[0].address_components[l].long_name+",").toLowerCase());if(1==o&&null!=i[1]&&null!=i[1]&&null!=s&&null!=s&&(s.includes((i[1]+" "+i[2]).replace(",","").toLowerCase().trim()+",")?($("#errorMsgValidInstallationAddress").hide(),$("#installationAdd").css("color",""),installationAddressValidationFlag(!0)):($("#errorMsgValidInstallationAddress").html(closeButton+"Installation address does not match google street address."),$("#errorMsgValidInstallationAddress").show(),$("#installationAdd").css("color","Red"),installationAddressValidationFlag(!1))),1==t&&null!=i[1]&&null!=i[1]&&null!=s&&null!=s&&(s.includes((i[1]+" "+i[2]).replace(",","").toLowerCase().trim()+",")?($("#errorMsgValidOwnerAddress").hide(),$("#ownerAdd").css("color",""),OwnerAddressValidationFlag(!0)):($("#errorMsgValidOwnerAddress").html(closeButton+"Owner address does not match google street address."),$("#errorMsgValidOwnerAddress").show(),$("#ownerAdd").css("color","Red"),OwnerAddressValidationFlag(!1))),n==google.maps.GeocoderStatus.OK){var d=a[0].geometry.location,r=d.lat(),c=d.lng();createMarker(e,r,c)}else $("#errorMsgRegionMap").html(closeButton+"Invalid Destination Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852)})}function GetRoute(e=0){if($("#dvDistance").html(""),$("#errorMsgRegionMap").hide(),source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,""!=source&&""!=destination){var t=new google.maps.LatLng(51.508742,-.12085),o={zoom:4,center:t};map=1==e?new google.maps.Map(document.getElementById("dMap"),o):new google.maps.Map(document.getElementById("dvMap"),o),directionsDisplay.setMap(map);var a={origin:source,destination:destination,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(a,function(e,t){t==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(e):(createMarker(destination,25.2744,133.7751),$("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  are not in same country."),$("#errorMsgRegionMap").show())})}else $("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  address are  required"),$("#errorMsgRegionMap").show()}function GetLocation(){latitude="",longitude="",latitude1="",longitude1="",$("#dvDistance").html(""),$("#errorMsgRegionMap").hide(),locations=[],source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,geocoder=new google.maps.Geocoder,""!=source||""!=destination?(""!=source&&geocoder.geocode({address:source},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude=e[0].geometry.location.lat(),longitude=e[0].geometry.location.lng(),sourcedetail=[source,latitude,longitude],locations.push(sourcedetail),GetLocationOnMap(latitude,longitude)):($("#errorMsgRegionMap").html(closeButton+"Invalid source Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852))}),""!=destination&&geocoder.geocode({address:destination},function(e,t){t==google.maps.GeocoderStatus.OK?(latitude1=e[0].geometry.location.lat(),longitude1=e[0].geometry.location.lng(),destinationdetail=[destination,latitude1,longitude1],locations.push(destinationdetail),GetLocationOnMap(latitude1,longitude1)):($("#errorMsgRegionMap").html(closeButton+"Invalid Destination Address."),$("#errorMsgRegionMap").show(),createMarker("Victoria , Australia",-37.4713,144.7852))})):($("#errorMsgRegionMap").html(closeButton+"Source or Destination address  are  required"),$("#errorMsgRegionMap").show())}function getLatitudeLongitude(e,t){"undefined"!=typeof google&&(geocoder=new google.maps.Geocoder,geocoder&&geocoder.geocode({address:t},function(t,o){o==google.maps.GeocoderStatus.OK?e(t[0]):e(null)}))}function GetLocationOnMap(e,t){var o,a,n=new google.maps.LatLngBounds,i=new google.maps.InfoWindow,s=e,l=t,d=new google.maps.Map(document.getElementById("dMap"),{zoom:10,center:new google.maps.LatLng(s,l),mapTypeId:google.maps.MapTypeId.DRIVING});for(a=0;a<locations.length;a++)o=new google.maps.Marker({position:new google.maps.LatLng(locations[a][1],locations[a][2]),draggable:!1,map:d}),n.extend(o.position),google.maps.event.addListener(o,"click",function(e,t){return function(){i.setContent(locations[t][0]),i.open(d,e)}}(o,a));d.fitBounds(n)}function createMarker(e,t,o){var a=new google.maps.InfoWindow,n=new google.maps.LatLng(t,o),i=new google.maps.Map(document.getElementById("dMap"),{zoom:12,center:new google.maps.LatLng(t,o),mapTypeId:google.maps.MapTypeId.DRIVING}),s=(new google.maps.LatLngBounds,e),l=new google.maps.Marker({position:new google.maps.LatLng(t,o),center:n,map:i,draggable:!1});google.maps.event.addListener(l,"click",function(){a.setContent(s),a.open(i,l)})}function loadMapScript(e=0){var t,o=document.createElement("script");o.type="text/javascript",t=1!=e?JobMapKeyUrl+"&callback=mapsCallback":JobMapKeyUrl,t=t.toString().replace(/&amp;/g,"&"),o.src=t;var a=$('script[src="'+t+'"]').length;if(a<=0)o.readyState?o.onreadystatechange=function(){if(("loaded"==o.readyState||"complete"==o.readyState)&&(o.onreadystatechange=null,loadMap(e),1!=e))setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtDestinationAddForMap").attr("data-id"))},1e3)}:o.onload=function(){if(loadMap(e),1!=e)setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtDestinationAddForMap").attr("data-id"))},1e3)},document.body.appendChild(o);else if(1!=e)setTimeout(function(){1==ProjectSession_UserTypeId&&geocodeAddress($("#txtDestinationAddForMap").attr("data-id"))},1e3)}function showMap(e,t){$(".lb-close").click(),$("#txtSource").val(e+","+t),$("#txtDestination").val($("#txtDestinationAddForMap").attr("data-id")),loadMapScript(1),$("#distance").html(""),$("#errorMsgRegionMap").hide(),$("#pMap").modal({backdrop:"static",keyboard:!1}),setTimeout(function(){GetrouteWithMarkerWithoutRoute(1),createLine()},1e3)}function GetrouteWithMarkerWithoutRoute(e=0){if($("#distance").html(""),$("#errorMsgRegionMap").hide(),source=document.getElementById("txtSource").value,destination=document.getElementById("txtDestination").value,""!=source&&""!=destination){var t=new google.maps.LatLng(51.508742,-.12085),o={zoom:4,center:t};map=1==e?new google.maps.Map(document.getElementById("dMap"),o):new google.maps.Map(document.getElementById("dvMap"),o);var a,n=$("#lblLatitude").text(),i=$("#lblLongitude").text(),s=$("#txtSource").val().split(",")[0],l=$("#txtSource").val().split(",")[1],d=[[n,i],[s,l]];new google.maps.InfoWindow;for(a=0;a<d.length;a++)new google.maps.Marker({position:new google.maps.LatLng(d[a][0],d[a][1]),map:map})}else $("#errorMsgRegionMap").html(closeButton+" Both Source and Destination  address are  required"),$("#errorMsgRegionMap").show()}function createLine(){address=$("#txtSource").val(),address2=$("#txtDestination").val();var e,t=$("#lblLatitude").text(),o=$("#lblLongitude").text(),a=$("#txtSource").val().split(",")[0],n=$("#txtSource").val().split(",")[1],i=[];if(i.push(t),i.push(o),e=$("#txtSource").val().split(","),address2){i;var s=new google.maps.Polyline({path:[new google.maps.LatLng(t,o),new google.maps.LatLng(a,n)],strokeColor:"#FF5E56",strokeOpacity:.6,strokeWeight:5});location1=e,location2=i;var l=distance(location1[0],location1[1],location2[0],location2[1],"K");document.getElementById("distance").innerHTML+="Distance between installation address and captured photo location is "+l+" meters long<br>",s.setMap(map),plotMap(location1,location2),address=address2}else location1=convertLocationToLatLong($("#txtSource").val()),plotMap(location1)}function distance(e,t,o,a,n){if(e==o&&t==a)return 0;var i=Math.PI*e/180,s=Math.PI*o/180,l=t-a,d=Math.PI*l/180,r=Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos(d);return r>1&&(r=1),r=Math.acos(r),r=180*r/Math.PI,r=60*r*1.1515,"K"==n&&(r*=1.609344),r=Math.round(1e3*r),r}function convertLocationToLatLong(e){var t=e.split(",").map(function(e){return parseFloat(e)});return t}function GetAddress(){var e=$("#txtSource").val().split(",")[0],t=$("#txtSource").val().split(",")[1],o=new google.maps.LatLng(e,t),a=a=new google.maps.Geocoder;a.geocode({latLng:o},function(e,t){t==google.maps.GeocoderStatus.OK&&e[1]&&alert("Location: "+e[1].formatted_address)})}function plotMap(e,t){var o=new google.maps.LatLng(e[0],e[1]);if(t)var a=new google.maps.LatLng(t[0],t[1]);var n=new google.maps.LatLngBounds;n.extend(o),a&&n.extend(a),map.fitBounds(n),setZoom()}function setZoom(){google.maps.event.addListener(map,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(map,"bounds_changed",function(e){this.getZoom()>15&&1==this.initialZoom&&(this.setZoom(15),this.initialZoom=!1),google.maps.event.removeListener(zoomChangeBoundsListener)})}),map.initialZoom=!0}function LoadIsSPVRequired(){$.ajax({url:urlGetIsSPV,type:"GET",data:{jobId:jobId},dataType:"json",success:function(e){$("div.line-no").removeClass("verified"),$("div.line-no").removeClass("unverified"),$("div.line-no").removeClass("installationVerified"),$("div.line-no").removeClass("notverified"),$("#GlobalisAllowedSPV").val(e.GlobalisAllowedSPV),e.IsSPVRequired?IsSPVRequired="True":IsSPVRequired="False",$("#SerialNumberPanel").length>0?e.IsSPVRequired?(VerifyUnVerifySerialNumber(),"true"==$("#GlobalisAllowedSPV").val().toLowerCase()&&"True"==IsSPVRequired?$(".isSPVRequired").show():$(".isSPVRequired").hide()):($(".isSPVRequired").hide(),$("#SPVLabel").hide()):VerifyUnVerifySerialNumber()}})}function lnkIgnore200mtrRule_click(){$.ajax({type:"post",url:urlIgnore200mtrValidation,dataType:"json",data:{jobId:JobId},async:!1,success:function(e){e.status?(ReloadJobPhotoSection(JobId),setTimeout(function(){"1"==e.result&&(showMessageForJobPhoto("Successfully removed 200mtr validation rule.",!1),"True"==e.isSPVRequired.toString()||"true"==e.isSPVRequired.toString()?ShowSPV():HideSPV()),"2"==e.result&&showMessageForJobPhoto("Successfully removed 200mtr validation but there is from SCA/Global/Manufacturer leval spv has been off.",!0),"3"==e.result&&showMessageForJobPhoto("Successfully removed 200mtr validation but job panel must be one for do SPV product verification.",!0)},1e3)):showMessageForJobPhoto("Something went wrong in removing 200mtr validation.",!0)},error:function(e){alert("Failed to remove 200mtr validation rule."+e)}})}function restoreDeletedVisit(){var e=[];$.each($(".visitId .visit-list-check:checked"),function(){e.push($(this).val())});var t=e.join(",");$.ajax({url:urlrestoreDeletedVisit,method:"GET",data:{jobscId:t},cache:!1,async:!1,success:function(e){}})}function lnkDeletedCheckListitem_click(){$.get(urldeletedChecklist+jobid,function(e){$("#mdlChecklistItmesdata").empty(),$("#mdlChecklistItmesdata").append(e),$("#mdlChecklistItmes").modal({backdrop:"static",keyboard:!1})})}function HideSPV(){RemoveSPVRelatedClass(),$(".isSPVRequired").hide(),$("#SPVLabel").hide(),IsSPVRequired="False",$("#btnSPVProductVerification").hide(),$("#btnSPVProductVerificationErrorLog").hide()}function RemoveSPVRelatedClass(){$("div.line-no").removeClass("verified"),$("div.line-no").removeClass("unverified"),$("div.line-no").removeClass("installationVerified"),$("div.line-no").removeClass("notverified")}function ReloadJobPhotoSection1(e){$("#loading-image").show(),setTimeout(function(){$.get(urlreloadphoto+e,function(e){$("#loadallPhotos").empty(),$("#loadallPhotos").append(e.photoView),showMessageForJobPhoto("File has been restored successfully.",!1)})},500)}function fnLoadReferencePhotos(){$(".refPhotos").empty(),$.ajax({type:"GET",url:"/Job/LoadReferencePhotos",data:{JobID:JobId},dataType:"json",contenttype:"application/json; charset=utf-8",async:!0,success:function(e){$(".refPhotos").append(e.referencephotoView)},error:function(e){alert("error")}})}function fnLoadDefaultPhotos(){$(".defPhotos").empty(),$.ajax({type:"GET",url:"/Job/LoadDefaultPhotos",data:{JobID:JobId},dataType:"json",contenttype:"application/json; charset=utf-8",async:!0,success:function(e){$(".defPhotos").append(e.defaultphotoView)},error:function(e){alert("error")}}),fnLoadddlListPhotos()}function showLocationofPhoto(){var e=$("#showlocationofPhoto").attr("data-lat"),t=$("#showlocationofPhoto").attr("data-lon");showMap(e,t)}var logoWidthPhoto,logoHeightPhoto;$(document).ready(function(){window.mapsCallback=function(){getLatitudeLongitude(DisplayLatLonOfInstallationAdd,$("#dMap").html())},"True"==IsSPVInstallationVerified&&1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&"False"==isUploadPhotoAfterTrade&&$(".IsSPVinstallationVerified").css("display","none"),2!=ProjectSession_UserTypeId&&4!=ProjectSession_UserTypeId&&5!=ProjectSession_UserTypeId||10!=$("#STCStatusId").val()&&12!=$("#STCStatusId").val()&&14!=$("#STCStatusId").val()&&17!=$("#STCStatusId").val()&&$(".isdelete").css("display","none"),1!=ProjectSession_UserTypeId&&3!=ProjectSession_UserTypeId&&$(".AccessOnlyForFSAFCO").css("display","none")}),$("#btnYes").click(function(){uploadPhotoAfterWarning()}),$("#btnClosepopupboxUploadPhoto").click(function(){$("#popuponuploadphoto").modal("toggle")});var geocoder,map,location1,location2,address,address2,UploadData={},urlPhoto=BaseURL+"UploadReferencePhoto";$("#divVisitList .panel-heading input[type=checkbox]").change(function(){$(this).closest(".panel").find("[type=checkbox]").prop("checked",this.checked),$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length==$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]:checked").length?0!=$(this).closest("[id*=pnlMain]").find("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length&&$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").prop("checked","checked"):$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").removeAttr("checked")}),$(document).on("click",".navbar-collapse.in",function(e){$(e.target).is("a")&&"dropdown-toggle"!=$(e.target).attr("class")&&$(this).collapse("hide")}),$("#uploadBtnPhoto").fileupload({url:urlPhoto,dataType:"json",done:function(e,t){var o=[];o.length=0;var a=[];a.length=0;var n=[];n.length=0;for(var i=UploadData.isRef?$("#ulPreference"):UploadData.isDefault?$("#pnlMainDefault").find(".defaultPanel:checked").closest(".panel").find("ul"):$("#divVisitList").find('[data-IsDeleted="False"]').find(".parentInput:checked").closest(".panel").find("ul"),s=0,l=0;l<t.result.uploadStatus.length;l++){var d=t.result.uploadStatus[l].Path,r=d,c=uploadPath+r,u="viewimgonPage('"+c+"','"+t.result.uploadStatus[l].AttachmentID+"')";$("#ddlviewphotosName").append($("<option></option>").val(c).attr("data-vclid",t.result.uploadStatus[l].AttachmentID).html(t.result.uploadStatus[l].FileName));var p="",h="";if(1==t.result.uploadStatus[l].Status){p=t.result.uploadStatus[l].latitude>0||t.result.uploadStatus[l].longitude>0?"with-location":"",h="False"==t.result.uploadStatus[l].isUnderInstallationArea?"with-IsUnderInstallationArea":"";var g=$("<li/>").attr("data-path",r).attr("data-vclid",t.result.uploadStatus[l].AttachmentID).attr("role","button").appendTo(i),f=($("<input/>").attr("type","checkbox").addClass("visit-list-check").appendTo(g),$("<a/>").addClass(p).addClass(h).attr("data-lat",t.result.uploadStatus[l].latitude).attr("data-lon",t.result.uploadStatus[l].longitude).attr("data-isunderinstallationarea",t.result.uploadStatus[l].isUnderInstallationArea).attr("data-date",t.result.uploadStatus[l].createdDate).attr("data-PhotoTypeId",t.result.PhotoTypeId).attr("title"," ").attr("onclick",u).text(" "+t.result.uploadStatus[l].FileName).appendTo(g));$("<span></span>").appendTo(f);s++,SearchHistory()}$("#ulPreference").children("li").length>1&&$("#liNoData").length>0&&$("#liNoData").remove(),0==t.result.uploadStatus[l].Status&&"NotImage"==t.result.uploadStatus[l].Message?a.push(t.result.uploadStatus[l].FileName):0==t.result.uploadStatus[l].Status&&"BigName"==t.result.uploadStatus[l].Message?n.push(t.result.uploadStatus[l].FileName):0==t.result.uploadStatus[l].Status&&o.push(t.result.uploadStatus[l].FileName)}i.closest(".panel").find(".totalCount").text(parseInt(i.closest(".panel").find(".totalCount").text())+s),a.length>0&&showMessageForJobPhoto(a.length+" Uploaded file is not .jpg , .jpeg or .png extension.",!0),o.length>0&&showMessageForJobPhoto(o.length+" File has not been uploaded.",!0),n.length>0&&showMessageForJobPhoto(n.length+" Uploaded filename is too big.",!0),0==n.length&&0==o.length&&0==a.length&&(showMessageForJobPhoto("File has been uploaded successfully.",!1),1==t.result.isSPVRequired?ShowSPV():HideSPV()),1==$(i).closest(".panel").closest(".collapse").closest(".panel").find(".visitParent").find(".submission").length&&ReloadSTCModule(),$("#loading-image").show(),setTimeout(function(){$("#loading-image").hide()},500)},progressall:function(e,t){},singleFileUploads:!1,send:function(e,t){var o=t.files[0].type.split("/"),a=o[0];if(1==t.files.length)for(var n=0;n<t.files.length;n++){if(t.files[n].name.length>50)return showMessageForJobPhoto("Please upload small filename.",!0),!1;if(CheckSpecialCharInFileName(t.files[n].name))return showMessageForJobPhoto("Please upload file that not conatain <> ^ [] .",!0),!1}if(t.files.length>1)for(n=0;n<t.files.length;n++){if(t.files[n].size>parseInt(MaxImageSize))return showMessageForJobPhoto(" "+t.files[n].name+" Maximum file size limit exceeded. Please upload a file smaller  than "+maxsize+"MB",!0),!1;if(CheckSpecialCharInFileName(t.files[n].name))return showMessageForJobPhoto("Please upload file that not conatain <> ^ [] .",!0),!1}else if(t.files[0].size>parseInt(MaxImageSize))return showMessageForJobPhoto("Maximum  file size limit exceeded.Please upload a  file smaller than "+maxsize+"MB",!0),!1;if(1==t.files.length){var i=t.files[0].name.toLowerCase().split(".").length>0?t.files[0].name.toLowerCase().split(".")[t.files[0].name.toLowerCase().split(".").length-1]:"";if("image"!=a&&"heic"!=i)return showMessageForJobPhoto("Please upload a file with .jpg , .jpeg or .png extension.",!0),!1}return $(".alert").hide(),$("#errorMsgRegion").html(""),$("#errorMsgRegion").hide(),$('<input type="hidden">').attr({name:"Guid",value:USERID,id:USERID}).appendTo("form"),!0},formData:getData(),change:function(e,t){$("#uploadFile").val("C:\\fakepath\\"+t.files[0].name)}}).prop("disabled",!$.support.fileInput),$("#accordion .panel-body").find("input[type=checkbox]").change(function(){this.checked?$(this).closest(".panel-body").find("input[type=checkbox]").length==$(this).closest(".panel-body").find("input[type=checkbox]:checked").length&&($(this).closest(".panel").find(".panel-heading").find("[type=checkbox]").prop("checked","checked"),$(this).closest("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]").length==$(this).closest("[id*=accordion]").find(".panel-heading").find("input[type=checkbox]:checked").length&&$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").prop("checked","checked")):($(this).closest(".panel").find(".panel-heading").find("[type=checkbox]").removeAttr("checked"),$(this).closest("[id*=pnlMain]").find("[id*=headingAssets]").find("[type=checkbox]").removeAttr("checked"))}),$("#divVisitList .panel-heading input[type=checkbox]").change(function(){var e=$(".visitId").find(".visit-list-check:checked").add();"True"==e.data("isdeleted")?$("#restoreDeletedVisit").show():1!=e.length&&$("#restoreDeletedVisit").hide()}),$("#restorebtn").click(function(){var e=[],t=$(".restore").find(".visit-list-check:checked").add(),o=t.data("jobscid"),a=t.data("cid"),n=$(".restore-photo").find(".visit-list-check:checked").add();if(1!=n.length)alert("Please select one Check list Item.");else{$.each($(".photo .visit-list-check:checked"),function(){e.push($(this).val())});var i=e.join(",");a=null!=a?a:n.data("cid");var s=n.data("ct"),l=!1,d=!1;"Default_Photo_Serial"!=a&&"Default_Photo_installation"!=a||(s=n.data("type"),l=!0,a=null),"Reference_Photo"==a&&(d=!0,a=null),urlRestoreData=urlRestoreDataforReferenceAndDefault+i+"&jobid="+jobId+"&jobscId="+o+"&vclId="+a+"&type="+s+"&isReference="+d+"&isDefault="+l,$("#restoreChecklistItmes").modal("hide"),$.ajax({url:urlRestoreData,method:"GET",cache:!1,async:!1,success:function(e){e?($("#mdlChecklistItmesdata").load(urldeletedChecklist+jobid),ReloadJobPhotoSection1(jobid),$("#mdlChecklistItmes").modal("show"),showMessageForJobPhoto("File has been restored successfully.",!1)):$("#mdlChecklistItmes").modal("show")}})}}),$("#cancelbtn").click(function(){$("#restoreChecklistItmes").modal("hide"),$("#mdlChecklistItmes").modal("show")}),$("#mdlcloseclitems").click(function(){$("#mdlChecklistItmes").modal("hide")}),$("#showlocationofPhoto").click(function(){var e=$(this).attr("data-lat"),t=$(this).attr("data-lon");showMap(e,t)});