function SaveGlobalPricingTerm(){ValidateForm()&&("Save"==$("#btnGlobalPricing").val()?$.ajax({type:"POST",url:SaveGlobalBillableTermURL,data:{Id:0,TermName:$("#txtTermName").val().trim(),TermCode:$("#ddlTermCode").val(),TermDescription:$("#txtTermDescription").val().trim(),GlobalPrice:$("#txtGlobalPrice").val(),IsGlobalGST:$("#IsGlobalGST").is(":checked"),CreatedBy:ProjectSessionLoggedInUserId,CreatedDate:Date.now,BillerCode:" "},success:function(e){ClearForm(),DrawSAASPricingGrid(),1==e.OutPutValue?alert("Global term settings saved successfully."):alert("Cannot update global term Settings as same combination is already exists!")}}):$.ajax({type:"POST",url:SaveGlobalBillableTermURL,data:{Id:$("#hdnglobalpriceId").val(),OldGlobalPrice:$("#hdnoldglobalprice").val(),TermName:$("#txtTermName").val().trim(),TermCode:$("#ddlTermCode").val(),TermDescription:$("#txtTermDescription").val().trim(),GlobalPrice:$("#txtGlobalPrice").val(),IsGlobalGST:$("#IsGlobalGST").is(":checked"),CreatedBy:ProjectSessionLoggedInUserId,CreatedDate:Date.now,BillerCode:$("#hdnbillercode").val()},success:function(e){ClearForm(),DrawSAASPricingGrid(),3==e.OutPutValue?alert("Cannot update global term as same term combination already exists!"):alert("Global term settings updated successfully.")}}))}function ClearForm(){$("#hdnglobalpriceId").val(""),$("#txtTermName").val(""),$("#ddlTermCode").val(0),$("#txtTermDescription").val(""),$("#txtGlobalPrice").val(""),$("#IsGlobalGST").prop("checked",!1),$("#btnGlobalPricing").val("Save"),$("#popupcreatenewbilling").modal("hide")}function ValidateForm(){return""==$("#txtTermName").val()?(alert("Please enter term name."),!1):"0"==$("#ddlTermCode").val()?(alert("Please enter term code."),!1):""==$("#txtTermDescription").val()?(alert("Please enter term description."),!1):""!=$("#txtGlobalPrice").val()||(alert("Please enter global price."),!1)}function EditGlobalPrice(e,a,t,r,l,i,o){Glbl_TermCode=r,Glbl_Price=i,Glbl_Description=l,$("#hdnbillercode").val(a),$("#hdnoldglobalprice").val(i),$("#btnSaveGlobalPricing").css("display","inline-block"),$("#hdnglobalpriceId").val(e),$("#txtTermName").val(t),$("#ddlTermCode").val(r),$("#txtTermDescription").val(l),$("#txtGlobalPrice").val(i),"true"==o?$("#IsGlobalGST").prop("checked",!0):$("#IsGlobalGST").prop("checked",!1),$("#popupcreatenewbilling").modal({backdrop:"static",keyboard:!1}),$("#btnGlobalPricing").val("Update")}function DrawSAASPricingGrid(){$.fn.DataTable.isDataTable("#datatable")&&$("#datatable").DataTable().destroy(),$("#datatable tbody").empty(),$("#datatable").DataTable({destory:!0,retrieve:!0,processing:!0,serverSide:!0,autoWidth:!1,iDisplayLength:10,lengthMenu:PageSize,language:{sLengthMenu:"Page Size: _MENU_"},columns:[{data:"Id",visible:!1},{data:"BillerCode"},{data:"TermName",width:"16%"},{data:"TermCode"},{data:"TermDescription"},{data:"GlobalPrice",render:function(e,a,t,r){return t.GlobalPrice.toFixed(2)}},{data:"IsGlobalGST",render:function(e,a,t,r){return e?"Yes":"No"}},{data:"CreatedByName"},{data:"CreatedDate",render:function(e,a,t,r){return ConvertToDateWithFormat(e,DateFormat)}},{data:"Id",width:"8%",render:function(e,a,t,r){var l="";if(1==t.isEnable){imgEdit="background:url(../Images/edit-icon.png) no-repeat center; text-decoration:none;";var i="javascript:EditGlobalPrice('"+t.Id+"','"+t.BillerCode+"', '"+t.TermName+"','"+t.TermCode+"','"+t.TermDescription+"','"+t.GlobalPrice.toFixed(2)+"','"+t.IsGlobalGST+"')";l+='&nbsp;&nbsp;<a href="'+i+'" class="action edit" style="'+imgEdit+'" title="Edit">&nbsp; &nbsp; &nbsp; &nbsp;</a>',imgdelete="background:url(../Images/delete-icon.png) no-repeat center; text-decoration:none; margin-left: 10px;";var o="javascript:DeleteBillableTerm('"+t.Id+"','"+t.BillerCode+"')";l+='<a href="'+o+'" class="action delete" style="'+imgdelete+'" title="Delete">&nbsp; &nbsp; &nbsp; &nbsp;</a>',imghistory="background:url(../Images/-icontest.png) no-repeat center; text-decoration:none; margin-left: 10px;";var n="javascript:ViewBillingTermHistory('"+t.BillerCode+"')";l+='<a href="'+n+'" class="action delete" style="'+imghistory+'" title="History">&nbsp; &nbsp; &nbsp; &nbsp;</a>'}else{imgRestore="background:url(../Images/ic-reset.png) no-repeat center; text-decoration:none; margin-left: 10px;";var s="javascript:restoreBillableTerm('"+t.Id+"','"+t.BillerCode+"')";l+='<a href="'+s+'" class="action delete" style="'+imgRestore+'" title="Restore">&nbsp; &nbsp; &nbsp; &nbsp;</a>',imghistory="background:url(../Images/-icontest.png) no-repeat center; text-decoration:none; margin-left: 10px;";n="javascript:ViewBillingTermHistory('"+t.BillerCode+"')";l+='<a href="'+n+'" class="action delete" style="'+imghistory+'" title="History">&nbsp; &nbsp; &nbsp; &nbsp;</a>'}return l},orderable:!1}],dom:"<<'table-responsive tbfix't><'paging grid-bottom prevar'p><'bottom'l><'clear'>>",createdRow:function(e,a,t){0==a.IsEnable&&$("td",e).css("background-color","#D2D2D2")},bServerSide:!0,sAjaxSource:urlGetGlobalPricingList,fnDrawCallback:function(){1==$("#chkAll").prop("checked")?chkCount=$("#datatable >tbody >tr").length:chkCount=0,$("#datatable_wrapper").find(".bottom").find(".dataTables_paginate").remove(),$(".paging a.previous").html("&nbsp"),$(".paging a.next").html("&nbsp"),$(".grid-bottom span:first").attr("id","spanMain"),$("#spanMain span").html(""),$(".ellipsis").html("..."),$(".paging").find("span").length>=1?$("#datatable_length").show():$("#datatable").find("tr").length>11?$("#datatable_length").show():$("#datatable_length").hide();var e=$("#datatable").DataTable(),a=e.page.info();0==a.recordsTotal?document.getElementById("numRecords").innerHTML="<b>0</b>  of  <b>"+a.recordsTotal+"</b> Billable Term(s) found":document.getElementById("numRecords").innerHTML="<b>"+$("#datatable >tbody >tr").length+"</b>  of  <b>"+a.recordsTotal+"</b> Billable Term(s) found"},fnServerParams:function(e){e.push({name:"TermName",value:$("#txtSearchTermName").val()}),e.push({name:"BillerCode",value:$("#txtSearchBillableCode").val()}),e.push({name:"TermDescription",value:$("#txtSearchTermDescription").val()}),e.push({name:"TermCode",value:$("#ddlSearchTermCode").val()})}})}function SearchBillableTerms(){$("#datatable").dataTable().fnDraw()}function ResetSearchFilters(){$("#txtSearchTermName").val(""),$("#txtSearchBillableCode").val(""),$("#txtSearchTermDescription").val(""),$("#ddlSearchTermCode").val(0),$("#datatable").dataTable().fnDraw()}function ViewBillingTermHistory(e){$("#loading-image").show(),setTimeout(function(){$.ajax({url:urlShowHistory,type:"GET",data:{BillerCode:e},cache:!1,async:!1,success:function(e){window.onbeforeunload=null,$("#JobHistoryOfJob").html($.parseHTML(e)),$("#divHistoryList li").length>=6?$("#historyList").css("height",300):$("#divHistoryList li").length>=2&&$("#historyList").css("height",200),$("#JobHistory").modal({backdrop:"static",keyboard:!1})}}),$("#loading-image").hide()},10)}function tagandsearchfilter(){var e=0,a="0",t="@@"+a,r=$("#JobHistorySearch").val();if("0"==a?$("#divCustom .history-box").each(function(){$(this).text().search(new RegExp(r,"i"))<0?$(this).hide():($(this).show(),$("#norecords").empty(),e++)}):$("#divCustom .history-box").each(function(){$(this).text().search(new RegExp(t,"i"))<0||$(this).text().search(new RegExp(r,"i"))<0?$(this).hide():($(this).show(),$("#norecords").empty(),e++)}),e>0)$(".history-box").css("border-top","1px solid #e3e3e3");else{$("#norecords").empty();var l="<div style='text-align:center;font-size:24px;margin-top:120px'>No Record(s) Found.</div>";$("#norecords").append(l)}}function DeleteBillableTerm(e,a){$.ajax({type:"POST",url:urlDeleteBillableTermByID,data:{Id:e,BillerCode:a},success:function(e){alert("Billing Term Deleted Sucessfully."),DrawSAASPricingGrid()},error:function(e){alert("Error deleting data")}})}function restoreBillableTerm(e,a){$.ajax({type:"POST",url:urlRestoreBillableTerm,data:{Id:e,BillerCode:a},success:function(e){DrawSAASPricingGrid()},error:function(e){alert("Error restoring data")}})}$(document).ready(function(){DrawSAASPricingGrid()}),$("#btnCreateNewBilling").click(function(){$("#popupcreatenewbilling").modal({backdrop:"static",keyboard:!1})}),$("#popupcreatenewbillingclose").click(function(){ClearForm()}),$("#JobHistorySearch").on("keyup",function(){tagandsearchfilter()});